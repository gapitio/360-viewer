var app=function(){"use strict";function t(){}function e(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(e)}function n(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e,r,i){if(t){const n=a(t,e,r,i);return t[0](n)}}function a(t,e,r,i){return t[1]&&i?function(t,e){for(const r in e)t[r]=e[r];return t}(r.ctx.slice(),t[1](i(e))):r.ctx}function h(t,e,r,i,n,o,s){const h=function(t,e,r,i){if(t[2]&&i){const n=t[2](i(r));if(void 0===e.dirty)return n;if("object"==typeof n){const t=[],r=Math.max(e.dirty.length,n.length);for(let i=0;i<r;i+=1)t[i]=e.dirty[i]|n[i];return t}return e.dirty|n}return e.dirty}(e,i,n,o);if(h){const n=a(e,r,i,s);t.p(n,h)}}function u(t){return null==t?"":t}function c(t,e){t.appendChild(e)}function l(t,e,r){t.insertBefore(e,r||null)}function f(t){t.parentNode.removeChild(t)}function p(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function d(t){return document.createElement(t)}function v(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function _(t){return document.createTextNode(t)}function m(){return _(" ")}function y(){return _("")}function g(t,e,r,i){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r,i)}function M(t,e,r){null==r?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let b;function x(t){b=t}function E(t){(function(){if(!b)throw new Error("Function called outside component initialization");return b})().$$.on_mount.push(t)}const T=[],S=[],L=[],A=[],P=Promise.resolve();let C=!1;function R(t){L.push(t)}let z=!1;const O=new Set;function F(){if(!z){z=!0;do{for(let t=0;t<T.length;t+=1){const e=T[t];x(e),I(e.$$)}for(x(null),T.length=0;S.length;)S.pop()();for(let t=0;t<L.length;t+=1){const e=L[t];O.has(e)||(O.add(e),e())}L.length=0}while(T.length);for(;A.length;)A.pop()();C=!1,z=!1,O.clear()}}function I(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(R)}}const k=new Set;let H;function D(){H={r:0,c:[],p:H}}function B(){H.r||i(H.c),H=H.p}function N(t,e){t&&t.i&&(k.delete(t),t.i(e))}function q(t,e,r,i){if(t&&t.o){if(k.has(t))return;k.add(t),H.c.push((()=>{k.delete(t),i&&(r&&t.d(1),i())})),t.o(e)}}function j(t){t&&t.c()}function V(t,r,o){const{fragment:s,on_mount:a,on_destroy:h,after_update:u}=t.$$;s&&s.m(r,o),R((()=>{const r=a.map(e).filter(n);h?h.push(...r):i(r),t.$$.on_mount=[]})),u.forEach(R)}function X(t,e){const r=t.$$;null!==r.fragment&&(i(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function W(t,e){-1===t.$$.dirty[0]&&(T.push(t),C||(C=!0,P.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Y(e,n,o,s,a,h,u=[-1]){const c=b;x(e);const l=n.props||{},p=e.$$={fragment:null,ctx:null,props:h,update:t,not_equal:a,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let d=!1;if(p.ctx=o?o(e,l,((t,r,...i)=>{const n=i.length?i[0]:r;return p.ctx&&a(p.ctx[t],p.ctx[t]=n)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](n),d&&W(e,t)),r})):[],p.update(),d=!0,i(p.before_update),p.fragment=!!s&&s(p.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);p.fragment&&p.fragment.l(t),t.forEach(f)}else p.fragment&&p.fragment.c();n.intro&&N(e.$$.fragment),V(e,n.target,n.anchor),F()}x(c)}class G{$destroy(){X(this,1),this.$destroy=t}$on(t,e){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const $=t=>({}),U=t=>({}),K=t=>({}),Z=t=>({});function Q(t){let e,r,i,n,o,a,u,p,m,y;const g=t[5].type,b=s(g,t,t[4],Z),x=b||function(t){let e;return{c(){e=_(t[1])},m(t,r){l(t,e,r)},p(t,r){2&r&&w(e,t[1])},d(t){t&&f(e)}}}(t),E=t[5].value,T=s(E,t,t[4],U),S=T||function(t){let e,r=`${t[0]} ${t[3][t[1]].unit}`;return{c(){e=_(r)},m(t,r){l(t,e,r)},p(t,i){3&i&&r!==(r=`${t[0]} ${t[3][t[1]].unit}`)&&w(e,r)},d(t){t&&f(e)}}}(t);return{c(){e=d("div"),r=v("svg"),i=v("g"),n=v("g"),o=v("rect"),a=v("rect"),p=v("text"),x&&x.c(),m=v("text"),S&&S.c(),M(o,"width","204"),M(o,"height","60"),M(o,"stroke","none"),M(a,"x","-2.5"),M(a,"y","-2.5"),M(a,"width","209"),M(a,"height","65"),M(a,"fill","none"),M(n,"transform","translate(657 552)"),M(n,"fill","#1b191c"),M(n,"stroke",u=t[3][t[1]].color),M(n,"stroke-width","5"),M(n,"opacity","0.88"),M(p,"class","type svelte-1dxqfiv"),M(p,"transform","translate(669 573)"),M(p,"fill","#d6d6d6"),M(p,"font-size","16"),M(p,"font-family","OpenSans, Open Sans"),M(p,"letter-spacing","0.01em"),M(m,"class","value"),M(m,"transform","translate(669 602)"),M(m,"fill","#fcfcfc"),M(m,"font-size","26"),M(m,"font-family","OpenSans-Semibold, Open Sans"),M(m,"font-weight","600"),M(i,"transform","translate(-652 -547)"),M(r,"xmlns","http://www.w3.org/2000/svg"),M(r,"width","100%"),M(r,"height","100%"),M(r,"viewBox","0 0 214 70"),M(e,"class","svelte-1dxqfiv")},m(s,h){l(s,e,h),c(e,r),c(r,i),c(i,n),c(n,o),c(n,a),c(i,p),x&&x.m(p,null),c(i,m),S&&S.m(m,null),t[6](e),y=!0},p(t,[e]){(!y||2&e&&u!==(u=t[3][t[1]].color))&&M(n,"stroke",u),b?b.p&&16&e&&h(b,g,t,t[4],e,K,Z):x&&x.p&&2&e&&x.p(t,e),T?T.p&&16&e&&h(T,E,t,t[4],e,$,U):S&&S.p&&3&e&&S.p(t,e)},i(t){y||(N(x,t),N(S,t),y=!0)},o(t){q(x,t),q(S,t),y=!1},d(r){r&&f(e),x&&x.d(r),S&&S.d(r),t[6](null)}}}function J(t,e,r){let{$$slots:i={},$$scope:n}=e,{type:o}=e,{value:s}=e;let a;return setInterval((()=>{r(0,s=(1e3*Math.random()).toFixed(2))}),1e3),t.$$set=t=>{"type"in t&&r(1,o=t.type),"value"in t&&r(0,s=t.value),"$$scope"in t&&r(4,n=t.$$scope)},[s,o,a,{flow:{color:"#7a36d2",unit:"L/h"},energy:{color:"#17C1B6",unit:"kWh"},power:{color:"#48ADE0",unit:"kW"},temperature:{color:"#D648E0",unit:"Â°C"}},n,i,function(t){S[t?"unshift":"push"]((()=>{a=t,r(2,a)}))}]}class tt extends G{constructor(t){super(),Y(this,t,J,Q,o,{type:1,value:0})}}function et(e){let r;return{c(){r=d("div"),r.textContent="Hello",M(r,"class","hotspot svelte-w2um5h")},m(t,i){l(t,r,i),e[1](r)},p:t,i:t,o:t,d(t){t&&f(r),e[1](null)}}}function rt(t,e,r){let i;return[i,function(t){S[t?"unshift":"push"]((()=>{i=t,r(0,i)}))}]}class it extends G{constructor(t){super(),Y(this,t,rt,et,o,{})}}function nt(e){let r,i,o;return{c(){r=d("div"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 95 95"><g id="Group_2" data-name="Group 2" transform="translate(-1406 -828)"><circle id="Ellipse_1" data-name="Ellipse 1" cx="47.5" cy="47.5" r="47.5" transform="translate(1406 828)" fill="#1b191c" opacity="0.88"></circle><path id="Path_1" data-name="Path 1" d="M846.277,2011.457l19.539-19.539,19.539,19.539" transform="translate(587.223 -1126.417)" fill="none" stroke="#f5f5f5" stroke-width="5"></path></g></svg>',M(r,"class","hotspot svelte-o72zk0")},m(t,s){l(t,r,s),i||(o=g(r,"click",(function(){n(e[0])&&e[0].apply(this,arguments)})),i=!0)},p(t,[r]){e=t},i:t,o:t,d(t){t&&f(r),i=!1,o()}}}function ot(t,e,r){let{func:i}=e;return t.$$set=t=>{"func"in t&&r(0,i=t.func)},[i]}class st extends G{constructor(t){super(),Y(this,t,ot,nt,o,{func:0})}}function at(){}at.prototype.addEventListener=function(t,e){var r=this.__events=this.__events||{},i=r[t]=r[t]||[];i.indexOf(e)<0&&i.push(e)},at.prototype.removeEventListener=function(t,e){var r=(this.__events=this.__events||{})[t];if(r){var i=r.indexOf(e);i>=0&&r.splice(i,1)}},at.prototype.emit=function(t,e){var r=this.__events=this.__events||{},i=r[t],n=Array.prototype.slice.call(arguments,1);if(i)for(var o=0;o<i.length;o++){var s=i[o];s.apply(this,n)}};var ht=function(t){for(var e in at.prototype)at.prototype.hasOwnProperty(e)&&(t.prototype[e]=at.prototype[e])};var ut="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()};function ct(t,e){this.fn=t,this.cb=e,this.cfn=null}function lt(t){this._queue=[],this._delay=t&&t.delay||0,this._paused=t&&!!t.paused||!1,this._currentTask=null,this._lastFinished=null}lt.prototype.length=function(){return this._queue.length},lt.prototype.push=function(t,e){var r=new ct(t,e),i=this._cancel.bind(this,r);return this._queue.push(r),this._next(),i},lt.prototype.pause=function(){this._paused||(this._paused=!0)},lt.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},lt.prototype._start=function(t){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=t;var e=this._finish.bind(this,t);if(t.cfn=t.fn(e),"function"!=typeof t.cfn)throw new Error("WorkQueue: function is not cancellable")},lt.prototype._finish=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask!==t)throw new Error("WorkQueue: called finish on wrong task");t.cb.apply(null,e),this._currentTask=null,this._lastFinished=ut(),this._next()},lt.prototype._cancel=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask===t)t.cfn.apply(null,e);else{var r=this._queue.indexOf(t);r>=0&&(this._queue.splice(r,1),t.cb.apply(null,e))}},lt.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var t=ut()-this._lastFinished,e=this._delay-t;if(e>0)return void setTimeout(this._next.bind(this),e)}var r=this._queue.shift();this._start(r)}};var ft=lt;var pt=function(t,e,r,i){var n,o,s,a;return i=i||{},n=null!=r&&null!=r.absoluteWidth?r.absoluteWidth/t:null!=r&&null!=r.relativeWidth?r.relativeWidth:1,o=r&&null!=r.absoluteHeight?r.absoluteHeight/e:null!=r&&null!=r.relativeHeight?r.relativeHeight:1,s=null!=r&&null!=r.absoluteX?r.absoluteX/t:null!=r&&null!=r.relativeX?r.relativeX:0,a=null!=r&&null!=r.absoluteY?r.absoluteY/e:null!=r&&null!=r.relativeY?r.relativeY:0,i.x=s,i.y=a,i.width=n,i.height=o,i};var dt=function(t){return function(e){var r,i;try{i=t()}catch(t){r=t}finally{r?e(r):e(null,i)}}};var vt=function(t){var e,r=!1;return function(){return r||(r=!0,e=t.apply(null,arguments)),e}};var _t=function(t){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var e=Array.prototype.slice.call(arguments,0),r=e[e.length-1]=vt(e[e.length-1]);function i(){r.apply(null,arguments)}return t.apply(null,e),i}};var mt=function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]=void 0)};function yt(){this._renderers={}}yt.prototype.set=function(t,e,r){this._renderers[t]||(this._renderers[t]={}),this._renderers[t][e]=r},yt.prototype.get=function(t,e){return this._renderers[t]&&this._renderers[t][e]||null};var gt=yt;function Mt(t,e){return t.cmp(e)}function wt(t,e){return-t.cmp(e)}function bt(t){this._progressive=!(!t||!t.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new ft,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new gt}ht(bt),bt.prototype.destroy=function(){this.removeAllLayers(),mt(this)},bt.prototype.registerRenderer=function(t,e,r){return this._rendererRegistry.set(t,e,r)},bt.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},bt.prototype.width=function(){return this._width},bt.prototype.height=function(){return this._height},bt.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},bt.prototype.setSize=function(t){this._width=t.width,this._height=t.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},bt.prototype.setSizeForType=function(t){throw new Error("Stage implementation must override setSizeForType")},bt.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},bt.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},bt.prototype.validateLayer=function(t){throw new Error("Stage implementation must override validateLayer")},bt.prototype.listLayers=function(){return[].concat(this._layers)},bt.prototype.hasLayer=function(t){return this._layers.indexOf(t)>=0},bt.prototype.addLayer=function(t,e){if(this._layers.indexOf(t)>=0)throw new Error("Layer already in stage");if(null==e&&(e=this._layers.length),e<0||e>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(t);var r=t.geometry().type,i=t.view().type,n=this._rendererRegistry.get(r,i);if(!n)throw new Error("No "+this.type+" renderer avaiable for "+r+" geometry and "+i+" view");var o=this.createRenderer(n);this._layers.splice(e,0,t),this._renderers.splice(e,0,o),t.addEventListener("viewChange",this._emitRenderInvalid),t.addEventListener("effectsChange",this._emitRenderInvalid),t.addEventListener("fixedLevelChange",this._emitRenderInvalid),t.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},bt.prototype.moveLayer=function(t,e){var r=this._layers.indexOf(t);if(r<0)throw new Error("No such layer in stage");if(e<0||e>=this._layers.length)throw new Error("Invalid layer position");t=this._layers.splice(r,1)[0];var i=this._renderers.splice(r,1)[0];this._layers.splice(e,0,t),this._renderers.splice(e,0,i),this._emitRenderInvalid()},bt.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in stage");var r=this._layers.splice(e,1)[0],i=this._renderers.splice(e,1)[0];this.destroyRenderer(i),r.removeEventListener("viewChange",this._emitRenderInvalid),r.removeEventListener("effectsChange",this._emitRenderInvalid),r.removeEventListener("fixedLevelChange",this._emitRenderInvalid),r.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},bt.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},bt.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},bt.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},bt.prototype.render=function(){var t,e,r,i=this._tilesToLoad,n=this._tilesToRender,o=!0,s=this._width,a=this._height,h=this._tmpRect,u=this._tmpSize;if(!(s<=0||a<=0)){for(this.startFrame(),t=0;t<this._layers.length;t++)this._layers[t].textureStore().startFrame();for(t=0;t<this._layers.length;t++){var c,l,f=this._layers[t],p=f.effects(),d=f.view(),v=f.textureStore(),_=this._renderers[t],m=this._layers.length-t;if(pt(s,a,p&&p.rect,h),!(h.width<=0||h.height<=0)){for(u.width=h.width*this._width,u.height=h.height*this._height,d.setSize(u),_.startLayer(f,h),r=this._collectTiles(f,v),e=0;e<i.length;e++)c=i[e],v.markTile(c);for(e=0;e<n.length;e++)c=n[e],l=v.texture(c),_.renderTile(c,l,f,m);f.emit("renderComplete",r),r||(o=!1),_.endLayer(f,h)}}for(t=0;t<this._layers.length;t++)this._layers[t].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",o)}},bt.prototype._collectTiles=function(t,e){var r=this._tilesToLoad,i=this._tilesToRender,n=this._tmpVisible;r.length=0,i.length=0,n.length=0,t.visibleTiles(n);for(var o=!0,s=0;s<n.length;s++){var a,h=n[s];this._collectTileToLoad(h),e.texture(h)?(a=!1,this._collectTileToRender(h)):(a=this._collectChildren(h,e),o=!1),this._collectParents(h,e,a)}return r.sort(Mt),i.sort(wt),o},bt.prototype._collectChildren=function(t,e){var r=this._tmpChildren,i=!0;do{if(r.length=0,!t.children(r))break;i=!1;for(var n=0;n<r.length;n++)t=r[n],e.texture(t)?(this._collectTileToLoad(t),this._collectTileToRender(t)):i=!0}while(i&&1===r.length);return i},bt.prototype._collectParents=function(t,e,r){for(var i=this._progressive;(i||r)&&null!=(t=t.parent());){if(r)if(e.texture(t))this._collectTileToRender(t),r=!1;else if(!this._progressive)continue;this._collectTileToLoad(t)||(i=!1)}return r},bt.prototype._collectTileToLoad=function(t){return this._collectTileIntoList(t,this._tilesToLoad)},bt.prototype._collectTileToRender=function(t){return this._collectTileIntoList(t,this._tilesToRender)},bt.prototype._collectTileIntoList=function(t,e){for(var r=!1,i=0;i<e.length;i++)if(t.equals(e[i])){r=!0;break}return r||e.push(t),!r},bt.prototype.createTexture=function(t,e,r){var i=this;var n=_t(dt((function(){return new i.TextureClass(i,t,e)})));return this._createTextureWorkQueue.push(n,(function(i,n){r(i,t,e,n)}))};var xt=bt,Et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Tt(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}function St(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})})),e}var Lt="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==Et?Et:null,At={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function Pt(t){var e=!1;for(var r in At)if(Lt[r]&&t instanceof Lt[r]){e=!0,this._widthProp=At[r][0],this._heightProp=At[r][1];break}if(!e)throw new Error("Unsupported pixel source");this._element=t}ht(Pt),Pt.prototype.destroy=function(){mt(this)},Pt.prototype.element=function(){return this._element},Pt.prototype.width=function(){return this._element[this._widthProp]},Pt.prototype.height=function(){return this._element[this._heightProp]},Pt.prototype.timestamp=function(){return 0},Pt.prototype.isDynamic=function(){return!1};var Ct=Pt;var Rt=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t};function zt(t){this.constructor.super_.apply(this,arguments),this.message=t}Rt(zt,Error);var Ot=zt,Ft={imageOrientation:"flipY",premultiplyAlpha:"premultiply",resizeQuality:"high"};function It(t){this._stage=t}It.prototype.loadImage=function(t,e,r){var i=this,n=new Image;n.crossOrigin="anonymous";var o=e&&e.x||0,s=e&&e.y||0,a=e&&e.width||1,h=e&&e.height||1;return r=vt(r),n.onload=function(){i._handleLoad(n,o,s,a,h,r)},n.onerror=function(){i._handleError(t,r)},n.src=t,function(){n.onload=n.onerror=null,n.src="",r.apply(null,arguments)}},It.prototype._handleLoad=function(t,e,r,i,n,o){if(0!==e||0!==r||1!==i||1!==n)if(e*=t.naturalWidth,r*=t.naturalHeight,i*=t.naturalWidth,n*=t.naturalHeight,Lt.createImageBitmap)Lt.createImageBitmap(t,e,r,i,n,Ft).then((function(t){o(null,new Ct(t))}));else{var s=document.createElement("canvas");s.width=i,s.height=n,s.getContext("2d").drawImage(t,e,r,i,n,0,0,i,n),o(null,new Ct(s))}else o(null,new Ct(t))},It.prototype._handleError=function(t,e){e(new Ot("Network error: "+t))};var kt=It,Ht=Tt((function(t,e){t.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=90)}({17:function(t,e,r){e.__esModule=!0,e.default=void 0;var i=r(18),n=function(){function t(){}return t.getFirstMatch=function(t,e){var r=e.match(t);return r&&r.length>0&&r[1]||""},t.getSecondMatch=function(t,e){var r=e.match(t);return r&&r.length>1&&r[2]||""},t.matchAndReturnConst=function(t,e,r){if(t.test(e))return r},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,r,i){void 0===i&&(i=!1);var n=t.getVersionPrecision(e),o=t.getVersionPrecision(r),s=Math.max(n,o),a=0,h=t.map([e,r],(function(e){var r=s-t.getVersionPrecision(e),i=e+new Array(r+1).join(".0");return t.map(i.split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));for(i&&(a=s-Math.min(n,o)),s-=1;s>=a;){if(h[0][s]>h[1][s])return 1;if(h[0][s]===h[1][s]){if(s===a)return 0;s-=1}else if(h[0][s]<h[1][s])return-1}},t.map=function(t,e){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(r=0;r<t.length;r+=1)i.push(e(t[r]));return i},t.find=function(t,e){var r,i;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(r=0,i=t.length;r<i;r+=1){var n=t[r];if(e(n,r))return n}},t.assign=function(t){for(var e,r,i=t,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[t].concat(o));var a=function(){var t=o[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){i[e]=t[e]}))};for(e=0,r=o.length;e<r;e+=1)a();return t},t.getBrowserAlias=function(t){return i.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return i.BROWSER_MAP[t]||""},t}();e.default=n,t.exports=e.default},18:function(t,e,r){e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},o=r(18);function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(){}var e,r,i;return t.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw new Error("UserAgent should be a string");return new n.default(t,e)},t.parse=function(t){return new n.default(t).getResult()},e=t,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(r=null)&&s(e.prototype,r),i&&s(e,i),t}();e.default=a,t.exports=e.default},91:function(t,e,r){e.__esModule=!0,e.default=void 0;var i=h(r(92)),n=h(r(93)),o=h(r(94)),s=h(r(95)),a=h(r(17));function h(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=a.default.find(i.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=a.default.find(n.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=a.default.find(o.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=a.default.find(s.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return a.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,r={},i=0,n={},o=0;if(Object.keys(t).forEach((function(e){var s=t[e];"string"==typeof s?(n[e]=s,o+=1):"object"==typeof s&&(r[e]=s,i+=1)})),i>0){var s=Object.keys(r),h=a.default.find(s,(function(t){return e.isOS(t)}));if(h){var u=this.satisfies(r[h]);if(void 0!==u)return u}var c=a.default.find(s,(function(t){return e.isPlatform(t)}));if(c){var l=this.satisfies(r[c]);if(void 0!==l)return l}}if(o>0){var f=Object.keys(n),p=a.default.find(f,(function(t){return e.isBrowser(t,!0)}));if(void 0!==p)return this.compareVersion(n[p])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var r=this.getBrowserName().toLowerCase(),i=t.toLowerCase(),n=a.default.getBrowserTypeByAlias(i);return e&&n&&(i=n.toLowerCase()),i===r},e.compareVersion=function(t){var e=[0],r=t,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===t[0]||"<"===t[0]?(r=t.substr(1),"="===t[1]?(i=!0,r=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?r=t.substr(1):"~"===t[0]&&(i=!0,r=t.substr(1)),e.indexOf(a.default.compareVersions(n,r,i))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some((function(t){return e.is(t)}))},t}();e.default=u,t.exports=e.default},92:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e={name:"Android Browser"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(e,t),version:n.default.getSecondMatch(e,t)}}}];e.default=s,t.exports=e.default},93:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:[/Roku\/DVP/],describe:function(t){var e=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:o.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=n.default.getWindowsVersionName(e);return{name:o.OS_MAP.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:o.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe:function(t){var e=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(e),i={name:o.OS_MAP.MacOS,version:e};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=n.default.getAndroidVersionName(e),i={name:o.OS_MAP.Android,version:e};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:o.OS_MAP.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||n.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:o.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.PlayStation4,version:e}}}];e.default=s,t.exports=e.default},94:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=n.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe:function(t){var e=n.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];e.default=s,t.exports=e.default},95:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:o.ENGINE_MAP.Blink};var e=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:o.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:o.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:o.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe:function(t){var e={name:o.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:o.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];e.default=s,t.exports=e.default}})}));var Dt=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t&&t.deviceXDPI&&t.logicalXDPI)return t.deviceXDPI/t.logicalXDPI;if(t&&t.systemXDPI&&t.logicalXDPI)return t.systemXDPI/t.logicalXDPI}return 1};var Bt=function(t){return 0==(t&t-1)};function Nt(t){for(var e=document.documentElement.style,r=["Moz","Webkit","Khtml","O","ms"],i=0;i<r.length;i++){var n=r[i]+(t[0].toUpperCase()+t.slice(1));if(n in e)return n}return t}function qt(t){var e=Nt(t);return function(t,r){return t.style[e]=r}}var jt=qt("transform"),Vt=qt("transformOrigin");var Xt={prefixProperty:Nt,getWithVendorPrefix:function(t){var e=Nt(t);return function(t){return t.style[e]}},setWithVendorPrefix:qt,setTransform:jt,setTransformOrigin:Vt,setNullTransform:function(t){jt(t,"translateZ(0)")},setNullTransformOrigin:function(t){Vt(t,"0 0 0")},setAbsolute:function(t){t.style.position="absolute"},setPixelPosition:function(t,e,r){t.style.left=e+"px",t.style.top=r+"px"},setPixelSize:function(t,e,r){t.style.width=e+"px",t.style.height=r+"px"},setNullSize:function(t){t.style.width=t.style.height=0},setFullSize:function(t){t.style.width=t.style.height="100%"},setOverflowHidden:function(t){t.style.overflow="hidden"},setOverflowVisible:function(t){t.style.overflow="visible"},setNoPointerEvents:function(t){t.style.pointerEvents="none"},setBlocking:function(t){t.style.backgroundColor="#000",t.style.opacity="0",t.style.filter="alpha(opacity=0)"}},Wt=Xt.setAbsolute,Yt=Xt.setFullSize,Gt=Ht.chrome;function $t(t){t=t||{};var e=this;this.constructor.super_.call(this,t),this._generateMipmaps=null!=t.generateMipmaps&&t.generateMipmaps,this._loader=new kt(this),this._domElement=document.createElement("canvas"),Wt(this._domElement),Yt(this._domElement),this._gl=function(t,e){var r={alpha:!0,premultipliedAlpha:!0,antialias:!(!e||!e.antialias),preserveDrawingBuffer:!(!e||!e.preserveDrawingBuffer)},i=t.getContext&&(t.getContext("webgl",r)||t.getContext("experimental-webgl",r));if(!i)throw new Error("Could not get WebGL context");return e.wrapContext&&(i=e.wrapContext(i)),i}(this._domElement,t),this._handleContextLoss=function(){e.emit("webglcontextlost"),e._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}function Ut(t,e,r){this._stage=t,this._gl=t._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(e,r)}Rt($t,xt),$t.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},$t.prototype.domElement=function(){return this._domElement},$t.prototype.webGlContext=function(){return this._gl},$t.prototype.setSizeForType=function(){var t=Dt();this._domElement.width=t*this._width,this._domElement.height=t*this._height},$t.prototype.loadImage=function(t,e,r){return this._loader.loadImage(t,e,r)},$t.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},$t.prototype.validateLayer=function(t){var e=t.geometry().maxTileSize(),r=this.maxTextureSize();if(e>r)throw new Error("Layer has level with tile size larger than maximum texture size ("+e+" vs. "+r+")")},$t.prototype.createRenderer=function(t){for(var e=this._rendererInstances,r=0;r<e.length;r++)if(e[r]instanceof t)return e[r];var i=new t(this._gl);return e.push(i),i},$t.prototype.destroyRenderer=function(t){var e=this._rendererInstances;if(this._renderers.indexOf(t)<0){t.destroy();var r=e.indexOf(t);r>=0&&e.splice(r,1)}},$t.prototype.startFrame=function(){var t=this._gl;if(!t)throw new Error("Bad WebGL context - maybe context was lost?");t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},$t.prototype.endFrame=function(){},$t.prototype.takeSnapshot=function(t){"object"==typeof t&&null!=t||(t={});var e=t.quality;if(void 0===e&&(e=75),"number"!=typeof e||e<0||e>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",e/100)},$t.type=$t.prototype.type="webgl",Ut.prototype.refresh=function(t,e){var r,i=this._gl,n=this._stage,o=e.timestamp();if(o!==this._timestamp){var s=e.element(),a=e.width(),h=e.height();if(a!==this._width||h!==this._height){var u=n.maxTextureSize();if(a>u)throw new Error("Texture width larger than max size ("+a+" vs. "+u+")");if(h>u)throw new Error("Texture height larger than max size ("+h+" vs. "+u+")");this._texture&&i.deleteTexture(r),r=this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s)}else r=this._texture,i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s instanceof HTMLVideoElement&&Gt?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s):i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,s);n._generateMipmaps&&Bt(a)&&Bt(h)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.generateMipmap(i.TEXTURE_2D)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null),this._timestamp=o,this._width=a,this._height=h}},Ut.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),mt(this)},$t.TextureClass=$t.prototype.TextureClass=Ut;var Kt=$t,Zt=1e-6,Qt="undefined"!=typeof Float32Array?Float32Array:Array,Jt=Math.random;var te=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ee=Object.freeze({__proto__:null,EPSILON:Zt,get ARRAY_TYPE(){return Qt},RANDOM:Jt,setMatrixArrayType:function(t){Qt=t},toRadian:function(t){return t*te},equals:function(t,e){return Math.abs(t-e)<=Zt*Math.max(1,Math.abs(t),Math.abs(e))}});function re(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*a+o*h,t[1]=n*a+s*h,t[2]=i*u+o*c,t[3]=n*u+s*c,t}function ie(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}var ne=re,oe=ie,se=Object.freeze({__proto__:null,create:function(){var t=new Qt(4);return Qt!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new Qt(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,r,i){var n=new Qt(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},set:function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},transpose:function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*o-n*i;return s?(s=1/s,t[0]=o*s,t[1]=-i*s,t[2]=-n*s,t[3]=r*s,t):null},adjoint:function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:re,rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+o*a,t[1]=n*h+s*a,t[2]=i*-a+o*h,t[3]=n*-a+s*h,t},scale:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1];return t[0]=i*a,t[1]=n*a,t[2]=o*h,t[3]=s*h,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:ie,exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=e[0],a=e[1],h=e[2],u=e[3];return Math.abs(r-s)<=Zt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=Zt*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=Zt*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-u)<=Zt*Math.max(1,Math.abs(o),Math.abs(u))},multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},mul:ne,sub:oe});function ae(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],c=r[1],l=r[2],f=r[3],p=r[4],d=r[5];return t[0]=i*u+o*c,t[1]=n*u+s*c,t[2]=i*l+o*f,t[3]=n*l+s*f,t[4]=i*p+o*d+a,t[5]=n*p+s*d+h,t}function he(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}var ue=ae,ce=he,le=Object.freeze({__proto__:null,create:function(){var t=new Qt(6);return Qt!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new Qt(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,r,i,n,o){var s=new Qt(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s[4]=n,s[5]=o,s},set:function(t,e,r,i,n,o,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=r*o-i*n;return h?(h=1/h,t[0]=o*h,t[1]=-i*h,t[2]=-n*h,t[3]=r*h,t[4]=(n*a-o*s)*h,t[5]=(i*s-r*a)*h,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:ae,rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=Math.sin(r),c=Math.cos(r);return t[0]=i*c+o*u,t[1]=n*c+s*u,t[2]=i*-u+o*c,t[3]=n*-u+s*c,t[4]=a,t[5]=h,t},scale:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i*u,t[1]=n*u,t[2]=o*c,t[3]=s*c,t[4]=a,t[5]=h,t},translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=i*u+o*c+a,t[5]=n*u+s*c+h,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},subtract:he,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=e[0],u=e[1],c=e[2],l=e[3],f=e[4],p=e[5];return Math.abs(r-h)<=Zt*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-u)<=Zt*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=Zt*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-l)<=Zt*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(s-f)<=Zt*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-p)<=Zt*Math.max(1,Math.abs(a),Math.abs(p))},mul:ue,sub:ce});function fe(){var t=new Qt(9);return Qt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function pe(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],p=r[1],d=r[2],v=r[3],_=r[4],m=r[5],y=r[6],g=r[7],M=r[8];return t[0]=f*i+p*s+d*u,t[1]=f*n+p*a+d*c,t[2]=f*o+p*h+d*l,t[3]=v*i+_*s+m*u,t[4]=v*n+_*a+m*c,t[5]=v*o+_*h+m*l,t[6]=y*i+g*s+M*u,t[7]=y*n+g*a+M*c,t[8]=y*o+g*h+M*l,t}function de(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}var ve=pe,_e=de,me=Object.freeze({__proto__:null,create:fe,fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new Qt(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,r,i,n,o,s,a,h){var u=new Qt(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=s,u[7]=a,u[8]=h,u},set:function(t,e,r,i,n,o,s,a,h,u){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=u,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=c*s-a*u,f=-c*o+a*h,p=u*o-s*h,d=r*l+i*f+n*p;return d?(d=1/d,t[0]=l*d,t[1]=(-c*i+n*u)*d,t[2]=(a*i-n*s)*d,t[3]=f*d,t[4]=(c*r-n*h)*d,t[5]=(-a*r+n*o)*d,t[6]=p*d,t[7]=(-u*r+i*h)*d,t[8]=(s*r-i*o)*d,t):null},adjoint:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-a*u,t[1]=n*u-i*c,t[2]=i*a-n*s,t[3]=a*h-o*c,t[4]=r*c-n*h,t[5]=n*o-r*a,t[6]=o*u-s*h,t[7]=i*h-r*u,t[8]=r*s-i*o,t},determinant:function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*(u*o-s*h)+r*(-u*n+s*a)+i*(h*n-o*a)},multiply:pe,translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=r[0],p=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=f*i+p*s+u,t[7]=f*n+p*a+c,t[8]=f*o+p*h+l,t},rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=Math.sin(r),p=Math.cos(r);return t[0]=p*i+f*s,t[1]=p*n+f*a,t[2]=p*o+f*h,t[3]=p*s-f*i,t[4]=p*a-f*n,t[5]=p*h-f*o,t[6]=u,t[7]=c,t[8]=l,t},scale:function(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,a=i+i,h=n+n,u=r*s,c=i*s,l=i*a,f=n*s,p=n*a,d=n*h,v=o*s,_=o*a,m=o*h;return t[0]=1-l-d,t[3]=c-m,t[6]=f+_,t[1]=c+m,t[4]=1-u-d,t[7]=p-v,t[2]=f-_,t[5]=p+v,t[8]=1-u-l,t},normalFromMat4:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],v=e[13],_=e[14],m=e[15],y=r*a-i*s,g=r*h-n*s,M=r*u-o*s,w=i*h-n*a,b=i*u-o*a,x=n*u-o*h,E=c*v-l*d,T=c*_-f*d,S=c*m-p*d,L=l*_-f*v,A=l*m-p*v,P=f*m-p*_,C=y*P-g*A+M*L+w*S-b*T+x*E;return C?(C=1/C,t[0]=(a*P-h*A+u*L)*C,t[1]=(h*S-s*P-u*T)*C,t[2]=(s*A-a*S+u*E)*C,t[3]=(n*A-i*P-o*L)*C,t[4]=(r*P-n*S+o*T)*C,t[5]=(i*S-r*A-o*E)*C,t[6]=(v*x-_*b+m*w)*C,t[7]=(_*M-d*x-m*g)*C,t[8]=(d*b-v*M+m*y)*C,t):null},projection:function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},subtract:de,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],c=t[8],l=e[0],f=e[1],p=e[2],d=e[3],v=e[4],_=e[5],m=e[6],y=e[7],g=e[8];return Math.abs(r-l)<=Zt*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-f)<=Zt*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-p)<=Zt*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-d)<=Zt*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-v)<=Zt*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-_)<=Zt*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(h-m)<=Zt*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-y)<=Zt*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-g)<=Zt*Math.max(1,Math.abs(c),Math.abs(g))},mul:ve,sub:_e});function ye(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ge(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],p=e[10],d=e[11],v=e[12],_=e[13],m=e[14],y=e[15],g=r[0],M=r[1],w=r[2],b=r[3];return t[0]=g*i+M*a+w*l+b*v,t[1]=g*n+M*h+w*f+b*_,t[2]=g*o+M*u+w*p+b*m,t[3]=g*s+M*c+w*d+b*y,g=r[4],M=r[5],w=r[6],b=r[7],t[4]=g*i+M*a+w*l+b*v,t[5]=g*n+M*h+w*f+b*_,t[6]=g*o+M*u+w*p+b*m,t[7]=g*s+M*c+w*d+b*y,g=r[8],M=r[9],w=r[10],b=r[11],t[8]=g*i+M*a+w*l+b*v,t[9]=g*n+M*h+w*f+b*_,t[10]=g*o+M*u+w*p+b*m,t[11]=g*s+M*c+w*d+b*y,g=r[12],M=r[13],w=r[14],b=r[15],t[12]=g*i+M*a+w*l+b*v,t[13]=g*n+M*h+w*f+b*_,t[14]=g*o+M*u+w*p+b*m,t[15]=g*s+M*c+w*d+b*y,t}function Me(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=i+i,h=n+n,u=o+o,c=i*a,l=i*h,f=i*u,p=n*h,d=n*u,v=o*u,_=s*a,m=s*h,y=s*u;return t[0]=1-(p+v),t[1]=l+y,t[2]=f-m,t[3]=0,t[4]=l-y,t[5]=1-(c+v),t[6]=d+_,t[7]=0,t[8]=f+m,t[9]=d-_,t[10]=1-(c+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function we(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function be(t,e){var r=e[0],i=e[1],n=e[2],o=e[4],s=e[5],a=e[6],h=e[8],u=e[9],c=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(o,s,a),t[2]=Math.hypot(h,u,c),t}function xe(t,e){var r=new Qt(3);be(r,e);var i=1/r[0],n=1/r[1],o=1/r[2],s=e[0]*i,a=e[1]*n,h=e[2]*o,u=e[4]*i,c=e[5]*n,l=e[6]*o,f=e[8]*i,p=e[9]*n,d=e[10]*o,v=s+c+d,_=0;return v>0?(_=2*Math.sqrt(v+1),t[3]=.25*_,t[0]=(l-p)/_,t[1]=(f-h)/_,t[2]=(a-u)/_):s>c&&s>d?(_=2*Math.sqrt(1+s-c-d),t[3]=(l-p)/_,t[0]=.25*_,t[1]=(a+u)/_,t[2]=(f+h)/_):c>d?(_=2*Math.sqrt(1+c-s-d),t[3]=(f-h)/_,t[0]=(a+u)/_,t[1]=.25*_,t[2]=(l+p)/_):(_=2*Math.sqrt(1+d-s-c),t[3]=(a-u)/_,t[0]=(f+h)/_,t[1]=(l+p)/_,t[2]=.25*_),t}function Ee(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}var Te=ge,Se=Ee,Le=Object.freeze({__proto__:null,create:function(){var t=new Qt(16);return Qt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var e=new Qt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,r,i,n,o,s,a,h,u,c,l,f,p,d,v){var _=new Qt(16);return _[0]=t,_[1]=e,_[2]=r,_[3]=i,_[4]=n,_[5]=o,_[6]=s,_[7]=a,_[8]=h,_[9]=u,_[10]=c,_[11]=l,_[12]=f,_[13]=p,_[14]=d,_[15]=v,_},set:function(t,e,r,i,n,o,s,a,h,u,c,l,f,p,d,v,_){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=u,t[9]=c,t[10]=l,t[11]=f,t[12]=p,t[13]=d,t[14]=v,t[15]=_,t},identity:ye,transpose:function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],v=e[13],_=e[14],m=e[15],y=r*a-i*s,g=r*h-n*s,M=r*u-o*s,w=i*h-n*a,b=i*u-o*a,x=n*u-o*h,E=c*v-l*d,T=c*_-f*d,S=c*m-p*d,L=l*_-f*v,A=l*m-p*v,P=f*m-p*_,C=y*P-g*A+M*L+w*S-b*T+x*E;return C?(C=1/C,t[0]=(a*P-h*A+u*L)*C,t[1]=(n*A-i*P-o*L)*C,t[2]=(v*x-_*b+m*w)*C,t[3]=(f*b-l*x-p*w)*C,t[4]=(h*S-s*P-u*T)*C,t[5]=(r*P-n*S+o*T)*C,t[6]=(_*M-d*x-m*g)*C,t[7]=(c*x-f*M+p*g)*C,t[8]=(s*A-a*S+u*E)*C,t[9]=(i*S-r*A-o*E)*C,t[10]=(d*b-v*M+m*y)*C,t[11]=(l*M-c*b-p*y)*C,t[12]=(a*T-s*L-h*E)*C,t[13]=(r*L-i*T+n*E)*C,t[14]=(v*g-d*w-_*y)*C,t[15]=(c*w-l*g+f*y)*C,t):null},adjoint:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],c=e[8],l=e[9],f=e[10],p=e[11],d=e[12],v=e[13],_=e[14],m=e[15];return t[0]=a*(f*m-p*_)-l*(h*m-u*_)+v*(h*p-u*f),t[1]=-(i*(f*m-p*_)-l*(n*m-o*_)+v*(n*p-o*f)),t[2]=i*(h*m-u*_)-a*(n*m-o*_)+v*(n*u-o*h),t[3]=-(i*(h*p-u*f)-a*(n*p-o*f)+l*(n*u-o*h)),t[4]=-(s*(f*m-p*_)-c*(h*m-u*_)+d*(h*p-u*f)),t[5]=r*(f*m-p*_)-c*(n*m-o*_)+d*(n*p-o*f),t[6]=-(r*(h*m-u*_)-s*(n*m-o*_)+d*(n*u-o*h)),t[7]=r*(h*p-u*f)-s*(n*p-o*f)+c*(n*u-o*h),t[8]=s*(l*m-p*v)-c*(a*m-u*v)+d*(a*p-u*l),t[9]=-(r*(l*m-p*v)-c*(i*m-o*v)+d*(i*p-o*l)),t[10]=r*(a*m-u*v)-s*(i*m-o*v)+d*(i*u-o*a),t[11]=-(r*(a*p-u*l)-s*(i*p-o*l)+c*(i*u-o*a)),t[12]=-(s*(l*_-f*v)-c*(a*_-h*v)+d*(a*f-h*l)),t[13]=r*(l*_-f*v)-c*(i*_-n*v)+d*(i*f-n*l),t[14]=-(r*(a*_-h*v)-s*(i*_-n*v)+d*(i*h-n*a)),t[15]=r*(a*f-h*l)-s*(i*f-n*l)+c*(i*h-n*a),t},determinant:function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8],c=t[9],l=t[10],f=t[11],p=t[12],d=t[13],v=t[14],_=t[15];return(e*s-r*o)*(l*_-f*v)-(e*a-i*o)*(c*_-f*d)+(e*h-n*o)*(c*v-l*d)+(r*a-i*s)*(u*_-f*p)-(r*h-n*s)*(u*v-l*p)+(i*h-n*a)*(u*d-c*p)},multiply:ge,translate:function(t,e,r){var i,n,o,s,a,h,u,c,l,f,p,d,v=r[0],_=r[1],m=r[2];return e===t?(t[12]=e[0]*v+e[4]*_+e[8]*m+e[12],t[13]=e[1]*v+e[5]*_+e[9]*m+e[13],t[14]=e[2]*v+e[6]*_+e[10]*m+e[14],t[15]=e[3]*v+e[7]*_+e[11]*m+e[15]):(i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=e[8],f=e[9],p=e[10],d=e[11],t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=f,t[10]=p,t[11]=d,t[12]=i*v+a*_+l*m+e[12],t[13]=n*v+h*_+f*m+e[13],t[14]=o*v+u*_+p*m+e[14],t[15]=s*v+c*_+d*m+e[15]),t},scale:function(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},rotate:function(t,e,r,i){var n,o,s,a,h,u,c,l,f,p,d,v,_,m,y,g,M,w,b,x,E,T,S,L,A=i[0],P=i[1],C=i[2],R=Math.hypot(A,P,C);return R<Zt?null:(A*=R=1/R,P*=R,C*=R,n=Math.sin(r),s=1-(o=Math.cos(r)),a=e[0],h=e[1],u=e[2],c=e[3],l=e[4],f=e[5],p=e[6],d=e[7],v=e[8],_=e[9],m=e[10],y=e[11],g=A*A*s+o,M=P*A*s+C*n,w=C*A*s-P*n,b=A*P*s-C*n,x=P*P*s+o,E=C*P*s+A*n,T=A*C*s+P*n,S=P*C*s-A*n,L=C*C*s+o,t[0]=a*g+l*M+v*w,t[1]=h*g+f*M+_*w,t[2]=u*g+p*M+m*w,t[3]=c*g+d*M+y*w,t[4]=a*b+l*x+v*E,t[5]=h*b+f*x+_*E,t[6]=u*b+p*x+m*E,t[7]=c*b+d*x+y*E,t[8]=a*T+l*S+v*L,t[9]=h*T+f*S+_*L,t[10]=u*T+p*S+m*L,t[11]=c*T+d*S+y*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+u*i,t[5]=s*n+c*i,t[6]=a*n+l*i,t[7]=h*n+f*i,t[8]=u*n-o*i,t[9]=c*n-s*i,t[10]=l*n-a*i,t[11]=f*n-h*i,t},rotateY:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-u*i,t[1]=s*n-c*i,t[2]=a*n-l*i,t[3]=h*n-f*i,t[8]=o*i+u*n,t[9]=s*i+c*n,t[10]=a*i+l*n,t[11]=h*i+f*n,t},rotateZ:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+u*i,t[1]=s*n+c*i,t[2]=a*n+l*i,t[3]=h*n+f*i,t[4]=u*n-o*i,t[5]=c*n-s*i,t[6]=l*n-a*i,t[7]=f*n-h*i,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,r){var i,n,o,s=r[0],a=r[1],h=r[2],u=Math.hypot(s,a,h);return u<Zt?null:(s*=u=1/u,a*=u,h*=u,i=Math.sin(e),o=1-(n=Math.cos(e)),t[0]=s*s*o+n,t[1]=a*s*o+h*i,t[2]=h*s*o-a*i,t[3]=0,t[4]=s*a*o-h*i,t[5]=a*a*o+n,t[6]=h*a*o+s*i,t[7]=0,t[8]=s*h*o+a*i,t[9]=a*h*o-s*i,t[10]=h*h*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:Me,fromQuat2:function(t,e){var r=new Qt(3),i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=i*i+n*n+o*o+s*s;return l>0?(r[0]=2*(a*s+c*i+h*o-u*n)/l,r[1]=2*(h*s+c*n+u*i-a*o)/l,r[2]=2*(u*s+c*o+a*n-h*i)/l):(r[0]=2*(a*s+c*i+h*o-u*n),r[1]=2*(h*s+c*n+u*i-a*o),r[2]=2*(u*s+c*o+a*n-h*i)),Me(t,e,r),t},getTranslation:we,getScaling:be,getRotation:xe,fromRotationTranslationScale:function(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=e[3],h=n+n,u=o+o,c=s+s,l=n*h,f=n*u,p=n*c,d=o*u,v=o*c,_=s*c,m=a*h,y=a*u,g=a*c,M=i[0],w=i[1],b=i[2];return t[0]=(1-(d+_))*M,t[1]=(f+g)*M,t[2]=(p-y)*M,t[3]=0,t[4]=(f-g)*w,t[5]=(1-(l+_))*w,t[6]=(v+m)*w,t[7]=0,t[8]=(p+y)*b,t[9]=(v-m)*b,t[10]=(1-(l+d))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,e,r,i,n){var o=e[0],s=e[1],a=e[2],h=e[3],u=o+o,c=s+s,l=a+a,f=o*u,p=o*c,d=o*l,v=s*c,_=s*l,m=a*l,y=h*u,g=h*c,M=h*l,w=i[0],b=i[1],x=i[2],E=n[0],T=n[1],S=n[2],L=(1-(v+m))*w,A=(p+M)*w,P=(d-g)*w,C=(p-M)*b,R=(1-(f+m))*b,z=(_+y)*b,O=(d+g)*x,F=(_-y)*x,I=(1-(f+v))*x;return t[0]=L,t[1]=A,t[2]=P,t[3]=0,t[4]=C,t[5]=R,t[6]=z,t[7]=0,t[8]=O,t[9]=F,t[10]=I,t[11]=0,t[12]=r[0]+E-(L*E+C*T+O*S),t[13]=r[1]+T-(A*E+R*T+F*S),t[14]=r[2]+S-(P*E+z*T+I*S),t[15]=1,t},fromQuat:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,a=i+i,h=n+n,u=r*s,c=i*s,l=i*a,f=n*s,p=n*a,d=n*h,v=o*s,_=o*a,m=o*h;return t[0]=1-l-d,t[1]=c+m,t[2]=f-_,t[3]=0,t[4]=c-m,t[5]=1-u-d,t[6]=p+v,t[7]=0,t[8]=f+_,t[9]=p-v,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,r,i,n,o,s){var a=1/(r-e),h=1/(n-i),u=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*h,t[10]=(s+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*u,t[15]=0,t},perspective:function(t,e,r,i,n){var o,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t},perspectiveFromFieldOfView:function(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+a),u=2/(n+o);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-a)*h*.5,t[9]=(n-o)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},ortho:function(t,e,r,i,n,o,s){var a=1/(e-r),h=1/(i-n),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*h,t[14]=(s+o)*u,t[15]=1,t},lookAt:function(t,e,r,i){var n,o,s,a,h,u,c,l,f,p,d=e[0],v=e[1],_=e[2],m=i[0],y=i[1],g=i[2],M=r[0],w=r[1],b=r[2];return Math.abs(d-M)<Zt&&Math.abs(v-w)<Zt&&Math.abs(_-b)<Zt?ye(t):(c=d-M,l=v-w,f=_-b,n=y*(f*=p=1/Math.hypot(c,l,f))-g*(l*=p),o=g*(c*=p)-m*f,s=m*l-y*c,(p=Math.hypot(n,o,s))?(n*=p=1/p,o*=p,s*=p):(n=0,o=0,s=0),a=l*s-f*o,h=f*n-c*s,u=c*o-l*n,(p=Math.hypot(a,h,u))?(a*=p=1/p,h*=p,u*=p):(a=0,h=0,u=0),t[0]=n,t[1]=a,t[2]=c,t[3]=0,t[4]=o,t[5]=h,t[6]=l,t[7]=0,t[8]=s,t[9]=u,t[10]=f,t[11]=0,t[12]=-(n*d+o*v+s*_),t[13]=-(a*d+h*v+u*_),t[14]=-(c*d+l*v+f*_),t[15]=1,t)},targetTo:function(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=i[0],h=i[1],u=i[2],c=n-r[0],l=o-r[1],f=s-r[2],p=c*c+l*l+f*f;p>0&&(c*=p=1/Math.sqrt(p),l*=p,f*=p);var d=h*f-u*l,v=u*c-a*f,_=a*l-h*c;return(p=d*d+v*v+_*_)>0&&(d*=p=1/Math.sqrt(p),v*=p,_*=p),t[0]=d,t[1]=v,t[2]=_,t[3]=0,t[4]=l*_-f*v,t[5]=f*d-c*_,t[6]=c*v-l*d,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=0,t[12]=n,t[13]=o,t[14]=s,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},subtract:Ee,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],c=t[8],l=t[9],f=t[10],p=t[11],d=t[12],v=t[13],_=t[14],m=t[15],y=e[0],g=e[1],M=e[2],w=e[3],b=e[4],x=e[5],E=e[6],T=e[7],S=e[8],L=e[9],A=e[10],P=e[11],C=e[12],R=e[13],z=e[14],O=e[15];return Math.abs(r-y)<=Zt*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-g)<=Zt*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(n-M)<=Zt*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(o-w)<=Zt*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-b)<=Zt*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-x)<=Zt*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(h-E)<=Zt*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(u-T)<=Zt*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(c-S)<=Zt*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-L)<=Zt*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(f-A)<=Zt*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(p-P)<=Zt*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(d-C)<=Zt*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(v-R)<=Zt*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(_-z)<=Zt*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(m-O)<=Zt*Math.max(1,Math.abs(m),Math.abs(O))},mul:Te,sub:Se});function Ae(){var t=new Qt(3);return Qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Pe(t){var e=t[0],r=t[1],i=t[2];return Math.hypot(e,r,i)}function Ce(t,e,r){var i=new Qt(3);return i[0]=t,i[1]=e,i[2]=r,i}function Re(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ze(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Oe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Fe(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,i,n)}function Ie(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function ke(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function He(t,e){var r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function De(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Be(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[0],a=r[1],h=r[2];return t[0]=n*h-o*a,t[1]=o*s-i*h,t[2]=i*a-n*s,t}var Ne,qe=Re,je=ze,Ve=Oe,Xe=Fe,We=Ie,Ye=Pe,Ge=ke,$e=(Ne=Ae(),function(t,e,r,i,n,o){var s,a;for(e||(e=3),r||(r=0),a=i?Math.min(i*e+r,t.length):t.length,s=r;s<a;s+=e)Ne[0]=t[s],Ne[1]=t[s+1],Ne[2]=t[s+2],n(Ne,Ne,o),t[s]=Ne[0],t[s+1]=Ne[1],t[s+2]=Ne[2];return t}),Ue=Object.freeze({__proto__:null,create:Ae,clone:function(t){var e=new Qt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},length:Pe,fromValues:Ce,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},subtract:Re,multiply:ze,divide:Oe,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},distance:Fe,squaredDistance:Ie,squaredLength:ke,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:He,dot:De,cross:Be,lerp:function(t,e,r,i){var n=e[0],o=e[1],s=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t},hermite:function(t,e,r,i,n,o){var s=o*o,a=s*(2*o-3)+1,h=s*(o-2)+o,u=s*(o-1),c=s*(3-2*o);return t[0]=e[0]*a+r[0]*h+i[0]*u+n[0]*c,t[1]=e[1]*a+r[1]*h+i[1]*u+n[1]*c,t[2]=e[2]*a+r[2]*h+i[2]*u+n[2]*c,t},bezier:function(t,e,r,i,n,o){var s=1-o,a=s*s,h=o*o,u=a*s,c=3*o*a,l=3*h*s,f=h*o;return t[0]=e[0]*u+r[0]*c+i[0]*l+n[0]*f,t[1]=e[1]*u+r[1]*c+i[1]*l+n[1]*f,t[2]=e[2]*u+r[2]*c+i[2]*l+n[2]*f,t},random:function(t,e){e=e||1;var r=2*Jt()*Math.PI,i=2*Jt()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t},transformMat4:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[3]*i+r[7]*n+r[11]*o+r[15];return s=s||1,t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/s,t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/s,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/s,t},transformMat3:function(t,e,r){var i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t},transformQuat:function(t,e,r){var i=r[0],n=r[1],o=r[2],s=r[3],a=e[0],h=e[1],u=e[2],c=n*u-o*h,l=o*a-i*u,f=i*h-n*a,p=n*f-o*l,d=o*c-i*f,v=i*l-n*c,_=2*s;return c*=_,l*=_,f*=_,p*=2,d*=2,v*=2,t[0]=a+c+p,t[1]=h+l+d,t[2]=u+f+v,t},rotateX:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},rotateY:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},rotateZ:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},angle:function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],s=e[1],a=e[2],h=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+s*s+a*a),u=h&&De(t,e)/h;return Math.acos(Math.min(Math.max(u,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(r-o)<=Zt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=Zt*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=Zt*Math.max(1,Math.abs(n),Math.abs(a))},sub:qe,mul:je,div:Ve,dist:Xe,sqrDist:We,len:Ye,sqrLen:Ge,forEach:$e});function Ke(){var t=new Qt(4);return Qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ze(t){var e=new Qt(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Qe(t,e,r,i){var n=new Qt(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Je(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function tr(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function er(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function rr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ir(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function nr(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function or(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function sr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return Math.hypot(r,i,n,o)}function ar(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+i*i+n*n+o*o}function hr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.hypot(e,r,i,n)}function ur(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function cr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*r+i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=o*s,t}function lr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function fr(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t[3]=a+i*(r[3]-a),t}function pr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function dr(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=e[0],a=e[1],h=e[2],u=e[3];return Math.abs(r-s)<=Zt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=Zt*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=Zt*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-u)<=Zt*Math.max(1,Math.abs(o),Math.abs(u))}var vr=rr,_r=ir,mr=nr,yr=sr,gr=ar,Mr=hr,wr=ur,br=function(){var t=Ke();return function(e,r,i,n,o,s){var a,h;for(r||(r=4),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,a=i;a<h;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),xr=Object.freeze({__proto__:null,create:Ke,clone:Ze,fromValues:Qe,copy:Je,set:tr,add:er,subtract:rr,multiply:ir,divide:nr,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:or,scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},distance:sr,squaredDistance:ar,length:hr,squaredLength:ur,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:cr,dot:lr,cross:function(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],c=e[0],l=e[1],f=e[2],p=e[3];return t[0]=l*u-f*h+p*a,t[1]=-c*u+f*s-p*o,t[2]=c*h-l*s+p*n,t[3]=-c*a+l*o-f*n,t},lerp:fr,random:function(t,e){var r,i,n,o,s,a;e=e||1;do{s=(r=2*Jt()-1)*r+(i=2*Jt()-1)*i}while(s>=1);do{a=(n=2*Jt()-1)*n+(o=2*Jt()-1)*o}while(a>=1);var h=Math.sqrt((1-s)/a);return t[0]=e*r,t[1]=e*i,t[2]=e*n*h,t[3]=e*o*h,t},transformMat4:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,t},transformQuat:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[0],a=r[1],h=r[2],u=r[3],c=u*i+a*o-h*n,l=u*n+h*i-s*o,f=u*o+s*n-a*i,p=-s*i-a*n-h*o;return t[0]=c*u+p*-s+l*-h-f*-a,t[1]=l*u+p*-a+f*-s-c*-h,t[2]=f*u+p*-h+c*-a-l*-s,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:pr,equals:dr,sub:vr,mul:_r,div:mr,dist:yr,sqrDist:gr,len:Mr,sqrLen:wr,forEach:br});function Er(){var t=new Qt(4);return Qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Tr(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Sr(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*c+s*a+n*u-o*h,t[1]=n*c+s*h+o*a-i*u,t[2]=o*c+s*u+i*h-n*a,t[3]=s*c-i*a-n*h-o*u,t}function Lr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+s*a,t[1]=n*h+o*a,t[2]=o*h-n*a,t[3]=s*h-i*a,t}function Ar(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h-o*a,t[1]=n*h+s*a,t[2]=o*h+i*a,t[3]=s*h-n*a,t}function Pr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*a,t[1]=n*h-i*a,t[2]=o*h+s*a,t[3]=s*h-o*a,t}function Cr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=Math.sqrt(r*r+i*i+n*n),a=Math.exp(o),h=s>0?a*Math.sin(s)/s:0;return t[0]=r*h,t[1]=i*h,t[2]=n*h,t[3]=a*Math.cos(s),t}function Rr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=Math.sqrt(r*r+i*i+n*n),a=s>0?Math.atan2(s,o)/s:0;return t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=.5*Math.log(r*r+i*i+n*n+o*o),t}function zr(t,e,r,i){var n,o,s,a,h,u=e[0],c=e[1],l=e[2],f=e[3],p=r[0],d=r[1],v=r[2],_=r[3];return(o=u*p+c*d+l*v+f*_)<0&&(o=-o,p=-p,d=-d,v=-v,_=-_),1-o>Zt?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-i)*n)/s,h=Math.sin(i*n)/s):(a=1-i,h=i),t[0]=a*u+h*p,t[1]=a*c+h*d,t[2]=a*l+h*v,t[3]=a*f+h*_,t}function Or(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*s+s]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*o+s]-e[3*s+o])*r,t[o]=(e[3*o+n]+e[3*n+o])*r,t[s]=(e[3*s+n]+e[3*n+s])*r}return t}var Fr,Ir,kr,Hr,Dr,Br,Nr=Ze,qr=Qe,jr=Je,Vr=tr,Xr=er,Wr=Sr,Yr=or,Gr=lr,$r=fr,Ur=hr,Kr=Ur,Zr=ur,Qr=Zr,Jr=cr,ti=pr,ei=dr,ri=(Fr=Ae(),Ir=Ce(1,0,0),kr=Ce(0,1,0),function(t,e,r){var i=De(e,r);return i<-.999999?(Be(Fr,Ir,e),Ye(Fr)<1e-6&&Be(Fr,kr,e),He(Fr,Fr),Tr(t,Fr,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Be(Fr,e,r),t[0]=Fr[0],t[1]=Fr[1],t[2]=Fr[2],t[3]=1+i,Jr(t,t))}),ii=(Hr=Er(),Dr=Er(),function(t,e,r,i,n,o){return zr(Hr,e,n,o),zr(Dr,r,i,o),zr(t,Hr,Dr,2*o*(1-o)),t}),ni=(Br=fe(),function(t,e,r,i){return Br[0]=r[0],Br[3]=r[1],Br[6]=r[2],Br[1]=i[0],Br[4]=i[1],Br[7]=i[2],Br[2]=-e[0],Br[5]=-e[1],Br[8]=-e[2],Jr(t,Or(t,Br))}),oi=Object.freeze({__proto__:null,create:Er,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:Tr,getAxisAngle:function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Zt?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,e){var r=Gr(t,e);return Math.acos(2*r*r-1)},multiply:Sr,rotateX:Lr,rotateY:Ar,rotateZ:Pr,calculateW:function(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t},exp:Cr,ln:Rr,pow:function(t,e,r){return Rr(t,e),Yr(t,t,r),Cr(t,t),t},slerp:zr,random:function(t){var e=Jt(),r=Jt(),i=Jt(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*r+i*i+n*n+o*o,a=s?1/s:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=o*a,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:Or,fromEuler:function(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(r),h=Math.cos(r),u=Math.sin(i),c=Math.cos(i);return t[0]=o*h*c-s*a*u,t[1]=s*a*c+o*h*u,t[2]=s*h*u-o*a*c,t[3]=s*h*c+o*a*u,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:Nr,fromValues:qr,copy:jr,set:Vr,add:Xr,mul:Wr,scale:Yr,dot:Gr,lerp:$r,length:Ur,len:Kr,squaredLength:Zr,sqrLen:Qr,normalize:Jr,exactEquals:ti,equals:ei,rotationTo:ri,sqlerp:ii,setAxes:ni});function si(t,e,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],s=e[0],a=e[1],h=e[2],u=e[3];return t[0]=s,t[1]=a,t[2]=h,t[3]=u,t[4]=i*u+n*h-o*a,t[5]=n*u+o*s-i*h,t[6]=o*u+i*a-n*s,t[7]=-i*s-n*a-o*h,t}function ai(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}var hi=jr;var ui=jr;function ci(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[4],h=r[5],u=r[6],c=r[7],l=e[4],f=e[5],p=e[6],d=e[7],v=r[0],_=r[1],m=r[2],y=r[3];return t[0]=i*y+s*v+n*m-o*_,t[1]=n*y+s*_+o*v-i*m,t[2]=o*y+s*m+i*_-n*v,t[3]=s*y-i*v-n*_-o*m,t[4]=i*c+s*a+n*u-o*h+l*y+d*v+f*m-p*_,t[5]=n*c+s*h+o*a-i*u+f*y+d*_+p*v-l*m,t[6]=o*c+s*u+i*h-n*a+p*y+d*m+l*_-f*v,t[7]=s*c-i*a-n*h-o*u+d*y-l*v-f*_-p*m,t}var li=ci;var fi=Gr;var pi=Ur,di=pi,vi=Zr,_i=vi;var mi=Object.freeze({__proto__:null,create:function(){var t=new Qt(8);return Qt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var e=new Qt(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},fromValues:function(t,e,r,i,n,o,s,a){var h=new Qt(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=i,h[4]=n,h[5]=o,h[6]=s,h[7]=a,h},fromRotationTranslationValues:function(t,e,r,i,n,o,s){var a=new Qt(8);a[0]=t,a[1]=e,a[2]=r,a[3]=i;var h=.5*n,u=.5*o,c=.5*s;return a[4]=h*i+u*r-c*e,a[5]=u*i+c*t-h*r,a[6]=c*i+h*e-u*t,a[7]=-h*t-u*e-c*r,a},fromRotationTranslation:si,fromTranslation:function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fromRotation:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,e){var r=Er();xe(r,e);var i=new Qt(3);return we(i,e),si(t,r,i),t},copy:ai,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,e,r,i,n,o,s,a,h){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t},getReal:hi,getDual:function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},setReal:ui,setDual:function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},getTranslation:function(t,e){var r=e[4],i=e[5],n=e[6],o=e[7],s=-e[0],a=-e[1],h=-e[2],u=e[3];return t[0]=2*(r*u+o*s+i*h-n*a),t[1]=2*(i*u+o*a+n*s-r*h),t[2]=2*(n*u+o*h+r*a-i*s),t},translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=.5*r[0],h=.5*r[1],u=.5*r[2],c=e[4],l=e[5],f=e[6],p=e[7];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=s*a+n*u-o*h+c,t[5]=s*h+o*a-i*u+l,t[6]=s*u+i*h-n*a+f,t[7]=-i*a-n*h-o*u+p,t},rotateX:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=a*s+c*i+h*o-u*n,f=h*s+c*n+u*i-a*o,p=u*s+c*o+a*n-h*i,d=c*s-a*i-h*n-u*o;return Lr(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=l*s+d*i+f*o-p*n,t[5]=f*s+d*n+p*i-l*o,t[6]=p*s+d*o+l*n-f*i,t[7]=d*s-l*i-f*n-p*o,t},rotateY:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=a*s+c*i+h*o-u*n,f=h*s+c*n+u*i-a*o,p=u*s+c*o+a*n-h*i,d=c*s-a*i-h*n-u*o;return Ar(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=l*s+d*i+f*o-p*n,t[5]=f*s+d*n+p*i-l*o,t[6]=p*s+d*o+l*n-f*i,t[7]=d*s-l*i-f*n-p*o,t},rotateZ:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],c=e[7],l=a*s+c*i+h*o-u*n,f=h*s+c*n+u*i-a*o,p=u*s+c*o+a*n-h*i,d=c*s-a*i-h*n-u*o;return Pr(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=l*s+d*i+f*o-p*n,t[5]=f*s+d*n+p*i-l*o,t[6]=p*s+d*o+l*n-f*i,t[7]=d*s-l*i-f*n-p*o,t},rotateByQuatAppend:function(t,e,r){var i=r[0],n=r[1],o=r[2],s=r[3],a=e[0],h=e[1],u=e[2],c=e[3];return t[0]=a*s+c*i+h*o-u*n,t[1]=h*s+c*n+u*i-a*o,t[2]=u*s+c*o+a*n-h*i,t[3]=c*s-a*i-h*n-u*o,a=e[4],h=e[5],u=e[6],c=e[7],t[4]=a*s+c*i+h*o-u*n,t[5]=h*s+c*n+u*i-a*o,t[6]=u*s+c*o+a*n-h*i,t[7]=c*s-a*i-h*n-u*o,t},rotateByQuatPrepend:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*c+s*a+n*u-o*h,t[1]=n*c+s*h+o*a-i*u,t[2]=o*c+s*u+i*h-n*a,t[3]=s*c-i*a-n*h-o*u,a=r[4],h=r[5],u=r[6],c=r[7],t[4]=i*c+s*a+n*u-o*h,t[5]=n*c+s*h+o*a-i*u,t[6]=o*c+s*u+i*h-n*a,t[7]=s*c-i*a-n*h-o*u,t},rotateAroundAxis:function(t,e,r,i){if(Math.abs(i)<Zt)return ai(t,e);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),s=o*r[0]/n,a=o*r[1]/n,h=o*r[2]/n,u=Math.cos(i),c=e[0],l=e[1],f=e[2],p=e[3];t[0]=c*u+p*s+l*h-f*a,t[1]=l*u+p*a+f*s-c*h,t[2]=f*u+p*h+c*a-l*s,t[3]=p*u-c*s-l*a-f*h;var d=e[4],v=e[5],_=e[6],m=e[7];return t[4]=d*u+m*s+v*h-_*a,t[5]=v*u+m*a+_*s-d*h,t[6]=_*u+m*h+d*a-v*s,t[7]=m*u-d*s-v*a-_*h,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},multiply:ci,mul:li,scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},dot:fi,lerp:function(t,e,r,i){var n=1-i;return fi(e,r)<0&&(i=-i),t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t[4]=e[4]*n+r[4]*i,t[5]=e[5]*n+r[5]*i,t[6]=e[6]*n+r[6]*i,t[7]=e[7]*n+r[7]*i,t},invert:function(t,e){var r=vi(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},length:pi,len:di,squaredLength:vi,sqrLen:_i,normalize:function(t,e){var r=vi(e);if(r>0){r=Math.sqrt(r);var i=e[0]/r,n=e[1]/r,o=e[2]/r,s=e[3]/r,a=e[4],h=e[5],u=e[6],c=e[7],l=i*a+n*h+o*u+s*c;t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=(a-i*l)/r,t[5]=(h-n*l)/r,t[6]=(u-o*l)/r,t[7]=(c-s*l)/r}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],c=e[0],l=e[1],f=e[2],p=e[3],d=e[4],v=e[5],_=e[6],m=e[7];return Math.abs(r-c)<=Zt*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-l)<=Zt*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-f)<=Zt*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-p)<=Zt*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-d)<=Zt*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-v)<=Zt*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-_)<=Zt*Math.max(1,Math.abs(h),Math.abs(_))&&Math.abs(u-m)<=Zt*Math.max(1,Math.abs(u),Math.abs(m))}});function yi(){var t=new Qt(2);return Qt!=Float32Array&&(t[0]=0,t[1]=0),t}function gi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Mi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function wi(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function bi(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.hypot(r,i)}function xi(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function Ei(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Ti(t){var e=t[0],r=t[1];return e*e+r*r}var Si=Ei,Li=gi,Ai=Mi,Pi=wi,Ci=bi,Ri=xi,zi=Ti,Oi=function(){var t=yi();return function(e,r,i,n,o,s){var a,h;for(r||(r=2),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,a=i;a<h;a+=r)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),Fi=Object.freeze({__proto__:null,create:yi,clone:function(t){var e=new Qt(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var r=new Qt(2);return r[0]=t,r[1]=e,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,r){return t[0]=e,t[1]=r,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},subtract:gi,multiply:Mi,divide:wi,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},distance:bi,squaredDistance:xi,length:Ei,squaredLength:Ti,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},lerp:function(t,e,r,i){var n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t},random:function(t,e){e=e||1;var r=2*Jt()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},transformMat2:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t},transformMat2d:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t},transformMat3:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t},transformMat4:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t},rotate:function(t,e,r,i){var n=e[0]-r[0],o=e[1]-r[1],s=Math.sin(i),a=Math.cos(i);return t[0]=n*a-o*s+r[0],t[1]=n*s+o*a+r[1],t},angle:function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o),a=s&&(r*n+i*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=Zt*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=Zt*Math.max(1,Math.abs(i),Math.abs(o))},len:Si,sub:Li,mul:Ai,div:Pi,dist:Ci,sqrDist:Ri,sqrLen:zi,forEach:Oi});var Ii=function(t,e,r){return Math.min(Math.max(t,e),r)},ki=St(Object.freeze({__proto__:null,glMatrix:ee,mat2:se,mat2d:le,mat3:me,mat4:Le,quat:oi,quat2:mi,vec2:Fi,vec3:Ue,vec4:xr})),Hi=ki.vec4,Di=ki.vec3,Bi=ki.mat4;function Ni(t,e,r){var i=t.createShader(e);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw t.getShaderInfoLog(i);return i}function qi(t,e,r,i){var n=t.createBuffer();return t.bindBuffer(e,n),t.bufferData(e,i,r),n}var ji=Hi.create(),Vi=Bi.create();Bi.identity(Vi);var Xi=Di.create(),Wi=Di.create();var Yi=function(t,e,r,i,n){var o=Ni(t,t.VERTEX_SHADER,e),s=Ni(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,o),t.attachShader(a,s),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw t.getProgramInfoLog(a);for(var h=0;h<i.length;h++){var u=i[h];if(a[u]=t.getAttribLocation(a,u),-1===a[u])throw new Error("Shader program has no "+u+" attribute")}for(var c=0;c<n.length;c++){var l=n[c];if(a[l]=t.getUniformLocation(a,l),-1===a[l])throw new Error("Shader program has no "+l+" uniform")}return a},Gi=function(t,e){for(var r=t.getAttachedShaders(e),i=0;i<r.length;i++){var n=r[i];t.detachShader(e,n),t.deleteShader(n)}t.deleteProgram(e)},$i=function(t,e,r,i){return{vertexIndices:qi(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW,new Uint16Array(e)),vertexPositions:qi(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(r)),textureCoords:qi(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(i))}},Ui=function(t,e){t.deleteBuffer(e.vertexIndices),t.deleteBuffer(e.vertexPositions),t.deleteBuffer(e.textureCoords)},Ki=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++)t.enableVertexAttribArray(i)},Zi=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++)t.disableVertexAttribArray(i)},Qi=function(t,e,r){t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r._texture),t.uniform1i(e.uSampler,0)},Ji=function(t,e,r,i){var n=(256*(r+1)-i)/65536;t.uniform1f(e.uDepth,n)},tn=function(t,e,r,i){if(0===r.x&&1===r.width&&0===r.y&&1===r.height)return t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),void Bi.identity(i);var n=r.x,o=Ii(n,0,1),s=o-n,a=1-o,h=Ii(r.width-s,0,a),u=r.width-h,c=1-r.height-r.y,l=Ii(c,0,1),f=l-c,p=1-l,d=Ii(r.height-f,0,p),v=r.height-d;Di.set(Wi,r.width/h,r.height/d,1),Di.set(Xi,(u-s)/h,(v-f)/d,0),Bi.identity(i),Bi.translate(i,i,Xi),Bi.scale(i,i,Wi),t.viewport(t.drawingBufferWidth*o,t.drawingBufferHeight*l,t.drawingBufferWidth*h,t.drawingBufferHeight*d)},en=function(t,e,r){var i=1;e&&null!=e.opacity&&(i=e.opacity),t.uniform1f(r.opacity,i);var n=ji;e&&e.colorOffset&&(n=e.colorOffset),t.uniform4fv(r.colorOffset,n);var o=Vi;e&&e.colorMatrix&&(o=e.colorMatrix),t.uniformMatrix4fv(r.colorMatrix,!1,o)},rn=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join("\n"),nn=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n"),on=ki.mat4,sn=ki.vec3,an=$i,hn=Ui,un=Yi,cn=Gi,ln=Ki,fn=Zi,pn=tn,dn=en,vn=Ji,_n=Qi,mn=[0,1,2,0,2,3],yn=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],gn=[0,0,1,0,1,1,0,1],Mn=["aVertexPosition","aTextureCoord"],wn=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function bn(t){this.gl=t,this.projMatrix=on.create(),this.viewportMatrix=on.create(),this.translateVector=sn.create(),this.scaleVector=sn.create(),this.constantBuffers=an(t,mn,yn,gn),this.shaderProgram=un(t,rn,nn,Mn,wn)}bn.prototype.destroy=function(){hn(this.gl,this.constantBuffers),cn(this.gl,this.shaderProgram),mt(this)},bn.prototype.startLayer=function(t,e){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,o=this.viewportMatrix;r.useProgram(i),ln(r,i),pn(r,t,e,o),r.uniformMatrix4fv(i.uViewportMatrix,!1,o),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,r.FALSE,0,0),dn(r,t.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},bn.prototype.endLayer=function(t,e){var r=this.gl,i=this.shaderProgram;fn(r,i)},bn.prototype.renderTile=function(t,e,r,i){var n=this.gl,o=this.shaderProgram,s=this.constantBuffers,a=this.projMatrix,h=this.translateVector,u=this.scaleVector;h[0]=t.centerX(),h[1]=t.centerY(),h[2]=-.5,u[0]=t.scaleX(),u[1]=t.scaleY(),u[2]=1,on.copy(a,r.view().projection()),on.rotateX(a,a,t.rotX()),on.rotateY(a,a,t.rotY()),on.translate(a,a,h),on.scale(a,a,u),n.uniformMatrix4fv(o.uProjMatrix,!1,a),vn(n,o,i,t.z),_n(n,o,e),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,mn.length,n.UNSIGNED_SHORT,0)};var xn=bn;function En(){this.constructor.super_.apply(this,arguments)}Rt(En,xn);var Tn=En;function Sn(){this.constructor.super_.apply(this,arguments)}Rt(Sn,xn);var Ln=Sn,An=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join("\n"),Pn=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n"),Cn=ki.mat4,Rn=$i,zn=Ui,On=Yi,Fn=Gi,In=Ki,kn=Zi,Hn=tn,Dn=en,Bn=Ji,Nn=Qi,qn=[0,1,2,0,2,3],jn=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],Vn=[0,0,1,0,1,1,0,1],Xn=["aVertexPosition"],Wn=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function Yn(t){this.gl=t,this.invProjMatrix=Cn.create(),this.viewportMatrix=Cn.create(),this.constantBuffers=Rn(t,qn,jn,Vn),this.shaderProgram=On(t,An,Pn,Xn,Wn)}Yn.prototype.destroy=function(){zn(this.gl,this.constantBuffers),Fn(this.gl,this.shaderProgram),mt(this)},Yn.prototype.startLayer=function(t,e){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,o=this.invProjMatrix,s=this.viewportMatrix;r.useProgram(i),In(r,i),Hn(r,t,e,s),r.uniformMatrix4fv(i.uViewportMatrix,!1,s),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),Cn.copy(o,t.view().projection()),Cn.invert(o,o),r.uniformMatrix4fv(i.uInvProjMatrix,!1,o);var a=t.effects().textureCrop||{},h=null!=a.x?a.x:0,u=null!=a.y?a.y:0,c=null!=a.width?a.width:1,l=null!=a.height?a.height:1;r.uniform1f(i.uTextureX,h),r.uniform1f(i.uTextureY,u),r.uniform1f(i.uTextureWidth,c),r.uniform1f(i.uTextureHeight,l),Dn(r,t.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Yn.prototype.endLayer=function(t,e){var r=this.gl,i=this.shaderProgram;kn(r,i)},Yn.prototype.renderTile=function(t,e,r,i){var n=this.gl,o=this.shaderProgram,s=this.constantBuffers;Bn(n,o,i,t.z),Nn(n,o,e),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,qn.length,n.UNSIGNED_SHORT,0)};var Gn=Yn;var $n=function(t){switch(t.type){case"webgl":t.registerRenderer("flat","flat",Ln),t.registerRenderer("cube","rectilinear",Tn),t.registerRenderer("equirect","rectilinear",Gn);break;default:throw new Error("Unknown stage type: "+t.type)}};var Un=function(){for(var t=0,e=0;e<arguments.length;e++){var r=arguments[e];t+=r,t+=r<<10,t^=r>>6}return t+=t<<3,t^=t>>11,(t+=t<<15)>=0?t:-t};var Kn=function(t,e){return(+t%(e=+e)+e)%e};function Zn(t){if(null!=t&&(!isFinite(t)||Math.floor(t)!==t||t<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||64,this._buckets=[];for(var e=0;e<this._capacity;e++)this._buckets.push([]);this._size=0}Zn.prototype.add=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return r[i]=t,n}return r.push(t),this._size++,null},Zn.prototype.remove=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n)){for(var o=i;o<r.length-1;o++)r[o]=r[o+1];return r.length=r.length-1,this._size--,n}}return null},Zn.prototype.has=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return!0}return!1},Zn.prototype.size=function(){return this._size},Zn.prototype.clear=function(){for(var t=0;t<this._capacity;t++)this._buckets[t].length=0;this._size=0},Zn.prototype.forEach=function(t){for(var e=0,r=0;r<this._capacity;r++)for(var i=this._buckets[r],n=0;n<i.length;n++)t(i[n]),e+=1;return e};var Qn=Zn;function Jn(){this._stack=[],this._visited=new Qn,this._vertices=null}Jn.prototype.search=function(t,e,r){var i=this._stack,n=this._visited,o=this._vertices,s=0;for(this._clear(),i.push(e);i.length>0;){var a=i.pop();if(!n.has(a)&&t.intersects(a.vertices(o))){n.add(a);for(var h=a.neighbors(),u=0;u<h.length;u++)i.push(h[u]);r.push(a),s++}}return this._vertices=o,this._clear(),s},Jn.prototype._clear=function(){this._stack.length=0,this._visited.clear()};var to=Jn;function eo(t){if(!isFinite(t)||Math.floor(t)!==t||t<0)throw new Error("LruMap: invalid capacity");this._capacity=t,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}eo.prototype._index=function(t){return Kn(this._start+t,this._capacity)},eo.prototype.get=function(t){for(var e=0;e<this._size;e++){var r=this._keys[this._index(e)];if(t.equals(r))return this._values[this._index(e)]}return null},eo.prototype.set=function(t,e){if(0===this._capacity)return t;this.del(t);var r=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=t,this._values[this._index(this._size)]=e,this._size<this._capacity?this._size++:this._start=this._index(1),r},eo.prototype.del=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._keys[this._index(e)])){for(var r=this._values[this._index(e)],i=e;i<this._size-1;i++)this._keys[this._index(i)]=this._keys[this._index(i+1)],this._values[this._index(i)]=this._values[this._index(i+1)];return this._size--,r}return null},eo.prototype.has=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._keys[this._index(e)]))return!0;return!1},eo.prototype.size=function(){return this._size},eo.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},eo.prototype.forEach=function(t){for(var e=0,r=0;r<this._size;r++)t(this._keys[this._index(r)],this._values[this._index(r)]),e+=1;return e};var ro=eo;function io(t){this._fallbackOnly=!!t.fallbackOnly}io.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},io.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},io.prototype.fallbackOnly=function(){return this._fallbackOnly};var no=io;var oo=function(t,e){return t<e?-1:t>e?1:0};var so={makeLevelList:function(t,e){for(var r=[],i=0;i<t.length;i++)r.push(new e(t[i]));return r.sort((function(t,e){return oo(t.width(),e.width())})),r},makeSelectableLevelList:function(t){for(var e=[],r=0;r<t.length;r++)t[r]._fallbackOnly||e.push(t[r]);if(!e.length)throw new Error("No selectable levels in list");return e}};var ao=function(t){var e=typeof t;if("object"===e){if(null===t)return"null";if("[object Array]"===Object.prototype.toString.call(t))return"array";if("[object RegExp]"===Object.prototype.toString.call(t))return"regexp"}return e},ho=so.makeLevelList,uo=so.makeSelectableLevelList,co=ki.vec3,lo=ki.vec4,fo="fudlrb",po={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},vo=co.create();function _o(t,e,r,i){e&&co.rotateZ(t,t,vo,e),r&&co.rotateX(t,t,vo,r),i&&co.rotateY(t,t,vo,i)}for(var mo={},yo=0;yo<fo.length;yo++){var go=fo[yo],Mo=po[go],wo=co.fromValues(0,0,-1);_o(wo,0,Mo.x,Mo.y),mo[go]=wo}var bo={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},xo=[[0,1],[1,0],[0,-1],[-1,0]];function Eo(t,e,r,i,n){this.face=t,this.x=e,this.y=r,this.z=i,this._geometry=n,this._level=n.levelList[i]}function To(t){if(this.constructor.super_.call(this,t),this._size=t.size,this._tileSize=t.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function So(t){if("array"!==ao(t))throw new Error("Level list must be an array");this.levelList=ho(t,To),this.selectableLevelList=uo(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._tileSearcher=new to(this),this._neighborsCache=new ro(64),this._vec=lo.create(),this._viewSize={}}Eo.prototype.rotX=function(){return po[this.face].x},Eo.prototype.rotY=function(){return po[this.face].y},Eo.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},Eo.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},Eo.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},Eo.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},Eo.prototype.vertices=function(t){t||(t=[co.create(),co.create(),co.create(),co.create()]);var e=po[this.face];function r(t,r,i){co.set(t,r,i,-.5),_o(t,0,e.x,e.y)}var i=this.centerX()-this.scaleX()/2,n=this.centerX()+this.scaleX()/2,o=this.centerY()-this.scaleY()/2,s=this.centerY()+this.scaleY()/2;return r(t[0],i,s),r(t[1],n,s),r(t[2],n,o),r(t[3],i,o),t},Eo.prototype.parent=function(){if(0===this.z)return null;var t=this.face,e=this.z,r=this.x,i=this.y,n=this._geometry,o=n.levelList[e],s=n.levelList[e-1];return new Eo(t,Math.floor(r/o.numHorizontalTiles()*s.numHorizontalTiles()),Math.floor(i/o.numVerticalTiles()*s.numVerticalTiles()),e-1,n)},Eo.prototype.children=function(t){if(this.z===this._geometry.levelList.length-1)return null;var e=this.face,r=this.z,i=this.x,n=this.y,o=this._geometry,s=o.levelList[r],a=o.levelList[r+1],h=a.numHorizontalTiles()/s.numHorizontalTiles(),u=a.numVerticalTiles()/s.numVerticalTiles();t=t||[];for(var c=0;c<h;c++)for(var l=0;l<u;l++){var f=h*i+c,p=u*n+l,d=r+1;t.push(new Eo(e,f,p,d,o))}return t},Eo.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,r=e.get(this);if(r)return r;for(var i=t._vec,n=this.face,o=this.x,s=this.y,a=this.z,h=this._level,u=h.numHorizontalTiles(),c=h.numVerticalTiles(),l=[],f=0;f<xo.length;f++){var p=o+xo[f][0],d=s+xo[f][1],v=a,_=n;if(p<0||p>=u||d<0||d>=c){var m,y=this.centerX(),g=this.centerY();p<0?(co.set(i,-.5,g,-.5),_=bo[n][0]):p>=u?(co.set(i,.5,g,-.5),_=bo[n][1]):d<0?(co.set(i,y,.5,-.5),_=bo[n][2]):d>=c&&(co.set(i,y,-.5,-.5),_=bo[n][3]),_o(i,0,(m=po[n]).x,m.y),_o(i,0,-(m=po[_]).x,-m.y),p=Ii(Math.floor((.5+i[0])*u),0,u-1),d=Ii(Math.floor((.5-i[1])*c),0,c-1)}l.push(new Eo(_,p,d,v,t))}return e.set(this,l),l},Eo.prototype.hash=function(){return Un(fo.indexOf(this.face),this.z,this.y,this.x)},Eo.prototype.equals=function(t){return this._geometry===t._geometry&&this.face===t.face&&this.z===t.z&&this.y===t.y&&this.x===t.x},Eo.prototype.cmp=function(t){return oo(this.z,t.z)||oo(fo.indexOf(this.face),fo.indexOf(t.face))||oo(this.y,t.y)||oo(this.x,t.x)},Eo.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"},Rt(To,no),To.prototype.width=function(){return this._size},To.prototype.height=function(){return this._size},To.prototype.tileWidth=function(){return this._tileSize},To.prototype.tileHeight=function(){return this._tileSize},To.prototype._validateWithParentLevel=function(t){var e=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),o=this.numHorizontalTiles(),s=this.numVerticalTiles(),a=t.width(),h=t.height(),u=t.tileWidth(),c=t.tileHeight(),l=t.numHorizontalTiles(),f=t.numVerticalTiles();if(e%a!=0)throw new Error("Level width must be multiple of parent level: "+e+" vs. "+a);if(r%h!=0)throw new Error("Level height must be multiple of parent level: "+r+" vs. "+h);if(o%l!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+o+" ("+e+"/"+i+") vs. "+l+" ("+a+"/"+u+")");if(s%f!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+s+" ("+r+"/"+n+") vs. "+f+" ("+h+"/"+c+")")},So.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},So.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t),i=t.numHorizontalTiles()-1,n=t.numVerticalTiles()-1;e=e||[];for(var o=0;o<fo.length;o++)for(var s=fo[o],a=0;a<=i;a++)for(var h=0;h<=n;h++)e.push(new Eo(s,a,h,r,this));return e},So.prototype._closestTile=function(t,e){var r=this._vec;lo.set(r,0,0,1,1),lo.transformMat4(r,r,t.inverseProjection());var i=1/0,n=null;for(var o in mo){var s=mo[o],a=1-co.dot(s,r);a<i&&(i=a,n=o)}for(var h=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,u=0;u<3;u++)r[u]=r[u]/h;var c=po[n];_o(r,0,-c.x,-c.y);var l=this.levelList.indexOf(e),f=e.numHorizontalTiles(),p=e.numVerticalTiles();return new Eo(n,Ii(Math.floor((.5+r[0])*f),0,f-1),Ii(Math.floor((.5-r[1])*p),0,p-1),l,this)},So.prototype.visibleTiles=function(t,e,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],t.size(i),0===i.width||0===i.height)return r;var o=this._closestTile(t,e);if(!n.search(t,o,r))throw new Error("Starting tile is not visible");return r},So.Tile=So.prototype.Tile=Eo,So.type=So.prototype.type="cube",Eo.type=Eo.prototype.type="cube";var Lo=So,Ao=so.makeLevelList,Po=so.makeSelectableLevelList,Co=ki.vec2,Ro=ki.vec4,zo=[[0,1],[1,0],[0,-1],[-1,0]];function Oo(t,e,r,i){this.x=t,this.y=e,this.z=r,this._geometry=i,this._level=i.levelList[r]}function Fo(t){this.constructor.super_.call(this,t),this._width=t.width,this._height=t.height,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight}function Io(t){if("array"!==ao(t))throw new Error("Level list must be an array");this.levelList=Ao(t,Fo),this.selectableLevelList=Po(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._tileSearcher=new to(this),this._neighborsCache=new ro(64),this._vec=Ro.create(),this._viewSize={}}Oo.prototype.rotX=function(){return 0},Oo.prototype.rotY=function(){return 0},Oo.prototype.centerX=function(){var t=this._level.width(),e=this._level.tileWidth();return(this.x*e+.5*this.width())/t-.5},Oo.prototype.centerY=function(){var t=this._level.height(),e=this._level.tileHeight();return.5-(this.y*e+.5*this.height())/t},Oo.prototype.scaleX=function(){var t=this._level.width();return this.width()/t},Oo.prototype.scaleY=function(){var t=this._level.height();return this.height()/t},Oo.prototype.width=function(){var t=this._level.width(),e=this._level.tileWidth();return this.x===this._level.numHorizontalTiles()-1&&Kn(t,e)||e},Oo.prototype.height=function(){var t=this._level.height(),e=this._level.tileHeight();return this.y===this._level.numVerticalTiles()-1&&Kn(t,e)||e},Oo.prototype.levelWidth=function(){return this._level.width()},Oo.prototype.levelHeight=function(){return this._level.height()},Oo.prototype.vertices=function(t){t||(t=[Co.create(),Co.create(),Co.create(),Co.create()]);var e=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,i=this.centerY()-this.scaleY()/2,n=this.centerY()+this.scaleY()/2;return Co.set(t[0],e,n),Co.set(t[1],r,n),Co.set(t[2],r,i),Co.set(t[3],e,i),t},Oo.prototype.parent=function(){if(0===this.z)return null;var t=this._geometry,e=this.z-1;return new Oo(Math.floor(this.x/2),Math.floor(this.y/2),e,t)},Oo.prototype.children=function(t){if(this.z===this._geometry.levelList.length-1)return null;var e=this._geometry,r=this.z+1;return(t=t||[]).push(new Oo(2*this.x,2*this.y,r,e)),t.push(new Oo(2*this.x,2*this.y+1,r,e)),t.push(new Oo(2*this.x+1,2*this.y,r,e)),t.push(new Oo(2*this.x+1,2*this.y+1,r,e)),t},Oo.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,r=e.get(this);if(r)return r;for(var i=this.x,n=this.y,o=this.z,s=this._level,a=s.numHorizontalTiles()-1,h=s.numVerticalTiles()-1,u=[],c=0;c<zo.length;c++){var l=i+zo[c][0],f=n+zo[c][1],p=o;0<=l&&l<=a&&0<=f&&f<=h&&u.push(new Oo(l,f,p,t))}return e.set(this,u),u},Oo.prototype.hash=function(){return Un(this.z,this.y,this.x)},Oo.prototype.equals=function(t){return this._geometry===t._geometry&&this.z===t.z&&this.y===t.y&&this.x===t.x},Oo.prototype.cmp=function(t){return oo(this.z,t.z)||oo(this.y,t.y)||oo(this.x,t.x)},Oo.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"},Rt(Fo,no),Fo.prototype.width=function(){return this._width},Fo.prototype.height=function(){return this._height},Fo.prototype.tileWidth=function(){return this._tileWidth},Fo.prototype.tileHeight=function(){return this._tileHeight},Fo.prototype._validateWithParentLevel=function(t){var e=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),o=t.width(),s=t.height(),a=t.tileWidth(),h=t.tileHeight();return e%o!=0?new Error("Level width must be multiple of parent level: "+e+" vs. "+o):r%s!=0?new Error("Level height must be multiple of parent level: "+r+" vs. "+s):i%a!=0?new Error("Level tile width must be multiple of parent level: "+i+" vs. "+a):n%h!=0?new Error("Level tile height must be multiple of parent level: "+n+" vs. "+h):void 0},Io.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},Io.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t),i=t.numHorizontalTiles()-1,n=t.numVerticalTiles()-1;e||(e=[]);for(var o=0;o<=i;o++)for(var s=0;s<=n;s++)e.push(new Oo(o,s,r,this));return e},Io.prototype._closestTile=function(t,e){var r=this._vec;Ro.set(r,0,0,1,1),Ro.transformMat4(r,r,t.inverseProjection());var i=.5+r[0],n=.5-r[1],o=this.levelList.indexOf(e),s=e.width(),a=e.height(),h=e.tileWidth(),u=e.tileHeight(),c=e.numHorizontalTiles(),l=e.numVerticalTiles();return new Oo(Ii(Math.floor(i*s/h),0,c-1),Ii(Math.floor(n*a/u),0,l-1),o,this)},Io.prototype.visibleTiles=function(t,e,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],t.size(i),0===i.width||0===i.height)return r;var o=this._closestTile(t,e);if(!n.search(t,o,r))throw new Error("Starting tile is not visible");return r},Io.Tile=Io.prototype.Tile=Oo,Io.type=Io.prototype.type="flat",Oo.type=Oo.prototype.type="flat";var ko=Io;function Ho(t,e){this.z=t,this._geometry=e,this._level=e.levelList[t]}function Do(t){this.constructor.super_.call(this,t),this._width=t.width}function Bo(t){if("array"!==ao(t))throw new Error("Level list must be an array");this.levelList=so.makeLevelList(t,Do),this.selectableLevelList=so.makeSelectableLevelList(this.levelList)}Ho.prototype.rotX=function(){return 0},Ho.prototype.rotY=function(){return 0},Ho.prototype.centerX=function(){return.5},Ho.prototype.centerY=function(){return.5},Ho.prototype.scaleX=function(){return 1},Ho.prototype.scaleY=function(){return 1},Ho.prototype.parent=function(){return 0===this.z?null:new Ho(this.z-1,this._geometry)},Ho.prototype.children=function(t){return this.z===this._geometry.levelList.length-1?null:((t=t||[]).push(new Ho(this.z+1,this._geometry)),t)},Ho.prototype.neighbors=function(){return[]},Ho.prototype.hash=function(){return Un(this.z)},Ho.prototype.equals=function(t){return this._geometry===t._geometry&&this.z===t.z},Ho.prototype.cmp=function(t){return oo(this.z,t.z)},Ho.prototype.str=function(){return"EquirectTile("+tile.z+")"},Rt(Do,no),Do.prototype.width=function(){return this._width},Do.prototype.height=function(){return this._width/2},Do.prototype.tileWidth=function(){return this._width},Do.prototype.tileHeight=function(){return this._width/2},Bo.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},Bo.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t);return(e=e||[]).push(new Ho(r,this)),e},Bo.prototype.visibleTiles=function(t,e,r){var i=new Ho(this.levelList.indexOf(e),this);(r=r||[]).length=0,r.push(i)},Bo.Tile=Bo.prototype.Tile=Ho,Bo.type=Bo.prototype.type="equirect",Ho.type=Ho.prototype.type="equirect";var No=Bo;function qo(t,e,r){return 2*Math.atan(r*Math.tan(t/2)/e)}var jo={convert:qo,htov:function(t,e,r){return qo(t,e,r)},htod:function(t,e,r){return qo(t,e,Math.sqrt(e*e+r*r))},vtoh:function(t,e,r){return qo(t,r,e)},vtod:function(t,e,r){return qo(t,r,Math.sqrt(e*e+r*r))},dtoh:function(t,e,r){return qo(t,Math.sqrt(e*e+r*r),e)},dtov:function(t,e,r){return qo(t,Math.sqrt(e*e+r*r),r)}};var Vo=function(t){return"number"==typeof t&&isFinite(t)};var Xo=function(t){return t.toPrecision(15)};var Wo=function(){var t=arguments;return function(e){for(var r=e,i=0;i<t.length;i++){r=t[i].call(null,r)}return r}},Yo=ki.mat4,Go=ki.vec4,$o=Math.PI/4,Uo=1e-6;function Ko(t,e){this._yaw=t&&null!=t.yaw?t.yaw:0,this._pitch=t&&null!=t.pitch?t.pitch:0,this._roll=t&&null!=t.roll?t.roll:0,this._fov=t&&null!=t.fov?t.fov:$o,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._projectionCenterX=t&&null!=t.projectionCenterX?t.projectionCenterX:0,this._projectionCenterY=t&&null!=t.projectionCenterY?t.projectionCenterY:0,this._limiter=e||null,this._projMatrix=Yo.create(),this._invProjMatrix=Yo.create(),this._frustum=[Go.create(),Go.create(),Go.create(),Go.create(),Go.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=Go.create(),this._update()}ht(Ko),Ko.prototype.destroy=function(){mt(this)},Ko.prototype.yaw=function(){return this._yaw},Ko.prototype.pitch=function(){return this._pitch},Ko.prototype.roll=function(){return this._roll},Ko.prototype.projectionCenterX=function(){return this._projectionCenterX},Ko.prototype.projectionCenterY=function(){return this._projectionCenterY},Ko.prototype.fov=function(){return this._fov},Ko.prototype.width=function(){return this._width},Ko.prototype.height=function(){return this._height},Ko.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},Ko.prototype.parameters=function(t){return(t=t||{}).yaw=this._yaw,t.pitch=this._pitch,t.roll=this._roll,t.fov=this._fov,t},Ko.prototype.limiter=function(){return this._limiter},Ko.prototype.setYaw=function(t){this._resetParams(),this._params.yaw=t,this._update(this._params)},Ko.prototype.setPitch=function(t){this._resetParams(),this._params.pitch=t,this._update(this._params)},Ko.prototype.setRoll=function(t){this._resetParams(),this._params.roll=t,this._update(this._params)},Ko.prototype.setFov=function(t){this._resetParams(),this._params.fov=t,this._update(this._params)},Ko.prototype.setProjectionCenterX=function(t){this._resetParams(),this._params.projectionCenterX=t,this._update(this._params)},Ko.prototype.setProjectionCenterY=function(t){this._resetParams(),this._params.projectionCenterY=t,this._update(this._params)},Ko.prototype.offsetYaw=function(t){this.setYaw(this._yaw+t)},Ko.prototype.offsetPitch=function(t){this.setPitch(this._pitch+t)},Ko.prototype.offsetRoll=function(t){this.setRoll(this._roll+t)},Ko.prototype.offsetFov=function(t){this.setFov(this._fov+t)},Ko.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},Ko.prototype.setParameters=function(t){this._resetParams(),this._params.yaw=t.yaw,this._params.pitch=t.pitch,this._params.roll=t.roll,this._params.fov=t.fov,this._params.projectionCenterX=t.projectionCenterX,this._params.projectionCenterY=t.projectionCenterY,this._update(this._params)},Ko.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},Ko.prototype._resetParams=function(){var t=this._params;t.yaw=null,t.pitch=null,t.roll=null,t.fov=null,t.width=null,t.height=null},Ko.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._yaw,r=this._pitch,i=this._roll,n=this._fov,o=this._projectionCenterX,s=this._projectionCenterY,a=this._width,h=this._height;if(t.yaw=null!=t.yaw?t.yaw:e,t.pitch=null!=t.pitch?t.pitch:r,t.roll=null!=t.roll?t.roll:i,t.fov=null!=t.fov?t.fov:n,t.width=null!=t.width?t.width:a,t.height=null!=t.height?t.height:h,t.projectionCenterX=null!=t.projectionCenterX?t.projectionCenterX:o,t.projectionCenterY=null!=t.projectionCenterY?t.projectionCenterY:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var u=(t=this._normalize(t)).yaw,c=t.pitch,l=t.roll,f=t.fov,p=t.width,d=t.height,v=t.projectionCenterX,_=t.projectionCenterY;if(!(Vo(u)&&Vo(c)&&Vo(l)&&Vo(f)&&Vo(p)&&Vo(d)&&Vo(v)&&Vo(_)))throw new Error("Bad view - suspect a broken limiter");this._yaw=u,this._pitch=c,this._roll=l,this._fov=f,this._width=p,this._height=d,this._projectionCenterX=v,this._projectionCenterY=_,u===e&&c===r&&l===i&&f===n&&p===a&&d===h&&v===o&&_===s||(this._projectionChanged=!0,this.emit("change")),p===a&&d===h||this.emit("resize")},Ko.prototype._normalize=function(t){this._normalizeCoordinates(t);var e=jo.htov(Math.PI,t.width,t.height),r=isNaN(e)?Math.PI:Math.min(Math.PI,e);return t.fov=Ii(t.fov,Uo,r-Uo),t},Ko.prototype._normalizeCoordinates=function(t){return"yaw"in t&&(t.yaw=Kn(t.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in t&&(t.pitch=Kn(t.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in t&&(t.roll=Kn(t.roll-Math.PI,-2*Math.PI)+Math.PI),t},Ko.prototype.normalizeToClosest=function(t,e){var r=this._yaw,i=this._pitch,n=t.yaw,o=t.pitch,s=n-2*Math.PI,a=n+2*Math.PI;Math.abs(s-r)<Math.abs(n-r)?n=s:Math.abs(a-r)<Math.abs(n-r)&&(n=a);var h=o-2*Math.PI,u=o+2*Math.PI;return Math.abs(h-i)<Math.abs(o-i)?o=h:Math.abs(h-i)<Math.abs(o-i)&&(o=u),(e=e||{}).yaw=n,e.pitch=o,e},Ko.prototype.updateWithControlParameters=function(t){var e=this._fov,r=jo.vtoh(e,this._width,this._height);isNaN(r)&&(r=e),this.offsetYaw(t.axisScaledX*r+2*t.x*r+t.yaw),this.offsetPitch(t.axisScaledY*e+2*t.y*r+t.pitch),this.offsetRoll(-t.roll),this.offsetFov(t.zoom*e)},Ko.prototype._updateProjection=function(){var t=this._projMatrix,e=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._width,n=this._height,o=this._fov,s=jo.vtoh(o,i,n),a=i/n,h=this._projectionCenterX,u=this._projectionCenterY;if(0!==h||0!==u){var c=Math.atan(2*h*Math.tan(s/2)),l=Math.atan(2*u*Math.tan(o/2)),f=this._fovs;f.leftDegrees=180*(s/2+c)/Math.PI,f.rightDegrees=180*(s/2-c)/Math.PI,f.upDegrees=180*(o/2+l)/Math.PI,f.downDegrees=180*(o/2-l)/Math.PI,Yo.perspectiveFromFieldOfView(t,f,-1,1)}else Yo.perspective(t,o,a,-1,1);Yo.rotateZ(t,t,this._roll),Yo.rotateX(t,t,this._pitch),Yo.rotateY(t,t,this._yaw),Yo.invert(e,t),this._matrixToFrustum(t,r),this._projectionChanged=!1}},Ko.prototype._matrixToFrustum=function(t,e){Go.set(e[0],t[3]+t[0],t[7]+t[4],t[11]+t[8],0),Go.set(e[1],t[3]-t[0],t[7]-t[4],t[11]-t[8],0),Go.set(e[2],t[3]+t[1],t[7]+t[5],t[11]+t[9],0),Go.set(e[3],t[3]-t[1],t[7]-t[5],t[11]-t[9],0),Go.set(e[4],t[3]+t[2],t[7]+t[6],t[11]+t[10],0)},Ko.prototype.projection=function(){return this._updateProjection(),this._projMatrix},Ko.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},Ko.prototype.intersects=function(t){this._updateProjection();for(var e=this._frustum,r=this._tmpVec,i=0;i<e.length;i++){for(var n=e[i],o=!1,s=0;s<t.length;s++){var a=t[s];Go.set(r,a[0],a[1],a[2],0),Go.dot(n,r)>=0&&(o=!0)}if(!o)return!1}return!0},Ko.prototype.selectLevel=function(t){for(var e=Dt()*this._height,r=Math.tan(.5*this._fov),i=0;i<t.length;i++){var n=t[i];if(r*n.height()>=e)return n}return t[t.length-1]},Ko.prototype.coordinatesToScreen=function(t,e){var r=this._tmpVec;e||(e={});var i=this._width,n=this._height;if(i<=0||n<=0)return e.x=null,e.y=null,null;var o=t.yaw,s=t.pitch,a=Math.sin(o)*Math.cos(s),h=-Math.sin(s),u=-Math.cos(o)*Math.cos(s);return Go.set(r,a,h,u,1),Go.transformMat4(r,r,this.projection()),r[3]>=0?(e.x=i*(r[0]/r[3]+1)/2,e.y=n*(1-r[1]/r[3])/2,e):(e.x=null,e.y=null,null)},Ko.prototype.screenToCoordinates=function(t,e){var r=this._tmpVec;e||(e={});var i=this._width,n=this._height,o=2*t.x/i-1,s=1-2*t.y/n;Go.set(r,o,s,1,1),Go.transformMat4(r,r,this.inverseProjection());var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return e.yaw=Math.atan2(r[0],-r[2]),e.pitch=Math.acos(r[1]/a)-Math.PI/2,this._normalizeCoordinates(e),e},Ko.prototype.coordinatesToPerspectiveTransform=function(t,e,r){r=r||"";var i=this._height,n=this._width,o=this._fov,s=.5*i/Math.tan(o/2),a="";return a+="translateX("+Xo(n/2)+"px) ",a+="translateY("+Xo(i/2)+"px) ",a+="translateX(-50%) translateY(-50%) ",a+="perspective("+Xo(s)+"px) ",a+="translateZ("+Xo(s)+"px) ",a+="rotateZ("+Xo(-this._roll)+"rad) ",a+="rotateX("+Xo(-this._pitch)+"rad) ",a+="rotateY("+Xo(this._yaw)+"rad) ",a+="rotateY("+Xo(-t.yaw)+"rad) ",a+="rotateX("+Xo(t.pitch)+"rad) ",a+="translateZ("+Xo(-e)+"px) ",a+=r+" "},Ko.limit={yaw:function(t,e){return function(r){return r.yaw=Ii(r.yaw,t,e),r}},pitch:function(t,e){return function(r){return r.pitch=Ii(r.pitch,t,e),r}},roll:function(t,e){return function(r){return r.roll=Ii(r.roll,t,e),r}},hfov:function(t,e){return function(r){var i=r.width,n=r.height;if(i>0&&n>0){var o=jo.htov(t,i,n),s=jo.htov(e,i,n);r.fov=Ii(r.fov,o,s)}return r}},vfov:function(t,e){return function(r){return r.fov=Ii(r.fov,t,e),r}},resolution:function(t){return function(e){var r=e.height;if(r){var i=Dt()*r,n=2*Math.atan(i/t);e.fov=Ii(e.fov,n,1/0)}return e}},traditional:function(t,e,r){return r=null!=r?r:e,Wo(Ko.limit.resolution(t),Ko.limit.vfov(0,e),Ko.limit.hfov(0,r),Ko.limit.pitch(-Math.PI/2,Math.PI/2))}},Ko.type=Ko.prototype.type="rectilinear";var Zo=Ko,Qo=ki.mat4,Jo=ki.vec4,ts=[1,0,1,0],es=[-1,-1,1,1];function rs(t,e){if(!t||null==t.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=t&&null!=t.x?t.x:.5,this._y=t&&null!=t.y?t.y:.5,this._zoom=t&&null!=t.zoom?t.zoom:1,this._mediaAspectRatio=t.mediaAspectRatio,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._limiter=e||null,this._projMatrix=Qo.create(),this._invProjMatrix=Qo.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=Jo.create(),this._update()}ht(rs),rs.prototype.destroy=function(){mt(this)},rs.prototype.x=function(){return this._x},rs.prototype.y=function(){return this._y},rs.prototype.zoom=function(){return this._zoom},rs.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},rs.prototype.width=function(){return this._width},rs.prototype.height=function(){return this._height},rs.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},rs.prototype.parameters=function(t){return(t=t||{}).x=this._x,t.y=this._y,t.zoom=this._zoom,t.mediaAspectRatio=this._mediaAspectRatio,t},rs.prototype.limiter=function(){return this._limiter},rs.prototype.setX=function(t){this._resetParams(),this._params.x=t,this._update(this._params)},rs.prototype.setY=function(t){this._resetParams(),this._params.y=t,this._update(this._params)},rs.prototype.setZoom=function(t){this._resetParams(),this._params.zoom=t,this._update(this._params)},rs.prototype.offsetX=function(t){this.setX(this._x+t)},rs.prototype.offsetY=function(t){this.setY(this._y+t)},rs.prototype.offsetZoom=function(t){this.setZoom(this._zoom+t)},rs.prototype.setMediaAspectRatio=function(t){this._resetParams(),this._params.mediaAspectRatio=t,this._update(this._params)},rs.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},rs.prototype.setParameters=function(t){this._resetParams(),this._params.x=t.x,this._params.y=t.y,this._params.zoom=t.zoom,this._params.mediaAspectRatio=t.mediaAspectRatio,this._update(this._params)},rs.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},rs.prototype._resetParams=function(){var t=this._params;t.x=null,t.y=null,t.zoom=null,t.mediaAspectRatio=null,t.width=null,t.height=null},rs.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._x,r=this._y,i=this._zoom,n=this._mediaAspectRatio,o=this._width,s=this._height;if(t.x=null!=t.x?t.x:e,t.y=null!=t.y?t.y:r,t.zoom=null!=t.zoom?t.zoom:i,t.mediaAspectRatio=null!=t.mediaAspectRatio?t.mediaAspectRatio:n,t.width=null!=t.width?t.width:o,t.height=null!=t.height?t.height:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var a=t.x,h=t.y,u=t.zoom,c=t.mediaAspectRatio,l=t.width,f=t.height;if(!(Vo(a)&&Vo(h)&&Vo(u)&&Vo(c)&&Vo(l)&&Vo(f)))throw new Error("Bad view - suspect a broken limiter");u=Ii(u,1e-6,1/0),this._x=a,this._y=h,this._zoom=u,this._mediaAspectRatio=c,this._width=l,this._height=f,a===e&&h===r&&u===i&&c===n&&l===o&&f===s||(this._projectionChanged=!0,this.emit("change")),l===o&&f===s||this.emit("resize")},rs.prototype._zoomX=function(){return this._zoom},rs.prototype._zoomY=function(){var t=this._mediaAspectRatio,e=this._width/this._height,r=this._zoom,i=r*t/e;return isNaN(i)&&(i=r),i},rs.prototype.updateWithControlParameters=function(t){var e=this.zoom(),r=this._zoomX(),i=this._zoomY();this.offsetX(t.axisScaledX*r+t.x*e),this.offsetY(t.axisScaledY*i+t.y*e),this.offsetZoom(t.zoom*e)},rs.prototype._updateProjection=function(){var t=this._projMatrix,e=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._x,n=this._y,o=this._zoomX(),s=this._zoomY(),a=r[0]=.5-n+.5*s,h=r[1]=i-.5+.5*o,u=r[2]=.5-n-.5*s,c=r[3]=i-.5-.5*o;Qo.ortho(t,c,h,u,a,-1,1),Qo.invert(e,t),this._projectionChanged=!1}},rs.prototype.projection=function(){return this._updateProjection(),this._projMatrix},rs.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},rs.prototype.intersects=function(t){this._updateProjection();for(var e=this._frustum,r=0;r<e.length;r++){for(var i=e[r],n=ts[r],o=es[r],s=!1,a=0;a<t.length;a++){var h=t[a];if(o<0&&h[n]<i||o>0&&h[n]>i){s=!0;break}}if(!s)return!1}return!0},rs.prototype.selectLevel=function(t){for(var e=Dt()*this.width(),r=this._zoom,i=0;i<t.length;i++){var n=t[i];if(r*n.width()>=e)return n}return t[t.length-1]},rs.prototype.coordinatesToScreen=function(t,e){var r=this._vec;e||(e={});var i=this._width,n=this._height;if(i<=0||n<=0)return e.x=null,e.y=null,null;var o=t&&null!=t.x?t.x:.5,s=t&&null!=t.y?t.y:.5;Jo.set(r,o-.5,.5-s,-1,1),Jo.transformMat4(r,r,this.projection());for(var a=0;a<3;a++)r[a]/=r[3];return e.x=i*(r[0]+1)/2,e.y=n*(1-r[1])/2,e},rs.prototype.screenToCoordinates=function(t,e){var r=this._vec;e||(e={});var i=this._width,n=this._height,o=2*t.x/i-1,s=1-2*t.y/n;return Jo.set(r,o,s,1,1),Jo.transformMat4(r,r,this.inverseProjection()),e.x=.5+r[0],e.y=.5-r[1],e},rs.limit={x:function(t,e){return function(r){return r.x=Ii(r.x,t,e),r}},y:function(t,e){return function(r){return r.y=Ii(r.y,t,e),r}},zoom:function(t,e){return function(r){return r.zoom=Ii(r.zoom,t,e),r}},resolution:function(t){return function(e){if(e.width<=0||e.height<=0)return e;var r=e.width,i=Dt()*r/t;return e.zoom=Ii(e.zoom,i,1/0),e}},visibleX:function(t,e){return function(r){var i=e-t;r.zoom>i&&(r.zoom=i);var n=t+.5*r.zoom,o=e-.5*r.zoom;return r.x=Ii(r.x,n,o),r}},visibleY:function(t,e){return function(r){if(r.width<=0||r.height<=0)return r;var i=r.width/r.height/r.mediaAspectRatio,n=(e-t)*i;r.zoom>n&&(r.zoom=n);var o=t+.5*r.zoom/i,s=e-.5*r.zoom/i;return r.y=Ii(r.y,o,s),r}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var e,r,i,n,o=t.width/t.height,s=o/t.mediaAspectRatio;return t.mediaAspectRatio>=o&&(t.zoom=Math.min(t.zoom,1)),t.mediaAspectRatio<=o&&(t.zoom=Math.min(t.zoom,s)),t.zoom>1?e=r=.5:(e=0+.5*t.zoom/1,r=1-.5*t.zoom/1),t.zoom>s?i=n=.5:(i=0+.5*t.zoom/s,n=1-.5*t.zoom/s),t.x=Ii(t.x,e,r),t.y=Ii(t.y,i,n),t}}},rs.type=rs.prototype.type="flat";var is=rs;function ns(t){this._concurrency=t&&t.concurrency||1,this._paused=t&&!!t.paused||!1,this._pool=[];for(var e=0;e<this._concurrency;e++)this._pool.push(new ft(t));this._next=0}ns.prototype.length=function(){for(var t=0,e=0;e<this._pool.length;e++)t+=this._pool[e].length();return t},ns.prototype.push=function(t,e){var r=this._next,i=this._pool[r].push(t,e);return this._next=Kn(this._next+1,this._concurrency),i},ns.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._concurrency;t++)this._pool[t].pause()}},ns.prototype.resume=function(){if(this._paused){this._paused=!1;for(var t=0;t<this._concurrency;t++)this._pool[t].resume()}};var os=ns;var ss=function(){};var as=function(){var t=Array.prototype.slice.call(arguments,0);return function(){var e=t.slice(0),r=null,i=null,n=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],o=arguments.length?arguments[arguments.length-1]:ss;function s(){var t=arguments[0];if(t)return r=i=null,void o.apply(null,arguments);if(!e.length)return r=i=null,void o.apply(null,arguments);var n=r=e.shift(),a=Array.prototype.slice.call(arguments,1);a.push(s);var h=r.apply(null,a);if(n===r){if("function"!=typeof h)throw new Error("chain: chaining on non-cancellable function");i=h}}function a(){i&&i.apply(null,arguments)}return n.unshift(null),s.apply(null,n),a}};var hs=function(t,e){var r=null;return r=setTimeout((function(){null!=r&&(r=null,e(null))}),t),function(){null!=r&&(clearTimeout(r),r=null,e.apply(null,arguments))}},us={x:"x",y:"y",z:"z",f:"face"};function cs(t,e){e=e||{},this._loadPool=new os({concurrency:e.concurrency||4}),this._retryDelay=e.retryDelay||1e4,this._retryMap={},this._sourceFromTile=t}function ls(t){return new RegExp("\\{("+t+")\\}","g")}ht(cs),cs.prototype.loadAsset=function(t,e,r){var i,n=this,o=this._retryDelay,s=this._retryMap,a=this._sourceFromTile(e),h=a.url,u=a.rect,c=t.loadImage.bind(t,h,u),l=s[h];if(null!=l){var f=ut()-l;f<o?i=o-f:(i=0,delete s[h])}var p=hs.bind(null,i);return as(p,(function(t){return n._loadPool.push(c,(function(r,i){r?(r instanceof Ot&&(s[h]=ut(),n.emit("networkError",r,e)),t(r,e)):(delete s[h],t(null,e,i))}))}))(r)},cs.fromString=function(t,e){var r=(e=e||{})&&e.cubeMapPreviewFaceOrder||"bdflru";return new cs(e.cubeMapPreviewUrl?function(t){return 0===t.z?function(t){var i=r.indexOf(t.face)/6;return{url:e.cubeMapPreviewUrl,rect:{x:0,y:i,width:1,height:1/6}}}(t):i(t)}:i,e);function i(e){var r=t;for(var i in us){var n=us[i],o=ls(i),s=e.hasOwnProperty(n)?e[n]:"";r=r.replace(o,s)}return{url:r}}};var fs=cs;function ps(t){this._asset=t}ps.prototype.asset=function(){return this._asset},ps.prototype.loadAsset=function(t,e,r){var i=this,n=setTimeout((function(){r(null,e,i._asset)}),0);return function(){clearTimeout(n),r.apply(null,arguments)}};var ds=ps;function vs(t){this.constructor.super_.call(this,t),this._timestamp=0}Rt(vs,Ct),ht(vs),vs.prototype.destroy=function(){mt(this)},vs.prototype.timestamp=function(){return this._timestamp},vs.prototype.isDynamic=function(){return!0},vs.prototype.markDirty=function(){this._timestamp++,this.emit("change")};var _s=vs;function ms(t){if(null!=t&&(!isFinite(t)||Math.floor(t)!==t||t<1))throw new Error("Map: invalid capacity");this._capacity=t||64,this._keyBuckets=[],this._valBuckets=[];for(var e=0;e<this._capacity;e++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}ms.prototype.get=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._keyBuckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return this._valBuckets[e][i]}return null},ms.prototype.set=function(t,e){for(var r=Kn(t.hash(),this._capacity),i=this._keyBuckets[r],n=this._valBuckets[r],o=0;o<i.length;o++){var s=i[o];if(t.equals(s)){var a=n[o];return i[o]=t,n[o]=e,a}}return i.push(t),n.push(e),this._size++,null},ms.prototype.del=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._keyBuckets[e],i=this._valBuckets[e],n=0;n<r.length;n++){var o=r[n];if(t.equals(o)){for(var s=i[n],a=n;a<r.length-1;a++)r[a]=r[a+1],i[a]=i[a+1];return r.length=r.length-1,i.length=i.length-1,this._size--,s}}return null},ms.prototype.has=function(t){for(var e=Kn(t.hash(),this._capacity),r=this._keyBuckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return!0}return!1},ms.prototype.size=function(){return this._size},ms.prototype.clear=function(){for(var t=0;t<this._capacity;t++)this._keyBuckets[t].length=0,this._valBuckets[t].length=0;this._size=0},ms.prototype.forEach=function(t){for(var e=0,r=0;r<this._capacity;r++)for(var i=this._keyBuckets[r],n=this._valBuckets[r],o=0;o<i.length;o++)t(i[o],n[o]),e+=1;return e};var ys=ms;function gs(t){if(!isFinite(t)||Math.floor(t)!==t||t<0)throw new Error("LruSet: invalid capacity");this._capacity=t,this._elements=new Array(this._capacity),this._start=0,this._size=0}gs.prototype._index=function(t){return Kn(this._start+t,this._capacity)},gs.prototype.add=function(t){if(0===this._capacity)return t;this.remove(t);var e=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=t,this._size<this._capacity?this._size++:this._start=this._index(1),e},gs.prototype.remove=function(t){for(var e=0;e<this._size;e++){var r=this._elements[this._index(e)];if(t.equals(r)){for(var i=e;i<this._size-1;i++)this._elements[this._index(i)]=this._elements[this._index(i+1)];return this._size--,r}}return null},gs.prototype.has=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._elements[this._index(e)]))return!0;return!1},gs.prototype.size=function(){return this._size},gs.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},gs.prototype.forEach=function(t){for(var e=0,r=0;r<this._size;r++)t(this._elements[this._index(r)]),e+=1;return e};var Ms=gs;var ws=function(t,e){for(var r in e)r in t||(t[r]=e[r]);return t};var bs=function(t){return function(){var e=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],r=arguments.length?arguments[arguments.length-1]:ss,i=null,n=!1;function o(){var o=arguments[0];!o||n?r.apply(null,arguments):i=t.apply(null,e)}return e.push(o),o(!0),function(){n=!0,i.apply(null,arguments)}}},xs="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,Es=0,Ts=1,Ss=2,Ls=3,As={previouslyVisibleCacheSize:512},Ps=0;function Cs(){}function Rs(t,e){var r=this,i=Ps++;r._id=i,r._store=t,r._tile=e,r._asset=null,r._texture=null,r._changeHandler=function(){t.emit("textureInvalid",e)};var n=t.source(),o=t.stage(),s=n.loadAsset.bind(n),a=o.createTexture.bind(o),h=as(bs(s),a);t.emit("textureStartLoad",e),xs&&console.log("loading",i,e),r._cancel=h(o,e,(function(n,o,s,a){if(r._cancel=null,n)return s&&s.destroy(),a&&a.destroy(),void(n instanceof Cs?(t.emit("textureCancel",e),xs&&console.log("cancel",i,e)):(t.emit("textureError",e,n),xs&&console.log("error",i,e)));r._texture=a,s.isDynamic()?(r._asset=s,s.addEventListener("change",r._changeHandler)):s.destroy(),t.emit("textureLoad",e),xs&&console.log("load",i,e)}))}function zs(t,e,r){r=ws(r||{},As),this._source=t,this._stage=e,this._state=Es,this._delimCount=0,this._itemMap=new ys,this._visible=new Qn,this._previouslyVisible=new Ms(r.previouslyVisibleCacheSize),this._pinMap=new ys,this._newVisible=new Qn,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}Rt(Cs,Error),Rs.prototype.asset=function(){return this._asset},Rs.prototype.texture=function(){return this._texture},Rs.prototype.destroy=function(){var t=this._id,e=this._store,r=this._tile,i=this._asset,n=this._texture,o=this._cancel;o?o(new Cs("Texture load cancelled")):(i&&(i.removeEventListener("change",this._changeHandler),i.destroy()),n&&n.destroy(),e.emit("textureUnload",r),xs&&console.log("unload",t,r),mt(this))},ht(Rs),ht(zs),zs.prototype.destroy=function(){this.clear(),mt(this)},zs.prototype.stage=function(){return this._stage},zs.prototype.source=function(){return this._source},zs.prototype.clear=function(){var t=this;t._evicted.length=0,t._itemMap.forEach((function(e){t._evicted.push(e)})),t._evicted.forEach((function(e){t._unloadTile(e)})),t._itemMap.clear(),t._visible.clear(),t._previouslyVisible.clear(),t._pinMap.clear(),t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},zs.prototype.clearNotPinned=function(){var t=this;t._evicted.length=0,t._itemMap.forEach((function(e){t._pinMap.has(e)||t._evicted.push(e)})),t._evicted.forEach((function(e){t._unloadTile(e)})),t._visible.clear(),t._previouslyVisible.clear(),t._evicted.length=0},zs.prototype.startFrame=function(){if(this._state!==Es&&this._state!==Ts)throw new Error("TextureStore: startFrame called out of sequence");this._state=Ts,this._delimCount++},zs.prototype.markTile=function(t){if(this._state!==Ts&&this._state!==Ss)throw new Error("TextureStore: markTile called out of sequence");this._state=Ss;var e=this._itemMap.get(t),r=e&&e.texture(),i=e&&e.asset();r&&i&&r.refresh(t,i),this._newVisible.add(t)},zs.prototype.endFrame=function(){if(this._state!==Ts&&this._state!==Ss&&this._state!==Ls)throw new Error("TextureStore: endFrame called out of sequence");this._state=Ls,this._delimCount--,this._delimCount||(this._update(),this._state=Es)},zs.prototype._update=function(){var t=this;t._noLongerVisible.length=0,t._visible.forEach((function(e){t._newVisible.has(e)||t._noLongerVisible.push(e)})),t._visibleAgain.length=0,t._newVisible.forEach((function(e){t._previouslyVisible.has(e)&&t._visibleAgain.push(e)})),t._visibleAgain.forEach((function(e){t._previouslyVisible.remove(e)})),t._evicted.length=0,t._noLongerVisible.forEach((function(e){var r=t._itemMap.get(e);if(r&&r.texture()){var i=t._previouslyVisible.add(e);null!=i&&t._evicted.push(i)}else r&&t._unloadTile(e)})),t._evicted.forEach((function(e){t._pinMap.has(e)||t._unloadTile(e)})),t._newVisible.forEach((function(e){t._itemMap.get(e)||t._loadTile(e)}));var e=t._visible;t._visible=t._newVisible,t._newVisible=e,t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},zs.prototype._loadTile=function(t){if(this._itemMap.has(t))throw new Error("TextureStore: loading texture already in cache");var e=new Rs(this,t);this._itemMap.set(t,e)},zs.prototype._unloadTile=function(t){var e=this._itemMap.del(t);if(!e)throw new Error("TextureStore: unloading texture not in cache");e.destroy()},zs.prototype.asset=function(t){var e=this._itemMap.get(t);return e?e.asset():null},zs.prototype.texture=function(t){var e=this._itemMap.get(t);return e?e.texture():null},zs.prototype.pin=function(t){var e=(this._pinMap.get(t)||0)+1;return this._pinMap.set(t,e),this._itemMap.has(t)||this._loadTile(t),e},zs.prototype.unpin=function(t){var e=this._pinMap.get(t);if(!e)throw new Error("TextureStore: unpin when not pinned");return--e>0?this._pinMap.set(t,e):(this._pinMap.del(t),this._visible.has(t)||this._previouslyVisible.has(t)||this._unloadTile(t)),e},zs.prototype.query=function(t){var e=this._itemMap.get(t),r=this._pinMap.get(t)||0;return{visible:this._visible.has(t),previouslyVisible:this._previouslyVisible.has(t),hasAsset:null!=e&&null!=e.asset(),hasTexture:null!=e&&null!=e.texture(),pinned:0!==r,pinCount:r}};var Os=zs;var Fs=function(t,e){for(var r in e)t[r]=e[r];return t};function Is(t,e,r,i,n){n=n||{};var o=this;this._source=t,this._geometry=e,this._view=r,this._textureStore=i,this._effects=n.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){o.emit("viewChange",o.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){o.emit("textureStoreChange",o.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}ht(Is),Is.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),mt(this)},Is.prototype.source=function(){return this._source},Is.prototype.geometry=function(){return this._geometry},Is.prototype.view=function(){return this._view},Is.prototype.textureStore=function(){return this._textureStore},Is.prototype.effects=function(){return this._effects},Is.prototype.setEffects=function(t){this._effects=t,this.emit("effectsChange",this._effects)},Is.prototype.mergeEffects=function(t){Fs(this._effects,t),this.emit("effectsChange",this._effects)},Is.prototype.fixedLevel=function(){return this._fixedLevelIndex},Is.prototype.setFixedLevel=function(t){if(t!==this._fixedLevelIndex){if(null!=t&&(t>=this._geometry.levelList.length||t<0))throw new Error("Level index out of range: "+t);this._fixedLevelIndex=t,this.emit("fixedLevelChange",this._fixedLevelIndex)}},Is.prototype._selectLevel=function(){return null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},Is.prototype.visibleTiles=function(t){var e=this._selectLevel();return this._geometry.visibleTiles(this._view,e,t)},Is.prototype.pinLevel=function(t){for(var e=this._geometry.levelList[t],r=this._geometry.levelTiles(e),i=0;i<r.length;i++)this._textureStore.pin(r[i])},Is.prototype.unpinLevel=function(t){for(var e=this._geometry.levelList[t],r=this._geometry.levelTiles(e),i=0;i<r.length;i++)this._textureStore.unpin(r[i])},Is.prototype.pinFirstLevel=function(){return this.pinLevel(0)},Is.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)};var ks=Is;function Hs(t){var e=this;this._stage=t,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){e._rendering||e.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}ht(Hs),Hs.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),mt(this)},Hs.prototype.stage=function(){return this._stage},Hs.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},Hs.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},Hs.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},Hs.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")};var Ds=Hs;function Bs(){this.velocity=null,this.friction=null,this.offset=null}Bs.equals=function(t,e){return t.velocity===e.velocity&&t.friction===e.friction&&t.offset===e.offset},Bs.prototype.equals=function(t){return Bs.equals(this,t)},Bs.prototype.update=function(t,e){t.offset&&(this.offset=this.offset||0,this.offset+=t.offset);var r=this.offsetFromVelocity(e);r&&(this.offset=this.offset||0,this.offset+=r),this.velocity=t.velocity,this.friction=t.friction},Bs.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},Bs.prototype.velocityAfter=function(t){return this.velocity?this.friction?function(t,e){if(t<0)return Math.min(0,t+e);if(t>0)return Math.max(0,t-e);return 0}(this.velocity,this.friction*t):this.velocity:null},Bs.prototype.offsetFromVelocity=function(t){t=Math.min(t,this.nullVelocityTime());var e=this.velocityAfter(t);return(this.velocity+e)/2*t},Bs.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)};var Ns=Bs;function qs(t,e,r,i,n){if(!t)throw new Error("KeyControlMethod: keyCode must be defined");if(!e)throw new Error("KeyControlMethod: parameter must be defined");if(!r)throw new Error("KeyControlMethod: velocity must be defined");if(!i)throw new Error("KeyControlMethod: friction must be defined");n=n||document,this._keyCode=t,this._parameter=e,this._velocity=r,this._friction=i,this._element=n,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new Ns,this._pressing=!1}ht(qs),qs.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),mt(this)},qs.prototype._handlePress=function(t){t.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},qs.prototype._handleRelease=function(t){t.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},qs.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1};var js=qs,Vs=Tt((function(t){
/*! Hammer.JS - v2.0.4 - 2014-09-28
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2014 Jorik Tangelder;
     * Licensed under the MIT license */
!function(e,r,i,n){var o=["","webkit","moz","MS","ms","o"],s=r.createElement("div"),a="function",h=Math.round,u=Math.abs,c=Date.now;function l(t,e,r){return setTimeout(m(t,r),e)}function f(t,e,r){return!!Array.isArray(t)&&(p(t,r[e],r),!0)}function p(t,e,r){var i;if(t)if(t.forEach)t.forEach(e,r);else if(t.length!==n)for(i=0;i<t.length;)e.call(r,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)}function d(t,e,r){for(var i=Object.keys(e),o=0;o<i.length;)(!r||r&&t[i[o]]===n)&&(t[i[o]]=e[i[o]]),o++;return t}function v(t,e){return d(t,e,!0)}function _(t,e,r){var i,n=e.prototype;(i=t.prototype=Object.create(n)).constructor=t,i._super=n,r&&d(i,r)}function m(t,e){return function(){return t.apply(e,arguments)}}function y(t,e){return typeof t==a?t.apply(e&&e[0]||n,e):t}function g(t,e){return t===n?e:t}function M(t,e,r){p(E(e),(function(e){t.addEventListener(e,r,!1)}))}function w(t,e,r){p(E(e),(function(e){t.removeEventListener(e,r,!1)}))}function b(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function x(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function T(t,e,r){if(t.indexOf&&!r)return t.indexOf(e);for(var i=0;i<t.length;){if(r&&t[i][r]==e||!r&&t[i]===e)return i;i++}return-1}function S(t){return Array.prototype.slice.call(t,0)}function L(t,e,r){for(var i=[],n=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];T(n,s)<0&&i.push(t[o]),n[o]=s,o++}return r&&(i=e?i.sort((function(t,r){return t[e]>r[e]})):i.sort()),i}function A(t,e){for(var r,i,s=e[0].toUpperCase()+e.slice(1),a=0;a<o.length;){if((i=(r=o[a])?r+s:e)in t)return i;a++}return n}var P=1;function C(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}var R="ontouchstart"in e,z=A(e,"PointerEvent")!==n,O=R&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F="touch",I="mouse",k=24,H=["x","y"],D=["clientX","clientY"];function B(t,e){var r=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){y(t.options.enable,[t])&&r.handler(e)},this.init()}function N(t,e,r){var i=r.pointers.length,o=r.changedPointers.length,s=1&e&&i-o==0,a=12&e&&i-o==0;r.isFirst=!!s,r.isFinal=!!a,s&&(t.session={}),r.eventType=e,function(t,e){var r=t.session,i=e.pointers,o=i.length;r.firstInput||(r.firstInput=q(e));o>1&&!r.firstMultiple?r.firstMultiple=q(e):1===o&&(r.firstMultiple=!1);var s=r.firstInput,a=r.firstMultiple,h=a?a.center:s.center,l=e.center=j(i);e.timeStamp=c(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=W(h,l),e.distance=X(h,l),function(t,e){var r=e.center,i=t.offsetDelta||{},n=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(n=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y});e.deltaX=n.x+(r.x-i.x),e.deltaY=n.y+(r.y-i.y)}(r,e),e.offsetDirection=V(e.deltaX,e.deltaY),e.scale=a?(f=a.pointers,p=i,X(p[0],p[1],D)/X(f[0],f[1],D)):1,e.rotation=a?function(t,e){return W(e[1],e[0],D)-W(t[1],t[0],D)}(a.pointers,i):0,function(t,e){var r,i,o,s,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(h>25||a.velocity===n)){var c=a.deltaX-e.deltaX,l=a.deltaY-e.deltaY,f=function(t,e,r){return{x:e/t||0,y:r/t||0}}(h,c,l);i=f.x,o=f.y,r=u(f.x)>u(f.y)?f.x:f.y,s=V(c,l),t.lastInterval=e}else r=a.velocity,i=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=r,e.velocityX=i,e.velocityY=o,e.direction=s}(r,e);var f,p;var d=t.element;b(e.srcEvent.target,d)&&(d=e.srcEvent.target);e.target=d}(t,r),t.emit("hammer.input",r),t.recognize(r),t.session.prevInput=r}function q(t){for(var e=[],r=0;r<t.pointers.length;)e[r]={clientX:h(t.pointers[r].clientX),clientY:h(t.pointers[r].clientY)},r++;return{timeStamp:c(),pointers:e,center:j(e),deltaX:t.deltaX,deltaY:t.deltaY}}function j(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var r=0,i=0,n=0;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:h(r/e),y:h(i/e)}}function V(t,e){return t===e?1:u(t)>=u(e)?t>0?2:4:e>0?8:16}function X(t,e,r){r||(r=H);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return Math.sqrt(i*i+n*n)}function W(t,e,r){r||(r=H);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return 180*Math.atan2(n,i)/Math.PI}B.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(C(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(C(this.element),this.evWin,this.domHandler)}};var Y={mousedown:1,mousemove:2,mouseup:4},G="mousedown",$="mousemove mouseup";function U(){this.evEl=G,this.evWin=$,this.allow=!0,this.pressed=!1,B.apply(this,arguments)}_(U,B,{handler:function(t){var e=Y[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&this.allow&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:I,srcEvent:t}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Z={2:F,3:"pen",4:I,5:"kinect"},Q="pointerdown",J="pointermove pointerup pointercancel";function tt(){this.evEl=Q,this.evWin=J,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&(Q="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),_(tt,B,{handler:function(t){var e=this.store,r=!1,i=t.type.toLowerCase().replace("ms",""),n=K[i],o=Z[t.pointerType]||t.pointerType,s=o==F,a=T(e,t.pointerId,"pointerId");1&n&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):12&n&&(r=!0),a<0||(e[a]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),r&&e.splice(a,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8},rt="touchstart",it="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=rt,this.evWin=it,this.started=!1,B.apply(this,arguments)}function ot(t,e){var r=S(t.touches),i=S(t.changedTouches);return 12&e&&(r=L(r.concat(i),"identifier",!0)),[r,i]}_(nt,B,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var r=ot.call(this,t,e);12&e&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:t})}}});var st={touchstart:1,touchmove:2,touchend:4,touchcancel:8},at="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=at,this.targetIds={},B.apply(this,arguments)}function ut(t,e){var r=S(t.touches),i=this.targetIds;if(3&e&&1===r.length)return i[r[0].identifier]=!0,[r,r];var n,o,s=S(t.changedTouches),a=[],h=this.target;if(o=r.filter((function(t){return b(t.target,h)})),1===e)for(n=0;n<o.length;)i[o[n].identifier]=!0,n++;for(n=0;n<s.length;)i[s[n].identifier]&&a.push(s[n]),12&e&&delete i[s[n].identifier],n++;return a.length?[L(o.concat(a),"identifier",!0),a]:void 0}function ct(){B.apply(this,arguments);var t=m(this.handler,this);this.touch=new ht(this.manager,t),this.mouse=new U(this.manager,t)}_(ht,B,{handler:function(t){var e=st[t.type],r=ut.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:t})}}),_(ct,B,{handler:function(t,e,r){var i=r.pointerType==F,n=r.pointerType==I;if(i)this.mouse.allow=!1;else if(n&&!this.mouse.allow)return;12&e&&(this.mouse.allow=!0),this.callback(t,e,r)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var lt=A(s.style,"touchAction"),ft=lt!==n,pt="compute",dt="auto",vt="manipulation",_t="none",mt="pan-x",yt="pan-y";function gt(t,e){this.manager=t,this.set(e)}gt.prototype={set:function(t){t==pt&&(t=this.compute()),ft&&(this.manager.element.style[lt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return p(this.manager.recognizers,(function(e){y(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(x(t,_t))return _t;var e=x(t,mt),r=x(t,yt);if(e&&r)return"pan-x pan-y";if(e||r)return e?mt:yt;if(x(t,vt))return vt;return dt}(t.join(" "))},preventDefaults:function(t){if(!ft){var e=t.srcEvent,r=t.offsetDirection;if(!this.manager.session.prevented){var i=this.actions,n=x(i,_t),o=x(i,yt),s=x(i,mt);return n||o&&6&r||s&&r&k?this.preventSrc(e):void 0}e.preventDefault()}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Mt=16,wt=32;function bt(t){this.id=P++,this.manager=null,this.options=v(t||{},this.defaults),this.options.enable=g(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function xt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Et(t,e){var r=e.manager;return r?r.get(t):t}function Tt(){bt.apply(this,arguments)}function St(){Tt.apply(this,arguments),this.pX=null,this.pY=null}function Lt(){Tt.apply(this,arguments)}function At(){bt.apply(this,arguments),this._timer=null,this._input=null}function Pt(){Tt.apply(this,arguments)}function Ct(){Tt.apply(this,arguments)}function Rt(){bt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function zt(t,e){return(e=e||{}).recognizers=g(e.recognizers,zt.defaults.preset),new Ot(t,e)}bt.prototype={defaults:{},set:function(t){return d(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(f(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Et(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return f(t,"dropRecognizeWith",this)||(t=Et(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(f(t,"requireFailure",this))return this;var e=this.requireFail;return-1===T(e,t=Et(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(f(t,"dropRequireFailure",this))return this;t=Et(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,r=this.state;function i(i){e.manager.emit(e.options.event+(i?function(t){if(t&Mt)return"cancel";if(8&t)return"end";if(4&t)return"move";if(2&t)return"start";return""}(r):""),t)}r<8&&i(!0),i(),r>=8&&i(!0)},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=wt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=d({},t);if(!y(this.options.enable,[this,e]))return this.reset(),void(this.state=wt);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},_(Tt,bt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,r=t.eventType,i=6&e,n=this.attrTest(t);return i&&(8&r||!n)?e|Mt:i||n?4&r?8|e:2&e?4|e:2:wt}}),_(St,Tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(yt),t&k&&e.push(mt),e},directionTest:function(t){var e=this.options,r=!0,i=t.distance,n=t.direction,o=t.deltaX,s=t.deltaY;return n&e.direction||(6&e.direction?(n=0===o?1:o<0?2:4,r=o!=this.pX,i=Math.abs(t.deltaX)):(n=0===s?1:s<0?8:16,r=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=n,r&&i>e.threshold&&n&e.direction},attrTest:function(t){return Tt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=xt(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),_(Lt,Tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),_(At,bt,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[dt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!i||!r||12&t.eventType&&!n)this.reset();else if(1&t.eventType)this.reset(),this._timer=l((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return wt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}}),_(Pt,Tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[_t]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),_(Ct,Tt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return St.prototype.getTouchAction.call(this)},attrTest:function(t){var e,r=this.options.direction;return 30&r?e=t.velocity:6&r?e=t.velocityX:r&k&&(e=t.velocityY),this._super.attrTest.call(this,t)&&r&t.direction&&t.distance>this.options.threshold&&u(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=xt(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),_(Rt,bt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[vt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&n&&r){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||X(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=l((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return wt},failTimeout:function(){return this._timer=l((function(){this.state=wt}),this.options.interval,this),wt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),zt.VERSION="2.0.4",zt.defaults={domEvents:!1,touchAction:pt,enable:!0,inputTarget:null,inputClass:null,preset:[[Pt,{enable:!1}],[Lt,{enable:!1},["rotate"]],[Ct,{direction:6}],[St,{direction:6},["swipe"]],[Rt],[Rt,{event:"doubletap",taps:2},["tap"]],[At]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Ot(t,e){var r;e=e||{},this.options=v(e,zt.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((r=this).options.inputClass||(z?tt:O?ht:R?ct:U))(r,N),this.touchAction=new gt(this,this.options.touchAction),Ft(this,!0),p(e.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Ft(t,e){var r=t.element;p(t.options.cssProps,(function(t,i){r.style[A(r.style,i)]=e?t:""}))}Ot.prototype={set:function(t){return d(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var r;this.touchAction.preventDefaults(t);var i=this.recognizers,n=e.curRecognizer;(!n||n&&8&n.state)&&(n=e.curRecognizer=null);for(var o=0;o<i.length;)r=i[o],2===e.stopped||n&&r!=n&&!r.canRecognizeWith(n)?r.reset():r.recognize(t),!n&&14&r.state&&(n=e.curRecognizer=r),o++}},get:function(t){if(t instanceof bt)return t;for(var e=this.recognizers,r=0;r<e.length;r++)if(e[r].options.event==t)return e[r];return null},add:function(t){if(f(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(f(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(T(e,t),1),this.touchAction.update(),this},on:function(t,e){var r=this.handlers;return p(E(t),(function(t){r[t]=r[t]||[],r[t].push(e)})),this},off:function(t,e){var r=this.handlers;return p(E(t),(function(t){e?r[t].splice(T(r[t],e),1):delete r[t]})),this},emit:function(t,e){this.options.domEvents&&function(t,e){var i=r.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&Ft(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},d(zt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:Mt,STATE_FAILED:wt,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:k,DIRECTION_ALL:30,Manager:Ot,Input:B,TouchAction:gt,TouchInput:ht,MouseInput:U,PointerEventInput:tt,TouchMouseInput:ct,SingleTouchInput:nt,Recognizer:bt,AttrRecognizer:Tt,Tap:Rt,Pan:St,Swipe:Ct,Pinch:Lt,Rotate:Pt,Press:At,on:M,off:w,each:p,merge:v,extend:d,inherit:_,bindFn:m,prefixed:A}),t.exports?t.exports=zt:e.Hammer=zt}(window,document)})),Xs=1,Ws="MarzipanoHammerElementId";function Ys(t,e){return t[Ws]||(t[Ws]=Xs++),e+t[Ws]}function Gs(){this._managers={},this._refCount={}}function $s(t,e,r,i){this._manager=e,this._element=r,this._type=i,this._hammerGestures=t,this._eventHandlers=[]}Gs.prototype.get=function(t,e){var r=Ys(t,e);return this._managers[r]||(this._managers[r]=this._createManager(t,e),this._refCount[r]=0),this._refCount[r]++,new $s(this,this._managers[r],t,e)},Gs.prototype._createManager=function(t,e){var r=new Vs.Manager(t);return"mouse"===e?r.add(new Vs.Pan({direction:Vs.DIRECTION_ALL,threshold:0})):"touch"!==e&&"pen"!==e&&"kinect"!==e||(r.add(new Vs.Pan({direction:Vs.DIRECTION_ALL,threshold:20,pointers:1})),r.add(new Vs.Pinch)),r},Gs.prototype._releaseHandle=function(t,e){var r=Ys(t,e);this._refCount[r]&&(this._refCount[r]--,this._refCount[r]||(this._managers[r].destroy(),delete this._managers[r],delete this._refCount[r]))},$s.prototype.on=function(t,e){var r=this._type,i=function(t){r===t.pointerType&&e(t)};this._eventHandlers.push({events:t,handler:i}),this._manager.on(t,i)},$s.prototype.release=function(){for(var t=0;t<this._eventHandlers.length;t++){var e=this._eventHandlers[t];this._manager.off(e.events,e.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},$s.prototype.manager=function(){return this._manager};var Us=new Gs;function Ks(t,e,r,i){var n=Math.atan(e/t);i[0]=r*Math.cos(n),i[1]=r*Math.sin(n)}var Zs=function(t,e,r,i,n){var o=Math.sqrt(Math.pow(e,2)+Math.pow(r,2));Ks(e,r,t=Math.max(t,o/i),n),n[0]=Math.abs(n[0]),n[1]=Math.abs(n[1])},Qs=Zs,Js={friction:6,maxFrictionTime:.3},ta="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;function ea(t,e,r){this._element=t,this._opts=ws(r||{},Js),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new Ns,y:new Ns},this._hammer=Us.get(t,e),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}ht(ea),ea.prototype.destroy=function(){this._hammer.release(),mt(this)},ea.prototype._handleHammerEvent=function(t){if(t.isFirst){if(ta&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(t.isFinal){if(ta&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},ea.prototype._handleStart=function(t){t.preventDefault(),this._startEvent=t},ea.prototype._handleMove=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsMove(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},ea.prototype._handleEnd=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},ea.prototype._updateDynamicsMove=function(t){var e=t.deltaX,r=t.deltaY,i=this._lastEvent||this._startEvent;i&&(e-=i.deltaX,r-=i.deltaY);var n=this._element.getBoundingClientRect();e/=n.right-n.left,r/=n.bottom-n.top,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-e,this._dynamics.y.offset=-r,this._lastEvent=t};var ra=[null,null];ea.prototype._updateDynamicsRelease=function(t){var e=this._element.getBoundingClientRect(),r=e.right-e.left,i=e.bottom-e.top,n=1e3*t.velocityX/r,o=1e3*t.velocityY/i;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=n,this._dynamics.y.velocity=o,Qs(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,ra),this._dynamics.x.friction=ra[0],this._dynamics.y.friction=ra[1]};var ia=ea,na=Zs,oa={speed:8,friction:6,maxFrictionTime:.3};function sa(t,e,r){this._element=t,this._opts=ws(r||{},oa),this._active=!1,this._hammer=Us.get(t,e),this._dynamics={x:new Ns,y:new Ns},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}ht(sa),sa.prototype.destroy=function(){this._hammer.release(),mt(this)},sa.prototype._handleStart=function(t){t.preventDefault(),this._active||(this._active=!0,this.emit("active"))},sa.prototype._handleMove=function(t){t.preventDefault(),this._updateDynamics(t,!1)},sa.prototype._handleRelease=function(t){t.preventDefault(),this._updateDynamics(t,!0),this._active&&(this._active=!1,this.emit("inactive"))};var aa=[null,null];sa.prototype._updateDynamics=function(t,e){var r=this._element.getBoundingClientRect(),i=r.right-r.left,n=r.bottom-r.top,o=Math.max(i,n),s=t.deltaX/o*this._opts.speed,a=t.deltaY/o*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=s,this._dynamics.y.velocity=a,e&&(na(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,aa),this._dynamics.x.friction=aa[0],this._dynamics.y.friction=aa[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)};var ha=sa,ua={frictionTime:.2,zoomDelta:.001};function ca(t,e){this._element=t,this._opts=ws(e||{},ua),this._dynamics=new Ns,this._eventList=[];var r=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=r.bind(this),t.addEventListener("wheel",this._wheelListener)}function la(t){var e=1==t.deltaMode?20:1;return t.deltaY*e}ht(ca),ca.prototype.destroy=function(){this._element.removeEventListener(this._wheelListener),mt(this)},ca.prototype.withoutSmoothing=function(t){this._dynamics.offset=la(t)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},ca.prototype.withSmoothing=function(t){var e=t.timeStamp;for(this._eventList.push(t);this._eventList[0].timeStamp<e-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var r=0,i=0;i<this._eventList.length;i++){r+=la(this._eventList[i])*this._opts.zoomDelta/this._opts.frictionTime}this._dynamics.velocity=r,this._dynamics.friction=Math.abs(r)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")};var fa=ca;function pa(t,e,r){this._hammer=Us.get(t,e),this._lastEvent=null,this._active=!1,this._dynamics=new Ns,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}ht(pa),pa.prototype.destroy=function(){this._hammer.release(),mt(this)},pa.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},pa.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},pa.prototype._handleEvent=function(t){var e=t.scale;this._lastEvent&&(e/=this._lastEvent.scale),this._dynamics.offset=-1*(e-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=t};var da=pa;function va(t){if(!t)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=t,this._dynamics=new Ns}ht(va),va.prototype.destroy=function(){mt(this)},va.prototype.setVelocity=function(t){this._dynamics.velocity=t,this.emit("parameterDynamics",this._parameter,this._dynamics)},va.prototype.setFriction=function(t){this._dynamics.friction=t,this.emit("parameterDynamics",this._parameter,this._dynamics)};var _a=va;function ma(t,e,r,i){if(!t)throw new Error("ElementPressControlMethod: element must be defined");if(!e)throw new Error("ElementPressControlMethod: parameter must be defined");if(!r)throw new Error("ElementPressControlMethod: velocity must be defined");if(!i)throw new Error("ElementPressControlMethod: friction must be defined");this._element=t,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),t.addEventListener("mousedown",this._pressHandler),t.addEventListener("mouseup",this._releaseHandler),t.addEventListener("mouseleave",this._releaseHandler),t.addEventListener("touchstart",this._pressHandler),t.addEventListener("touchmove",this._releaseHandler),t.addEventListener("touchend",this._releaseHandler),this._parameter=e,this._velocity=r,this._friction=i,this._dynamics=new Ns,this._pressing=!1}ht(ma),ma.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),mt(this)},ma.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},ma.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1};var ya=ma;function ga(t){t=t||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=t.nowForTesting||ut,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}ht(ga),ga.prototype.add=function(t){if(!this.has(t)){var e={};this._parameters.forEach((function(t){e[t]={dynamics:new Ns,time:null}}));var r=this._updateDynamics.bind(this,e),i={instance:t,dynamics:e,parameterDynamicsHandler:r};t.addEventListener("parameterDynamics",r),this._methods.push(i)}},ga.prototype.remove=function(t){var e=this._indexOfInstance(t);if(e>=0){var r=this._methods.splice(e,1)[0];r.instance.removeEventListener("parameterDynamics",r.parameterDynamicsHandler)}},ga.prototype.has=function(t){return this._indexOfInstance(t)>=0},ga.prototype._indexOfInstance=function(t){for(var e=0;e<this._methods.length;e++)if(this._methods[e].instance===t)return e;return-1},ga.prototype.list=function(){for(var t=[],e=0;e<this._methods.length;e++)t.push(this._methods[e].instance);return t},ga.prototype._updateDynamics=function(t,e,r){var i=t[e];if(!i)throw new Error("Unknown control parameter "+e);var n=this._now();i.dynamics.update(r,(n-i.time)/1e3),i.time=n,this.emit("change")},ga.prototype._resetComposedOffsets=function(){for(var t=0;t<this._parameters.length;t++)this._composedOffsets[this._parameters[t]]=0},ga.prototype.offsets=function(){var t,e=!1,r=this._now();this._resetComposedOffsets();for(var i=0;i<this._methods.length;i++)for(var n=this._methods[i].dynamics,o=0;o<this._parameters.length;o++){var s=n[t=this._parameters[o]],a=s.dynamics;null!=a.offset&&(this._composedOffsets[t]+=a.offset,a.offset=null);var h=(r-s.time)/1e3,u=a.offsetFromVelocity(h);u&&(this._composedOffsets[t]+=u);var c=a.velocityAfter(h);a.velocity=c,c&&(e=!0),s.time=r}return this._composeReturn.changing=e,this._composeReturn},ga.prototype.destroy=function(){for(var t=this.list(),e=0;e<t.length;e++)this.remove(t[e]);mt(this)};var Ma=ga,wa="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;function ba(t){t=t||{},this._methods={},this._methodGroups={},this._composer=new Ma,this._enabled=!t||!t.enabled||!!t.enabled,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}ht(ba),ba.prototype.destroy=function(){this.detach(),this._composer.destroy(),mt(this)},ba.prototype.methods=function(){var t={};for(var e in this._methods)t[e]=this._methods[e];return t},ba.prototype.method=function(t){return this._methods[t]},ba.prototype.registerMethod=function(t,e,r){if(this._methods[t])throw new Error("Control method already registered with id "+t);this._methods[t]={instance:e,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,t),inactiveHandler:this._handleInactive.bind(this,t)},r&&this.enableMethod(t,e)},ba.prototype.unregisterMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&this.disableMethod(t),delete this._methods[t]},ba.prototype.enableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled||(e.enabled=!0,e.active&&this._incrementActiveCount(),this._listen(t),this._updateComposer(),this.emit("methodEnabled",t))},ba.prototype.disableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&(e.enabled=!1,e.active&&this._decrementActiveCount(),this._unlisten(t),this._updateComposer(),this.emit("methodDisabled",t))},ba.prototype.addMethodGroup=function(t,e){this._methodGroups[t]=e},ba.prototype.removeMethodGroup=function(t){delete this._methodGroups[t]},ba.prototype.methodGroups=function(){var t={};for(var e in this._methodGroups)t[e]=this._methodGroups[e];return t},ba.prototype.enableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach((function(t){e.enableMethod(t)}))},ba.prototype.disableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach((function(t){e.disableMethod(t)}))},ba.prototype.enabled=function(){return this._enabled},ba.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},ba.prototype.disable=function(){this._enabled&&(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},ba.prototype.attach=function(t){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=t,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=t.renderOnNextFrame.bind(t),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},ba.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},ba.prototype.attached=function(){return null!=this._attachedRenderLoop},ba.prototype._listen=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.addEventListener("active",e.activeHandler),e.instance.addEventListener("inactive",e.inactiveHandler)},ba.prototype._unlisten=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.removeEventListener("active",e.activeHandler),e.instance.removeEventListener("inactive",e.inactiveHandler)},ba.prototype._handleActive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active||(e.active=!0,this._incrementActiveCount())},ba.prototype._handleInactive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active&&(e.active=!1,this._decrementActiveCount())},ba.prototype._incrementActiveCount=function(){this._activeCount++,wa&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},ba.prototype._decrementActiveCount=function(){this._activeCount--,wa&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},ba.prototype._checkActiveCount=function(){var t=0;for(var e in this._methods){var r=this._methods[e];r.enabled&&r.active&&t++}if(t!=this._activeCount)throw new Error("Bad control state")},ba.prototype._updateComposer=function(){var t=this._composer;for(var e in this._methods){var r=this._methods[e],i=this._enabled&&r.enabled;i&&!t.has(r.instance)&&t.add(r.instance),!i&&t.has(r.instance)&&t.remove(r.instance)}},ba.prototype._updateViewsWithControls=function(){var t=this._composer.offsets();t.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var e=this._attachedRenderLoop.stage().listLayers(),r=0;r<e.length;r++){var i=e[r].view();this.updatedViews_.indexOf(i)<0&&(e[r].view().updateWithControlParameters(t.offsets),this.updatedViews_.push(i))}};var xa=ba,Ea=Xt.setTransform;var Ta=function(t,e,r,i){i=i||"";var n="translateX("+Xo(e)+"px) translateY("+Xo(r)+"px) translateZ(0) "+i;Ea(t,n)},Sa=Xt.setTransform;function La(t,e,r,i,n){(n=n||{}).perspective=n.perspective||{},n.perspective.extraTransforms=null!=n.perspective.extraTransforms?n.perspective.extraTransforms:"",this._domElement=t,this._parentDomElement=e,this._view=r,this._coords={},this._perspective={},this.setPosition(i),this._parentDomElement.appendChild(this._domElement),this.setPerspective(n.perspective),this._visible=!0,this._position={x:0,y:0}}ht(La),La.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),mt(this)},La.prototype.domElement=function(){return this._domElement},La.prototype.position=function(){return this._coords},La.prototype.setPosition=function(t){for(var e in t)this._coords[e]=t[e];this._update()},La.prototype.perspective=function(){return this._perspective},La.prototype.setPerspective=function(t){for(var e in t)this._perspective[e]=t[e];this._update()},La.prototype.show=function(){this._visible||(this._visible=!0,this._update())},La.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},La.prototype._update=function(){var t,e,r=this._domElement,i=this._coords,n=this._position,o=!1;if(this._visible){var s=this._view;this._perspective.radius?(o=!0,this._setEmbeddedPosition(s,i)):(s.coordinatesToScreen(i,n),t=n.x,e=n.y,null!=t&&null!=e&&(o=!0,this._setPosition(t,e)))}o?(r.style.display="block",r.style.position="absolute"):(r.style.display="none",r.style.position="")},La.prototype._setEmbeddedPosition=function(t,e){var r=t.coordinatesToPerspectiveTransform(e,this._perspective.radius,this._perspective.extraTransforms);Sa(this._domElement,r)},La.prototype._setPosition=function(t,e){Ta(this._domElement,t,e,this._perspective.extraTransforms)};var Aa=La,Pa=Xt.setAbsolute,Ca=Xt.setOverflowHidden,Ra=Xt.setOverflowVisible,za=Xt.setNullSize,Oa=Xt.setPixelSize,Fa=Xt.setWithVendorPrefix("pointer-events");function Ia(t,e,r,i,n){n=n||{},this._parentDomElement=t,this._stage=e,this._view=r,this._renderLoop=i,this._hotspots=[],this._visible=!0,this._rect=n.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Pa(this._hotspotContainerWrapper),Fa(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Pa(this._hotspotContainer),Fa(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}ht(Ia),Ia.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),mt(this)},Ia.prototype.domElement=function(){return this._hotspotContainer},Ia.prototype.setRect=function(t){this._rect=t,this._visibilityOrRectChanged=!0},Ia.prototype.rect=function(){return this._rect},Ia.prototype.createHotspot=function(t,e,r){e=e||{};var i=new Aa(t,this._hotspotContainer,this._view,e,r);return this._hotspots.push(i),i._update(),this.emit("hotspotsChange"),i},Ia.prototype.hasHotspot=function(t){return this._hotspots.indexOf(t)>=0},Ia.prototype.listHotspots=function(){return[].concat(this._hotspots)},Ia.prototype.destroyHotspot=function(t){var e=this._hotspots.indexOf(t);if(e<0)throw new Error("No such hotspot");this._hotspots.splice(e,1),t.destroy(),this.emit("hotspotsChange")},Ia.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},Ia.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},Ia.prototype._update=function(){var t=this._hotspotContainerWrapper,e=this._stage.width(),r=this._stage.height(),i=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(e!==this._stageWidth||r!==this._stageHeight)){var n=this._visible;t.style.display=n?"block":"none",n&&(this._rect?(pt(e,r,this._rect,i),Ta(t,e*i.x,r*i.y),Oa(t,e*i.width,r*i.height),Ca(t)):(Ta(t,0,0),za(t),Ra(t))),this._stageWidth=e,this._stageHeight=r,this._visibilityOrRectChanged=!1}for(var o=0;o<this._hotspots.length;o++)this._hotspots[o]._update()};var ka=Ia;function Ha(t,e){this._viewer=t,this._view=e,this._layers=[],this._hotspotContainer=new ka(t._controlContainer,t.stage(),this._view,t.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}ht(Ha),Ha.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),mt(this)},Ha.prototype.hotspotContainer=function(){return this._hotspotContainer},Ha.prototype.layer=function(){return this._layers[0]},Ha.prototype.listLayers=function(){return[].concat(this._layers)},Ha.prototype.view=function(){return this._view},Ha.prototype.viewer=function(){return this._viewer},Ha.prototype.visible=function(){return this._viewer.scene()===this},Ha.prototype.createLayer=function(t){var e=(t=t||{}).textureStoreOpts||{},r=t.layerOpts||{},i=t.source,n=t.geometry,o=this._view,s=this._viewer.stage(),a=new Os(i,s,e),h=new ks(i,n,o,a,r);return this._layers.push(h),t.pinFirstLevel&&h.pinFirstLevel(),this.emit("layerChange"),h},Ha.prototype.destroyLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in scene");this._layers.splice(e,1),this.emit("layerChange"),t.textureStore().destroy(),t.destroy()},Ha.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},Ha.prototype.switchTo=function(t,e){return this._viewer.switchScene(this,t,e)},Ha.prototype.lookTo=function(t,e,r){if(e=e||{},r=r||ss,"object"!==ao(t))throw new Error("Target view parameters must be an object");var i=null!=e.ease?e.ease:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},n=null!=e.controlsInterrupt&&e.controlsInterrupt,o=null!=e.transitionDuration?e.transitionDuration:1e3,s=null==e.shortest||e.shortest,a=this._view,h=a.parameters(),u={};ws(u,t),ws(u,h),s&&a.normalizeToClosest&&a.normalizeToClosest(u,u);var c=this._viewer.controls().enabled();n||this._viewer.controls().disable(),this.startMovement((function(){var t=!1;return function(e,r){if(r>=o&&t)return null;var n=Math.min(r/o,1);for(var s in e){var a=h[s],c=u[s];e[s]=a+i(n)*(c-a)}return t=r>=o,e}}),(function(){c&&this._viewer.controls().enable(),r()}))},Ha.prototype.startMovement=function(t,e){var r=this._viewer.renderLoop();this._movement&&this.stopMovement();var i=t();if("function"!=typeof i)throw new Error("Bad movement");this._movement=t,this._movementStep=i,this._movementStartTime=ut(),this._movementParams={},this._movementCallback=e,r.addEventListener("beforeRender",this._updateMovementHandler),r.renderOnNextFrame()},Ha.prototype.stopMovement=function(){var t=this._viewer.renderLoop();this._movement&&(this._movementCallback&&this._movementCallback(),t.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null)},Ha.prototype.movement=function(){return this._movement},Ha.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var t=this._viewer.renderLoop(),e=this._view,r=ut()-this._movementStartTime,i=this._movementStep,n=this._movementParams;null==(n=i(n=e.parameters(n),r))?this.stopMovement():(e.setParameters(n),t.renderOnNextFrame())},Ha.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()};var Da=Ha,Ba={duration:1/0};function Na(t){t=ws(t||{},Ba),this._duration=t.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}ht(Na),Na.prototype.start=function(){this._startTime=ut(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},Na.prototype.started=function(){return null!=this._startTime},Na.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},Na.prototype._setup=function(t){this._handle=setTimeout(this._check,t)},Na.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Na.prototype._check=function(){var t=ut()-this._startTime,e=this._duration-t;this._teardown(),e<=0?(this.emit("timeout"),this._startTime=null):e<1/0&&this._setup(e)},Na.prototype.duration=function(){return this._duration},Na.prototype.setDuration=function(t){this._duration=t,null!=this._startTime&&this._check()};var qa=Na,ja={active:"move",inactive:"default",disabled:"default"};function Va(t,e,r,i){i=ws(i||{},ja),this._element=r,this._controls=t,this._id=e,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,i.active),this._setInactiveCursor=this._setCursor.bind(this,i.inactive),this._setDisabledCursor=this._setCursor.bind(this,i.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),t.addEventListener("methodEnabled",this._updateAttachmentHandler),t.addEventListener("methodDisabled",this._updateAttachmentHandler),t.addEventListener("enabled",this._updateAttachmentHandler),t.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}Va.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),mt(this)},Va.prototype._updateAttachment=function(){var t=this._controls,e=this._id;t.enabled()&&t.method(e).enabled?this._attachToControlMethod(t.method(e)):this._detachFromControlMethod(t.method(e))},Va.prototype._attachToControlMethod=function(t){this._attached||(t.instance.addEventListener("active",this._setActiveCursor),t.instance.addEventListener("inactive",this._setInactiveCursor),t.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},Va.prototype._detachFromControlMethod=function(t){this._attached&&(t.instance.removeEventListener("active",this._setActiveCursor),t.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},Va.prototype._setCursor=function(t){this._element.style.cursor=t};var Xa=Va,Wa={mouseViewMode:"drag"};var Ya=function(t,e,r){r=ws(r||{},Wa);var i={mouseViewDrag:new ia(e,"mouse"),mouseViewQtvr:new ha(e,"mouse"),touchView:new ia(e,"touch"),pinch:new da(e,"touch"),leftArrowKey:new js(37,"x",-.7,3),rightArrowKey:new js(39,"x",.7,3),upArrowKey:new js(38,"y",-.7,3),downArrowKey:new js(40,"y",.7,3),plusKey:new js(107,"zoom",-.7,3),minusKey:new js(109,"zoom",.7,3),wKey:new js(87,"y",-.7,3),aKey:new js(65,"x",-.7,3),sKey:new js(83,"y",.7,3),dKey:new js(68,"x",.7,3),qKey:new js(81,"roll",.7,3),eKey:new js(69,"roll",-.7,3)};!1!==r.scrollZoom&&(i.scrollZoom=new fa(e));var n={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]},o=["scrollZoom","touchView","pinch"];switch(r.mouseViewMode){case"drag":o.push("mouseViewDrag");break;case"qtvr":o.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+r.mouseViewMode)}for(var s in i){var a=i[s];t.registerMethod(s,a),o.indexOf(s)>=0&&t.enableMethod(s)}for(var h in n){var u=n[h];t.addMethodGroup(h,u)}return i};var Ga=function(t,e,r){var i=!1,n=ut();return e(0),requestAnimationFrame((function o(){if(!i){var s=(ut()-n)/t;s<1?(e(s),requestAnimationFrame(o)):(e(1),r())}})),function(){i=!0,r.apply(null,arguments)}},$a=Xt.setOverflowHidden,Ua=Xt.setAbsolute,Ka=Xt.setFullSize,Za=Xt.setBlocking;function Qa(t,e){e=e||{},this._domElement=t,$a(t),this._stage=new Kt(e.stage),$n(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),Ua(this._controlContainer),Ka(this._controlContainer),Ht.ios&&this._controlContainer.addEventListener("touchmove",(function(t){t.preventDefault()}));var r=document.createElement("div");Ua(r),Ka(r),Za(r),this._controlContainer.appendChild(r),t.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new Ds(this._stage),this._controls=new xa,this._controlMethods=Ya(this._controls,this._controlContainer,e.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=Us.get(this._controlContainer,"touch"),this._hammerManagerMouse=Us.get(this._controlContainer,"mouse"),this._dragCursor=new Xa(this._controls,"mouseViewDrag",t,e.cursors&&e.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new qa,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}ht(Qa),Qa.prototype.destroy=function(){for(var t in window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy(),this._controlMethods)this._controlMethods[t].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),mt(this)},Qa.prototype.updateSize=function(){var t=this._size;t.width=this._domElement.clientWidth,t.height=this._domElement.clientHeight,this._stage.setSize(t)},Qa.prototype.stage=function(){return this._stage},Qa.prototype.renderLoop=function(){return this._renderLoop},Qa.prototype.controls=function(){return this._controls},Qa.prototype.domElement=function(){return this._domElement},Qa.prototype.createScene=function(t){t=t||{};var e=this.createEmptyScene({view:t.view});return e.createLayer({source:t.source,geometry:t.geometry,pinFirstLevel:t.pinFirstLevel,textureStoreOpts:t.textureStoreOpts,layerOpts:t.layerOpts}),e},Qa.prototype.createEmptyScene=function(t){var e=new Da(this,(t=t||{}).view);return this._scenes.push(e),e},Qa.prototype._updateSceneLayers=function(){var t,e,r=this._stage,i=this._currentScene,n=this._replacedScene,o=r.listLayers(),s=[];if(n&&(s=s.concat(n.listLayers())),i&&(s=s.concat(i.listLayers())),1!==Math.abs(o.length-s.length))throw new Error("Stage and scene out of sync");if(s.length<o.length)for(t=0;t<o.length;t++)if(e=o[t],s.indexOf(e)<0){this._removeLayerFromStage(e);break}if(s.length>o.length)for(t=0;t<s.length;t++)e=s[t],o.indexOf(e)<0&&this._addLayerToStage(e,t)},Qa.prototype._addLayerToStage=function(t,e){t.pinFirstLevel(),this._stage.addLayer(t,e)},Qa.prototype._removeLayerFromStage=function(t){this._stage.removeLayer(t),t.unpinFirstLevel(),t.textureStore().clearNotPinned()},Qa.prototype._addSceneEventListeners=function(t){t.addEventListener("layerChange",this._layerChangeHandler),t.addEventListener("viewChange",this._viewChangeHandler)},Qa.prototype._removeSceneEventListeners=function(t){t.removeEventListener("layerChange",this._layerChangeHandler),t.removeEventListener("viewChange",this._viewChangeHandler)},Qa.prototype.destroyScene=function(t){var e,r,i=this._scenes.indexOf(t);if(i<0)throw new Error("No such scene in viewer");if(this._currentScene===t){for(this._removeSceneEventListeners(t),r=t.listLayers(),e=0;e<r.length;e++)this._removeLayerFromStage(r[e]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===t){for(this._removeSceneEventListeners(t),r=t.listLayers(),e=0;e<r.length;e++)this._removeLayerFromStage(r[e]);this._replacedScene=null}this._scenes.splice(i,1),t.destroy()},Qa.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},Qa.prototype.hasScene=function(t){return this._scenes.indexOf(t)>=0},Qa.prototype.listScenes=function(){return[].concat(this._scenes)},Qa.prototype.scene=function(){return this._currentScene},Qa.prototype.view=function(){var t=this._currentScene;return t?t.view():null},Qa.prototype.lookTo=function(t,e,r){var i=this._currentScene;i&&i.lookTo(t,e,r)},Qa.prototype.startMovement=function(t,e){var r=this._currentScene;r&&r.startMovement(t,e)},Qa.prototype.stopMovement=function(){var t=this._currentScene;t&&t.stopMovement()},Qa.prototype.movement=function(){var t=this._currentScene;if(t)return t.movement()},Qa.prototype.setIdleMovement=function(t,e){this._idleTimer.setDuration(t),this._idleMovement=e},Qa.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},Qa.prototype._resetIdleTimer=function(){this._idleTimer.start()},Qa.prototype._triggerIdleTimer=function(){var t=this._idleMovement;t&&this.startMovement(t)};function Ja(t,e,r){e.listLayers().forEach((function(e){e.mergeEffects({opacity:t})})),e._hotspotContainer.domElement().style.opacity=t}Qa.prototype.switchScene=function(t,e,r){var i=this;e=e||{},r=r||ss;var n=this._stage,o=this._currentScene;if(o!==t){if(this._scenes.indexOf(t)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var s=o?o.listLayers():[],a=t.listLayers(),h=n.listLayers();if(o&&(h.length!==s.length||h.length>1&&h[0]!=s[0]))throw new Error("Stage not in sync with viewer");for(var u=null!=e.transitionDuration?e.transitionDuration:1e3,c=null!=e.transitionUpdate?e.transitionUpdate:Ja,l=0;l<a.length;l++)this._addLayerToStage(a[l]);this._cancelCurrentTween=Ga(u,(function(e){c(e,t,o)}),(function(){if(i._replacedScene){i._removeSceneEventListeners(i._replacedScene),s=i._replacedScene.listLayers();for(var t=0;t<s.length;t++)i._removeLayerFromStage(s[t]);i._replacedScene=null}i._cancelCurrentTween=null,r()})),this._currentScene=t,this._replacedScene=o,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(t)}else r()};var th=Qa,eh=ki.vec4,rh=ki.mat4;function ih(t,e,r){var i,n,o,s,a,h,u;i=r,n=t,o=e.colorMatrix,s=n[0],a=n[1],h=n[2],u=n[3],i[0]=o[0]*s+o[1]*a+o[2]*h+o[3]*u,i[1]=o[4]*s+o[5]*a+o[6]*h+o[7]*u,i[2]=o[8]*s+o[9]*a+o[10]*h+o[11]*u,i[3]=o[12]*s+o[13]*a+o[14]*h+o[15]*u,eh.add(r,r,e.colorOffset)}var nh=eh.create();var oh=.01,sh={yawSpeed:.1,pitchSpeed:.1,fovSpeed:.1,yawAccel:oh,pitchAccel:oh,fovAccel:oh,targetPitch:0,targetFov:null};var ah={WebGlStage:Kt,WebGlCubeRenderer:Tn,WebGlFlatRenderer:Ln,WebGlEquirectRenderer:Gn,registerDefaultRenderers:$n,CubeGeometry:Lo,FlatGeometry:ko,EquirectGeometry:No,RectilinearView:Zo,FlatView:is,ImageUrlSource:fs,SingleAssetSource:ds,StaticAsset:Ct,DynamicAsset:_s,TextureStore:Os,Layer:ks,RenderLoop:Ds,KeyControlMethod:js,DragControlMethod:ia,QtvrControlMethod:ha,ScrollZoomControlMethod:fa,PinchZoomControlMethod:da,VelocityControlMethod:_a,ElementPressControlMethod:ya,Controls:xa,Dynamics:Ns,Viewer:th,Scene:Da,Hotspot:Aa,HotspotContainer:ka,colorEffects:{identity:function(t){var e=t||{};return e.colorOffset=e.colorOffset||eh.create(),e.colorMatrix=e.colorMatrix||rh.create(),e},applyToPixel:ih,applyToImageData:function(t,e){for(var r=t.width,i=t.height,n=t.data,o=0;o<r*i;o++)eh.set(nh,n[4*o+0]/255,n[4*o+1]/255,n[4*o+2]/255,n[4*o+3]/255),ih(nh,e,nh),n[4*o+0]=255*nh[0],n[4*o+1]=255*nh[1],n[4*o+2]=255*nh[2],n[4*o+3]=255*nh[3]}},registerDefaultControls:Ya,autorotate:function(t){var e=(t=ws(t||{},sh)).yawSpeed,r=t.pitchSpeed,i=t.fovSpeed,n=t.yawAccel,o=t.pitchAccel,s=t.fovAccel,a=t.targetPitch,h=t.targetFov;return function(){var t,u,c,l,f=0,p=0,d=0,v=0,_=0,m=0,y=0;return function(g,M){if(t=(M-f)/1e3,_=Math.min(p+t*n,e),u=_*t,g.yaw=g.yaw+u,null!=a&&g.pitch!==a){var w=.5*d*d/o;m=Math.abs(a-g.pitch)>w?Math.min(d+t*o,r):Math.max(d-t*o,0),c=m*t,a<g.pitch&&(g.pitch=Math.max(a,g.pitch-c)),a>g.pitch&&(g.pitch=Math.min(a,g.pitch+c))}if(null!=h&&g.fov!==a){var b=.5*v*v/s;y=Math.abs(h-g.fov)>b?Math.min(v+t*s,i):Math.max(v-t*s,0),l=y*t,h<g.fov&&(g.fov=Math.max(h,g.fov-l)),h>g.fov&&(g.fov=Math.min(h,g.fov+l))}return f=M,p=_,d=m,v=y,g}}},util:{async:dt,cancelize:_t,chain:as,clamp:Ii,clearOwnProperties:mt,cmp:oo,compose:Wo,convertFov:jo,decimal:Xo,defaults:ws,defer:function(t,e){setTimeout((function(){e&&e.length>0?t.apply(null,e):t()}),0)},degToRad:function(t){return t*Math.PI/180},delay:hs,dom:Xt,extend:Fs,hash:Un,inherits:Rt,mod:Kn,noop:ss,now:ut,once:vt,pixelRatio:Dt,radToDeg:function(t){return 180*t/Math.PI},real:Vo,retry:bs,tween:Ga,type:ao},dependencies:{bowser:Ht,glMatrix:ki,eventEmitter:ht,hammerjs:Vs}};function hh(t,e,r){const i=t.slice();return i[15]=e[r],i[17]=r,i}function uh(t,e,r){const i=t.slice();return i[15]=e[r],i[17]=r,i}function ch(t,e,r){const i=t.slice();return i[19]=e[r],i}function lh(t){let e,r,i=t[4].scenes,n=[];for(let e=0;e<i.length;e+=1)n[e]=mh(uh(t,i,e));const o=t=>q(n[t],1,1,(()=>{n[t]=null}));return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=y()},m(t,i){for(let e=0;e<n.length;e+=1)n[e].m(t,i);l(t,e,i),r=!0},p(t,r){if(18&r){let s;for(i=t[4].scenes,s=0;s<i.length;s+=1){const o=uh(t,i,s);n[s]?(n[s].p(o,r),N(n[s],1)):(n[s]=mh(o),n[s].c(),N(n[s],1),n[s].m(e.parentNode,e))}for(D(),s=i.length;s<n.length;s+=1)o(s);B()}},i(t){if(!r){for(let t=0;t<i.length;t+=1)N(n[t]);r=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)q(n[t]);r=!1},d(t){p(n,t),t&&f(e)}}}function fh(e){let r,i;return r=new it({}),{c(){j(r.$$.fragment)},m(t,e){V(r,t,e),i=!0},p:t,i(t){i||(N(r.$$.fragment,t),i=!0)},o(t){q(r.$$.fragment,t),i=!1},d(t){X(r,t)}}}function ph(t){let e,r;function i(){return t[7](t[19])}return e=new st({props:{func:i}}),{c(){j(e.$$.fragment)},m(t,i){V(e,t,i),r=!0},p(r,n){t=r;const o={};18&n&&(o.func=i),e.$set(o)},i(t){r||(N(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function dh(t){let e,r;return e=new tt({props:{type:t[19].dataType,value:"2",$$slots:{default:[vh]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},m(t,i){V(e,t,i),r=!0},p(t,r){const i={};16&r&&(i.type=t[19].dataType),4194304&r&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){r||(N(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){X(e,t)}}}function vh(e){let r;return{c(){r=_("0")},m(t,e){l(t,r,e)},p:t,d(t){t&&f(r)}}}function _h(e){let r,i,o,s,a,h,u,p,v,_,y;const g=[dh,ph,fh],w=[];function b(t,e){return"data"==t[19].type?0:"scene"==t[19].type?1:"info"==t[19].type?2:-1}return~(i=b(e))&&(o=w[i]=g[i](e)),{c(){r=d("div"),o&&o.c(),s=m(),M(r,"data-scene-index",a=e[17]),M(r,"data-yaw",h=e[19].yaw),M(r,"data-pitch",u=e[19].pitch)},m(o,a){var h;l(o,r,a),~i&&w[i].m(r,null),c(r,s),v=!0,_||(h=p=e[5].call(null,r),y=h&&n(h.destroy)?h.destroy:t,_=!0)},p(t,e){let n=i;i=b(t),i===n?~i&&w[i].p(t,e):(o&&(D(),q(w[n],1,1,(()=>{w[n]=null})),B()),~i?(o=w[i],o?o.p(t,e):(o=w[i]=g[i](t),o.c()),N(o,1),o.m(r,s)):o=null),(!v||16&e&&h!==(h=t[19].yaw))&&M(r,"data-yaw",h),(!v||16&e&&u!==(u=t[19].pitch))&&M(r,"data-pitch",u)},i(t){v||(N(o),v=!0)},o(t){q(o),v=!1},d(t){t&&f(r),~i&&w[i].d(),_=!1,y()}}}function mh(t){let e,r,i=t[15].hotspots,n=[];for(let e=0;e<i.length;e+=1)n[e]=_h(ch(t,i,e));const o=t=>q(n[t],1,1,(()=>{n[t]=null}));return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=y()},m(t,i){for(let e=0;e<n.length;e+=1)n[e].m(t,i);l(t,e,i),r=!0},p(t,r){if(18&r){let s;for(i=t[15].hotspots,s=0;s<i.length;s+=1){const o=ch(t,i,s);n[s]?(n[s].p(o,r),N(n[s],1)):(n[s]=_h(o),n[s].c(),N(n[s],1),n[s].m(e.parentNode,e))}for(D(),s=i.length;s<n.length;s+=1)o(s);B()}},i(t){if(!r){for(let t=0;t<i.length;t+=1)N(n[t]);r=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)q(n[t]);r=!1},d(t){p(n,t),t&&f(e)}}}function yh(t){let e,r,i,n,o,s,a,h,p,v,y=t[15].name+"";return{c(){e=d("li"),r=d("label"),i=d("input"),o=m(),s=_(y),h=m(),M(i,"type","radio"),i.__value=n=t[17],i.value=i.__value,M(i,"class","svelte-komer1"),t[10][0].push(i),M(r,"class",a=u(t[17]==t[1]?"active":"")+" svelte-komer1")},m(n,a){l(n,e,a),c(e,r),c(r,i),i.checked=i.__value===t[1],c(r,o),c(r,s),c(e,h),p||(v=g(i,"change",t[9]),p=!0)},p(t,e){2&e&&(i.checked=i.__value===t[1]),1&e&&y!==(y=t[15].name+"")&&w(s,y),2&e&&a!==(a=u(t[17]==t[1]?"active":"")+" svelte-komer1")&&M(r,"class",a)},d(r){r&&f(e),t[10][0].splice(t[10][0].indexOf(i),1),p=!1,v()}}}function gh(t){let e,r,i,n,o,s,a,h=t[4]&&lh(t),u=t[0],v=[];for(let e=0;e<u.length;e+=1)v[e]=yh(hh(t,u,e));return{c(){e=d("div"),r=d("div"),i=m(),h&&h.c(),n=m(),o=d("div"),s=d("ul");for(let t=0;t<v.length;t+=1)v[t].c();M(r,"class","panorama-container svelte-komer1"),M(s,"class","svelte-komer1"),M(o,"class","scene-list svelte-komer1")},m(u,f){l(u,e,f),c(e,r),t[6](r),c(e,i),h&&h.m(e,null),t[8](e),l(u,n,f),l(u,o,f),c(o,s);for(let t=0;t<v.length;t+=1)v[t].m(s,null);a=!0},p(t,[r]){if(t[4]?h?(h.p(t,r),16&r&&N(h,1)):(h=lh(t),h.c(),N(h,1),h.m(e,null)):h&&(D(),q(h,1,1,(()=>{h=null})),B()),3&r){let e;for(u=t[0],e=0;e<u.length;e+=1){const i=hh(t,u,e);v[e]?v[e].p(i,r):(v[e]=yh(i),v[e].c(),v[e].m(s,null))}for(;e<v.length;e+=1)v[e].d(1);v.length=u.length}},i(t){a||(N(h),a=!0)},o(t){q(h),a=!1},d(r){r&&f(e),t[6](null),h&&h.d(),t[8](null),r&&f(n),r&&f(o),p(v,r)}}}function Mh(t,e,r){var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))};let n,o,s,a=[],h=0;const u=window.location.href,c=u+"/config.json";E((()=>i(void 0,void 0,void 0,(function*(){const t=new ah.Viewer(o);if(r(4,s=yield function(){return i(this,void 0,void 0,(function*(){return yield fetch(u+"/config.json").then((t=>t.json())).catch((t=>{console.warn("Failed to fetch config from "+c)}))}))}()),s&&s.scenes)for(const e of s.scenes){const i=ah.ImageUrlSource.fromString(u+e.url),n=new ah.EquirectGeometry([{width:2048}]),o=ah.RectilinearView.limit.traditional(1024,100*Math.PI/180),s=new ah.RectilinearView({yaw:0},o),h=t.createScene({source:i,geometry:n,view:s,pinFirstLevel:!0});r(0,a=[...a,{name:e.name,scene:h}])}o.addEventListener("click",(t=>{console.log(a[h].scene.view().screenToCoordinates({x:t.x,y:t.y}))}))}))));return t.$$.update=()=>{3&t.$$.dirty&&null!=h&&a.length>0&&a[h].scene.switchTo()},[a,h,n,o,s,function(t){const e=t.dataset.sceneIndex;e&&a[Number(e)].scene.hotspotContainer().createHotspot(t,{yaw:Number(t.dataset.yaw),pitch:Number(t.dataset.pitch)},{perspective:{radius:1024}})},function(t){S[t?"unshift":"push"]((()=>{o=t,r(3,o)}))},t=>{r(1,h=t.sceneIndex)},function(t){S[t?"unshift":"push"]((()=>{n=t,r(2,n)}))},function(){h=this.__value,r(1,h)},[[]]]}class wh extends G{constructor(t){super(),Y(this,t,Mh,gh,o,{})}}function bh(e){let r,i;return r=new wh({}),{c(){j(r.$$.fragment)},m(t,e){V(r,t,e),i=!0},p:t,i(t){i||(N(r.$$.fragment,t),i=!0)},o(t){q(r.$$.fragment,t),i=!1},d(t){X(r,t)}}}return new class extends G{constructor(t){super(),Y(this,t,null,bh,o,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
