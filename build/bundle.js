var app=function(){"use strict";function t(){}function e(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(e)}function n(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e,r,i){if(t){const n=a(t,e,r,i);return t[0](n)}}function a(t,e,r,i){return t[1]&&i?function(t,e){for(const r in e)t[r]=e[r];return t}(r.ctx.slice(),t[1](i(e))):r.ctx}function h(t,e,r,i,n,o,s){const h=function(t,e,r,i){if(t[2]&&i){const n=t[2](i(r));if(void 0===e.dirty)return n;if("object"==typeof n){const t=[],r=Math.max(e.dirty.length,n.length);for(let i=0;i<r;i+=1)t[i]=e.dirty[i]|n[i];return t}return e.dirty|n}return e.dirty}(e,i,n,o);if(h){const n=a(e,r,i,s);t.p(n,h)}}function u(t){return null==t?"":t}function l(t,e){t.appendChild(e)}function c(t,e,r){t.insertBefore(e,r||null)}function f(t){t.parentNode.removeChild(t)}function d(t,e){for(let r=0;r<t.length;r+=1)t[r]&&t[r].d(e)}function p(t){return document.createElement(t)}function m(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function v(t){return document.createTextNode(t)}function _(){return v(" ")}function y(){return v("")}function g(t,e,r,i){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r,i)}function w(t,e,r){null==r?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function M(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}let b;function x(t){b=t}function E(){if(!b)throw new Error("Function called outside component initialization");return b}function T(t){E().$$.on_destroy.push(t)}const S=[],L=[],A=[],C=[],P=Promise.resolve();let R=!1;function O(t){A.push(t)}let z=!1;const F=new Set;function I(){if(!z){z=!0;do{for(let t=0;t<S.length;t+=1){const e=S[t];x(e),k(e.$$)}for(x(null),S.length=0;L.length;)L.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];F.has(e)||(F.add(e),e())}A.length=0}while(S.length);for(;C.length;)C.pop()();R=!1,z=!1,F.clear()}}function k(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(O)}}const D=new Set;let B;function H(){B={r:0,c:[],p:B}}function N(){B.r||i(B.c),B=B.p}function j(t,e){t&&t.i&&(D.delete(t),t.i(e))}function q(t,e,r,i){if(t&&t.o){if(D.has(t))return;D.add(t),B.c.push((()=>{D.delete(t),i&&(r&&t.d(1),i())})),t.o(e)}}function V(t){t&&t.c()}function $(t,r,o){const{fragment:s,on_mount:a,on_destroy:h,after_update:u}=t.$$;s&&s.m(r,o),O((()=>{const r=a.map(e).filter(n);h?h.push(...r):i(r),t.$$.on_mount=[]})),u.forEach(O)}function W(t,e){const r=t.$$;null!==r.fragment&&(i(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function X(t,e){-1===t.$$.dirty[0]&&(S.push(t),R||(R=!0,P.then(I)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Y(e,n,o,s,a,h,u=[-1]){const l=b;x(e);const c=n.props||{},d=e.$$={fragment:null,ctx:null,props:h,update:t,not_equal:a,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(l?l.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let p=!1;if(d.ctx=o?o(e,c,((t,r,...i)=>{const n=i.length?i[0]:r;return d.ctx&&a(d.ctx[t],d.ctx[t]=n)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](n),p&&X(e,t)),r})):[],d.update(),p=!0,i(d.before_update),d.fragment=!!s&&s(d.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);d.fragment&&d.fragment.l(t),t.forEach(f)}else d.fragment&&d.fragment.c();n.intro&&j(e.$$.fragment),$(e,n.target,n.anchor),I()}x(l)}class U{$destroy(){W(this,1),this.$destroy=t}$on(t,e){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const G=t=>({}),K=t=>({}),Z=t=>({}),Q=t=>({}),J=t=>({}),tt=t=>({});function et(t){let e,r,i,n,o,a,u,d,_,y;const g=t[5].title,b=s(g,t,t[4],tt),x=b||function(t){let e;return{c(){e=v(t[0])},m(t,r){c(t,e,r)},p(t,r){1&r&&M(e,t[0])},d(t){t&&f(e)}}}(t),E=t[5].value,T=s(E,t,t[4],Q),S=T||function(t){let e;return{c(){e=v(t[1])},m(t,r){c(t,e,r)},p(t,r){2&r&&M(e,t[1])},d(t){t&&f(e)}}}(t),L=t[5].unit,A=s(L,t,t[4],K),C=A||function(t){let e,r=` ${t[3][t[0]].unit}`;return{c(){e=v(r)},m(t,r){c(t,e,r)},p(t,i){1&i&&r!==(r=` ${t[3][t[0]].unit}`)&&M(e,r)},d(t){t&&f(e)}}}(t),P=t[5].default,R=s(P,t,t[4],null);return{c(){e=p("div"),r=m("svg"),i=m("g"),n=m("g"),o=m("rect"),a=m("rect"),d=m("text"),x&&x.c(),_=m("text"),S&&S.c(),C&&C.c(),R&&R.c(),w(o,"width","204"),w(o,"height","60"),w(o,"stroke","none"),w(a,"x","-2.5"),w(a,"y","-2.5"),w(a,"width","209"),w(a,"height","65"),w(a,"fill","none"),w(n,"transform","translate(657 552)"),w(n,"fill","#1b191c"),w(n,"stroke",u=t[3][t[0]].color),w(n,"stroke-width","5"),w(n,"opacity","0.88"),w(d,"class","type svelte-nwsa11"),w(d,"transform","translate(669 573)"),w(d,"fill","#d6d6d6"),w(d,"font-size","16"),w(d,"font-family","OpenSans, Open Sans"),w(d,"letter-spacing","0.01em"),w(_,"class","value"),w(_,"transform","translate(669 602)"),w(_,"fill","#fcfcfc"),w(_,"font-size","26"),w(_,"font-family","OpenSans-Semibold, Open Sans"),w(_,"font-weight","600"),w(i,"transform","translate(-652 -547)"),w(r,"xmlns","http://www.w3.org/2000/svg"),w(r,"width","100%"),w(r,"height","100%"),w(r,"viewBox","0 0 214 70"),w(e,"class","svelte-nwsa11")},m(s,h){c(s,e,h),l(e,r),l(r,i),l(i,n),l(n,o),l(n,a),l(i,d),x&&x.m(d,null),l(i,_),S&&S.m(_,null),C&&C.m(_,null),R&&R.m(_,null),t[6](e),y=!0},p(t,[e]){(!y||1&e&&u!==(u=t[3][t[0]].color))&&w(n,"stroke",u),b?b.p&&16&e&&h(b,g,t,t[4],e,J,tt):x&&x.p&&1&e&&x.p(t,e),T?T.p&&16&e&&h(T,E,t,t[4],e,Z,Q):S&&S.p&&2&e&&S.p(t,e),A?A.p&&16&e&&h(A,L,t,t[4],e,G,K):C&&C.p&&1&e&&C.p(t,e),R&&R.p&&16&e&&h(R,P,t,t[4],e,null,null)},i(t){y||(j(x,t),j(S,t),j(C,t),j(R,t),y=!0)},o(t){q(x,t),q(S,t),q(C,t),q(R,t),y=!1},d(r){r&&f(e),x&&x.d(r),S&&S.d(r),C&&C.d(r),R&&R.d(r),t[6](null)}}}function rt(t,e,r){let{$$slots:i={},$$scope:n}=e,{type:o}=e,{value:s}=e;let a;return t.$$set=t=>{"type"in t&&r(0,o=t.type),"value"in t&&r(1,s=t.value),"$$scope"in t&&r(4,n=t.$$scope)},[o,s,a,{flow:{color:"#7a36d2",unit:"L/h"},energy:{color:"#17C1B6",unit:"kWh"},power:{color:"#48ADE0",unit:"kW"},temperature:{color:"#D648E0",unit:"Â°C"}},n,i,function(t){L[t?"unshift":"push"]((()=>{a=t,r(2,a)}))}]}class it extends U{constructor(t){super(),Y(this,t,rt,et,o,{type:0,value:1})}}function nt(e){let r;return{c(){r=p("div"),r.textContent="Hello",w(r,"class","hotspot svelte-w2um5h")},m(t,i){c(t,r,i),e[1](r)},p:t,i:t,o:t,d(t){t&&f(r),e[1](null)}}}function ot(t,e,r){let i;return[i,function(t){L[t?"unshift":"push"]((()=>{i=t,r(0,i)}))}]}class st extends U{constructor(t){super(),Y(this,t,ot,nt,o,{})}}function at(e){let r,i,o;return{c(){r=p("div"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 95 95"><g id="Group_2" data-name="Group 2" transform="translate(-1406 -828)"><circle id="Ellipse_1" data-name="Ellipse 1" cx="47.5" cy="47.5" r="47.5" transform="translate(1406 828)" fill="#1b191c" opacity="0.88"></circle><path id="Path_1" data-name="Path 1" d="M846.277,2011.457l19.539-19.539,19.539,19.539" transform="translate(587.223 -1126.417)" fill="none" stroke="#f5f5f5" stroke-width="5"></path></g></svg>',w(r,"class","hotspot svelte-o72zk0")},m(t,s){c(t,r,s),i||(o=g(r,"click",(function(){n(e[0])&&e[0].apply(this,arguments)})),i=!0)},p(t,[r]){e=t},i:t,o:t,d(t){t&&f(r),i=!1,o()}}}function ht(t,e,r){let{func:i}=e;return t.$$set=t=>{"func"in t&&r(0,i=t.func)},[i]}class ut extends U{constructor(t){super(),Y(this,t,ht,at,o,{func:0})}}function lt(){}lt.prototype.addEventListener=function(t,e){var r=this.__events=this.__events||{},i=r[t]=r[t]||[];i.indexOf(e)<0&&i.push(e)},lt.prototype.removeEventListener=function(t,e){var r=(this.__events=this.__events||{})[t];if(r){var i=r.indexOf(e);i>=0&&r.splice(i,1)}},lt.prototype.emit=function(t,e){var r=this.__events=this.__events||{},i=r[t],n=Array.prototype.slice.call(arguments,1);if(i)for(var o=0;o<i.length;o++){var s=i[o];s.apply(this,n)}};var ct=function(t){for(var e in lt.prototype)lt.prototype.hasOwnProperty(e)&&(t.prototype[e]=lt.prototype[e])};var ft="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()};function dt(t,e){this.fn=t,this.cb=e,this.cfn=null}function pt(t){this._queue=[],this._delay=t&&t.delay||0,this._paused=t&&!!t.paused||!1,this._currentTask=null,this._lastFinished=null}pt.prototype.length=function(){return this._queue.length},pt.prototype.push=function(t,e){var r=new dt(t,e),i=this._cancel.bind(this,r);return this._queue.push(r),this._next(),i},pt.prototype.pause=function(){this._paused||(this._paused=!0)},pt.prototype.resume=function(){this._paused&&(this._paused=!1,this._next())},pt.prototype._start=function(t){if(this._currentTask)throw new Error("WorkQueue: called start while running task");this._currentTask=t;var e=this._finish.bind(this,t);if(t.cfn=t.fn(e),"function"!=typeof t.cfn)throw new Error("WorkQueue: function is not cancellable")},pt.prototype._finish=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask!==t)throw new Error("WorkQueue: called finish on wrong task");t.cb.apply(null,e),this._currentTask=null,this._lastFinished=ft(),this._next()},pt.prototype._cancel=function(t){var e=Array.prototype.slice.call(arguments,1);if(this._currentTask===t)t.cfn.apply(null,e);else{var r=this._queue.indexOf(t);r>=0&&(this._queue.splice(r,1),t.cb.apply(null,e))}},pt.prototype._next=function(){if(!this._paused&&this._queue.length&&!this._currentTask){if(null!=this._lastFinished){var t=ft()-this._lastFinished,e=this._delay-t;if(e>0)return void setTimeout(this._next.bind(this),e)}var r=this._queue.shift();this._start(r)}};var mt=pt;var vt=function(t,e,r,i){var n,o,s,a;return i=i||{},n=null!=r&&null!=r.absoluteWidth?r.absoluteWidth/t:null!=r&&null!=r.relativeWidth?r.relativeWidth:1,o=r&&null!=r.absoluteHeight?r.absoluteHeight/e:null!=r&&null!=r.relativeHeight?r.relativeHeight:1,s=null!=r&&null!=r.absoluteX?r.absoluteX/t:null!=r&&null!=r.relativeX?r.relativeX:0,a=null!=r&&null!=r.absoluteY?r.absoluteY/e:null!=r&&null!=r.relativeY?r.relativeY:0,i.x=s,i.y=a,i.width=n,i.height=o,i};var _t=function(t){return function(e){var r,i;try{i=t()}catch(t){r=t}finally{r?e(r):e(null,i)}}};var yt=function(t){var e,r=!1;return function(){return r||(r=!0,e=t.apply(null,arguments)),e}};var gt=function(t){return function(){if(!arguments.length)throw new Error("cancelized: expected at least one argument");var e=Array.prototype.slice.call(arguments,0),r=e[e.length-1]=yt(e[e.length-1]);function i(){r.apply(null,arguments)}return t.apply(null,e),i}};var wt=function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]=void 0)};function Mt(){this._renderers={}}Mt.prototype.set=function(t,e,r){this._renderers[t]||(this._renderers[t]={}),this._renderers[t][e]=r},Mt.prototype.get=function(t,e){return this._renderers[t]&&this._renderers[t][e]||null};var bt=Mt;function xt(t,e){return t.cmp(e)}function Et(t,e){return-t.cmp(e)}function Tt(t){this._progressive=!(!t||!t.progressive),this._layers=[],this._renderers=[],this._tilesToLoad=[],this._tilesToRender=[],this._tmpVisible=[],this._tmpChildren=[],this._width=0,this._height=0,this._tmpRect={},this._tmpSize={},this._createTextureWorkQueue=new mt,this._emitRenderInvalid=this._emitRenderInvalid.bind(this),this._rendererRegistry=new bt}ct(Tt),Tt.prototype.destroy=function(){this.removeAllLayers(),wt(this)},Tt.prototype.registerRenderer=function(t,e,r){return this._rendererRegistry.set(t,e,r)},Tt.prototype.domElement=function(){throw new Error("Stage implementation must override domElement")},Tt.prototype.width=function(){return this._width},Tt.prototype.height=function(){return this._height},Tt.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},Tt.prototype.setSize=function(t){this._width=t.width,this._height=t.height,this.setSizeForType(),this.emit("resize"),this._emitRenderInvalid()},Tt.prototype.setSizeForType=function(t){throw new Error("Stage implementation must override setSizeForType")},Tt.prototype.loadImage=function(){throw new Error("Stage implementation must override loadImage")},Tt.prototype._emitRenderInvalid=function(){this.emit("renderInvalid")},Tt.prototype.validateLayer=function(t){throw new Error("Stage implementation must override validateLayer")},Tt.prototype.listLayers=function(){return[].concat(this._layers)},Tt.prototype.hasLayer=function(t){return this._layers.indexOf(t)>=0},Tt.prototype.addLayer=function(t,e){if(this._layers.indexOf(t)>=0)throw new Error("Layer already in stage");if(null==e&&(e=this._layers.length),e<0||e>this._layers.length)throw new Error("Invalid layer position");this.validateLayer(t);var r=t.geometry().type,i=t.view().type,n=this._rendererRegistry.get(r,i);if(!n)throw new Error("No "+this.type+" renderer avaiable for "+r+" geometry and "+i+" view");var o=this.createRenderer(n);this._layers.splice(e,0,t),this._renderers.splice(e,0,o),t.addEventListener("viewChange",this._emitRenderInvalid),t.addEventListener("effectsChange",this._emitRenderInvalid),t.addEventListener("fixedLevelChange",this._emitRenderInvalid),t.addEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},Tt.prototype.moveLayer=function(t,e){var r=this._layers.indexOf(t);if(r<0)throw new Error("No such layer in stage");if(e<0||e>=this._layers.length)throw new Error("Invalid layer position");t=this._layers.splice(r,1)[0];var i=this._renderers.splice(r,1)[0];this._layers.splice(e,0,t),this._renderers.splice(e,0,i),this._emitRenderInvalid()},Tt.prototype.removeLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in stage");var r=this._layers.splice(e,1)[0],i=this._renderers.splice(e,1)[0];this.destroyRenderer(i),r.removeEventListener("viewChange",this._emitRenderInvalid),r.removeEventListener("effectsChange",this._emitRenderInvalid),r.removeEventListener("fixedLevelChange",this._emitRenderInvalid),r.removeEventListener("textureStoreChange",this._emitRenderInvalid),this._emitRenderInvalid()},Tt.prototype.removeAllLayers=function(){for(;this._layers.length>0;)this.removeLayer(this._layers[0])},Tt.prototype.startFrame=function(){throw new Error("Stage implementation must override startFrame")},Tt.prototype.endFrame=function(){throw new Error("Stage implementation must override endFrame")},Tt.prototype.render=function(){var t,e,r,i=this._tilesToLoad,n=this._tilesToRender,o=!0,s=this._width,a=this._height,h=this._tmpRect,u=this._tmpSize;if(!(s<=0||a<=0)){for(this.startFrame(),t=0;t<this._layers.length;t++)this._layers[t].textureStore().startFrame();for(t=0;t<this._layers.length;t++){var l,c,f=this._layers[t],d=f.effects(),p=f.view(),m=f.textureStore(),v=this._renderers[t],_=this._layers.length-t;if(vt(s,a,d&&d.rect,h),!(h.width<=0||h.height<=0)){for(u.width=h.width*this._width,u.height=h.height*this._height,p.setSize(u),v.startLayer(f,h),r=this._collectTiles(f,m),e=0;e<i.length;e++)l=i[e],m.markTile(l);for(e=0;e<n.length;e++)l=n[e],c=m.texture(l),v.renderTile(l,c,f,_);f.emit("renderComplete",r),r||(o=!1),v.endLayer(f,h)}}for(t=0;t<this._layers.length;t++)this._layers[t].textureStore().endFrame();this.endFrame(),this.emit("renderComplete",o)}},Tt.prototype._collectTiles=function(t,e){var r=this._tilesToLoad,i=this._tilesToRender,n=this._tmpVisible;r.length=0,i.length=0,n.length=0,t.visibleTiles(n);for(var o=!0,s=0;s<n.length;s++){var a,h=n[s];this._collectTileToLoad(h),e.texture(h)?(a=!1,this._collectTileToRender(h)):(a=this._collectChildren(h,e),o=!1),this._collectParents(h,e,a)}return r.sort(xt),i.sort(Et),o},Tt.prototype._collectChildren=function(t,e){var r=this._tmpChildren,i=!0;do{if(r.length=0,!t.children(r))break;i=!1;for(var n=0;n<r.length;n++)t=r[n],e.texture(t)?(this._collectTileToLoad(t),this._collectTileToRender(t)):i=!0}while(i&&1===r.length);return i},Tt.prototype._collectParents=function(t,e,r){for(var i=this._progressive;(i||r)&&null!=(t=t.parent());){if(r)if(e.texture(t))this._collectTileToRender(t),r=!1;else if(!this._progressive)continue;this._collectTileToLoad(t)||(i=!1)}return r},Tt.prototype._collectTileToLoad=function(t){return this._collectTileIntoList(t,this._tilesToLoad)},Tt.prototype._collectTileToRender=function(t){return this._collectTileIntoList(t,this._tilesToRender)},Tt.prototype._collectTileIntoList=function(t,e){for(var r=!1,i=0;i<e.length;i++)if(t.equals(e[i])){r=!0;break}return r||e.push(t),!r},Tt.prototype.createTexture=function(t,e,r){var i=this;var n=gt(_t((function(){return new i.TextureClass(i,t,e)})));return this._createTextureWorkQueue.push(n,(function(i,n){r(i,t,e,n)}))};var St=Tt,Lt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function At(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}function Ct(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})})),e}var Pt="undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0!==Lt?Lt:null,Rt={HTMLImageElement:["naturalWidth","naturalHeight"],HTMLCanvasElement:["width","height"],ImageBitmap:["width","height"]};function Ot(t){var e=!1;for(var r in Rt)if(Pt[r]&&t instanceof Pt[r]){e=!0,this._widthProp=Rt[r][0],this._heightProp=Rt[r][1];break}if(!e)throw new Error("Unsupported pixel source");this._element=t}ct(Ot),Ot.prototype.destroy=function(){wt(this)},Ot.prototype.element=function(){return this._element},Ot.prototype.width=function(){return this._element[this._widthProp]},Ot.prototype.height=function(){return this._element[this._heightProp]},Ot.prototype.timestamp=function(){return 0},Ot.prototype.isDynamic=function(){return!1};var zt=Ot;var Ft=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t};function It(t){this.constructor.super_.apply(this,arguments),this.message=t}Ft(It,Error);var kt=It,Dt={imageOrientation:"flipY",premultiplyAlpha:"premultiply",resizeQuality:"high"};function Bt(t){this._stage=t}Bt.prototype.loadImage=function(t,e,r){var i=this,n=new Image;n.crossOrigin="anonymous";var o=e&&e.x||0,s=e&&e.y||0,a=e&&e.width||1,h=e&&e.height||1;return r=yt(r),n.onload=function(){i._handleLoad(n,o,s,a,h,r)},n.onerror=function(){i._handleError(t,r)},n.src=t,function(){n.onload=n.onerror=null,n.src="",r.apply(null,arguments)}},Bt.prototype._handleLoad=function(t,e,r,i,n,o){if(0!==e||0!==r||1!==i||1!==n)if(e*=t.naturalWidth,r*=t.naturalHeight,i*=t.naturalWidth,n*=t.naturalHeight,Pt.createImageBitmap)Pt.createImageBitmap(t,e,r,i,n,Dt).then((function(t){o(null,new zt(t))}));else{var s=document.createElement("canvas");s.width=i,s.height=n,s.getContext("2d").drawImage(t,e,r,i,n,0,0,i,n),o(null,new zt(s))}else o(null,new zt(t))},Bt.prototype._handleError=function(t,e){e(new kt("Network error: "+t))};var Ht=Bt,Nt=At((function(t,e){t.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=90)}({17:function(t,e,r){e.__esModule=!0,e.default=void 0;var i=r(18),n=function(){function t(){}return t.getFirstMatch=function(t,e){var r=e.match(t);return r&&r.length>0&&r[1]||""},t.getSecondMatch=function(t,e){var r=e.match(t);return r&&r.length>1&&r[2]||""},t.matchAndReturnConst=function(t,e,r){if(t.test(e))return r},t.getWindowsVersionName=function(t){switch(t){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},t.getMacOSVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},t.getAndroidVersionName=function(t){var e=t.split(".").splice(0,2).map((function(t){return parseInt(t,10)||0}));if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&e[1]>=6?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&e[1]>2?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&e[1]>=4?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},t.getVersionPrecision=function(t){return t.split(".").length},t.compareVersions=function(e,r,i){void 0===i&&(i=!1);var n=t.getVersionPrecision(e),o=t.getVersionPrecision(r),s=Math.max(n,o),a=0,h=t.map([e,r],(function(e){var r=s-t.getVersionPrecision(e),i=e+new Array(r+1).join(".0");return t.map(i.split("."),(function(t){return new Array(20-t.length).join("0")+t})).reverse()}));for(i&&(a=s-Math.min(n,o)),s-=1;s>=a;){if(h[0][s]>h[1][s])return 1;if(h[0][s]===h[1][s]){if(s===a)return 0;s-=1}else if(h[0][s]<h[1][s])return-1}},t.map=function(t,e){var r,i=[];if(Array.prototype.map)return Array.prototype.map.call(t,e);for(r=0;r<t.length;r+=1)i.push(e(t[r]));return i},t.find=function(t,e){var r,i;if(Array.prototype.find)return Array.prototype.find.call(t,e);for(r=0,i=t.length;r<i;r+=1){var n=t[r];if(e(n,r))return n}},t.assign=function(t){for(var e,r,i=t,n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];if(Object.assign)return Object.assign.apply(Object,[t].concat(o));var a=function(){var t=o[e];"object"==typeof t&&null!==t&&Object.keys(t).forEach((function(e){i[e]=t[e]}))};for(e=0,r=o.length;e<r;e+=1)a();return t},t.getBrowserAlias=function(t){return i.BROWSER_ALIASES_MAP[t]},t.getBrowserTypeByAlias=function(t){return i.BROWSER_MAP[t]||""},t}();e.default=n,t.exports=e.default},18:function(t,e,r){e.__esModule=!0,e.ENGINE_MAP=e.OS_MAP=e.PLATFORMS_MAP=e.BROWSER_MAP=e.BROWSER_ALIASES_MAP=void 0,e.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},e.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},e.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},e.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},e.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(91))&&i.__esModule?i:{default:i},o=r(18);function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(){}var e,r,i;return t.getParser=function(t,e){if(void 0===e&&(e=!1),"string"!=typeof t)throw new Error("UserAgent should be a string");return new n.default(t,e)},t.parse=function(t){return new n.default(t).getResult()},e=t,i=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],(r=null)&&s(e.prototype,r),i&&s(e,i),t}();e.default=a,t.exports=e.default},91:function(t,e,r){e.__esModule=!0,e.default=void 0;var i=h(r(92)),n=h(r(93)),o=h(r(94)),s=h(r(95)),a=h(r(17));function h(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(t,e){if(void 0===e&&(e=!1),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==e&&this.parse()}var e=t.prototype;return e.getUA=function(){return this._ua},e.test=function(t){return t.test(this._ua)},e.parseBrowser=function(){var t=this;this.parsedResult.browser={};var e=a.default.find(i.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},e.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},e.getBrowserName=function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},e.getBrowserVersion=function(){return this.getBrowser().version},e.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},e.parseOS=function(){var t=this;this.parsedResult.os={};var e=a.default.find(n.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},e.getOSName=function(t){var e=this.getOS().name;return t?String(e).toLowerCase()||"":e||""},e.getOSVersion=function(){return this.getOS().version},e.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},e.getPlatformType=function(t){void 0===t&&(t=!1);var e=this.getPlatform().type;return t?String(e).toLowerCase()||"":e||""},e.parsePlatform=function(){var t=this;this.parsedResult.platform={};var e=a.default.find(o.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},e.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},e.getEngineName=function(t){return t?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},e.parseEngine=function(){var t=this;this.parsedResult.engine={};var e=a.default.find(s.default,(function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some((function(e){return t.test(e)}));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},e.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},e.getResult=function(){return a.default.assign({},this.parsedResult)},e.satisfies=function(t){var e=this,r={},i=0,n={},o=0;if(Object.keys(t).forEach((function(e){var s=t[e];"string"==typeof s?(n[e]=s,o+=1):"object"==typeof s&&(r[e]=s,i+=1)})),i>0){var s=Object.keys(r),h=a.default.find(s,(function(t){return e.isOS(t)}));if(h){var u=this.satisfies(r[h]);if(void 0!==u)return u}var l=a.default.find(s,(function(t){return e.isPlatform(t)}));if(l){var c=this.satisfies(r[l]);if(void 0!==c)return c}}if(o>0){var f=Object.keys(n),d=a.default.find(f,(function(t){return e.isBrowser(t,!0)}));if(void 0!==d)return this.compareVersion(n[d])}},e.isBrowser=function(t,e){void 0===e&&(e=!1);var r=this.getBrowserName().toLowerCase(),i=t.toLowerCase(),n=a.default.getBrowserTypeByAlias(i);return e&&n&&(i=n.toLowerCase()),i===r},e.compareVersion=function(t){var e=[0],r=t,i=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===t[0]||"<"===t[0]?(r=t.substr(1),"="===t[1]?(i=!0,r=t.substr(2)):e=[],">"===t[0]?e.push(1):e.push(-1)):"="===t[0]?r=t.substr(1):"~"===t[0]&&(i=!0,r=t.substr(1)),e.indexOf(a.default.compareVersions(n,r,i))>-1},e.isOS=function(t){return this.getOSName(!0)===String(t).toLowerCase()},e.isPlatform=function(t){return this.getPlatformType(!0)===String(t).toLowerCase()},e.isEngine=function(t){return this.getEngineName(!0)===String(t).toLowerCase()},e.is=function(t,e){return void 0===e&&(e=!1),this.isBrowser(t,e)||this.isOS(t)||this.isPlatform(t)},e.some=function(t){var e=this;return void 0===t&&(t=[]),t.some((function(t){return e.is(t)}))},t}();e.default=u,t.exports=e.default},92:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=/version\/(\d+(\.?_?\d+)+)/i,s=[{test:[/googlebot/i],describe:function(t){var e={name:"Googlebot"},r=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/opera/i],describe:function(t){var e={name:"Opera"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe:function(t){var e={name:"Opera"},r=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe:function(t){var e={name:"Samsung Internet for Android"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Whale/i],describe:function(t){var e={name:"NAVER Whale Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe:function(t){var e={name:"MZ Browser"},r=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/focus/i],describe:function(t){var e={name:"Focus"},r=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/swing/i],describe:function(t){var e={name:"Swing"},r=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/coast/i],describe:function(t){var e={name:"Opera Coast"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(t){var e={name:"Opera Touch"},r=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe:function(t){var e={name:"Yandex Browser"},r=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe:function(t){var e={name:"UC Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe:function(t){var e={name:"Maxthon"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/epiphany/i],describe:function(t){var e={name:"Epiphany"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/puffin/i],describe:function(t){var e={name:"Puffin"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe:function(t){var e={name:"Sleipnir"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe:function(t){var e={name:"K-Meleon"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe:function(t){var e={name:"WeChat"},r=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe:function(t){var e={name:/qqbrowserlite/i.test(t)?"QQ Browser Lite":"QQ Browser"},r=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe:function(t){var e={name:"Internet Explorer"},r=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe:function(t){var e={name:"Microsoft Edge"},r=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe:function(t){var e={name:"Microsoft Edge"},r=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe:function(t){var e={name:"Vivaldi"},r=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe:function(t){var e={name:"SeaMonkey"},r=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/sailfish/i],describe:function(t){var e={name:"Sailfish"},r=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(e.version=r),e}},{test:[/silk/i],describe:function(t){var e={name:"Amazon Silk"},r=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/phantom/i],describe:function(t){var e={name:"PhantomJS"},r=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe:function(t){var e={name:"SlimerJS"},r=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e={name:"BlackBerry"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e={name:"WebOS Browser"},r=n.default.getFirstMatch(o,t)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/bada/i],describe:function(t){var e={name:"Bada"},r=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/tizen/i],describe:function(t){var e={name:"Tizen"},r=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe:function(t){var e={name:"QupZilla"},r=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var e={name:"Firefox"},r=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/electron/i],describe:function(t){var e={name:"Electron"},r=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe:function(t){var e={name:"Miui"},r=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/chromium/i],describe:function(t){var e={name:"Chromium"},r=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe:function(t){var e={name:"Chrome"},r=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/GSA/i],describe:function(t){var e={name:"Google Search"},r=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e={name:"Android Browser"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe:function(t){var e={name:"PlayStation 4"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe:function(t){var e={name:"Safari"},r=n.default.getFirstMatch(o,t);return r&&(e.version=r),e}},{test:[/.*/i],describe:function(t){var e=-1!==t.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(e,t),version:n.default.getSecondMatch(e,t)}}}];e.default=s,t.exports=e.default},93:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:[/Roku\/DVP/],describe:function(t){var e=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,t);return{name:o.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(t){var e=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(t){var e=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=n.default.getWindowsVersionName(e);return{name:o.OS_MAP.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(t){var e={name:o.OS_MAP.iOS},r=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,t);return r&&(e.version=r),e}},{test:[/macintosh/i],describe:function(t){var e=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,"."),r=n.default.getMacOSVersionName(e),i={name:o.OS_MAP.MacOS,version:e};return r&&(i.versionName=r),i}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var e=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:e}}},{test:function(t){var e=!t.test(/like android/i),r=t.test(/android/i);return e&&r},describe:function(t){var e=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,t),r=n.default.getAndroidVersionName(e),i={name:o.OS_MAP.Android,version:e};return r&&(i.versionName=r),i}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var e=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:o.OS_MAP.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var e=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||n.default.getFirstMatch(/\bbb(\d+)/i,t);return{name:o.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(t){var e=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(t){var e=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(t){var e=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,t);return{name:o.OS_MAP.PlayStation4,version:e}}}];e.default=s,t.exports=e.default},94:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(t){var e=n.default.getFirstMatch(/(can-l01)/i,t)&&"Nova",r={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){var e=t.test(/ipod|iphone/i),r=t.test(/like (ipod|iphone)/i);return e&&!r},describe:function(t){var e=n.default.getFirstMatch(/(ipod|iphone)/i,t);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(t){var e=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&e>=3},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(t){return"playstation 4"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(t){return"roku"===t.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}];e.default=s,t.exports=e.default},95:function(t,e,r){e.__esModule=!0,e.default=void 0;var i,n=(i=r(17))&&i.__esModule?i:{default:i},o=r(18),s=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){if(/\sedg\//i.test(t))return{name:o.ENGINE_MAP.Blink};var e=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:o.ENGINE_MAP.EdgeHTML,version:e}}},{test:[/trident/i],describe:function(t){var e={name:o.ENGINE_MAP.Trident},r=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){return t.test(/presto/i)},describe:function(t){var e={name:o.ENGINE_MAP.Presto},r=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:function(t){var e=t.test(/gecko/i),r=t.test(/like gecko/i);return e&&!r},describe:function(t){var e={name:o.ENGINE_MAP.Gecko},r=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(t){var e={name:o.ENGINE_MAP.WebKit},r=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(e.version=r),e}}];e.default=s,t.exports=e.default}})}));var jt=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t&&t.deviceXDPI&&t.logicalXDPI)return t.deviceXDPI/t.logicalXDPI;if(t&&t.systemXDPI&&t.logicalXDPI)return t.systemXDPI/t.logicalXDPI}return 1};var qt=function(t){return 0==(t&t-1)};function Vt(t){for(var e=document.documentElement.style,r=["Moz","Webkit","Khtml","O","ms"],i=0;i<r.length;i++){var n=r[i]+(t[0].toUpperCase()+t.slice(1));if(n in e)return n}return t}function $t(t){var e=Vt(t);return function(t,r){return t.style[e]=r}}var Wt=$t("transform"),Xt=$t("transformOrigin");var Yt={prefixProperty:Vt,getWithVendorPrefix:function(t){var e=Vt(t);return function(t){return t.style[e]}},setWithVendorPrefix:$t,setTransform:Wt,setTransformOrigin:Xt,setNullTransform:function(t){Wt(t,"translateZ(0)")},setNullTransformOrigin:function(t){Xt(t,"0 0 0")},setAbsolute:function(t){t.style.position="absolute"},setPixelPosition:function(t,e,r){t.style.left=e+"px",t.style.top=r+"px"},setPixelSize:function(t,e,r){t.style.width=e+"px",t.style.height=r+"px"},setNullSize:function(t){t.style.width=t.style.height=0},setFullSize:function(t){t.style.width=t.style.height="100%"},setOverflowHidden:function(t){t.style.overflow="hidden"},setOverflowVisible:function(t){t.style.overflow="visible"},setNoPointerEvents:function(t){t.style.pointerEvents="none"},setBlocking:function(t){t.style.backgroundColor="#000",t.style.opacity="0",t.style.filter="alpha(opacity=0)"}},Ut=Yt.setAbsolute,Gt=Yt.setFullSize,Kt=Nt.chrome;function Zt(t){t=t||{};var e=this;this.constructor.super_.call(this,t),this._generateMipmaps=null!=t.generateMipmaps&&t.generateMipmaps,this._loader=new Ht(this),this._domElement=document.createElement("canvas"),Ut(this._domElement),Gt(this._domElement),this._gl=function(t,e){var r={alpha:!0,premultipliedAlpha:!0,antialias:!(!e||!e.antialias),preserveDrawingBuffer:!(!e||!e.preserveDrawingBuffer)},i=t.getContext&&(t.getContext("webgl",r)||t.getContext("experimental-webgl",r));if(!i)throw new Error("Could not get WebGL context");return e.wrapContext&&(i=e.wrapContext(i)),i}(this._domElement,t),this._handleContextLoss=function(){e.emit("webglcontextlost"),e._gl=null},this._domElement.addEventListener("webglcontextlost",this._handleContextLoss),this._rendererInstances=[]}function Qt(t,e,r){this._stage=t,this._gl=t._gl,this._texture=null,this._timestamp=null,this._width=this._height=null,this.refresh(e,r)}Ft(Zt,St),Zt.prototype.destroy=function(){this._domElement.removeEventListener("webglcontextlost",this._handleContextLoss),this.constructor.super_.prototype.destroy.call(this)},Zt.prototype.domElement=function(){return this._domElement},Zt.prototype.webGlContext=function(){return this._gl},Zt.prototype.setSizeForType=function(){var t=jt();this._domElement.width=t*this._width,this._domElement.height=t*this._height},Zt.prototype.loadImage=function(t,e,r){return this._loader.loadImage(t,e,r)},Zt.prototype.maxTextureSize=function(){return this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE)},Zt.prototype.validateLayer=function(t){var e=t.geometry().maxTileSize(),r=this.maxTextureSize();if(e>r)throw new Error("Layer has level with tile size larger than maximum texture size ("+e+" vs. "+r+")")},Zt.prototype.createRenderer=function(t){for(var e=this._rendererInstances,r=0;r<e.length;r++)if(e[r]instanceof t)return e[r];var i=new t(this._gl);return e.push(i),i},Zt.prototype.destroyRenderer=function(t){var e=this._rendererInstances;if(this._renderers.indexOf(t)<0){t.destroy();var r=e.indexOf(t);r>=0&&e.splice(r,1)}},Zt.prototype.startFrame=function(){var t=this._gl;if(!t)throw new Error("Bad WebGL context - maybe context was lost?");t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},Zt.prototype.endFrame=function(){},Zt.prototype.takeSnapshot=function(t){"object"==typeof t&&null!=t||(t={});var e=t.quality;if(void 0===e&&(e=75),"number"!=typeof e||e<0||e>100)throw new Error("WebGLStage: Snapshot quality needs to be a number between 0 and 100");return this.render(),this._domElement.toDataURL("image/jpeg",e/100)},Zt.type=Zt.prototype.type="webgl",Qt.prototype.refresh=function(t,e){var r,i=this._gl,n=this._stage,o=e.timestamp();if(o!==this._timestamp){var s=e.element(),a=e.width(),h=e.height();if(a!==this._width||h!==this._height){var u=n.maxTextureSize();if(a>u)throw new Error("Texture width larger than max size ("+a+" vs. "+u+")");if(h>u)throw new Error("Texture height larger than max size ("+h+" vs. "+u+")");this._texture&&i.deleteTexture(r),r=this._texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s)}else r=this._texture,i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s instanceof HTMLVideoElement&&Kt?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s):i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,s);n._generateMipmaps&&qt(a)&&qt(h)?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.generateMipmap(i.TEXTURE_2D)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null),this._timestamp=o,this._width=a,this._height=h}},Qt.prototype.destroy=function(){this._texture&&this._gl.deleteTexture(this._texture),wt(this)},Zt.TextureClass=Zt.prototype.TextureClass=Qt;var Jt=Zt,te=1e-6,ee="undefined"!=typeof Float32Array?Float32Array:Array,re=Math.random;var ie=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ne=Object.freeze({__proto__:null,EPSILON:te,get ARRAY_TYPE(){return ee},RANDOM:re,setMatrixArrayType:function(t){ee=t},toRadian:function(t){return t*ie},equals:function(t,e){return Math.abs(t-e)<=te*Math.max(1,Math.abs(t),Math.abs(e))}});function oe(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*a+o*h,t[1]=n*a+s*h,t[2]=i*u+o*l,t[3]=n*u+s*l,t}function se(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}var ae=oe,he=se,ue=Object.freeze({__proto__:null,create:function(){var t=new ee(4);return ee!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,r,i){var n=new ee(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},set:function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},transpose:function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*o-n*i;return s?(s=1/s,t[0]=o*s,t[1]=-i*s,t[2]=-n*s,t[3]=r*s,t):null},adjoint:function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:oe,rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+o*a,t[1]=n*h+s*a,t[2]=i*-a+o*h,t[3]=n*-a+s*h,t},scale:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1];return t[0]=i*a,t[1]=n*a,t[2]=o*h,t[3]=s*h,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:se,exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=e[0],a=e[1],h=e[2],u=e[3];return Math.abs(r-s)<=te*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=te*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=te*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-u)<=te*Math.max(1,Math.abs(o),Math.abs(u))},multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},mul:ae,sub:he});function le(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],l=r[1],c=r[2],f=r[3],d=r[4],p=r[5];return t[0]=i*u+o*l,t[1]=n*u+s*l,t[2]=i*c+o*f,t[3]=n*c+s*f,t[4]=i*d+o*p+a,t[5]=n*d+s*p+h,t}function ce(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}var fe=le,de=ce,pe=Object.freeze({__proto__:null,create:function(){var t=new ee(6);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new ee(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,r,i,n,o){var s=new ee(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s[4]=n,s[5]=o,s},set:function(t,e,r,i,n,o,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=r*o-i*n;return h?(h=1/h,t[0]=o*h,t[1]=-i*h,t[2]=-n*h,t[3]=r*h,t[4]=(n*a-o*s)*h,t[5]=(i*s-r*a)*h,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:le,rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*u,t[1]=n*l+s*u,t[2]=i*-u+o*l,t[3]=n*-u+s*l,t[4]=a,t[5]=h,t},scale:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],l=r[1];return t[0]=i*u,t[1]=n*u,t[2]=o*l,t[3]=s*l,t[4]=a,t[5]=h,t},translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=r[0],l=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=i*u+o*l+a,t[5]=n*u+s*l+h,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},subtract:ce,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=e[0],u=e[1],l=e[2],c=e[3],f=e[4],d=e[5];return Math.abs(r-h)<=te*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-u)<=te*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-l)<=te*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-c)<=te*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-f)<=te*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-d)<=te*Math.max(1,Math.abs(a),Math.abs(d))},mul:fe,sub:de});function me(){var t=new ee(9);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ve(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=r[0],d=r[1],p=r[2],m=r[3],v=r[4],_=r[5],y=r[6],g=r[7],w=r[8];return t[0]=f*i+d*s+p*u,t[1]=f*n+d*a+p*l,t[2]=f*o+d*h+p*c,t[3]=m*i+v*s+_*u,t[4]=m*n+v*a+_*l,t[5]=m*o+v*h+_*c,t[6]=y*i+g*s+w*u,t[7]=y*n+g*a+w*l,t[8]=y*o+g*h+w*c,t}function _e(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}var ye=ve,ge=_e,we=Object.freeze({__proto__:null,create:me,fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new ee(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,r,i,n,o,s,a,h){var u=new ee(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=s,u[7]=a,u[8]=h,u},set:function(t,e,r,i,n,o,s,a,h,u){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=u,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=l*s-a*u,f=-l*o+a*h,d=u*o-s*h,p=r*c+i*f+n*d;return p?(p=1/p,t[0]=c*p,t[1]=(-l*i+n*u)*p,t[2]=(a*i-n*s)*p,t[3]=f*p,t[4]=(l*r-n*h)*p,t[5]=(-a*r+n*o)*p,t[6]=d*p,t[7]=(-u*r+i*h)*p,t[8]=(s*r-i*o)*p,t):null},adjoint:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8];return t[0]=s*l-a*u,t[1]=n*u-i*l,t[2]=i*a-n*s,t[3]=a*h-o*l,t[4]=r*l-n*h,t[5]=n*o-r*a,t[6]=o*u-s*h,t[7]=i*h-r*u,t[8]=r*s-i*o,t},determinant:function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8];return e*(u*o-s*h)+r*(-u*n+s*a)+i*(h*n-o*a)},multiply:ve,translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=r[0],d=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=f*i+d*s+u,t[7]=f*n+d*a+l,t[8]=f*o+d*h+c,t},rotate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*i+f*s,t[1]=d*n+f*a,t[2]=d*o+f*h,t[3]=d*s-f*i,t[4]=d*a-f*n,t[5]=d*h-f*o,t[6]=u,t[7]=l,t[8]=c,t},scale:function(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,a=i+i,h=n+n,u=r*s,l=i*s,c=i*a,f=n*s,d=n*a,p=n*h,m=o*s,v=o*a,_=o*h;return t[0]=1-c-p,t[3]=l-_,t[6]=f+v,t[1]=l+_,t[4]=1-u-p,t[7]=d-m,t[2]=f-v,t[5]=d+m,t[8]=1-u-c,t},normalFromMat4:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],_=e[15],y=r*a-i*s,g=r*h-n*s,w=r*u-o*s,M=i*h-n*a,b=i*u-o*a,x=n*u-o*h,E=l*m-c*p,T=l*v-f*p,S=l*_-d*p,L=c*v-f*m,A=c*_-d*m,C=f*_-d*v,P=y*C-g*A+w*L+M*S-b*T+x*E;return P?(P=1/P,t[0]=(a*C-h*A+u*L)*P,t[1]=(h*S-s*C-u*T)*P,t[2]=(s*A-a*S+u*E)*P,t[3]=(n*A-i*C-o*L)*P,t[4]=(r*C-n*S+o*T)*P,t[5]=(i*S-r*A-o*E)*P,t[6]=(m*x-v*b+_*M)*P,t[7]=(v*w-p*x-_*g)*P,t[8]=(p*b-m*w+_*y)*P,t):null},projection:function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},subtract:_e,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=t[8],c=e[0],f=e[1],d=e[2],p=e[3],m=e[4],v=e[5],_=e[6],y=e[7],g=e[8];return Math.abs(r-c)<=te*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=te*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-d)<=te*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(o-p)<=te*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-m)<=te*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-v)<=te*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-_)<=te*Math.max(1,Math.abs(h),Math.abs(_))&&Math.abs(u-y)<=te*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-g)<=te*Math.max(1,Math.abs(l),Math.abs(g))},mul:ye,sub:ge});function Me(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function be(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=e[9],d=e[10],p=e[11],m=e[12],v=e[13],_=e[14],y=e[15],g=r[0],w=r[1],M=r[2],b=r[3];return t[0]=g*i+w*a+M*c+b*m,t[1]=g*n+w*h+M*f+b*v,t[2]=g*o+w*u+M*d+b*_,t[3]=g*s+w*l+M*p+b*y,g=r[4],w=r[5],M=r[6],b=r[7],t[4]=g*i+w*a+M*c+b*m,t[5]=g*n+w*h+M*f+b*v,t[6]=g*o+w*u+M*d+b*_,t[7]=g*s+w*l+M*p+b*y,g=r[8],w=r[9],M=r[10],b=r[11],t[8]=g*i+w*a+M*c+b*m,t[9]=g*n+w*h+M*f+b*v,t[10]=g*o+w*u+M*d+b*_,t[11]=g*s+w*l+M*p+b*y,g=r[12],w=r[13],M=r[14],b=r[15],t[12]=g*i+w*a+M*c+b*m,t[13]=g*n+w*h+M*f+b*v,t[14]=g*o+w*u+M*d+b*_,t[15]=g*s+w*l+M*p+b*y,t}function xe(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=i+i,h=n+n,u=o+o,l=i*a,c=i*h,f=i*u,d=n*h,p=n*u,m=o*u,v=s*a,_=s*h,y=s*u;return t[0]=1-(d+m),t[1]=c+y,t[2]=f-_,t[3]=0,t[4]=c-y,t[5]=1-(l+m),t[6]=p+v,t[7]=0,t[8]=f+_,t[9]=p-v,t[10]=1-(l+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Ee(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Te(t,e){var r=e[0],i=e[1],n=e[2],o=e[4],s=e[5],a=e[6],h=e[8],u=e[9],l=e[10];return t[0]=Math.hypot(r,i,n),t[1]=Math.hypot(o,s,a),t[2]=Math.hypot(h,u,l),t}function Se(t,e){var r=new ee(3);Te(r,e);var i=1/r[0],n=1/r[1],o=1/r[2],s=e[0]*i,a=e[1]*n,h=e[2]*o,u=e[4]*i,l=e[5]*n,c=e[6]*o,f=e[8]*i,d=e[9]*n,p=e[10]*o,m=s+l+p,v=0;return m>0?(v=2*Math.sqrt(m+1),t[3]=.25*v,t[0]=(c-d)/v,t[1]=(f-h)/v,t[2]=(a-u)/v):s>l&&s>p?(v=2*Math.sqrt(1+s-l-p),t[3]=(c-d)/v,t[0]=.25*v,t[1]=(a+u)/v,t[2]=(f+h)/v):l>p?(v=2*Math.sqrt(1+l-s-p),t[3]=(f-h)/v,t[0]=(a+u)/v,t[1]=.25*v,t[2]=(c+d)/v):(v=2*Math.sqrt(1+p-s-l),t[3]=(a-u)/v,t[0]=(f+h)/v,t[1]=(c+d)/v,t[2]=.25*v),t}function Le(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}var Ae=be,Ce=Le,Pe=Object.freeze({__proto__:null,create:function(){var t=new ee(16);return ee!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var e=new ee(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,r,i,n,o,s,a,h,u,l,c,f,d,p,m){var v=new ee(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=i,v[4]=n,v[5]=o,v[6]=s,v[7]=a,v[8]=h,v[9]=u,v[10]=l,v[11]=c,v[12]=f,v[13]=d,v[14]=p,v[15]=m,v},set:function(t,e,r,i,n,o,s,a,h,u,l,c,f,d,p,m,v){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=v,t},identity:Me,transpose:function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],_=e[15],y=r*a-i*s,g=r*h-n*s,w=r*u-o*s,M=i*h-n*a,b=i*u-o*a,x=n*u-o*h,E=l*m-c*p,T=l*v-f*p,S=l*_-d*p,L=c*v-f*m,A=c*_-d*m,C=f*_-d*v,P=y*C-g*A+w*L+M*S-b*T+x*E;return P?(P=1/P,t[0]=(a*C-h*A+u*L)*P,t[1]=(n*A-i*C-o*L)*P,t[2]=(m*x-v*b+_*M)*P,t[3]=(f*b-c*x-d*M)*P,t[4]=(h*S-s*C-u*T)*P,t[5]=(r*C-n*S+o*T)*P,t[6]=(v*w-p*x-_*g)*P,t[7]=(l*x-f*w+d*g)*P,t[8]=(s*A-a*S+u*E)*P,t[9]=(i*S-r*A-o*E)*P,t[10]=(p*b-m*w+_*y)*P,t[11]=(c*w-l*b-d*y)*P,t[12]=(a*T-s*L-h*E)*P,t[13]=(r*L-i*T+n*E)*P,t[14]=(m*g-p*M-v*y)*P,t[15]=(l*M-c*g+f*y)*P,t):null},adjoint:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],_=e[15];return t[0]=a*(f*_-d*v)-c*(h*_-u*v)+m*(h*d-u*f),t[1]=-(i*(f*_-d*v)-c*(n*_-o*v)+m*(n*d-o*f)),t[2]=i*(h*_-u*v)-a*(n*_-o*v)+m*(n*u-o*h),t[3]=-(i*(h*d-u*f)-a*(n*d-o*f)+c*(n*u-o*h)),t[4]=-(s*(f*_-d*v)-l*(h*_-u*v)+p*(h*d-u*f)),t[5]=r*(f*_-d*v)-l*(n*_-o*v)+p*(n*d-o*f),t[6]=-(r*(h*_-u*v)-s*(n*_-o*v)+p*(n*u-o*h)),t[7]=r*(h*d-u*f)-s*(n*d-o*f)+l*(n*u-o*h),t[8]=s*(c*_-d*m)-l*(a*_-u*m)+p*(a*d-u*c),t[9]=-(r*(c*_-d*m)-l*(i*_-o*m)+p*(i*d-o*c)),t[10]=r*(a*_-u*m)-s*(i*_-o*m)+p*(i*u-o*a),t[11]=-(r*(a*d-u*c)-s*(i*d-o*c)+l*(i*u-o*a)),t[12]=-(s*(c*v-f*m)-l*(a*v-h*m)+p*(a*f-h*c)),t[13]=r*(c*v-f*m)-l*(i*v-n*m)+p*(i*f-n*c),t[14]=-(r*(a*v-h*m)-s*(i*v-n*m)+p*(i*h-n*a)),t[15]=r*(a*f-h*c)-s*(i*f-n*c)+l*(i*h-n*a),t},determinant:function(t){var e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],s=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15];return(e*s-r*o)*(c*v-f*m)-(e*a-i*o)*(l*v-f*p)+(e*h-n*o)*(l*m-c*p)+(r*a-i*s)*(u*v-f*d)-(r*h-n*s)*(u*m-c*d)+(i*h-n*a)*(u*p-l*d)},multiply:be,translate:function(t,e,r){var i,n,o,s,a,h,u,l,c,f,d,p,m=r[0],v=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],f=e[9],d=e[10],p=e[11],t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=f,t[10]=d,t[11]=p,t[12]=i*m+a*v+c*_+e[12],t[13]=n*m+h*v+f*_+e[13],t[14]=o*m+u*v+d*_+e[14],t[15]=s*m+l*v+p*_+e[15]),t},scale:function(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},rotate:function(t,e,r,i){var n,o,s,a,h,u,l,c,f,d,p,m,v,_,y,g,w,M,b,x,E,T,S,L,A=i[0],C=i[1],P=i[2],R=Math.hypot(A,C,P);return R<te?null:(A*=R=1/R,C*=R,P*=R,n=Math.sin(r),s=1-(o=Math.cos(r)),a=e[0],h=e[1],u=e[2],l=e[3],c=e[4],f=e[5],d=e[6],p=e[7],m=e[8],v=e[9],_=e[10],y=e[11],g=A*A*s+o,w=C*A*s+P*n,M=P*A*s-C*n,b=A*C*s-P*n,x=C*C*s+o,E=P*C*s+A*n,T=A*P*s+C*n,S=C*P*s-A*n,L=P*P*s+o,t[0]=a*g+c*w+m*M,t[1]=h*g+f*w+v*M,t[2]=u*g+d*w+_*M,t[3]=l*g+p*w+y*M,t[4]=a*b+c*x+m*E,t[5]=h*b+f*x+v*E,t[6]=u*b+d*x+_*E,t[7]=l*b+p*x+y*E,t[8]=a*T+c*S+m*L,t[9]=h*T+f*S+v*L,t[10]=u*T+d*S+_*L,t[11]=l*T+p*S+y*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[4],s=e[5],a=e[6],h=e[7],u=e[8],l=e[9],c=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+u*i,t[5]=s*n+l*i,t[6]=a*n+c*i,t[7]=h*n+f*i,t[8]=u*n-o*i,t[9]=l*n-s*i,t[10]=c*n-a*i,t[11]=f*n-h*i,t},rotateY:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[8],l=e[9],c=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-u*i,t[1]=s*n-l*i,t[2]=a*n-c*i,t[3]=h*n-f*i,t[8]=o*i+u*n,t[9]=s*i+l*n,t[10]=a*i+c*n,t[11]=h*i+f*n,t},rotateZ:function(t,e,r){var i=Math.sin(r),n=Math.cos(r),o=e[0],s=e[1],a=e[2],h=e[3],u=e[4],l=e[5],c=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+u*i,t[1]=s*n+l*i,t[2]=a*n+c*i,t[3]=h*n+f*i,t[4]=u*n-o*i,t[5]=l*n-s*i,t[6]=c*n-a*i,t[7]=f*n-h*i,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,r){var i,n,o,s=r[0],a=r[1],h=r[2],u=Math.hypot(s,a,h);return u<te?null:(s*=u=1/u,a*=u,h*=u,i=Math.sin(e),o=1-(n=Math.cos(e)),t[0]=s*s*o+n,t[1]=a*s*o+h*i,t[2]=h*s*o-a*i,t[3]=0,t[4]=s*a*o-h*i,t[5]=a*a*o+n,t[6]=h*a*o+s*i,t[7]=0,t[8]=s*h*o+a*i,t[9]=a*h*o-s*i,t[10]=h*h*o+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:xe,fromQuat2:function(t,e){var r=new ee(3),i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=i*i+n*n+o*o+s*s;return c>0?(r[0]=2*(a*s+l*i+h*o-u*n)/c,r[1]=2*(h*s+l*n+u*i-a*o)/c,r[2]=2*(u*s+l*o+a*n-h*i)/c):(r[0]=2*(a*s+l*i+h*o-u*n),r[1]=2*(h*s+l*n+u*i-a*o),r[2]=2*(u*s+l*o+a*n-h*i)),xe(t,e,r),t},getTranslation:Ee,getScaling:Te,getRotation:Se,fromRotationTranslationScale:function(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=e[3],h=n+n,u=o+o,l=s+s,c=n*h,f=n*u,d=n*l,p=o*u,m=o*l,v=s*l,_=a*h,y=a*u,g=a*l,w=i[0],M=i[1],b=i[2];return t[0]=(1-(p+v))*w,t[1]=(f+g)*w,t[2]=(d-y)*w,t[3]=0,t[4]=(f-g)*M,t[5]=(1-(c+v))*M,t[6]=(m+_)*M,t[7]=0,t[8]=(d+y)*b,t[9]=(m-_)*b,t[10]=(1-(c+p))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,e,r,i,n){var o=e[0],s=e[1],a=e[2],h=e[3],u=o+o,l=s+s,c=a+a,f=o*u,d=o*l,p=o*c,m=s*l,v=s*c,_=a*c,y=h*u,g=h*l,w=h*c,M=i[0],b=i[1],x=i[2],E=n[0],T=n[1],S=n[2],L=(1-(m+_))*M,A=(d+w)*M,C=(p-g)*M,P=(d-w)*b,R=(1-(f+_))*b,O=(v+y)*b,z=(p+g)*x,F=(v-y)*x,I=(1-(f+m))*x;return t[0]=L,t[1]=A,t[2]=C,t[3]=0,t[4]=P,t[5]=R,t[6]=O,t[7]=0,t[8]=z,t[9]=F,t[10]=I,t[11]=0,t[12]=r[0]+E-(L*E+P*T+z*S),t[13]=r[1]+T-(A*E+R*T+F*S),t[14]=r[2]+S-(C*E+O*T+I*S),t[15]=1,t},fromQuat:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r+r,a=i+i,h=n+n,u=r*s,l=i*s,c=i*a,f=n*s,d=n*a,p=n*h,m=o*s,v=o*a,_=o*h;return t[0]=1-c-p,t[1]=l+_,t[2]=f-v,t[3]=0,t[4]=l-_,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=f+v,t[9]=d-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,r,i,n,o,s){var a=1/(r-e),h=1/(n-i),u=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*h,t[10]=(s+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*u,t[15]=0,t},perspective:function(t,e,r,i,n){var o,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t},perspectiveFromFieldOfView:function(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+a),u=2/(n+o);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-a)*h*.5,t[9]=(n-o)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},ortho:function(t,e,r,i,n,o,s){var a=1/(e-r),h=1/(i-n),u=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*h,t[14]=(s+o)*u,t[15]=1,t},lookAt:function(t,e,r,i){var n,o,s,a,h,u,l,c,f,d,p=e[0],m=e[1],v=e[2],_=i[0],y=i[1],g=i[2],w=r[0],M=r[1],b=r[2];return Math.abs(p-w)<te&&Math.abs(m-M)<te&&Math.abs(v-b)<te?Me(t):(l=p-w,c=m-M,f=v-b,n=y*(f*=d=1/Math.hypot(l,c,f))-g*(c*=d),o=g*(l*=d)-_*f,s=_*c-y*l,(d=Math.hypot(n,o,s))?(n*=d=1/d,o*=d,s*=d):(n=0,o=0,s=0),a=c*s-f*o,h=f*n-l*s,u=l*o-c*n,(d=Math.hypot(a,h,u))?(a*=d=1/d,h*=d,u*=d):(a=0,h=0,u=0),t[0]=n,t[1]=a,t[2]=l,t[3]=0,t[4]=o,t[5]=h,t[6]=c,t[7]=0,t[8]=s,t[9]=u,t[10]=f,t[11]=0,t[12]=-(n*p+o*m+s*v),t[13]=-(a*p+h*m+u*v),t[14]=-(l*p+c*m+f*v),t[15]=1,t)},targetTo:function(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=i[0],h=i[1],u=i[2],l=n-r[0],c=o-r[1],f=s-r[2],d=l*l+c*c+f*f;d>0&&(l*=d=1/Math.sqrt(d),c*=d,f*=d);var p=h*f-u*c,m=u*l-a*f,v=a*c-h*l;return(d=p*p+m*m+v*v)>0&&(p*=d=1/Math.sqrt(d),m*=d,v*=d),t[0]=p,t[1]=m,t[2]=v,t[3]=0,t[4]=c*v-f*m,t[5]=f*p-l*v,t[6]=l*m-c*p,t[7]=0,t[8]=l,t[9]=c,t[10]=f,t[11]=0,t[12]=n,t[13]=o,t[14]=s,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},subtract:Le,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},multiplyScalarAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=t[8],c=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],_=t[15],y=e[0],g=e[1],w=e[2],M=e[3],b=e[4],x=e[5],E=e[6],T=e[7],S=e[8],L=e[9],A=e[10],C=e[11],P=e[12],R=e[13],O=e[14],z=e[15];return Math.abs(r-y)<=te*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-g)<=te*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(n-w)<=te*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(o-M)<=te*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-b)<=te*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-x)<=te*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(h-E)<=te*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(u-T)<=te*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(l-S)<=te*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-L)<=te*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(f-A)<=te*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-C)<=te*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-P)<=te*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-R)<=te*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(v-O)<=te*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(_-z)<=te*Math.max(1,Math.abs(_),Math.abs(z))},mul:Ae,sub:Ce});function Re(){var t=new ee(3);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Oe(t){var e=t[0],r=t[1],i=t[2];return Math.hypot(e,r,i)}function ze(t,e,r){var i=new ee(3);return i[0]=t,i[1]=e,i[2]=r,i}function Fe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ie(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function ke(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function De(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.hypot(r,i,n)}function Be(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function He(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Ne(t,e){var r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function je(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function qe(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[0],a=r[1],h=r[2];return t[0]=n*h-o*a,t[1]=o*s-i*h,t[2]=i*a-n*s,t}var Ve,$e=Fe,We=Ie,Xe=ke,Ye=De,Ue=Be,Ge=Oe,Ke=He,Ze=(Ve=Re(),function(t,e,r,i,n,o){var s,a;for(e||(e=3),r||(r=0),a=i?Math.min(i*e+r,t.length):t.length,s=r;s<a;s+=e)Ve[0]=t[s],Ve[1]=t[s+1],Ve[2]=t[s+2],n(Ve,Ve,o),t[s]=Ve[0],t[s+1]=Ve[1],t[s+2]=Ve[2];return t}),Qe=Object.freeze({__proto__:null,create:Re,clone:function(t){var e=new ee(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},length:Oe,fromValues:ze,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},subtract:Fe,multiply:Ie,divide:ke,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},distance:De,squaredDistance:Be,squaredLength:He,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:Ne,dot:je,cross:qe,lerp:function(t,e,r,i){var n=e[0],o=e[1],s=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t},hermite:function(t,e,r,i,n,o){var s=o*o,a=s*(2*o-3)+1,h=s*(o-2)+o,u=s*(o-1),l=s*(3-2*o);return t[0]=e[0]*a+r[0]*h+i[0]*u+n[0]*l,t[1]=e[1]*a+r[1]*h+i[1]*u+n[1]*l,t[2]=e[2]*a+r[2]*h+i[2]*u+n[2]*l,t},bezier:function(t,e,r,i,n,o){var s=1-o,a=s*s,h=o*o,u=a*s,l=3*o*a,c=3*h*s,f=h*o;return t[0]=e[0]*u+r[0]*l+i[0]*c+n[0]*f,t[1]=e[1]*u+r[1]*l+i[1]*c+n[1]*f,t[2]=e[2]*u+r[2]*l+i[2]*c+n[2]*f,t},random:function(t,e){e=e||1;var r=2*re()*Math.PI,i=2*re()-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t},transformMat4:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[3]*i+r[7]*n+r[11]*o+r[15];return s=s||1,t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/s,t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/s,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/s,t},transformMat3:function(t,e,r){var i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t},transformQuat:function(t,e,r){var i=r[0],n=r[1],o=r[2],s=r[3],a=e[0],h=e[1],u=e[2],l=n*u-o*h,c=o*a-i*u,f=i*h-n*a,d=n*f-o*c,p=o*l-i*f,m=i*c-n*l,v=2*s;return l*=v,c*=v,f*=v,d*=2,p*=2,m*=2,t[0]=a+l+d,t[1]=h+c+p,t[2]=u+f+m,t},rotateX:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},rotateY:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},rotateZ:function(t,e,r,i){var n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},angle:function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],s=e[1],a=e[2],h=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+s*s+a*a),u=h&&je(t,e)/h;return Math.acos(Math.min(Math.max(u,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(r-o)<=te*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=te*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=te*Math.max(1,Math.abs(n),Math.abs(a))},sub:$e,mul:We,div:Xe,dist:Ye,sqrDist:Ue,len:Ge,sqrLen:Ke,forEach:Ze});function Je(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tr(t){var e=new ee(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function er(t,e,r,i){var n=new ee(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function rr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ir(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function nr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function or(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function sr(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ar(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function hr(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ur(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return Math.hypot(r,i,n,o)}function lr(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+i*i+n*n+o*o}function cr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.hypot(e,r,i,n)}function fr(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function dr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*r+i*i+n*n+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=o*s,t}function pr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function mr(t,e,r,i){var n=e[0],o=e[1],s=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=s+i*(r[2]-s),t[3]=a+i*(r[3]-a),t}function vr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _r(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=e[0],a=e[1],h=e[2],u=e[3];return Math.abs(r-s)<=te*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=te*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-h)<=te*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-u)<=te*Math.max(1,Math.abs(o),Math.abs(u))}var yr=or,gr=sr,wr=ar,Mr=ur,br=lr,xr=cr,Er=fr,Tr=function(){var t=Je();return function(e,r,i,n,o,s){var a,h;for(r||(r=4),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,a=i;a<h;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),Sr=Object.freeze({__proto__:null,create:Je,clone:tr,fromValues:er,copy:rr,set:ir,add:nr,subtract:or,multiply:sr,divide:ar,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:hr,scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},distance:ur,squaredDistance:lr,length:cr,squaredLength:fr,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:dr,dot:pr,cross:function(t,e,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],s=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],u=r[2]*i[3]-r[3]*i[2],l=e[0],c=e[1],f=e[2],d=e[3];return t[0]=c*u-f*h+d*a,t[1]=-l*u+f*s-d*o,t[2]=l*h-c*s+d*n,t[3]=-l*a+c*o-f*n,t},lerp:mr,random:function(t,e){var r,i,n,o,s,a;e=e||1;do{s=(r=2*re()-1)*r+(i=2*re()-1)*i}while(s>=1);do{a=(n=2*re()-1)*n+(o=2*re()-1)*o}while(a>=1);var h=Math.sqrt((1-s)/a);return t[0]=e*r,t[1]=e*i,t[2]=e*n*h,t[3]=e*o*h,t},transformMat4:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*s,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*s,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*s,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*s,t},transformQuat:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=r[0],a=r[1],h=r[2],u=r[3],l=u*i+a*o-h*n,c=u*n+h*i-s*o,f=u*o+s*n-a*i,d=-s*i-a*n-h*o;return t[0]=l*u+d*-s+c*-h-f*-a,t[1]=c*u+d*-a+f*-s-l*-h,t[2]=f*u+d*-h+l*-a-c*-s,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:vr,equals:_r,sub:yr,mul:gr,div:wr,dist:Mr,sqrDist:br,len:xr,sqrLen:Er,forEach:Tr});function Lr(){var t=new ee(4);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ar(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function Cr(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*l+s*a+n*u-o*h,t[1]=n*l+s*h+o*a-i*u,t[2]=o*l+s*u+i*h-n*a,t[3]=s*l-i*a-n*h-o*u,t}function Pr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+s*a,t[1]=n*h+o*a,t[2]=o*h-n*a,t[3]=s*h-i*a,t}function Rr(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h-o*a,t[1]=n*h+s*a,t[2]=o*h+i*a,t[3]=s*h-n*a,t}function Or(t,e,r){r*=.5;var i=e[0],n=e[1],o=e[2],s=e[3],a=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*a,t[1]=n*h-i*a,t[2]=o*h+s*a,t[3]=s*h-o*a,t}function zr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=Math.sqrt(r*r+i*i+n*n),a=Math.exp(o),h=s>0?a*Math.sin(s)/s:0;return t[0]=r*h,t[1]=i*h,t[2]=n*h,t[3]=a*Math.cos(s),t}function Fr(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=Math.sqrt(r*r+i*i+n*n),a=s>0?Math.atan2(s,o)/s:0;return t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=.5*Math.log(r*r+i*i+n*n+o*o),t}function Ir(t,e,r,i){var n,o,s,a,h,u=e[0],l=e[1],c=e[2],f=e[3],d=r[0],p=r[1],m=r[2],v=r[3];return(o=u*d+l*p+c*m+f*v)<0&&(o=-o,d=-d,p=-p,m=-m,v=-v),1-o>te?(n=Math.acos(o),s=Math.sin(n),a=Math.sin((1-i)*n)/s,h=Math.sin(i*n)/s):(a=1-i,h=i),t[0]=a*u+h*d,t[1]=a*l+h*p,t[2]=a*c+h*m,t[3]=a*f+h*v,t}function kr(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,s=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*s+s]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*o+s]-e[3*s+o])*r,t[o]=(e[3*o+n]+e[3*n+o])*r,t[s]=(e[3*s+n]+e[3*n+s])*r}return t}var Dr,Br,Hr,Nr,jr,qr,Vr=tr,$r=er,Wr=rr,Xr=ir,Yr=nr,Ur=Cr,Gr=hr,Kr=pr,Zr=mr,Qr=cr,Jr=Qr,ti=fr,ei=ti,ri=dr,ii=vr,ni=_r,oi=(Dr=Re(),Br=ze(1,0,0),Hr=ze(0,1,0),function(t,e,r){var i=je(e,r);return i<-.999999?(qe(Dr,Br,e),Ge(Dr)<1e-6&&qe(Dr,Hr,e),Ne(Dr,Dr),Ar(t,Dr,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(qe(Dr,e,r),t[0]=Dr[0],t[1]=Dr[1],t[2]=Dr[2],t[3]=1+i,ri(t,t))}),si=(Nr=Lr(),jr=Lr(),function(t,e,r,i,n,o){return Ir(Nr,e,n,o),Ir(jr,r,i,o),Ir(t,Nr,jr,2*o*(1-o)),t}),ai=(qr=me(),function(t,e,r,i){return qr[0]=r[0],qr[3]=r[1],qr[6]=r[2],qr[1]=i[0],qr[4]=i[1],qr[7]=i[2],qr[2]=-e[0],qr[5]=-e[1],qr[8]=-e[2],ri(t,kr(t,qr))}),hi=Object.freeze({__proto__:null,create:Lr,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:Ar,getAxisAngle:function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>te?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,e){var r=Kr(t,e);return Math.acos(2*r*r-1)},multiply:Cr,rotateX:Pr,rotateY:Rr,rotateZ:Or,calculateW:function(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t},exp:zr,ln:Fr,pow:function(t,e,r){return Fr(t,e),Gr(t,t,r),zr(t,t),t},slerp:Ir,random:function(t){var e=re(),r=re(),i=re(),n=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=n*Math.sin(2*Math.PI*r),t[1]=n*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},invert:function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],s=r*r+i*i+n*n+o*o,a=s?1/s:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=o*a,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:kr,fromEuler:function(t,e,r,i){var n=.5*Math.PI/180;e*=n,r*=n,i*=n;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(r),h=Math.cos(r),u=Math.sin(i),l=Math.cos(i);return t[0]=o*h*l-s*a*u,t[1]=s*a*l+o*h*u,t[2]=s*h*u-o*a*l,t[3]=s*h*l+o*a*u,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:Vr,fromValues:$r,copy:Wr,set:Xr,add:Yr,mul:Ur,scale:Gr,dot:Kr,lerp:Zr,length:Qr,len:Jr,squaredLength:ti,sqrLen:ei,normalize:ri,exactEquals:ii,equals:ni,rotationTo:oi,sqlerp:si,setAxes:ai});function ui(t,e,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],s=e[0],a=e[1],h=e[2],u=e[3];return t[0]=s,t[1]=a,t[2]=h,t[3]=u,t[4]=i*u+n*h-o*a,t[5]=n*u+o*s-i*h,t[6]=o*u+i*a-n*s,t[7]=-i*s-n*a-o*h,t}function li(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}var ci=Wr;var fi=Wr;function di(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[4],h=r[5],u=r[6],l=r[7],c=e[4],f=e[5],d=e[6],p=e[7],m=r[0],v=r[1],_=r[2],y=r[3];return t[0]=i*y+s*m+n*_-o*v,t[1]=n*y+s*v+o*m-i*_,t[2]=o*y+s*_+i*v-n*m,t[3]=s*y-i*m-n*v-o*_,t[4]=i*l+s*a+n*u-o*h+c*y+p*m+f*_-d*v,t[5]=n*l+s*h+o*a-i*u+f*y+p*v+d*m-c*_,t[6]=o*l+s*u+i*h-n*a+d*y+p*_+c*v-f*m,t[7]=s*l-i*a-n*h-o*u+p*y-c*m-f*v-d*_,t}var pi=di;var mi=Kr;var vi=Qr,_i=vi,yi=ti,gi=yi;var wi=Object.freeze({__proto__:null,create:function(){var t=new ee(8);return ee!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var e=new ee(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},fromValues:function(t,e,r,i,n,o,s,a){var h=new ee(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=i,h[4]=n,h[5]=o,h[6]=s,h[7]=a,h},fromRotationTranslationValues:function(t,e,r,i,n,o,s){var a=new ee(8);a[0]=t,a[1]=e,a[2]=r,a[3]=i;var h=.5*n,u=.5*o,l=.5*s;return a[4]=h*i+u*r-l*e,a[5]=u*i+l*t-h*r,a[6]=l*i+h*e-u*t,a[7]=-h*t-u*e-l*r,a},fromRotationTranslation:ui,fromTranslation:function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fromRotation:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,e){var r=Lr();Se(r,e);var i=new ee(3);return Ee(i,e),ui(t,r,i),t},copy:li,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,e,r,i,n,o,s,a,h){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t},getReal:ci,getDual:function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},setReal:fi,setDual:function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},getTranslation:function(t,e){var r=e[4],i=e[5],n=e[6],o=e[7],s=-e[0],a=-e[1],h=-e[2],u=e[3];return t[0]=2*(r*u+o*s+i*h-n*a),t[1]=2*(i*u+o*a+n*s-r*h),t[2]=2*(n*u+o*h+r*a-i*s),t},translate:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=.5*r[0],h=.5*r[1],u=.5*r[2],l=e[4],c=e[5],f=e[6],d=e[7];return t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=s*a+n*u-o*h+l,t[5]=s*h+o*a-i*u+c,t[6]=s*u+i*h-n*a+f,t[7]=-i*a-n*h-o*u+d,t},rotateX:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=a*s+l*i+h*o-u*n,f=h*s+l*n+u*i-a*o,d=u*s+l*o+a*n-h*i,p=l*s-a*i-h*n-u*o;return Pr(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=c*s+p*i+f*o-d*n,t[5]=f*s+p*n+d*i-c*o,t[6]=d*s+p*o+c*n-f*i,t[7]=p*s-c*i-f*n-d*o,t},rotateY:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=a*s+l*i+h*o-u*n,f=h*s+l*n+u*i-a*o,d=u*s+l*o+a*n-h*i,p=l*s-a*i-h*n-u*o;return Rr(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=c*s+p*i+f*o-d*n,t[5]=f*s+p*n+d*i-c*o,t[6]=d*s+p*o+c*n-f*i,t[7]=p*s-c*i-f*n-d*o,t},rotateZ:function(t,e,r){var i=-e[0],n=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=a*s+l*i+h*o-u*n,f=h*s+l*n+u*i-a*o,d=u*s+l*o+a*n-h*i,p=l*s-a*i-h*n-u*o;return Or(t,e,r),i=t[0],n=t[1],o=t[2],s=t[3],t[4]=c*s+p*i+f*o-d*n,t[5]=f*s+p*n+d*i-c*o,t[6]=d*s+p*o+c*n-f*i,t[7]=p*s-c*i-f*n-d*o,t},rotateByQuatAppend:function(t,e,r){var i=r[0],n=r[1],o=r[2],s=r[3],a=e[0],h=e[1],u=e[2],l=e[3];return t[0]=a*s+l*i+h*o-u*n,t[1]=h*s+l*n+u*i-a*o,t[2]=u*s+l*o+a*n-h*i,t[3]=l*s-a*i-h*n-u*o,a=e[4],h=e[5],u=e[6],l=e[7],t[4]=a*s+l*i+h*o-u*n,t[5]=h*s+l*n+u*i-a*o,t[6]=u*s+l*o+a*n-h*i,t[7]=l*s-a*i-h*n-u*o,t},rotateByQuatPrepend:function(t,e,r){var i=e[0],n=e[1],o=e[2],s=e[3],a=r[0],h=r[1],u=r[2],l=r[3];return t[0]=i*l+s*a+n*u-o*h,t[1]=n*l+s*h+o*a-i*u,t[2]=o*l+s*u+i*h-n*a,t[3]=s*l-i*a-n*h-o*u,a=r[4],h=r[5],u=r[6],l=r[7],t[4]=i*l+s*a+n*u-o*h,t[5]=n*l+s*h+o*a-i*u,t[6]=o*l+s*u+i*h-n*a,t[7]=s*l-i*a-n*h-o*u,t},rotateAroundAxis:function(t,e,r,i){if(Math.abs(i)<te)return li(t,e);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),s=o*r[0]/n,a=o*r[1]/n,h=o*r[2]/n,u=Math.cos(i),l=e[0],c=e[1],f=e[2],d=e[3];t[0]=l*u+d*s+c*h-f*a,t[1]=c*u+d*a+f*s-l*h,t[2]=f*u+d*h+l*a-c*s,t[3]=d*u-l*s-c*a-f*h;var p=e[4],m=e[5],v=e[6],_=e[7];return t[4]=p*u+_*s+m*h-v*a,t[5]=m*u+_*a+v*s-p*h,t[6]=v*u+_*h+p*a-m*s,t[7]=_*u-p*s-m*a-v*h,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},multiply:di,mul:pi,scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},dot:mi,lerp:function(t,e,r,i){var n=1-i;return mi(e,r)<0&&(i=-i),t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i,t[3]=e[3]*n+r[3]*i,t[4]=e[4]*n+r[4]*i,t[5]=e[5]*n+r[5]*i,t[6]=e[6]*n+r[6]*i,t[7]=e[7]*n+r[7]*i,t},invert:function(t,e){var r=yi(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},length:vi,len:_i,squaredLength:yi,sqrLen:gi,normalize:function(t,e){var r=yi(e);if(r>0){r=Math.sqrt(r);var i=e[0]/r,n=e[1]/r,o=e[2]/r,s=e[3]/r,a=e[4],h=e[5],u=e[6],l=e[7],c=i*a+n*h+o*u+s*l;t[0]=i,t[1]=n,t[2]=o,t[3]=s,t[4]=(a-i*c)/r,t[5]=(h-n*c)/r,t[6]=(u-o*c)/r,t[7]=(l-s*c)/r}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},equals:function(t,e){var r=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=t[6],u=t[7],l=e[0],c=e[1],f=e[2],d=e[3],p=e[4],m=e[5],v=e[6],_=e[7];return Math.abs(r-l)<=te*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=te*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-f)<=te*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-d)<=te*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=te*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-m)<=te*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(h-v)<=te*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(u-_)<=te*Math.max(1,Math.abs(u),Math.abs(_))}});function Mi(){var t=new ee(2);return ee!=Float32Array&&(t[0]=0,t[1]=0),t}function bi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function xi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Ei(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Ti(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.hypot(r,i)}function Si(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function Li(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Ai(t){var e=t[0],r=t[1];return e*e+r*r}var Ci=Li,Pi=bi,Ri=xi,Oi=Ei,zi=Ti,Fi=Si,Ii=Ai,ki=function(){var t=Mi();return function(e,r,i,n,o,s){var a,h;for(r||(r=2),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,a=i;a<h;a+=r)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),Di=Object.freeze({__proto__:null,create:Mi,clone:function(t){var e=new ee(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var r=new ee(2);return r[0]=t,r[1]=e,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,r){return t[0]=e,t[1]=r,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},subtract:bi,multiply:xi,divide:Ei,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},scaleAndAdd:function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},distance:Ti,squaredDistance:Si,length:Li,squaredLength:Ai,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},lerp:function(t,e,r,i){var n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t},random:function(t,e){e=e||1;var r=2*re()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},transformMat2:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t},transformMat2d:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t},transformMat3:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t},transformMat4:function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t},rotate:function(t,e,r,i){var n=e[0]-r[0],o=e[1]-r[1],s=Math.sin(i),a=Math.cos(i);return t[0]=n*a-o*s+r[0],t[1]=n*s+o*a+r[1],t},angle:function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1],s=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o),a=s&&(r*n+i*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var r=t[0],i=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=te*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=te*Math.max(1,Math.abs(i),Math.abs(o))},len:Ci,sub:Pi,mul:Ri,div:Oi,dist:zi,sqrDist:Fi,sqrLen:Ii,forEach:ki});var Bi=function(t,e,r){return Math.min(Math.max(t,e),r)},Hi=Ct(Object.freeze({__proto__:null,glMatrix:ne,mat2:ue,mat2d:pe,mat3:we,mat4:Pe,quat:hi,quat2:wi,vec2:Di,vec3:Qe,vec4:Sr})),Ni=Hi.vec4,ji=Hi.vec3,qi=Hi.mat4;function Vi(t,e,r){var i=t.createShader(e);if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw t.getShaderInfoLog(i);return i}function $i(t,e,r,i){var n=t.createBuffer();return t.bindBuffer(e,n),t.bufferData(e,i,r),n}var Wi=Ni.create(),Xi=qi.create();qi.identity(Xi);var Yi=ji.create(),Ui=ji.create();var Gi=function(t,e,r,i,n){var o=Vi(t,t.VERTEX_SHADER,e),s=Vi(t,t.FRAGMENT_SHADER,r),a=t.createProgram();if(t.attachShader(a,o),t.attachShader(a,s),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw t.getProgramInfoLog(a);for(var h=0;h<i.length;h++){var u=i[h];if(a[u]=t.getAttribLocation(a,u),-1===a[u])throw new Error("Shader program has no "+u+" attribute")}for(var l=0;l<n.length;l++){var c=n[l];if(a[c]=t.getUniformLocation(a,c),-1===a[c])throw new Error("Shader program has no "+c+" uniform")}return a},Ki=function(t,e){for(var r=t.getAttachedShaders(e),i=0;i<r.length;i++){var n=r[i];t.detachShader(e,n),t.deleteShader(n)}t.deleteProgram(e)},Zi=function(t,e,r,i){return{vertexIndices:$i(t,t.ELEMENT_ARRAY_BUFFER,t.STATIC_DRAW,new Uint16Array(e)),vertexPositions:$i(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(r)),textureCoords:$i(t,t.ARRAY_BUFFER,t.STATIC_DRAW,new Float32Array(i))}},Qi=function(t,e){t.deleteBuffer(e.vertexIndices),t.deleteBuffer(e.vertexPositions),t.deleteBuffer(e.textureCoords)},Ji=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++)t.enableVertexAttribArray(i)},tn=function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++)t.disableVertexAttribArray(i)},en=function(t,e,r){t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r._texture),t.uniform1i(e.uSampler,0)},rn=function(t,e,r,i){var n=(256*(r+1)-i)/65536;t.uniform1f(e.uDepth,n)},nn=function(t,e,r,i){if(0===r.x&&1===r.width&&0===r.y&&1===r.height)return t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),void qi.identity(i);var n=r.x,o=Bi(n,0,1),s=o-n,a=1-o,h=Bi(r.width-s,0,a),u=r.width-h,l=1-r.height-r.y,c=Bi(l,0,1),f=c-l,d=1-c,p=Bi(r.height-f,0,d),m=r.height-p;ji.set(Ui,r.width/h,r.height/p,1),ji.set(Yi,(u-s)/h,(m-f)/p,0),qi.identity(i),qi.translate(i,i,Yi),qi.scale(i,i,Ui),t.viewport(t.drawingBufferWidth*o,t.drawingBufferHeight*c,t.drawingBufferWidth*h,t.drawingBufferHeight*p)},on=function(t,e,r){var i=1;e&&null!=e.opacity&&(i=e.opacity),t.uniform1f(r.opacity,i);var n=Wi;e&&e.colorOffset&&(n=e.colorOffset),t.uniform4fv(r.colorOffset,n);var o=Xi;e&&e.colorMatrix&&(o=e.colorMatrix),t.uniformMatrix4fv(r.colorMatrix,!1,o)},sn=["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uProjMatrix;","varying vec2 vTextureCoord;","void main(void) {","  gl_Position = uViewportMatrix * uProjMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);","  gl_Position.z = uDepth * gl_Position.w;","  vTextureCoord = aTextureCoord;","}"].join("\n"),an=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float;","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec2 vTextureCoord;","void main(void) {","  vec4 color = texture2D(uSampler, vTextureCoord) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n"),hn=Hi.mat4,un=Hi.vec3,ln=Zi,cn=Qi,fn=Gi,dn=Ki,pn=Ji,mn=tn,vn=nn,_n=on,yn=rn,gn=en,wn=[0,1,2,0,2,3],Mn=[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],bn=[0,0,1,0,1,1,0,1],xn=["aVertexPosition","aTextureCoord"],En=["uDepth","uOpacity","uSampler","uProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix"];function Tn(t){this.gl=t,this.projMatrix=hn.create(),this.viewportMatrix=hn.create(),this.translateVector=un.create(),this.scaleVector=un.create(),this.constantBuffers=ln(t,wn,Mn,bn),this.shaderProgram=fn(t,sn,an,xn,En)}Tn.prototype.destroy=function(){cn(this.gl,this.constantBuffers),dn(this.gl,this.shaderProgram),wt(this)},Tn.prototype.startLayer=function(t,e){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,o=this.viewportMatrix;r.useProgram(i),pn(r,i),vn(r,t,e,o),r.uniformMatrix4fv(i.uViewportMatrix,!1,o),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,r.FALSE,0,0),_n(r,t.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Tn.prototype.endLayer=function(t,e){var r=this.gl,i=this.shaderProgram;mn(r,i)},Tn.prototype.renderTile=function(t,e,r,i){var n=this.gl,o=this.shaderProgram,s=this.constantBuffers,a=this.projMatrix,h=this.translateVector,u=this.scaleVector;h[0]=t.centerX(),h[1]=t.centerY(),h[2]=-.5,u[0]=t.scaleX(),u[1]=t.scaleY(),u[2]=1,hn.copy(a,r.view().projection()),hn.rotateX(a,a,t.rotX()),hn.rotateY(a,a,t.rotY()),hn.translate(a,a,h),hn.scale(a,a,u),n.uniformMatrix4fv(o.uProjMatrix,!1,a),yn(n,o,i,t.z),gn(n,o,e),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,wn.length,n.UNSIGNED_SHORT,0)};var Sn=Tn;function Ln(){this.constructor.super_.apply(this,arguments)}Ft(Ln,Sn);var An=Ln;function Cn(){this.constructor.super_.apply(this,arguments)}Ft(Cn,Sn);var Pn=Cn,Rn=["attribute vec3 aVertexPosition;","uniform float uDepth;","uniform mat4 uViewportMatrix;","uniform mat4 uInvProjMatrix;","varying vec4 vRay;","void main(void) {","  vRay = uInvProjMatrix * vec4(aVertexPosition.xy, 1.0, 1.0);","  gl_Position = uViewportMatrix * vec4(aVertexPosition.xy, uDepth, 1.0);","}"].join("\n"),On=["#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","#else","precision mediump float","#endif","uniform sampler2D uSampler;","uniform float uOpacity;","uniform float uTextureX;","uniform float uTextureY;","uniform float uTextureWidth;","uniform float uTextureHeight;","uniform vec4 uColorOffset;","uniform mat4 uColorMatrix;","varying vec4 vRay;","const float PI = 3.14159265358979323846264;","void main(void) {","  float r = inversesqrt(vRay.x * vRay.x + vRay.y * vRay.y + vRay.z * vRay.z);","  float phi  = acos(vRay.y * r);","  float theta = atan(vRay.x, -1.0*vRay.z);","  float s = 0.5 + 0.5 * theta / PI;","  float t = 1.0 - phi / PI;","  s = s * uTextureWidth + uTextureX;","  t = t * uTextureHeight + uTextureY;","  vec4 color = texture2D(uSampler, vec2(s, t)) * uColorMatrix + uColorOffset;","  gl_FragColor = vec4(color.rgba * uOpacity);","}"].join("\n"),zn=Hi.mat4,Fn=Zi,In=Qi,kn=Gi,Dn=Ki,Bn=Ji,Hn=tn,Nn=nn,jn=on,qn=rn,Vn=en,$n=[0,1,2,0,2,3],Wn=[-1,-1,0,1,-1,0,1,1,0,-1,1,0],Xn=[0,0,1,0,1,1,0,1],Yn=["aVertexPosition"],Un=["uDepth","uOpacity","uSampler","uInvProjMatrix","uViewportMatrix","uColorOffset","uColorMatrix","uTextureX","uTextureY","uTextureWidth","uTextureHeight"];function Gn(t){this.gl=t,this.invProjMatrix=zn.create(),this.viewportMatrix=zn.create(),this.constantBuffers=Fn(t,$n,Wn,Xn),this.shaderProgram=kn(t,Rn,On,Yn,Un)}Gn.prototype.destroy=function(){In(this.gl,this.constantBuffers),Dn(this.gl,this.shaderProgram),wt(this)},Gn.prototype.startLayer=function(t,e){var r=this.gl,i=this.shaderProgram,n=this.constantBuffers,o=this.invProjMatrix,s=this.viewportMatrix;r.useProgram(i),Bn(r,i),Nn(r,t,e,s),r.uniformMatrix4fv(i.uViewportMatrix,!1,s),r.bindBuffer(r.ARRAY_BUFFER,n.vertexPositions),r.vertexAttribPointer(i.aVertexPosition,3,r.FLOAT,r.FALSE,0,0),r.bindBuffer(r.ARRAY_BUFFER,n.textureCoords),zn.copy(o,t.view().projection()),zn.invert(o,o),r.uniformMatrix4fv(i.uInvProjMatrix,!1,o);var a=t.effects().textureCrop||{},h=null!=a.x?a.x:0,u=null!=a.y?a.y:0,l=null!=a.width?a.width:1,c=null!=a.height?a.height:1;r.uniform1f(i.uTextureX,h),r.uniform1f(i.uTextureY,u),r.uniform1f(i.uTextureWidth,l),r.uniform1f(i.uTextureHeight,c),jn(r,t.effects(),{opacity:i.uOpacity,colorOffset:i.uColorOffset,colorMatrix:i.uColorMatrix})},Gn.prototype.endLayer=function(t,e){var r=this.gl,i=this.shaderProgram;Hn(r,i)},Gn.prototype.renderTile=function(t,e,r,i){var n=this.gl,o=this.shaderProgram,s=this.constantBuffers;qn(n,o,i,t.z),Vn(n,o,e),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.vertexIndices),n.drawElements(n.TRIANGLES,$n.length,n.UNSIGNED_SHORT,0)};var Kn=Gn;var Zn=function(t){switch(t.type){case"webgl":t.registerRenderer("flat","flat",Pn),t.registerRenderer("cube","rectilinear",An),t.registerRenderer("equirect","rectilinear",Kn);break;default:throw new Error("Unknown stage type: "+t.type)}};var Qn=function(){for(var t=0,e=0;e<arguments.length;e++){var r=arguments[e];t+=r,t+=r<<10,t^=r>>6}return t+=t<<3,t^=t>>11,(t+=t<<15)>=0?t:-t};var Jn=function(t,e){return(+t%(e=+e)+e)%e};function to(t){if(null!=t&&(!isFinite(t)||Math.floor(t)!==t||t<1))throw new Error("Set: invalid capacity");this._capacity=this._capacity||64,this._buckets=[];for(var e=0;e<this._capacity;e++)this._buckets.push([]);this._size=0}to.prototype.add=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return r[i]=t,n}return r.push(t),this._size++,null},to.prototype.remove=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n)){for(var o=i;o<r.length-1;o++)r[o]=r[o+1];return r.length=r.length-1,this._size--,n}}return null},to.prototype.has=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._buckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return!0}return!1},to.prototype.size=function(){return this._size},to.prototype.clear=function(){for(var t=0;t<this._capacity;t++)this._buckets[t].length=0;this._size=0},to.prototype.forEach=function(t){for(var e=0,r=0;r<this._capacity;r++)for(var i=this._buckets[r],n=0;n<i.length;n++)t(i[n]),e+=1;return e};var eo=to;function ro(){this._stack=[],this._visited=new eo,this._vertices=null}ro.prototype.search=function(t,e,r){var i=this._stack,n=this._visited,o=this._vertices,s=0;for(this._clear(),i.push(e);i.length>0;){var a=i.pop();if(!n.has(a)&&t.intersects(a.vertices(o))){n.add(a);for(var h=a.neighbors(),u=0;u<h.length;u++)i.push(h[u]);r.push(a),s++}}return this._vertices=o,this._clear(),s},ro.prototype._clear=function(){this._stack.length=0,this._visited.clear()};var io=ro;function no(t){if(!isFinite(t)||Math.floor(t)!==t||t<0)throw new Error("LruMap: invalid capacity");this._capacity=t,this._keys=new Array(this._capacity),this._values=new Array(this._capacity),this._start=0,this._size=0}no.prototype._index=function(t){return Jn(this._start+t,this._capacity)},no.prototype.get=function(t){for(var e=0;e<this._size;e++){var r=this._keys[this._index(e)];if(t.equals(r))return this._values[this._index(e)]}return null},no.prototype.set=function(t,e){if(0===this._capacity)return t;this.del(t);var r=this._size===this._capacity?this._keys[this._index(0)]:null;return this._keys[this._index(this._size)]=t,this._values[this._index(this._size)]=e,this._size<this._capacity?this._size++:this._start=this._index(1),r},no.prototype.del=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._keys[this._index(e)])){for(var r=this._values[this._index(e)],i=e;i<this._size-1;i++)this._keys[this._index(i)]=this._keys[this._index(i+1)],this._values[this._index(i)]=this._values[this._index(i+1)];return this._size--,r}return null},no.prototype.has=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._keys[this._index(e)]))return!0;return!1},no.prototype.size=function(){return this._size},no.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._start=0,this._size=0},no.prototype.forEach=function(t){for(var e=0,r=0;r<this._size;r++)t(this._keys[this._index(r)],this._values[this._index(r)]),e+=1;return e};var oo=no;function so(t){this._fallbackOnly=!!t.fallbackOnly}so.prototype.numHorizontalTiles=function(){return Math.ceil(this.width()/this.tileWidth())},so.prototype.numVerticalTiles=function(){return Math.ceil(this.height()/this.tileHeight())},so.prototype.fallbackOnly=function(){return this._fallbackOnly};var ao=so;var ho=function(t,e){return t<e?-1:t>e?1:0};var uo={makeLevelList:function(t,e){for(var r=[],i=0;i<t.length;i++)r.push(new e(t[i]));return r.sort((function(t,e){return ho(t.width(),e.width())})),r},makeSelectableLevelList:function(t){for(var e=[],r=0;r<t.length;r++)t[r]._fallbackOnly||e.push(t[r]);if(!e.length)throw new Error("No selectable levels in list");return e}};var lo=function(t){var e=typeof t;if("object"===e){if(null===t)return"null";if("[object Array]"===Object.prototype.toString.call(t))return"array";if("[object RegExp]"===Object.prototype.toString.call(t))return"regexp"}return e},co=uo.makeLevelList,fo=uo.makeSelectableLevelList,po=Hi.vec3,mo=Hi.vec4,vo="fudlrb",_o={f:{x:0,y:0},b:{x:0,y:Math.PI},l:{x:0,y:Math.PI/2},r:{x:0,y:-Math.PI/2},u:{x:Math.PI/2,y:0},d:{x:-Math.PI/2,y:0}},yo=po.create();function go(t,e,r,i){e&&po.rotateZ(t,t,yo,e),r&&po.rotateX(t,t,yo,r),i&&po.rotateY(t,t,yo,i)}for(var wo={},Mo=0;Mo<vo.length;Mo++){var bo=vo[Mo],xo=_o[bo],Eo=po.fromValues(0,0,-1);go(Eo,0,xo.x,xo.y),wo[bo]=Eo}var To={f:["l","r","u","d"],b:["r","l","u","d"],l:["b","f","u","d"],r:["f","b","u","d"],u:["l","r","b","f"],d:["l","r","f","b"]},So=[[0,1],[1,0],[0,-1],[-1,0]];function Lo(t,e,r,i,n){this.face=t,this.x=e,this.y=r,this.z=i,this._geometry=n,this._level=n.levelList[i]}function Ao(t){if(this.constructor.super_.call(this,t),this._size=t.size,this._tileSize=t.tileSize,this._size%this._tileSize!=0)throw new Error("Level size is not multiple of tile size: "+this._size+" "+this._tileSize)}function Co(t){if("array"!==lo(t))throw new Error("Level list must be an array");this.levelList=co(t,Ao),this.selectableLevelList=fo(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._tileSearcher=new io(this),this._neighborsCache=new oo(64),this._vec=mo.create(),this._viewSize={}}Lo.prototype.rotX=function(){return _o[this.face].x},Lo.prototype.rotY=function(){return _o[this.face].y},Lo.prototype.centerX=function(){return(this.x+.5)/this._level.numHorizontalTiles()-.5},Lo.prototype.centerY=function(){return.5-(this.y+.5)/this._level.numVerticalTiles()},Lo.prototype.scaleX=function(){return 1/this._level.numHorizontalTiles()},Lo.prototype.scaleY=function(){return 1/this._level.numVerticalTiles()},Lo.prototype.vertices=function(t){t||(t=[po.create(),po.create(),po.create(),po.create()]);var e=_o[this.face];function r(t,r,i){po.set(t,r,i,-.5),go(t,0,e.x,e.y)}var i=this.centerX()-this.scaleX()/2,n=this.centerX()+this.scaleX()/2,o=this.centerY()-this.scaleY()/2,s=this.centerY()+this.scaleY()/2;return r(t[0],i,s),r(t[1],n,s),r(t[2],n,o),r(t[3],i,o),t},Lo.prototype.parent=function(){if(0===this.z)return null;var t=this.face,e=this.z,r=this.x,i=this.y,n=this._geometry,o=n.levelList[e],s=n.levelList[e-1];return new Lo(t,Math.floor(r/o.numHorizontalTiles()*s.numHorizontalTiles()),Math.floor(i/o.numVerticalTiles()*s.numVerticalTiles()),e-1,n)},Lo.prototype.children=function(t){if(this.z===this._geometry.levelList.length-1)return null;var e=this.face,r=this.z,i=this.x,n=this.y,o=this._geometry,s=o.levelList[r],a=o.levelList[r+1],h=a.numHorizontalTiles()/s.numHorizontalTiles(),u=a.numVerticalTiles()/s.numVerticalTiles();t=t||[];for(var l=0;l<h;l++)for(var c=0;c<u;c++){var f=h*i+l,d=u*n+c,p=r+1;t.push(new Lo(e,f,d,p,o))}return t},Lo.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,r=e.get(this);if(r)return r;for(var i=t._vec,n=this.face,o=this.x,s=this.y,a=this.z,h=this._level,u=h.numHorizontalTiles(),l=h.numVerticalTiles(),c=[],f=0;f<So.length;f++){var d=o+So[f][0],p=s+So[f][1],m=a,v=n;if(d<0||d>=u||p<0||p>=l){var _,y=this.centerX(),g=this.centerY();d<0?(po.set(i,-.5,g,-.5),v=To[n][0]):d>=u?(po.set(i,.5,g,-.5),v=To[n][1]):p<0?(po.set(i,y,.5,-.5),v=To[n][2]):p>=l&&(po.set(i,y,-.5,-.5),v=To[n][3]),go(i,0,(_=_o[n]).x,_.y),go(i,0,-(_=_o[v]).x,-_.y),d=Bi(Math.floor((.5+i[0])*u),0,u-1),p=Bi(Math.floor((.5-i[1])*l),0,l-1)}c.push(new Lo(v,d,p,m,t))}return e.set(this,c),c},Lo.prototype.hash=function(){return Qn(vo.indexOf(this.face),this.z,this.y,this.x)},Lo.prototype.equals=function(t){return this._geometry===t._geometry&&this.face===t.face&&this.z===t.z&&this.y===t.y&&this.x===t.x},Lo.prototype.cmp=function(t){return ho(this.z,t.z)||ho(vo.indexOf(this.face),vo.indexOf(t.face))||ho(this.y,t.y)||ho(this.x,t.x)},Lo.prototype.str=function(){return"CubeTile("+tile.face+", "+tile.x+", "+tile.y+", "+tile.z+")"},Ft(Ao,ao),Ao.prototype.width=function(){return this._size},Ao.prototype.height=function(){return this._size},Ao.prototype.tileWidth=function(){return this._tileSize},Ao.prototype.tileHeight=function(){return this._tileSize},Ao.prototype._validateWithParentLevel=function(t){var e=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),o=this.numHorizontalTiles(),s=this.numVerticalTiles(),a=t.width(),h=t.height(),u=t.tileWidth(),l=t.tileHeight(),c=t.numHorizontalTiles(),f=t.numVerticalTiles();if(e%a!=0)throw new Error("Level width must be multiple of parent level: "+e+" vs. "+a);if(r%h!=0)throw new Error("Level height must be multiple of parent level: "+r+" vs. "+h);if(o%c!=0)throw new Error("Number of horizontal tiles must be multiple of parent level: "+o+" ("+e+"/"+i+") vs. "+c+" ("+a+"/"+u+")");if(s%f!=0)throw new Error("Number of vertical tiles must be multiple of parent level: "+s+" ("+r+"/"+n+") vs. "+f+" ("+h+"/"+l+")")},Co.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},Co.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t),i=t.numHorizontalTiles()-1,n=t.numVerticalTiles()-1;e=e||[];for(var o=0;o<vo.length;o++)for(var s=vo[o],a=0;a<=i;a++)for(var h=0;h<=n;h++)e.push(new Lo(s,a,h,r,this));return e},Co.prototype._closestTile=function(t,e){var r=this._vec;mo.set(r,0,0,1,1),mo.transformMat4(r,r,t.inverseProjection());var i=1/0,n=null;for(var o in wo){var s=wo[o],a=1-po.dot(s,r);a<i&&(i=a,n=o)}for(var h=Math.max(Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]))/.5,u=0;u<3;u++)r[u]=r[u]/h;var l=_o[n];go(r,0,-l.x,-l.y);var c=this.levelList.indexOf(e),f=e.numHorizontalTiles(),d=e.numVerticalTiles();return new Lo(n,Bi(Math.floor((.5+r[0])*f),0,f-1),Bi(Math.floor((.5-r[1])*d),0,d-1),c,this)},Co.prototype.visibleTiles=function(t,e,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],t.size(i),0===i.width||0===i.height)return r;var o=this._closestTile(t,e);if(!n.search(t,o,r))throw new Error("Starting tile is not visible");return r},Co.Tile=Co.prototype.Tile=Lo,Co.type=Co.prototype.type="cube",Lo.type=Lo.prototype.type="cube";var Po=Co,Ro=uo.makeLevelList,Oo=uo.makeSelectableLevelList,zo=Hi.vec2,Fo=Hi.vec4,Io=[[0,1],[1,0],[0,-1],[-1,0]];function ko(t,e,r,i){this.x=t,this.y=e,this.z=r,this._geometry=i,this._level=i.levelList[r]}function Do(t){this.constructor.super_.call(this,t),this._width=t.width,this._height=t.height,this._tileWidth=t.tileWidth,this._tileHeight=t.tileHeight}function Bo(t){if("array"!==lo(t))throw new Error("Level list must be an array");this.levelList=Ro(t,Do),this.selectableLevelList=Oo(this.levelList);for(var e=1;e<this.levelList.length;e++)this.levelList[e]._validateWithParentLevel(this.levelList[e-1]);this._tileSearcher=new io(this),this._neighborsCache=new oo(64),this._vec=Fo.create(),this._viewSize={}}ko.prototype.rotX=function(){return 0},ko.prototype.rotY=function(){return 0},ko.prototype.centerX=function(){var t=this._level.width(),e=this._level.tileWidth();return(this.x*e+.5*this.width())/t-.5},ko.prototype.centerY=function(){var t=this._level.height(),e=this._level.tileHeight();return.5-(this.y*e+.5*this.height())/t},ko.prototype.scaleX=function(){var t=this._level.width();return this.width()/t},ko.prototype.scaleY=function(){var t=this._level.height();return this.height()/t},ko.prototype.width=function(){var t=this._level.width(),e=this._level.tileWidth();return this.x===this._level.numHorizontalTiles()-1&&Jn(t,e)||e},ko.prototype.height=function(){var t=this._level.height(),e=this._level.tileHeight();return this.y===this._level.numVerticalTiles()-1&&Jn(t,e)||e},ko.prototype.levelWidth=function(){return this._level.width()},ko.prototype.levelHeight=function(){return this._level.height()},ko.prototype.vertices=function(t){t||(t=[zo.create(),zo.create(),zo.create(),zo.create()]);var e=this.centerX()-this.scaleX()/2,r=this.centerX()+this.scaleX()/2,i=this.centerY()-this.scaleY()/2,n=this.centerY()+this.scaleY()/2;return zo.set(t[0],e,n),zo.set(t[1],r,n),zo.set(t[2],r,i),zo.set(t[3],e,i),t},ko.prototype.parent=function(){if(0===this.z)return null;var t=this._geometry,e=this.z-1;return new ko(Math.floor(this.x/2),Math.floor(this.y/2),e,t)},ko.prototype.children=function(t){if(this.z===this._geometry.levelList.length-1)return null;var e=this._geometry,r=this.z+1;return(t=t||[]).push(new ko(2*this.x,2*this.y,r,e)),t.push(new ko(2*this.x,2*this.y+1,r,e)),t.push(new ko(2*this.x+1,2*this.y,r,e)),t.push(new ko(2*this.x+1,2*this.y+1,r,e)),t},ko.prototype.neighbors=function(){var t=this._geometry,e=t._neighborsCache,r=e.get(this);if(r)return r;for(var i=this.x,n=this.y,o=this.z,s=this._level,a=s.numHorizontalTiles()-1,h=s.numVerticalTiles()-1,u=[],l=0;l<Io.length;l++){var c=i+Io[l][0],f=n+Io[l][1],d=o;0<=c&&c<=a&&0<=f&&f<=h&&u.push(new ko(c,f,d,t))}return e.set(this,u),u},ko.prototype.hash=function(){return Qn(this.z,this.y,this.x)},ko.prototype.equals=function(t){return this._geometry===t._geometry&&this.z===t.z&&this.y===t.y&&this.x===t.x},ko.prototype.cmp=function(t){return ho(this.z,t.z)||ho(this.y,t.y)||ho(this.x,t.x)},ko.prototype.str=function(){return"FlatTile("+tile.x+", "+tile.y+", "+tile.z+")"},Ft(Do,ao),Do.prototype.width=function(){return this._width},Do.prototype.height=function(){return this._height},Do.prototype.tileWidth=function(){return this._tileWidth},Do.prototype.tileHeight=function(){return this._tileHeight},Do.prototype._validateWithParentLevel=function(t){var e=this.width(),r=this.height(),i=this.tileWidth(),n=this.tileHeight(),o=t.width(),s=t.height(),a=t.tileWidth(),h=t.tileHeight();return e%o!=0?new Error("Level width must be multiple of parent level: "+e+" vs. "+o):r%s!=0?new Error("Level height must be multiple of parent level: "+r+" vs. "+s):i%a!=0?new Error("Level tile width must be multiple of parent level: "+i+" vs. "+a):n%h!=0?new Error("Level tile height must be multiple of parent level: "+n+" vs. "+h):void 0},Bo.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},Bo.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t),i=t.numHorizontalTiles()-1,n=t.numVerticalTiles()-1;e||(e=[]);for(var o=0;o<=i;o++)for(var s=0;s<=n;s++)e.push(new ko(o,s,r,this));return e},Bo.prototype._closestTile=function(t,e){var r=this._vec;Fo.set(r,0,0,1,1),Fo.transformMat4(r,r,t.inverseProjection());var i=.5+r[0],n=.5-r[1],o=this.levelList.indexOf(e),s=e.width(),a=e.height(),h=e.tileWidth(),u=e.tileHeight(),l=e.numHorizontalTiles(),c=e.numVerticalTiles();return new ko(Bi(Math.floor(i*s/h),0,l-1),Bi(Math.floor(n*a/u),0,c-1),o,this)},Bo.prototype.visibleTiles=function(t,e,r){var i=this._viewSize,n=this._tileSearcher;if(r=r||[],t.size(i),0===i.width||0===i.height)return r;var o=this._closestTile(t,e);if(!n.search(t,o,r))throw new Error("Starting tile is not visible");return r},Bo.Tile=Bo.prototype.Tile=ko,Bo.type=Bo.prototype.type="flat",ko.type=ko.prototype.type="flat";var Ho=Bo;function No(t,e){this.z=t,this._geometry=e,this._level=e.levelList[t]}function jo(t){this.constructor.super_.call(this,t),this._width=t.width}function qo(t){if("array"!==lo(t))throw new Error("Level list must be an array");this.levelList=uo.makeLevelList(t,jo),this.selectableLevelList=uo.makeSelectableLevelList(this.levelList)}No.prototype.rotX=function(){return 0},No.prototype.rotY=function(){return 0},No.prototype.centerX=function(){return.5},No.prototype.centerY=function(){return.5},No.prototype.scaleX=function(){return 1},No.prototype.scaleY=function(){return 1},No.prototype.parent=function(){return 0===this.z?null:new No(this.z-1,this._geometry)},No.prototype.children=function(t){return this.z===this._geometry.levelList.length-1?null:((t=t||[]).push(new No(this.z+1,this._geometry)),t)},No.prototype.neighbors=function(){return[]},No.prototype.hash=function(){return Qn(this.z)},No.prototype.equals=function(t){return this._geometry===t._geometry&&this.z===t.z},No.prototype.cmp=function(t){return ho(this.z,t.z)},No.prototype.str=function(){return"EquirectTile("+tile.z+")"},Ft(jo,ao),jo.prototype.width=function(){return this._width},jo.prototype.height=function(){return this._width/2},jo.prototype.tileWidth=function(){return this._width},jo.prototype.tileHeight=function(){return this._width/2},qo.prototype.maxTileSize=function(){for(var t=0,e=0;e<this.levelList.length;e++){var r=this.levelList[e];t=Math.max(t,r.tileWidth,r.tileHeight)}return t},qo.prototype.levelTiles=function(t,e){var r=this.levelList.indexOf(t);return(e=e||[]).push(new No(r,this)),e},qo.prototype.visibleTiles=function(t,e,r){var i=new No(this.levelList.indexOf(e),this);(r=r||[]).length=0,r.push(i)},qo.Tile=qo.prototype.Tile=No,qo.type=qo.prototype.type="equirect",No.type=No.prototype.type="equirect";var Vo=qo;function $o(t,e,r){return 2*Math.atan(r*Math.tan(t/2)/e)}var Wo={convert:$o,htov:function(t,e,r){return $o(t,e,r)},htod:function(t,e,r){return $o(t,e,Math.sqrt(e*e+r*r))},vtoh:function(t,e,r){return $o(t,r,e)},vtod:function(t,e,r){return $o(t,r,Math.sqrt(e*e+r*r))},dtoh:function(t,e,r){return $o(t,Math.sqrt(e*e+r*r),e)},dtov:function(t,e,r){return $o(t,Math.sqrt(e*e+r*r),r)}};var Xo=function(t){return"number"==typeof t&&isFinite(t)};var Yo=function(t){return t.toPrecision(15)};var Uo=function(){var t=arguments;return function(e){for(var r=e,i=0;i<t.length;i++){r=t[i].call(null,r)}return r}},Go=Hi.mat4,Ko=Hi.vec4,Zo=Math.PI/4,Qo=1e-6;function Jo(t,e){this._yaw=t&&null!=t.yaw?t.yaw:0,this._pitch=t&&null!=t.pitch?t.pitch:0,this._roll=t&&null!=t.roll?t.roll:0,this._fov=t&&null!=t.fov?t.fov:Zo,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._projectionCenterX=t&&null!=t.projectionCenterX?t.projectionCenterX:0,this._projectionCenterY=t&&null!=t.projectionCenterY?t.projectionCenterY:0,this._limiter=e||null,this._projMatrix=Go.create(),this._invProjMatrix=Go.create(),this._frustum=[Ko.create(),Ko.create(),Ko.create(),Ko.create(),Ko.create()],this._projectionChanged=!0,this._params={},this._fovs={},this._tmpVec=Ko.create(),this._update()}ct(Jo),Jo.prototype.destroy=function(){wt(this)},Jo.prototype.yaw=function(){return this._yaw},Jo.prototype.pitch=function(){return this._pitch},Jo.prototype.roll=function(){return this._roll},Jo.prototype.projectionCenterX=function(){return this._projectionCenterX},Jo.prototype.projectionCenterY=function(){return this._projectionCenterY},Jo.prototype.fov=function(){return this._fov},Jo.prototype.width=function(){return this._width},Jo.prototype.height=function(){return this._height},Jo.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},Jo.prototype.parameters=function(t){return(t=t||{}).yaw=this._yaw,t.pitch=this._pitch,t.roll=this._roll,t.fov=this._fov,t},Jo.prototype.limiter=function(){return this._limiter},Jo.prototype.setYaw=function(t){this._resetParams(),this._params.yaw=t,this._update(this._params)},Jo.prototype.setPitch=function(t){this._resetParams(),this._params.pitch=t,this._update(this._params)},Jo.prototype.setRoll=function(t){this._resetParams(),this._params.roll=t,this._update(this._params)},Jo.prototype.setFov=function(t){this._resetParams(),this._params.fov=t,this._update(this._params)},Jo.prototype.setProjectionCenterX=function(t){this._resetParams(),this._params.projectionCenterX=t,this._update(this._params)},Jo.prototype.setProjectionCenterY=function(t){this._resetParams(),this._params.projectionCenterY=t,this._update(this._params)},Jo.prototype.offsetYaw=function(t){this.setYaw(this._yaw+t)},Jo.prototype.offsetPitch=function(t){this.setPitch(this._pitch+t)},Jo.prototype.offsetRoll=function(t){this.setRoll(this._roll+t)},Jo.prototype.offsetFov=function(t){this.setFov(this._fov+t)},Jo.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},Jo.prototype.setParameters=function(t){this._resetParams(),this._params.yaw=t.yaw,this._params.pitch=t.pitch,this._params.roll=t.roll,this._params.fov=t.fov,this._params.projectionCenterX=t.projectionCenterX,this._params.projectionCenterY=t.projectionCenterY,this._update(this._params)},Jo.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},Jo.prototype._resetParams=function(){var t=this._params;t.yaw=null,t.pitch=null,t.roll=null,t.fov=null,t.width=null,t.height=null},Jo.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._yaw,r=this._pitch,i=this._roll,n=this._fov,o=this._projectionCenterX,s=this._projectionCenterY,a=this._width,h=this._height;if(t.yaw=null!=t.yaw?t.yaw:e,t.pitch=null!=t.pitch?t.pitch:r,t.roll=null!=t.roll?t.roll:i,t.fov=null!=t.fov?t.fov:n,t.width=null!=t.width?t.width:a,t.height=null!=t.height?t.height:h,t.projectionCenterX=null!=t.projectionCenterX?t.projectionCenterX:o,t.projectionCenterY=null!=t.projectionCenterY?t.projectionCenterY:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var u=(t=this._normalize(t)).yaw,l=t.pitch,c=t.roll,f=t.fov,d=t.width,p=t.height,m=t.projectionCenterX,v=t.projectionCenterY;if(!(Xo(u)&&Xo(l)&&Xo(c)&&Xo(f)&&Xo(d)&&Xo(p)&&Xo(m)&&Xo(v)))throw new Error("Bad view - suspect a broken limiter");this._yaw=u,this._pitch=l,this._roll=c,this._fov=f,this._width=d,this._height=p,this._projectionCenterX=m,this._projectionCenterY=v,u===e&&l===r&&c===i&&f===n&&d===a&&p===h&&m===o&&v===s||(this._projectionChanged=!0,this.emit("change")),d===a&&p===h||this.emit("resize")},Jo.prototype._normalize=function(t){this._normalizeCoordinates(t);var e=Wo.htov(Math.PI,t.width,t.height),r=isNaN(e)?Math.PI:Math.min(Math.PI,e);return t.fov=Bi(t.fov,Qo,r-Qo),t},Jo.prototype._normalizeCoordinates=function(t){return"yaw"in t&&(t.yaw=Jn(t.yaw-Math.PI,-2*Math.PI)+Math.PI),"pitch"in t&&(t.pitch=Jn(t.pitch-Math.PI,-2*Math.PI)+Math.PI),"roll"in t&&(t.roll=Jn(t.roll-Math.PI,-2*Math.PI)+Math.PI),t},Jo.prototype.normalizeToClosest=function(t,e){var r=this._yaw,i=this._pitch,n=t.yaw,o=t.pitch,s=n-2*Math.PI,a=n+2*Math.PI;Math.abs(s-r)<Math.abs(n-r)?n=s:Math.abs(a-r)<Math.abs(n-r)&&(n=a);var h=o-2*Math.PI,u=o+2*Math.PI;return Math.abs(h-i)<Math.abs(o-i)?o=h:Math.abs(h-i)<Math.abs(o-i)&&(o=u),(e=e||{}).yaw=n,e.pitch=o,e},Jo.prototype.updateWithControlParameters=function(t){var e=this._fov,r=Wo.vtoh(e,this._width,this._height);isNaN(r)&&(r=e),this.offsetYaw(t.axisScaledX*r+2*t.x*r+t.yaw),this.offsetPitch(t.axisScaledY*e+2*t.y*r+t.pitch),this.offsetRoll(-t.roll),this.offsetFov(t.zoom*e)},Jo.prototype._updateProjection=function(){var t=this._projMatrix,e=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._width,n=this._height,o=this._fov,s=Wo.vtoh(o,i,n),a=i/n,h=this._projectionCenterX,u=this._projectionCenterY;if(0!==h||0!==u){var l=Math.atan(2*h*Math.tan(s/2)),c=Math.atan(2*u*Math.tan(o/2)),f=this._fovs;f.leftDegrees=180*(s/2+l)/Math.PI,f.rightDegrees=180*(s/2-l)/Math.PI,f.upDegrees=180*(o/2+c)/Math.PI,f.downDegrees=180*(o/2-c)/Math.PI,Go.perspectiveFromFieldOfView(t,f,-1,1)}else Go.perspective(t,o,a,-1,1);Go.rotateZ(t,t,this._roll),Go.rotateX(t,t,this._pitch),Go.rotateY(t,t,this._yaw),Go.invert(e,t),this._matrixToFrustum(t,r),this._projectionChanged=!1}},Jo.prototype._matrixToFrustum=function(t,e){Ko.set(e[0],t[3]+t[0],t[7]+t[4],t[11]+t[8],0),Ko.set(e[1],t[3]-t[0],t[7]-t[4],t[11]-t[8],0),Ko.set(e[2],t[3]+t[1],t[7]+t[5],t[11]+t[9],0),Ko.set(e[3],t[3]-t[1],t[7]-t[5],t[11]-t[9],0),Ko.set(e[4],t[3]+t[2],t[7]+t[6],t[11]+t[10],0)},Jo.prototype.projection=function(){return this._updateProjection(),this._projMatrix},Jo.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},Jo.prototype.intersects=function(t){this._updateProjection();for(var e=this._frustum,r=this._tmpVec,i=0;i<e.length;i++){for(var n=e[i],o=!1,s=0;s<t.length;s++){var a=t[s];Ko.set(r,a[0],a[1],a[2],0),Ko.dot(n,r)>=0&&(o=!0)}if(!o)return!1}return!0},Jo.prototype.selectLevel=function(t){for(var e=jt()*this._height,r=Math.tan(.5*this._fov),i=0;i<t.length;i++){var n=t[i];if(r*n.height()>=e)return n}return t[t.length-1]},Jo.prototype.coordinatesToScreen=function(t,e){var r=this._tmpVec;e||(e={});var i=this._width,n=this._height;if(i<=0||n<=0)return e.x=null,e.y=null,null;var o=t.yaw,s=t.pitch,a=Math.sin(o)*Math.cos(s),h=-Math.sin(s),u=-Math.cos(o)*Math.cos(s);return Ko.set(r,a,h,u,1),Ko.transformMat4(r,r,this.projection()),r[3]>=0?(e.x=i*(r[0]/r[3]+1)/2,e.y=n*(1-r[1]/r[3])/2,e):(e.x=null,e.y=null,null)},Jo.prototype.screenToCoordinates=function(t,e){var r=this._tmpVec;e||(e={});var i=this._width,n=this._height,o=2*t.x/i-1,s=1-2*t.y/n;Ko.set(r,o,s,1,1),Ko.transformMat4(r,r,this.inverseProjection());var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);return e.yaw=Math.atan2(r[0],-r[2]),e.pitch=Math.acos(r[1]/a)-Math.PI/2,this._normalizeCoordinates(e),e},Jo.prototype.coordinatesToPerspectiveTransform=function(t,e,r){r=r||"";var i=this._height,n=this._width,o=this._fov,s=.5*i/Math.tan(o/2),a="";return a+="translateX("+Yo(n/2)+"px) ",a+="translateY("+Yo(i/2)+"px) ",a+="translateX(-50%) translateY(-50%) ",a+="perspective("+Yo(s)+"px) ",a+="translateZ("+Yo(s)+"px) ",a+="rotateZ("+Yo(-this._roll)+"rad) ",a+="rotateX("+Yo(-this._pitch)+"rad) ",a+="rotateY("+Yo(this._yaw)+"rad) ",a+="rotateY("+Yo(-t.yaw)+"rad) ",a+="rotateX("+Yo(t.pitch)+"rad) ",a+="translateZ("+Yo(-e)+"px) ",a+=r+" "},Jo.limit={yaw:function(t,e){return function(r){return r.yaw=Bi(r.yaw,t,e),r}},pitch:function(t,e){return function(r){return r.pitch=Bi(r.pitch,t,e),r}},roll:function(t,e){return function(r){return r.roll=Bi(r.roll,t,e),r}},hfov:function(t,e){return function(r){var i=r.width,n=r.height;if(i>0&&n>0){var o=Wo.htov(t,i,n),s=Wo.htov(e,i,n);r.fov=Bi(r.fov,o,s)}return r}},vfov:function(t,e){return function(r){return r.fov=Bi(r.fov,t,e),r}},resolution:function(t){return function(e){var r=e.height;if(r){var i=jt()*r,n=2*Math.atan(i/t);e.fov=Bi(e.fov,n,1/0)}return e}},traditional:function(t,e,r){return r=null!=r?r:e,Uo(Jo.limit.resolution(t),Jo.limit.vfov(0,e),Jo.limit.hfov(0,r),Jo.limit.pitch(-Math.PI/2,Math.PI/2))}},Jo.type=Jo.prototype.type="rectilinear";var ts=Jo,es=Hi.mat4,rs=Hi.vec4,is=[1,0,1,0],ns=[-1,-1,1,1];function os(t,e){if(!t||null==t.mediaAspectRatio)throw new Error("mediaAspectRatio must be defined");this._x=t&&null!=t.x?t.x:.5,this._y=t&&null!=t.y?t.y:.5,this._zoom=t&&null!=t.zoom?t.zoom:1,this._mediaAspectRatio=t.mediaAspectRatio,this._width=t&&null!=t.width?t.width:0,this._height=t&&null!=t.height?t.height:0,this._limiter=e||null,this._projMatrix=es.create(),this._invProjMatrix=es.create(),this._frustum=[0,0,0,0],this._projectionChanged=!0,this._params={},this._vec=rs.create(),this._update()}ct(os),os.prototype.destroy=function(){wt(this)},os.prototype.x=function(){return this._x},os.prototype.y=function(){return this._y},os.prototype.zoom=function(){return this._zoom},os.prototype.mediaAspectRatio=function(){return this._mediaAspectRatio},os.prototype.width=function(){return this._width},os.prototype.height=function(){return this._height},os.prototype.size=function(t){return(t=t||{}).width=this._width,t.height=this._height,t},os.prototype.parameters=function(t){return(t=t||{}).x=this._x,t.y=this._y,t.zoom=this._zoom,t.mediaAspectRatio=this._mediaAspectRatio,t},os.prototype.limiter=function(){return this._limiter},os.prototype.setX=function(t){this._resetParams(),this._params.x=t,this._update(this._params)},os.prototype.setY=function(t){this._resetParams(),this._params.y=t,this._update(this._params)},os.prototype.setZoom=function(t){this._resetParams(),this._params.zoom=t,this._update(this._params)},os.prototype.offsetX=function(t){this.setX(this._x+t)},os.prototype.offsetY=function(t){this.setY(this._y+t)},os.prototype.offsetZoom=function(t){this.setZoom(this._zoom+t)},os.prototype.setMediaAspectRatio=function(t){this._resetParams(),this._params.mediaAspectRatio=t,this._update(this._params)},os.prototype.setSize=function(t){this._resetParams(),this._params.width=t.width,this._params.height=t.height,this._update(this._params)},os.prototype.setParameters=function(t){this._resetParams(),this._params.x=t.x,this._params.y=t.y,this._params.zoom=t.zoom,this._params.mediaAspectRatio=t.mediaAspectRatio,this._update(this._params)},os.prototype.setLimiter=function(t){this._limiter=t||null,this._update()},os.prototype._resetParams=function(){var t=this._params;t.x=null,t.y=null,t.zoom=null,t.mediaAspectRatio=null,t.width=null,t.height=null},os.prototype._update=function(t){null==t&&(this._resetParams(),t=this._params);var e=this._x,r=this._y,i=this._zoom,n=this._mediaAspectRatio,o=this._width,s=this._height;if(t.x=null!=t.x?t.x:e,t.y=null!=t.y?t.y:r,t.zoom=null!=t.zoom?t.zoom:i,t.mediaAspectRatio=null!=t.mediaAspectRatio?t.mediaAspectRatio:n,t.width=null!=t.width?t.width:o,t.height=null!=t.height?t.height:s,this._limiter&&!(t=this._limiter(t)))throw new Error("Bad view limiter");var a=t.x,h=t.y,u=t.zoom,l=t.mediaAspectRatio,c=t.width,f=t.height;if(!(Xo(a)&&Xo(h)&&Xo(u)&&Xo(l)&&Xo(c)&&Xo(f)))throw new Error("Bad view - suspect a broken limiter");u=Bi(u,1e-6,1/0),this._x=a,this._y=h,this._zoom=u,this._mediaAspectRatio=l,this._width=c,this._height=f,a===e&&h===r&&u===i&&l===n&&c===o&&f===s||(this._projectionChanged=!0,this.emit("change")),c===o&&f===s||this.emit("resize")},os.prototype._zoomX=function(){return this._zoom},os.prototype._zoomY=function(){var t=this._mediaAspectRatio,e=this._width/this._height,r=this._zoom,i=r*t/e;return isNaN(i)&&(i=r),i},os.prototype.updateWithControlParameters=function(t){var e=this.zoom(),r=this._zoomX(),i=this._zoomY();this.offsetX(t.axisScaledX*r+t.x*e),this.offsetY(t.axisScaledY*i+t.y*e),this.offsetZoom(t.zoom*e)},os.prototype._updateProjection=function(){var t=this._projMatrix,e=this._invProjMatrix,r=this._frustum;if(this._projectionChanged){var i=this._x,n=this._y,o=this._zoomX(),s=this._zoomY(),a=r[0]=.5-n+.5*s,h=r[1]=i-.5+.5*o,u=r[2]=.5-n-.5*s,l=r[3]=i-.5-.5*o;es.ortho(t,l,h,u,a,-1,1),es.invert(e,t),this._projectionChanged=!1}},os.prototype.projection=function(){return this._updateProjection(),this._projMatrix},os.prototype.inverseProjection=function(){return this._updateProjection(),this._invProjMatrix},os.prototype.intersects=function(t){this._updateProjection();for(var e=this._frustum,r=0;r<e.length;r++){for(var i=e[r],n=is[r],o=ns[r],s=!1,a=0;a<t.length;a++){var h=t[a];if(o<0&&h[n]<i||o>0&&h[n]>i){s=!0;break}}if(!s)return!1}return!0},os.prototype.selectLevel=function(t){for(var e=jt()*this.width(),r=this._zoom,i=0;i<t.length;i++){var n=t[i];if(r*n.width()>=e)return n}return t[t.length-1]},os.prototype.coordinatesToScreen=function(t,e){var r=this._vec;e||(e={});var i=this._width,n=this._height;if(i<=0||n<=0)return e.x=null,e.y=null,null;var o=t&&null!=t.x?t.x:.5,s=t&&null!=t.y?t.y:.5;rs.set(r,o-.5,.5-s,-1,1),rs.transformMat4(r,r,this.projection());for(var a=0;a<3;a++)r[a]/=r[3];return e.x=i*(r[0]+1)/2,e.y=n*(1-r[1])/2,e},os.prototype.screenToCoordinates=function(t,e){var r=this._vec;e||(e={});var i=this._width,n=this._height,o=2*t.x/i-1,s=1-2*t.y/n;return rs.set(r,o,s,1,1),rs.transformMat4(r,r,this.inverseProjection()),e.x=.5+r[0],e.y=.5-r[1],e},os.limit={x:function(t,e){return function(r){return r.x=Bi(r.x,t,e),r}},y:function(t,e){return function(r){return r.y=Bi(r.y,t,e),r}},zoom:function(t,e){return function(r){return r.zoom=Bi(r.zoom,t,e),r}},resolution:function(t){return function(e){if(e.width<=0||e.height<=0)return e;var r=e.width,i=jt()*r/t;return e.zoom=Bi(e.zoom,i,1/0),e}},visibleX:function(t,e){return function(r){var i=e-t;r.zoom>i&&(r.zoom=i);var n=t+.5*r.zoom,o=e-.5*r.zoom;return r.x=Bi(r.x,n,o),r}},visibleY:function(t,e){return function(r){if(r.width<=0||r.height<=0)return r;var i=r.width/r.height/r.mediaAspectRatio,n=(e-t)*i;r.zoom>n&&(r.zoom=n);var o=t+.5*r.zoom/i,s=e-.5*r.zoom/i;return r.y=Bi(r.y,o,s),r}},letterbox:function(){return function(t){if(t.width<=0||t.height<=0)return t;var e,r,i,n,o=t.width/t.height,s=o/t.mediaAspectRatio;return t.mediaAspectRatio>=o&&(t.zoom=Math.min(t.zoom,1)),t.mediaAspectRatio<=o&&(t.zoom=Math.min(t.zoom,s)),t.zoom>1?e=r=.5:(e=0+.5*t.zoom/1,r=1-.5*t.zoom/1),t.zoom>s?i=n=.5:(i=0+.5*t.zoom/s,n=1-.5*t.zoom/s),t.x=Bi(t.x,e,r),t.y=Bi(t.y,i,n),t}}},os.type=os.prototype.type="flat";var ss=os;function as(t){this._concurrency=t&&t.concurrency||1,this._paused=t&&!!t.paused||!1,this._pool=[];for(var e=0;e<this._concurrency;e++)this._pool.push(new mt(t));this._next=0}as.prototype.length=function(){for(var t=0,e=0;e<this._pool.length;e++)t+=this._pool[e].length();return t},as.prototype.push=function(t,e){var r=this._next,i=this._pool[r].push(t,e);return this._next=Jn(this._next+1,this._concurrency),i},as.prototype.pause=function(){if(!this._paused){this._paused=!0;for(var t=0;t<this._concurrency;t++)this._pool[t].pause()}},as.prototype.resume=function(){if(this._paused){this._paused=!1;for(var t=0;t<this._concurrency;t++)this._pool[t].resume()}};var hs=as;var us=function(){};var ls=function(){var t=Array.prototype.slice.call(arguments,0);return function(){var e=t.slice(0),r=null,i=null,n=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],o=arguments.length?arguments[arguments.length-1]:us;function s(){var t=arguments[0];if(t)return r=i=null,void o.apply(null,arguments);if(!e.length)return r=i=null,void o.apply(null,arguments);var n=r=e.shift(),a=Array.prototype.slice.call(arguments,1);a.push(s);var h=r.apply(null,a);if(n===r){if("function"!=typeof h)throw new Error("chain: chaining on non-cancellable function");i=h}}function a(){i&&i.apply(null,arguments)}return n.unshift(null),s.apply(null,n),a}};var cs=function(t,e){var r=null;return r=setTimeout((function(){null!=r&&(r=null,e(null))}),t),function(){null!=r&&(clearTimeout(r),r=null,e.apply(null,arguments))}},fs={x:"x",y:"y",z:"z",f:"face"};function ds(t,e){e=e||{},this._loadPool=new hs({concurrency:e.concurrency||4}),this._retryDelay=e.retryDelay||1e4,this._retryMap={},this._sourceFromTile=t}function ps(t){return new RegExp("\\{("+t+")\\}","g")}ct(ds),ds.prototype.loadAsset=function(t,e,r){var i,n=this,o=this._retryDelay,s=this._retryMap,a=this._sourceFromTile(e),h=a.url,u=a.rect,l=t.loadImage.bind(t,h,u),c=s[h];if(null!=c){var f=ft()-c;f<o?i=o-f:(i=0,delete s[h])}var d=cs.bind(null,i);return ls(d,(function(t){return n._loadPool.push(l,(function(r,i){r?(r instanceof kt&&(s[h]=ft(),n.emit("networkError",r,e)),t(r,e)):(delete s[h],t(null,e,i))}))}))(r)},ds.fromString=function(t,e){var r=(e=e||{})&&e.cubeMapPreviewFaceOrder||"bdflru";return new ds(e.cubeMapPreviewUrl?function(t){return 0===t.z?function(t){var i=r.indexOf(t.face)/6;return{url:e.cubeMapPreviewUrl,rect:{x:0,y:i,width:1,height:1/6}}}(t):i(t)}:i,e);function i(e){var r=t;for(var i in fs){var n=fs[i],o=ps(i),s=e.hasOwnProperty(n)?e[n]:"";r=r.replace(o,s)}return{url:r}}};var ms=ds;function vs(t){this._asset=t}vs.prototype.asset=function(){return this._asset},vs.prototype.loadAsset=function(t,e,r){var i=this,n=setTimeout((function(){r(null,e,i._asset)}),0);return function(){clearTimeout(n),r.apply(null,arguments)}};var _s=vs;function ys(t){this.constructor.super_.call(this,t),this._timestamp=0}Ft(ys,zt),ct(ys),ys.prototype.destroy=function(){wt(this)},ys.prototype.timestamp=function(){return this._timestamp},ys.prototype.isDynamic=function(){return!0},ys.prototype.markDirty=function(){this._timestamp++,this.emit("change")};var gs=ys;function ws(t){if(null!=t&&(!isFinite(t)||Math.floor(t)!==t||t<1))throw new Error("Map: invalid capacity");this._capacity=t||64,this._keyBuckets=[],this._valBuckets=[];for(var e=0;e<this._capacity;e++)this._keyBuckets.push([]),this._valBuckets.push([]);this._size=0}ws.prototype.get=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._keyBuckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return this._valBuckets[e][i]}return null},ws.prototype.set=function(t,e){for(var r=Jn(t.hash(),this._capacity),i=this._keyBuckets[r],n=this._valBuckets[r],o=0;o<i.length;o++){var s=i[o];if(t.equals(s)){var a=n[o];return i[o]=t,n[o]=e,a}}return i.push(t),n.push(e),this._size++,null},ws.prototype.del=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._keyBuckets[e],i=this._valBuckets[e],n=0;n<r.length;n++){var o=r[n];if(t.equals(o)){for(var s=i[n],a=n;a<r.length-1;a++)r[a]=r[a+1],i[a]=i[a+1];return r.length=r.length-1,i.length=i.length-1,this._size--,s}}return null},ws.prototype.has=function(t){for(var e=Jn(t.hash(),this._capacity),r=this._keyBuckets[e],i=0;i<r.length;i++){var n=r[i];if(t.equals(n))return!0}return!1},ws.prototype.size=function(){return this._size},ws.prototype.clear=function(){for(var t=0;t<this._capacity;t++)this._keyBuckets[t].length=0,this._valBuckets[t].length=0;this._size=0},ws.prototype.forEach=function(t){for(var e=0,r=0;r<this._capacity;r++)for(var i=this._keyBuckets[r],n=this._valBuckets[r],o=0;o<i.length;o++)t(i[o],n[o]),e+=1;return e};var Ms=ws;function bs(t){if(!isFinite(t)||Math.floor(t)!==t||t<0)throw new Error("LruSet: invalid capacity");this._capacity=t,this._elements=new Array(this._capacity),this._start=0,this._size=0}bs.prototype._index=function(t){return Jn(this._start+t,this._capacity)},bs.prototype.add=function(t){if(0===this._capacity)return t;this.remove(t);var e=this._size===this._capacity?this._elements[this._index(0)]:null;return this._elements[this._index(this._size)]=t,this._size<this._capacity?this._size++:this._start=this._index(1),e},bs.prototype.remove=function(t){for(var e=0;e<this._size;e++){var r=this._elements[this._index(e)];if(t.equals(r)){for(var i=e;i<this._size-1;i++)this._elements[this._index(i)]=this._elements[this._index(i+1)];return this._size--,r}}return null},bs.prototype.has=function(t){for(var e=0;e<this._size;e++)if(t.equals(this._elements[this._index(e)]))return!0;return!1},bs.prototype.size=function(){return this._size},bs.prototype.clear=function(){this._elements.length=0,this._start=0,this._size=0},bs.prototype.forEach=function(t){for(var e=0,r=0;r<this._size;r++)t(this._elements[this._index(r)]),e+=1;return e};var xs=bs;var Es=function(t,e){for(var r in e)r in t||(t[r]=e[r]);return t};var Ts=function(t){return function(){var e=arguments.length?Array.prototype.slice.call(arguments,0,arguments.length-1):[],r=arguments.length?arguments[arguments.length-1]:us,i=null,n=!1;function o(){var o=arguments[0];!o||n?r.apply(null,arguments):i=t.apply(null,e)}return e.push(o),o(!0),function(){n=!0,i.apply(null,arguments)}}},Ss="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.textureStore,Ls=0,As=1,Cs=2,Ps=3,Rs={previouslyVisibleCacheSize:512},Os=0;function zs(){}function Fs(t,e){var r=this,i=Os++;r._id=i,r._store=t,r._tile=e,r._asset=null,r._texture=null,r._changeHandler=function(){t.emit("textureInvalid",e)};var n=t.source(),o=t.stage(),s=n.loadAsset.bind(n),a=o.createTexture.bind(o),h=ls(Ts(s),a);t.emit("textureStartLoad",e),Ss&&console.log("loading",i,e),r._cancel=h(o,e,(function(n,o,s,a){if(r._cancel=null,n)return s&&s.destroy(),a&&a.destroy(),void(n instanceof zs?(t.emit("textureCancel",e),Ss&&console.log("cancel",i,e)):(t.emit("textureError",e,n),Ss&&console.log("error",i,e)));r._texture=a,s.isDynamic()?(r._asset=s,s.addEventListener("change",r._changeHandler)):s.destroy(),t.emit("textureLoad",e),Ss&&console.log("load",i,e)}))}function Is(t,e,r){r=Es(r||{},Rs),this._source=t,this._stage=e,this._state=Ls,this._delimCount=0,this._itemMap=new Ms,this._visible=new eo,this._previouslyVisible=new xs(r.previouslyVisibleCacheSize),this._pinMap=new Ms,this._newVisible=new eo,this._noLongerVisible=[],this._visibleAgain=[],this._evicted=[]}Ft(zs,Error),Fs.prototype.asset=function(){return this._asset},Fs.prototype.texture=function(){return this._texture},Fs.prototype.destroy=function(){var t=this._id,e=this._store,r=this._tile,i=this._asset,n=this._texture,o=this._cancel;o?o(new zs("Texture load cancelled")):(i&&(i.removeEventListener("change",this._changeHandler),i.destroy()),n&&n.destroy(),e.emit("textureUnload",r),Ss&&console.log("unload",t,r),wt(this))},ct(Fs),ct(Is),Is.prototype.destroy=function(){this.clear(),wt(this)},Is.prototype.stage=function(){return this._stage},Is.prototype.source=function(){return this._source},Is.prototype.clear=function(){var t=this;t._evicted.length=0,t._itemMap.forEach((function(e){t._evicted.push(e)})),t._evicted.forEach((function(e){t._unloadTile(e)})),t._itemMap.clear(),t._visible.clear(),t._previouslyVisible.clear(),t._pinMap.clear(),t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},Is.prototype.clearNotPinned=function(){var t=this;t._evicted.length=0,t._itemMap.forEach((function(e){t._pinMap.has(e)||t._evicted.push(e)})),t._evicted.forEach((function(e){t._unloadTile(e)})),t._visible.clear(),t._previouslyVisible.clear(),t._evicted.length=0},Is.prototype.startFrame=function(){if(this._state!==Ls&&this._state!==As)throw new Error("TextureStore: startFrame called out of sequence");this._state=As,this._delimCount++},Is.prototype.markTile=function(t){if(this._state!==As&&this._state!==Cs)throw new Error("TextureStore: markTile called out of sequence");this._state=Cs;var e=this._itemMap.get(t),r=e&&e.texture(),i=e&&e.asset();r&&i&&r.refresh(t,i),this._newVisible.add(t)},Is.prototype.endFrame=function(){if(this._state!==As&&this._state!==Cs&&this._state!==Ps)throw new Error("TextureStore: endFrame called out of sequence");this._state=Ps,this._delimCount--,this._delimCount||(this._update(),this._state=Ls)},Is.prototype._update=function(){var t=this;t._noLongerVisible.length=0,t._visible.forEach((function(e){t._newVisible.has(e)||t._noLongerVisible.push(e)})),t._visibleAgain.length=0,t._newVisible.forEach((function(e){t._previouslyVisible.has(e)&&t._visibleAgain.push(e)})),t._visibleAgain.forEach((function(e){t._previouslyVisible.remove(e)})),t._evicted.length=0,t._noLongerVisible.forEach((function(e){var r=t._itemMap.get(e);if(r&&r.texture()){var i=t._previouslyVisible.add(e);null!=i&&t._evicted.push(i)}else r&&t._unloadTile(e)})),t._evicted.forEach((function(e){t._pinMap.has(e)||t._unloadTile(e)})),t._newVisible.forEach((function(e){t._itemMap.get(e)||t._loadTile(e)}));var e=t._visible;t._visible=t._newVisible,t._newVisible=e,t._newVisible.clear(),t._noLongerVisible.length=0,t._visibleAgain.length=0,t._evicted.length=0},Is.prototype._loadTile=function(t){if(this._itemMap.has(t))throw new Error("TextureStore: loading texture already in cache");var e=new Fs(this,t);this._itemMap.set(t,e)},Is.prototype._unloadTile=function(t){var e=this._itemMap.del(t);if(!e)throw new Error("TextureStore: unloading texture not in cache");e.destroy()},Is.prototype.asset=function(t){var e=this._itemMap.get(t);return e?e.asset():null},Is.prototype.texture=function(t){var e=this._itemMap.get(t);return e?e.texture():null},Is.prototype.pin=function(t){var e=(this._pinMap.get(t)||0)+1;return this._pinMap.set(t,e),this._itemMap.has(t)||this._loadTile(t),e},Is.prototype.unpin=function(t){var e=this._pinMap.get(t);if(!e)throw new Error("TextureStore: unpin when not pinned");return--e>0?this._pinMap.set(t,e):(this._pinMap.del(t),this._visible.has(t)||this._previouslyVisible.has(t)||this._unloadTile(t)),e},Is.prototype.query=function(t){var e=this._itemMap.get(t),r=this._pinMap.get(t)||0;return{visible:this._visible.has(t),previouslyVisible:this._previouslyVisible.has(t),hasAsset:null!=e&&null!=e.asset(),hasTexture:null!=e&&null!=e.texture(),pinned:0!==r,pinCount:r}};var ks=Is;var Ds=function(t,e){for(var r in e)t[r]=e[r];return t};function Bs(t,e,r,i,n){n=n||{};var o=this;this._source=t,this._geometry=e,this._view=r,this._textureStore=i,this._effects=n.effects||{},this._fixedLevelIndex=null,this._viewChangeHandler=function(){o.emit("viewChange",o.view())},this._view.addEventListener("change",this._viewChangeHandler),this._textureStoreChangeHandler=function(){o.emit("textureStoreChange",o.textureStore())},this._textureStore.addEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.addEventListener("textureInvalid",this._textureStoreChangeHandler)}ct(Bs),Bs.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._textureStore.removeEventListener("textureLoad",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureError",this._textureStoreChangeHandler),this._textureStore.removeEventListener("textureInvalid",this._textureStoreChangeHandler),wt(this)},Bs.prototype.source=function(){return this._source},Bs.prototype.geometry=function(){return this._geometry},Bs.prototype.view=function(){return this._view},Bs.prototype.textureStore=function(){return this._textureStore},Bs.prototype.effects=function(){return this._effects},Bs.prototype.setEffects=function(t){this._effects=t,this.emit("effectsChange",this._effects)},Bs.prototype.mergeEffects=function(t){Ds(this._effects,t),this.emit("effectsChange",this._effects)},Bs.prototype.fixedLevel=function(){return this._fixedLevelIndex},Bs.prototype.setFixedLevel=function(t){if(t!==this._fixedLevelIndex){if(null!=t&&(t>=this._geometry.levelList.length||t<0))throw new Error("Level index out of range: "+t);this._fixedLevelIndex=t,this.emit("fixedLevelChange",this._fixedLevelIndex)}},Bs.prototype._selectLevel=function(){return null!=this._fixedLevelIndex?this._geometry.levelList[this._fixedLevelIndex]:this._view.selectLevel(this._geometry.selectableLevelList)},Bs.prototype.visibleTiles=function(t){var e=this._selectLevel();return this._geometry.visibleTiles(this._view,e,t)},Bs.prototype.pinLevel=function(t){for(var e=this._geometry.levelList[t],r=this._geometry.levelTiles(e),i=0;i<r.length;i++)this._textureStore.pin(r[i])},Bs.prototype.unpinLevel=function(t){for(var e=this._geometry.levelList[t],r=this._geometry.levelTiles(e),i=0;i<r.length;i++)this._textureStore.unpin(r[i])},Bs.prototype.pinFirstLevel=function(){return this.pinLevel(0)},Bs.prototype.unpinFirstLevel=function(){return this.unpinLevel(0)};var Hs=Bs;function Ns(t){var e=this;this._stage=t,this._running=!1,this._rendering=!1,this._requestHandle=null,this._boundLoop=this._loop.bind(this),this._renderInvalidHandler=function(){e._rendering||e.renderOnNextFrame()},this._stage.addEventListener("renderInvalid",this._renderInvalidHandler)}ct(Ns),Ns.prototype.destroy=function(){this.stop(),this._stage.removeEventListener("renderInvalid",this._renderInvalidHandler),wt(this)},Ns.prototype.stage=function(){return this._stage},Ns.prototype.start=function(){this._running=!0,this.renderOnNextFrame()},Ns.prototype.stop=function(){this._requestHandle&&(window.cancelAnimationFrame(this._requestHandle),this._requestHandle=null),this._running=!1},Ns.prototype.renderOnNextFrame=function(){this._running&&!this._requestHandle&&(this._requestHandle=window.requestAnimationFrame(this._boundLoop))},Ns.prototype._loop=function(){if(!this._running)throw new Error("Render loop running while in stopped state");this._requestHandle=null,this._rendering=!0,this.emit("beforeRender"),this._rendering=!1,this._stage.render(),this.emit("afterRender")};var js=Ns;function qs(){this.velocity=null,this.friction=null,this.offset=null}qs.equals=function(t,e){return t.velocity===e.velocity&&t.friction===e.friction&&t.offset===e.offset},qs.prototype.equals=function(t){return qs.equals(this,t)},qs.prototype.update=function(t,e){t.offset&&(this.offset=this.offset||0,this.offset+=t.offset);var r=this.offsetFromVelocity(e);r&&(this.offset=this.offset||0,this.offset+=r),this.velocity=t.velocity,this.friction=t.friction},qs.prototype.reset=function(){this.velocity=null,this.friction=null,this.offset=null},qs.prototype.velocityAfter=function(t){return this.velocity?this.friction?function(t,e){if(t<0)return Math.min(0,t+e);if(t>0)return Math.max(0,t-e);return 0}(this.velocity,this.friction*t):this.velocity:null},qs.prototype.offsetFromVelocity=function(t){t=Math.min(t,this.nullVelocityTime());var e=this.velocityAfter(t);return(this.velocity+e)/2*t},qs.prototype.nullVelocityTime=function(){return null==this.velocity?0:this.velocity&&!this.friction?1/0:Math.abs(this.velocity/this.friction)};var Vs=qs;function $s(t,e,r,i,n){if(!t)throw new Error("KeyControlMethod: keyCode must be defined");if(!e)throw new Error("KeyControlMethod: parameter must be defined");if(!r)throw new Error("KeyControlMethod: velocity must be defined");if(!i)throw new Error("KeyControlMethod: friction must be defined");n=n||document,this._keyCode=t,this._parameter=e,this._velocity=r,this._friction=i,this._element=n,this._keydownHandler=this._handlePress.bind(this),this._keyupHandler=this._handleRelease.bind(this),this._blurHandler=this._handleBlur.bind(this),this._element.addEventListener("keydown",this._keydownHandler),this._element.addEventListener("keyup",this._keyupHandler),window.addEventListener("blur",this._blurHandler),this._dynamics=new Vs,this._pressing=!1}ct($s),$s.prototype.destroy=function(){this._element.removeEventListener("keydown",this._keydownHandler),this._element.removeEventListener("keyup",this._keyupHandler),window.removeEventListener("blur",this._blurHandler),wt(this)},$s.prototype._handlePress=function(t){t.keyCode===this._keyCode&&(this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active"))},$s.prototype._handleRelease=function(t){t.keyCode===this._keyCode&&(this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1)},$s.prototype._handleBlur=function(){this._dynamics.velocity=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive"),this._pressing=!1};var Ws=$s,Xs=At((function(t){
/*! Hammer.JS - v2.0.4 - 2014-09-28
     * http://hammerjs.github.io/
     *
     * Copyright (c) 2014 Jorik Tangelder;
     * Licensed under the MIT license */
!function(e,r,i,n){var o=["","webkit","moz","MS","ms","o"],s=r.createElement("div"),a="function",h=Math.round,u=Math.abs,l=Date.now;function c(t,e,r){return setTimeout(_(t,r),e)}function f(t,e,r){return!!Array.isArray(t)&&(d(t,r[e],r),!0)}function d(t,e,r){var i;if(t)if(t.forEach)t.forEach(e,r);else if(t.length!==n)for(i=0;i<t.length;)e.call(r,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)}function p(t,e,r){for(var i=Object.keys(e),o=0;o<i.length;)(!r||r&&t[i[o]]===n)&&(t[i[o]]=e[i[o]]),o++;return t}function m(t,e){return p(t,e,!0)}function v(t,e,r){var i,n=e.prototype;(i=t.prototype=Object.create(n)).constructor=t,i._super=n,r&&p(i,r)}function _(t,e){return function(){return t.apply(e,arguments)}}function y(t,e){return typeof t==a?t.apply(e&&e[0]||n,e):t}function g(t,e){return t===n?e:t}function w(t,e,r){d(E(e),(function(e){t.addEventListener(e,r,!1)}))}function M(t,e,r){d(E(e),(function(e){t.removeEventListener(e,r,!1)}))}function b(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function x(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function T(t,e,r){if(t.indexOf&&!r)return t.indexOf(e);for(var i=0;i<t.length;){if(r&&t[i][r]==e||!r&&t[i]===e)return i;i++}return-1}function S(t){return Array.prototype.slice.call(t,0)}function L(t,e,r){for(var i=[],n=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];T(n,s)<0&&i.push(t[o]),n[o]=s,o++}return r&&(i=e?i.sort((function(t,r){return t[e]>r[e]})):i.sort()),i}function A(t,e){for(var r,i,s=e[0].toUpperCase()+e.slice(1),a=0;a<o.length;){if((i=(r=o[a])?r+s:e)in t)return i;a++}return n}var C=1;function P(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}var R="ontouchstart"in e,O=A(e,"PointerEvent")!==n,z=R&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F="touch",I="mouse",k=24,D=["x","y"],B=["clientX","clientY"];function H(t,e){var r=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){y(t.options.enable,[t])&&r.handler(e)},this.init()}function N(t,e,r){var i=r.pointers.length,o=r.changedPointers.length,s=1&e&&i-o==0,a=12&e&&i-o==0;r.isFirst=!!s,r.isFinal=!!a,s&&(t.session={}),r.eventType=e,function(t,e){var r=t.session,i=e.pointers,o=i.length;r.firstInput||(r.firstInput=j(e));o>1&&!r.firstMultiple?r.firstMultiple=j(e):1===o&&(r.firstMultiple=!1);var s=r.firstInput,a=r.firstMultiple,h=a?a.center:s.center,c=e.center=q(i);e.timeStamp=l(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=W(h,c),e.distance=$(h,c),function(t,e){var r=e.center,i=t.offsetDelta||{},n=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(n=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y});e.deltaX=n.x+(r.x-i.x),e.deltaY=n.y+(r.y-i.y)}(r,e),e.offsetDirection=V(e.deltaX,e.deltaY),e.scale=a?(f=a.pointers,d=i,$(d[0],d[1],B)/$(f[0],f[1],B)):1,e.rotation=a?function(t,e){return W(e[1],e[0],B)-W(t[1],t[0],B)}(a.pointers,i):0,function(t,e){var r,i,o,s,a=t.lastInterval||e,h=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(h>25||a.velocity===n)){var l=a.deltaX-e.deltaX,c=a.deltaY-e.deltaY,f=function(t,e,r){return{x:e/t||0,y:r/t||0}}(h,l,c);i=f.x,o=f.y,r=u(f.x)>u(f.y)?f.x:f.y,s=V(l,c),t.lastInterval=e}else r=a.velocity,i=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=r,e.velocityX=i,e.velocityY=o,e.direction=s}(r,e);var f,d;var p=t.element;b(e.srcEvent.target,p)&&(p=e.srcEvent.target);e.target=p}(t,r),t.emit("hammer.input",r),t.recognize(r),t.session.prevInput=r}function j(t){for(var e=[],r=0;r<t.pointers.length;)e[r]={clientX:h(t.pointers[r].clientX),clientY:h(t.pointers[r].clientY)},r++;return{timeStamp:l(),pointers:e,center:q(e),deltaX:t.deltaX,deltaY:t.deltaY}}function q(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var r=0,i=0,n=0;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:h(r/e),y:h(i/e)}}function V(t,e){return t===e?1:u(t)>=u(e)?t>0?2:4:e>0?8:16}function $(t,e,r){r||(r=D);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return Math.sqrt(i*i+n*n)}function W(t,e,r){r||(r=D);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return 180*Math.atan2(n,i)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&w(this.element,this.evEl,this.domHandler),this.evTarget&&w(this.target,this.evTarget,this.domHandler),this.evWin&&w(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(P(this.element),this.evWin,this.domHandler)}};var X={mousedown:1,mousemove:2,mouseup:4},Y="mousedown",U="mousemove mouseup";function G(){this.evEl=Y,this.evWin=U,this.allow=!0,this.pressed=!1,H.apply(this,arguments)}v(G,H,{handler:function(t){var e=X[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&this.allow&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:I,srcEvent:t}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Z={2:F,3:"pen",4:I,5:"kinect"},Q="pointerdown",J="pointermove pointerup pointercancel";function tt(){this.evEl=Q,this.evWin=J,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&(Q="MSPointerDown",J="MSPointerMove MSPointerUp MSPointerCancel"),v(tt,H,{handler:function(t){var e=this.store,r=!1,i=t.type.toLowerCase().replace("ms",""),n=K[i],o=Z[t.pointerType]||t.pointerType,s=o==F,a=T(e,t.pointerId,"pointerId");1&n&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):12&n&&(r=!0),a<0||(e[a]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),r&&e.splice(a,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8},rt="touchstart",it="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=rt,this.evWin=it,this.started=!1,H.apply(this,arguments)}function ot(t,e){var r=S(t.touches),i=S(t.changedTouches);return 12&e&&(r=L(r.concat(i),"identifier",!0)),[r,i]}v(nt,H,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var r=ot.call(this,t,e);12&e&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:t})}}});var st={touchstart:1,touchmove:2,touchend:4,touchcancel:8},at="touchstart touchmove touchend touchcancel";function ht(){this.evTarget=at,this.targetIds={},H.apply(this,arguments)}function ut(t,e){var r=S(t.touches),i=this.targetIds;if(3&e&&1===r.length)return i[r[0].identifier]=!0,[r,r];var n,o,s=S(t.changedTouches),a=[],h=this.target;if(o=r.filter((function(t){return b(t.target,h)})),1===e)for(n=0;n<o.length;)i[o[n].identifier]=!0,n++;for(n=0;n<s.length;)i[s[n].identifier]&&a.push(s[n]),12&e&&delete i[s[n].identifier],n++;return a.length?[L(o.concat(a),"identifier",!0),a]:void 0}function lt(){H.apply(this,arguments);var t=_(this.handler,this);this.touch=new ht(this.manager,t),this.mouse=new G(this.manager,t)}v(ht,H,{handler:function(t){var e=st[t.type],r=ut.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:t})}}),v(lt,H,{handler:function(t,e,r){var i=r.pointerType==F,n=r.pointerType==I;if(i)this.mouse.allow=!1;else if(n&&!this.mouse.allow)return;12&e&&(this.mouse.allow=!0),this.callback(t,e,r)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ct=A(s.style,"touchAction"),ft=ct!==n,dt="compute",pt="auto",mt="manipulation",vt="none",_t="pan-x",yt="pan-y";function gt(t,e){this.manager=t,this.set(e)}gt.prototype={set:function(t){t==dt&&(t=this.compute()),ft&&(this.manager.element.style[ct]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return d(this.manager.recognizers,(function(e){y(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(x(t,vt))return vt;var e=x(t,_t),r=x(t,yt);if(e&&r)return"pan-x pan-y";if(e||r)return e?_t:yt;if(x(t,mt))return mt;return pt}(t.join(" "))},preventDefaults:function(t){if(!ft){var e=t.srcEvent,r=t.offsetDirection;if(!this.manager.session.prevented){var i=this.actions,n=x(i,vt),o=x(i,yt),s=x(i,_t);return n||o&&6&r||s&&r&k?this.preventSrc(e):void 0}e.preventDefault()}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var wt=16,Mt=32;function bt(t){this.id=C++,this.manager=null,this.options=m(t||{},this.defaults),this.options.enable=g(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function xt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function Et(t,e){var r=e.manager;return r?r.get(t):t}function Tt(){bt.apply(this,arguments)}function St(){Tt.apply(this,arguments),this.pX=null,this.pY=null}function Lt(){Tt.apply(this,arguments)}function At(){bt.apply(this,arguments),this._timer=null,this._input=null}function Ct(){Tt.apply(this,arguments)}function Pt(){Tt.apply(this,arguments)}function Rt(){bt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ot(t,e){return(e=e||{}).recognizers=g(e.recognizers,Ot.defaults.preset),new zt(t,e)}bt.prototype={defaults:{},set:function(t){return p(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(f(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Et(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return f(t,"dropRecognizeWith",this)||(t=Et(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(f(t,"requireFailure",this))return this;var e=this.requireFail;return-1===T(e,t=Et(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(f(t,"dropRequireFailure",this))return this;t=Et(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,r=this.state;function i(i){e.manager.emit(e.options.event+(i?function(t){if(t&wt)return"cancel";if(8&t)return"end";if(4&t)return"move";if(2&t)return"start";return""}(r):""),t)}r<8&&i(!0),i(),r>=8&&i(!0)},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=Mt},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=p({},t);if(!y(this.options.enable,[this,e]))return this.reset(),void(this.state=Mt);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},v(Tt,bt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,r=t.eventType,i=6&e,n=this.attrTest(t);return i&&(8&r||!n)?e|wt:i||n?4&r?8|e:2&e?4|e:2:Mt}}),v(St,Tt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push(yt),t&k&&e.push(_t),e},directionTest:function(t){var e=this.options,r=!0,i=t.distance,n=t.direction,o=t.deltaX,s=t.deltaY;return n&e.direction||(6&e.direction?(n=0===o?1:o<0?2:4,r=o!=this.pX,i=Math.abs(t.deltaX)):(n=0===s?1:s<0?8:16,r=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=n,r&&i>e.threshold&&n&e.direction},attrTest:function(t){return Tt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=xt(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),v(Lt,Tt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[vt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),v(At,bt,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[pt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!i||!r||12&t.eventType&&!n)this.reset();else if(1&t.eventType)this.reset(),this._timer=c((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return Mt},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}}),v(Ct,Tt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[vt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),v(Pt,Tt,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:30,pointers:1},getTouchAction:function(){return St.prototype.getTouchAction.call(this)},attrTest:function(t){var e,r=this.options.direction;return 30&r?e=t.velocity:6&r?e=t.velocityX:r&k&&(e=t.velocityY),this._super.attrTest.call(this,t)&&r&t.direction&&t.distance>this.options.threshold&&u(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=xt(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),v(Rt,bt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[mt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&n&&r){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||$(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&o?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=c((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return Mt},failTimeout:function(){return this._timer=c((function(){this.state=Mt}),this.options.interval,this),Mt},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ot.VERSION="2.0.4",Ot.defaults={domEvents:!1,touchAction:dt,enable:!0,inputTarget:null,inputClass:null,preset:[[Ct,{enable:!1}],[Lt,{enable:!1},["rotate"]],[Pt,{direction:6}],[St,{direction:6},["swipe"]],[Rt],[Rt,{event:"doubletap",taps:2},["tap"]],[At]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function zt(t,e){var r;e=e||{},this.options=m(e,Ot.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=new((r=this).options.inputClass||(O?tt:z?ht:R?lt:G))(r,N),this.touchAction=new gt(this,this.options.touchAction),Ft(this,!0),d(e.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Ft(t,e){var r=t.element;d(t.options.cssProps,(function(t,i){r.style[A(r.style,i)]=e?t:""}))}zt.prototype={set:function(t){return p(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var r;this.touchAction.preventDefaults(t);var i=this.recognizers,n=e.curRecognizer;(!n||n&&8&n.state)&&(n=e.curRecognizer=null);for(var o=0;o<i.length;)r=i[o],2===e.stopped||n&&r!=n&&!r.canRecognizeWith(n)?r.reset():r.recognize(t),!n&&14&r.state&&(n=e.curRecognizer=r),o++}},get:function(t){if(t instanceof bt)return t;for(var e=this.recognizers,r=0;r<e.length;r++)if(e[r].options.event==t)return e[r];return null},add:function(t){if(f(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(f(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(T(e,t),1),this.touchAction.update(),this},on:function(t,e){var r=this.handlers;return d(E(t),(function(t){r[t]=r[t]||[],r[t].push(e)})),this},off:function(t,e){var r=this.handlers;return d(E(t),(function(t){e?r[t].splice(T(r[t],e),1):delete r[t]})),this},emit:function(t,e){this.options.domEvents&&function(t,e){var i=r.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&Ft(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},p(Ot,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:wt,STATE_FAILED:Mt,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:k,DIRECTION_ALL:30,Manager:zt,Input:H,TouchAction:gt,TouchInput:ht,MouseInput:G,PointerEventInput:tt,TouchMouseInput:lt,SingleTouchInput:nt,Recognizer:bt,AttrRecognizer:Tt,Tap:Rt,Pan:St,Swipe:Pt,Pinch:Lt,Rotate:Ct,Press:At,on:w,off:M,each:d,merge:m,extend:p,inherit:v,bindFn:_,prefixed:A}),t.exports?t.exports=Ot:e.Hammer=Ot}(window,document)})),Ys=1,Us="MarzipanoHammerElementId";function Gs(t,e){return t[Us]||(t[Us]=Ys++),e+t[Us]}function Ks(){this._managers={},this._refCount={}}function Zs(t,e,r,i){this._manager=e,this._element=r,this._type=i,this._hammerGestures=t,this._eventHandlers=[]}Ks.prototype.get=function(t,e){var r=Gs(t,e);return this._managers[r]||(this._managers[r]=this._createManager(t,e),this._refCount[r]=0),this._refCount[r]++,new Zs(this,this._managers[r],t,e)},Ks.prototype._createManager=function(t,e){var r=new Xs.Manager(t);return"mouse"===e?r.add(new Xs.Pan({direction:Xs.DIRECTION_ALL,threshold:0})):"touch"!==e&&"pen"!==e&&"kinect"!==e||(r.add(new Xs.Pan({direction:Xs.DIRECTION_ALL,threshold:20,pointers:1})),r.add(new Xs.Pinch)),r},Ks.prototype._releaseHandle=function(t,e){var r=Gs(t,e);this._refCount[r]&&(this._refCount[r]--,this._refCount[r]||(this._managers[r].destroy(),delete this._managers[r],delete this._refCount[r]))},Zs.prototype.on=function(t,e){var r=this._type,i=function(t){r===t.pointerType&&e(t)};this._eventHandlers.push({events:t,handler:i}),this._manager.on(t,i)},Zs.prototype.release=function(){for(var t=0;t<this._eventHandlers.length;t++){var e=this._eventHandlers[t];this._manager.off(e.events,e.handler)}this._hammerGestures._releaseHandle(this._element,this._type),this._manager=null,this._element=null,this._type=null,this._hammerGestures=null},Zs.prototype.manager=function(){return this._manager};var Qs=new Ks;function Js(t,e,r,i){var n=Math.atan(e/t);i[0]=r*Math.cos(n),i[1]=r*Math.sin(n)}var ta=function(t,e,r,i,n){var o=Math.sqrt(Math.pow(e,2)+Math.pow(r,2));Js(e,r,t=Math.max(t,o/i),n),n[0]=Math.abs(n[0]),n[1]=Math.abs(n[1])},ea=ta,ra={friction:6,maxFrictionTime:.3},ia="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;function na(t,e,r){this._element=t,this._opts=Es(r||{},ra),this._startEvent=null,this._lastEvent=null,this._active=!1,this._dynamics={x:new Vs,y:new Vs},this._hammer=Qs.get(t,e),this._hammer.on("hammer.input",this._handleHammerEvent.bind(this)),this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleEnd.bind(this)),this._hammer.on("pancancel",this._handleEnd.bind(this))}ct(na),na.prototype.destroy=function(){this._hammer.release(),wt(this)},na.prototype._handleHammerEvent=function(t){if(t.isFirst){if(ia&&this._active)throw new Error("DragControlMethod active detected when already active");this._active=!0,this.emit("active")}if(t.isFinal){if(ia&&!this._active)throw new Error("DragControlMethod inactive detected when already inactive");this._active=!1,this.emit("inactive")}},na.prototype._handleStart=function(t){t.preventDefault(),this._startEvent=t},na.prototype._handleMove=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsMove(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y))},na.prototype._handleEnd=function(t){t.preventDefault(),this._startEvent&&(this._updateDynamicsRelease(t),this.emit("parameterDynamics","axisScaledX",this._dynamics.x),this.emit("parameterDynamics","axisScaledY",this._dynamics.y)),this._startEvent=!1,this._lastEvent=!1},na.prototype._updateDynamicsMove=function(t){var e=t.deltaX,r=t.deltaY,i=this._lastEvent||this._startEvent;i&&(e-=i.deltaX,r-=i.deltaY);var n=this._element.getBoundingClientRect();e/=n.right-n.left,r/=n.bottom-n.top,this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.offset=-e,this._dynamics.y.offset=-r,this._lastEvent=t};var oa=[null,null];na.prototype._updateDynamicsRelease=function(t){var e=this._element.getBoundingClientRect(),r=e.right-e.left,i=e.bottom-e.top,n=1e3*t.velocityX/r,o=1e3*t.velocityY/i;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=n,this._dynamics.y.velocity=o,ea(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,oa),this._dynamics.x.friction=oa[0],this._dynamics.y.friction=oa[1]};var sa=na,aa=ta,ha={speed:8,friction:6,maxFrictionTime:.3};function ua(t,e,r){this._element=t,this._opts=Es(r||{},ha),this._active=!1,this._hammer=Qs.get(t,e),this._dynamics={x:new Vs,y:new Vs},this._hammer.on("panstart",this._handleStart.bind(this)),this._hammer.on("panmove",this._handleMove.bind(this)),this._hammer.on("panend",this._handleRelease.bind(this)),this._hammer.on("pancancel",this._handleRelease.bind(this))}ct(ua),ua.prototype.destroy=function(){this._hammer.release(),wt(this)},ua.prototype._handleStart=function(t){t.preventDefault(),this._active||(this._active=!0,this.emit("active"))},ua.prototype._handleMove=function(t){t.preventDefault(),this._updateDynamics(t,!1)},ua.prototype._handleRelease=function(t){t.preventDefault(),this._updateDynamics(t,!0),this._active&&(this._active=!1,this.emit("inactive"))};var la=[null,null];ua.prototype._updateDynamics=function(t,e){var r=this._element.getBoundingClientRect(),i=r.right-r.left,n=r.bottom-r.top,o=Math.max(i,n),s=t.deltaX/o*this._opts.speed,a=t.deltaY/o*this._opts.speed;this._dynamics.x.reset(),this._dynamics.y.reset(),this._dynamics.x.velocity=s,this._dynamics.y.velocity=a,e&&(aa(this._opts.friction,this._dynamics.x.velocity,this._dynamics.y.velocity,this._opts.maxFrictionTime,la),this._dynamics.x.friction=la[0],this._dynamics.y.friction=la[1]),this.emit("parameterDynamics","x",this._dynamics.x),this.emit("parameterDynamics","y",this._dynamics.y)};var ca=ua,fa={frictionTime:.2,zoomDelta:.001};function da(t,e){this._element=t,this._opts=Es(e||{},fa),this._dynamics=new Vs,this._eventList=[];var r=this._opts.frictionTime?this.withSmoothing:this.withoutSmoothing;this._wheelListener=r.bind(this),t.addEventListener("wheel",this._wheelListener)}function pa(t){var e=1==t.deltaMode?20:1;return t.deltaY*e}ct(da),da.prototype.destroy=function(){this._element.removeEventListener(this._wheelListener),wt(this)},da.prototype.withoutSmoothing=function(t){this._dynamics.offset=pa(t)*this._opts.zoomDelta,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")},da.prototype.withSmoothing=function(t){var e=t.timeStamp;for(this._eventList.push(t);this._eventList[0].timeStamp<e-1e3*this._opts.frictionTime;)this._eventList.shift(0);for(var r=0,i=0;i<this._eventList.length;i++){r+=pa(this._eventList[i])*this._opts.zoomDelta/this._opts.frictionTime}this._dynamics.velocity=r,this._dynamics.friction=Math.abs(r)/this._opts.frictionTime,this.emit("parameterDynamics","zoom",this._dynamics),t.preventDefault(),this.emit("active"),this.emit("inactive")};var ma=da;function va(t,e,r){this._hammer=Qs.get(t,e),this._lastEvent=null,this._active=!1,this._dynamics=new Vs,this._hammer.on("pinchstart",this._handleStart.bind(this)),this._hammer.on("pinch",this._handleEvent.bind(this)),this._hammer.on("pinchend",this._handleEnd.bind(this)),this._hammer.on("pinchcancel",this._handleEnd.bind(this))}ct(va),va.prototype.destroy=function(){this._hammer.release(),wt(this)},va.prototype._handleStart=function(){this._active||(this._active=!0,this.emit("active"))},va.prototype._handleEnd=function(){this._lastEvent=null,this._active&&(this._active=!1,this.emit("inactive"))},va.prototype._handleEvent=function(t){var e=t.scale;this._lastEvent&&(e/=this._lastEvent.scale),this._dynamics.offset=-1*(e-1),this.emit("parameterDynamics","zoom",this._dynamics),this._lastEvent=t};var _a=va;function ya(t){if(!t)throw new Error("VelocityControlMethod: parameter must be defined");this._parameter=t,this._dynamics=new Vs}ct(ya),ya.prototype.destroy=function(){wt(this)},ya.prototype.setVelocity=function(t){this._dynamics.velocity=t,this.emit("parameterDynamics",this._parameter,this._dynamics)},ya.prototype.setFriction=function(t){this._dynamics.friction=t,this.emit("parameterDynamics",this._parameter,this._dynamics)};var ga=ya;function wa(t,e,r,i){if(!t)throw new Error("ElementPressControlMethod: element must be defined");if(!e)throw new Error("ElementPressControlMethod: parameter must be defined");if(!r)throw new Error("ElementPressControlMethod: velocity must be defined");if(!i)throw new Error("ElementPressControlMethod: friction must be defined");this._element=t,this._pressHandler=this._handlePress.bind(this),this._releaseHandler=this._handleRelease.bind(this),t.addEventListener("mousedown",this._pressHandler),t.addEventListener("mouseup",this._releaseHandler),t.addEventListener("mouseleave",this._releaseHandler),t.addEventListener("touchstart",this._pressHandler),t.addEventListener("touchmove",this._releaseHandler),t.addEventListener("touchend",this._releaseHandler),this._parameter=e,this._velocity=r,this._friction=i,this._dynamics=new Vs,this._pressing=!1}ct(wa),wa.prototype.destroy=function(){this._element.removeEventListener("mousedown",this._pressHandler),this._element.removeEventListener("mouseup",this._releaseHandler),this._element.removeEventListener("mouseleave",this._releaseHandler),this._element.removeEventListener("touchstart",this._pressHandler),this._element.removeEventListener("touchmove",this._releaseHandler),this._element.removeEventListener("touchend",this._releaseHandler),wt(this)},wa.prototype._handlePress=function(){this._pressing=!0,this._dynamics.velocity=this._velocity,this._dynamics.friction=0,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("active")},wa.prototype._handleRelease=function(){this._pressing&&(this._dynamics.friction=this._friction,this.emit("parameterDynamics",this._parameter,this._dynamics),this.emit("inactive")),this._pressing=!1};var Ma=wa;function ba(t){t=t||{},this._methods=[],this._parameters=["x","y","axisScaledX","axisScaledY","zoom","yaw","pitch","roll"],this._now=t.nowForTesting||ft,this._composedOffsets={},this._composeReturn={offsets:this._composedOffsets,changing:null}}ct(ba),ba.prototype.add=function(t){if(!this.has(t)){var e={};this._parameters.forEach((function(t){e[t]={dynamics:new Vs,time:null}}));var r=this._updateDynamics.bind(this,e),i={instance:t,dynamics:e,parameterDynamicsHandler:r};t.addEventListener("parameterDynamics",r),this._methods.push(i)}},ba.prototype.remove=function(t){var e=this._indexOfInstance(t);if(e>=0){var r=this._methods.splice(e,1)[0];r.instance.removeEventListener("parameterDynamics",r.parameterDynamicsHandler)}},ba.prototype.has=function(t){return this._indexOfInstance(t)>=0},ba.prototype._indexOfInstance=function(t){for(var e=0;e<this._methods.length;e++)if(this._methods[e].instance===t)return e;return-1},ba.prototype.list=function(){for(var t=[],e=0;e<this._methods.length;e++)t.push(this._methods[e].instance);return t},ba.prototype._updateDynamics=function(t,e,r){var i=t[e];if(!i)throw new Error("Unknown control parameter "+e);var n=this._now();i.dynamics.update(r,(n-i.time)/1e3),i.time=n,this.emit("change")},ba.prototype._resetComposedOffsets=function(){for(var t=0;t<this._parameters.length;t++)this._composedOffsets[this._parameters[t]]=0},ba.prototype.offsets=function(){var t,e=!1,r=this._now();this._resetComposedOffsets();for(var i=0;i<this._methods.length;i++)for(var n=this._methods[i].dynamics,o=0;o<this._parameters.length;o++){var s=n[t=this._parameters[o]],a=s.dynamics;null!=a.offset&&(this._composedOffsets[t]+=a.offset,a.offset=null);var h=(r-s.time)/1e3,u=a.offsetFromVelocity(h);u&&(this._composedOffsets[t]+=u);var l=a.velocityAfter(h);a.velocity=l,l&&(e=!0),s.time=r}return this._composeReturn.changing=e,this._composeReturn},ba.prototype.destroy=function(){for(var t=this.list(),e=0;e<t.length;e++)this.remove(t[e]);wt(this)};var xa=ba,Ea="undefined"!=typeof MARZIPANODEBUG&&MARZIPANODEBUG.controls;function Ta(t){t=t||{},this._methods={},this._methodGroups={},this._composer=new xa,this._enabled=!t||!t.enabled||!!t.enabled,this._activeCount=0,this.updatedViews_=[],this._attachedRenderLoop=null}ct(Ta),Ta.prototype.destroy=function(){this.detach(),this._composer.destroy(),wt(this)},Ta.prototype.methods=function(){var t={};for(var e in this._methods)t[e]=this._methods[e];return t},Ta.prototype.method=function(t){return this._methods[t]},Ta.prototype.registerMethod=function(t,e,r){if(this._methods[t])throw new Error("Control method already registered with id "+t);this._methods[t]={instance:e,enabled:!1,active:!1,activeHandler:this._handleActive.bind(this,t),inactiveHandler:this._handleInactive.bind(this,t)},r&&this.enableMethod(t,e)},Ta.prototype.unregisterMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&this.disableMethod(t),delete this._methods[t]},Ta.prototype.enableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled||(e.enabled=!0,e.active&&this._incrementActiveCount(),this._listen(t),this._updateComposer(),this.emit("methodEnabled",t))},Ta.prototype.disableMethod=function(t){var e=this._methods[t];if(!e)throw new Error("No control method registered with id "+t);e.enabled&&(e.enabled=!1,e.active&&this._decrementActiveCount(),this._unlisten(t),this._updateComposer(),this.emit("methodDisabled",t))},Ta.prototype.addMethodGroup=function(t,e){this._methodGroups[t]=e},Ta.prototype.removeMethodGroup=function(t){delete this._methodGroups[t]},Ta.prototype.methodGroups=function(){var t={};for(var e in this._methodGroups)t[e]=this._methodGroups[e];return t},Ta.prototype.enableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach((function(t){e.enableMethod(t)}))},Ta.prototype.disableMethodGroup=function(t){var e=this;e._methodGroups[t].forEach((function(t){e.disableMethod(t)}))},Ta.prototype.enabled=function(){return this._enabled},Ta.prototype.enable=function(){this._enabled||(this._enabled=!0,this._activeCount>0&&this.emit("active"),this.emit("enabled"),this._updateComposer())},Ta.prototype.disable=function(){this._enabled&&(this._enabled=!1,this._activeCount>0&&this.emit("inactive"),this.emit("disabled"),this._updateComposer())},Ta.prototype.attach=function(t){this._attachedRenderLoop&&this.detach(),this._attachedRenderLoop=t,this._beforeRenderHandler=this._updateViewsWithControls.bind(this),this._changeHandler=t.renderOnNextFrame.bind(t),this._attachedRenderLoop.addEventListener("beforeRender",this._beforeRenderHandler),this._composer.addEventListener("change",this._changeHandler)},Ta.prototype.detach=function(){this._attachedRenderLoop&&(this._attachedRenderLoop.removeEventListener("beforeRender",this._beforeRenderHandler),this._composer.removeEventListener("change",this._changeHandler),this._beforeRenderHandler=null,this._changeHandler=null,this._attachedRenderLoop=null)},Ta.prototype.attached=function(){return null!=this._attachedRenderLoop},Ta.prototype._listen=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.addEventListener("active",e.activeHandler),e.instance.addEventListener("inactive",e.inactiveHandler)},Ta.prototype._unlisten=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");e.instance.removeEventListener("active",e.activeHandler),e.instance.removeEventListener("inactive",e.inactiveHandler)},Ta.prototype._handleActive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active||(e.active=!0,this._incrementActiveCount())},Ta.prototype._handleInactive=function(t){var e=this._methods[t];if(!e)throw new Error("Bad method id");if(!e.enabled)throw new Error("Should not receive event from disabled control method");e.active&&(e.active=!1,this._decrementActiveCount())},Ta.prototype._incrementActiveCount=function(){this._activeCount++,Ea&&this._checkActiveCount(),this._enabled&&1===this._activeCount&&this.emit("active")},Ta.prototype._decrementActiveCount=function(){this._activeCount--,Ea&&this._checkActiveCount(),this._enabled&&0===this._activeCount&&this.emit("inactive")},Ta.prototype._checkActiveCount=function(){var t=0;for(var e in this._methods){var r=this._methods[e];r.enabled&&r.active&&t++}if(t!=this._activeCount)throw new Error("Bad control state")},Ta.prototype._updateComposer=function(){var t=this._composer;for(var e in this._methods){var r=this._methods[e],i=this._enabled&&r.enabled;i&&!t.has(r.instance)&&t.add(r.instance),!i&&t.has(r.instance)&&t.remove(r.instance)}},Ta.prototype._updateViewsWithControls=function(){var t=this._composer.offsets();t.changing&&this._attachedRenderLoop.renderOnNextFrame(),this.updatedViews_.length=0;for(var e=this._attachedRenderLoop.stage().listLayers(),r=0;r<e.length;r++){var i=e[r].view();this.updatedViews_.indexOf(i)<0&&(e[r].view().updateWithControlParameters(t.offsets),this.updatedViews_.push(i))}};var Sa=Ta,La=Yt.setTransform;var Aa=function(t,e,r,i){i=i||"";var n="translateX("+Yo(e)+"px) translateY("+Yo(r)+"px) translateZ(0) "+i;La(t,n)},Ca=Yt.setTransform;function Pa(t,e,r,i,n){(n=n||{}).perspective=n.perspective||{},n.perspective.extraTransforms=null!=n.perspective.extraTransforms?n.perspective.extraTransforms:"",this._domElement=t,this._parentDomElement=e,this._view=r,this._coords={},this._perspective={},this.setPosition(i),this._parentDomElement.appendChild(this._domElement),this.setPerspective(n.perspective),this._visible=!0,this._position={x:0,y:0}}ct(Pa),Pa.prototype.destroy=function(){this._parentDomElement.removeChild(this._domElement),wt(this)},Pa.prototype.domElement=function(){return this._domElement},Pa.prototype.position=function(){return this._coords},Pa.prototype.setPosition=function(t){for(var e in t)this._coords[e]=t[e];this._update()},Pa.prototype.perspective=function(){return this._perspective},Pa.prototype.setPerspective=function(t){for(var e in t)this._perspective[e]=t[e];this._update()},Pa.prototype.show=function(){this._visible||(this._visible=!0,this._update())},Pa.prototype.hide=function(){this._visible&&(this._visible=!1,this._update())},Pa.prototype._update=function(){var t,e,r=this._domElement,i=this._coords,n=this._position,o=!1;if(this._visible){var s=this._view;this._perspective.radius?(o=!0,this._setEmbeddedPosition(s,i)):(s.coordinatesToScreen(i,n),t=n.x,e=n.y,null!=t&&null!=e&&(o=!0,this._setPosition(t,e)))}o?(r.style.display="block",r.style.position="absolute"):(r.style.display="none",r.style.position="")},Pa.prototype._setEmbeddedPosition=function(t,e){var r=t.coordinatesToPerspectiveTransform(e,this._perspective.radius,this._perspective.extraTransforms);Ca(this._domElement,r)},Pa.prototype._setPosition=function(t,e){Aa(this._domElement,t,e,this._perspective.extraTransforms)};var Ra=Pa,Oa=Yt.setAbsolute,za=Yt.setOverflowHidden,Fa=Yt.setOverflowVisible,Ia=Yt.setNullSize,ka=Yt.setPixelSize,Da=Yt.setWithVendorPrefix("pointer-events");function Ba(t,e,r,i,n){n=n||{},this._parentDomElement=t,this._stage=e,this._view=r,this._renderLoop=i,this._hotspots=[],this._visible=!0,this._rect=n.rect,this._visibilityOrRectChanged=!0,this._stageWidth=null,this._stageHeight=null,this._tmpRect={},this._hotspotContainerWrapper=document.createElement("div"),Oa(this._hotspotContainerWrapper),Da(this._hotspotContainerWrapper,"none"),this._parentDomElement.appendChild(this._hotspotContainerWrapper),this._hotspotContainer=document.createElement("div"),Oa(this._hotspotContainer),Da(this._hotspotContainer,"all"),this._hotspotContainerWrapper.appendChild(this._hotspotContainer),this._updateHandler=this._update.bind(this),this._renderLoop.addEventListener("afterRender",this._updateHandler)}ct(Ba),Ba.prototype.destroy=function(){for(;this._hotspots.length;)this.destroyHotspot(this._hotspots[0]);this._parentDomElement.removeChild(this._hotspotContainerWrapper),this._renderLoop.removeEventListener("afterRender",this._updateHandler),wt(this)},Ba.prototype.domElement=function(){return this._hotspotContainer},Ba.prototype.setRect=function(t){this._rect=t,this._visibilityOrRectChanged=!0},Ba.prototype.rect=function(){return this._rect},Ba.prototype.createHotspot=function(t,e,r){e=e||{};var i=new Ra(t,this._hotspotContainer,this._view,e,r);return this._hotspots.push(i),i._update(),this.emit("hotspotsChange"),i},Ba.prototype.hasHotspot=function(t){return this._hotspots.indexOf(t)>=0},Ba.prototype.listHotspots=function(){return[].concat(this._hotspots)},Ba.prototype.destroyHotspot=function(t){var e=this._hotspots.indexOf(t);if(e<0)throw new Error("No such hotspot");this._hotspots.splice(e,1),t.destroy(),this.emit("hotspotsChange")},Ba.prototype.hide=function(){this._visible&&(this._visible=!1,this._visibilityOrRectChanged=!0,this._update())},Ba.prototype.show=function(){this._visible||(this._visible=!0,this._visibilityOrRectChanged=!0,this._update())},Ba.prototype._update=function(){var t=this._hotspotContainerWrapper,e=this._stage.width(),r=this._stage.height(),i=this._tmpRect;if(this._visibilityOrRectChanged||this._rect&&(e!==this._stageWidth||r!==this._stageHeight)){var n=this._visible;t.style.display=n?"block":"none",n&&(this._rect?(vt(e,r,this._rect,i),Aa(t,e*i.x,r*i.y),ka(t,e*i.width,r*i.height),za(t)):(Aa(t,0,0),Ia(t),Fa(t))),this._stageWidth=e,this._stageHeight=r,this._visibilityOrRectChanged=!1}for(var o=0;o<this._hotspots.length;o++)this._hotspots[o]._update()};var Ha=Ba;function Na(t,e){this._viewer=t,this._view=e,this._layers=[],this._hotspotContainer=new Ha(t._controlContainer,t.stage(),this._view,t.renderLoop()),this._movement=null,this._movementStartTime=null,this._movementStep=null,this._movementParams=null,this._movementCallback=null,this._updateMovementHandler=this._updateMovement.bind(this),this._updateHotspotContainerHandler=this._updateHotspotContainer.bind(this),this._viewer.addEventListener("sceneChange",this._updateHotspotContainerHandler),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._view.addEventListener("change",this._viewChangeHandler),this._updateHotspotContainer()}ct(Na),Na.prototype.destroy=function(){this._view.removeEventListener("change",this._viewChangeHandler),this._viewer.removeEventListener("sceneChange",this._updateHotspotContainerHandler),this._movement&&this.stopMovement(),this._hotspotContainer.destroy(),this.destroyAllLayers(),wt(this)},Na.prototype.hotspotContainer=function(){return this._hotspotContainer},Na.prototype.layer=function(){return this._layers[0]},Na.prototype.listLayers=function(){return[].concat(this._layers)},Na.prototype.view=function(){return this._view},Na.prototype.viewer=function(){return this._viewer},Na.prototype.visible=function(){return this._viewer.scene()===this},Na.prototype.createLayer=function(t){var e=(t=t||{}).textureStoreOpts||{},r=t.layerOpts||{},i=t.source,n=t.geometry,o=this._view,s=this._viewer.stage(),a=new ks(i,s,e),h=new Hs(i,n,o,a,r);return this._layers.push(h),t.pinFirstLevel&&h.pinFirstLevel(),this.emit("layerChange"),h},Na.prototype.destroyLayer=function(t){var e=this._layers.indexOf(t);if(e<0)throw new Error("No such layer in scene");this._layers.splice(e,1),this.emit("layerChange"),t.textureStore().destroy(),t.destroy()},Na.prototype.destroyAllLayers=function(){for(;this._layers.length>0;)this.destroyLayer(this._layers[0])},Na.prototype.switchTo=function(t,e){return this._viewer.switchScene(this,t,e)},Na.prototype.lookTo=function(t,e,r){if(e=e||{},r=r||us,"object"!==lo(t))throw new Error("Target view parameters must be an object");var i=null!=e.ease?e.ease:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},n=null!=e.controlsInterrupt&&e.controlsInterrupt,o=null!=e.transitionDuration?e.transitionDuration:1e3,s=null==e.shortest||e.shortest,a=this._view,h=a.parameters(),u={};Es(u,t),Es(u,h),s&&a.normalizeToClosest&&a.normalizeToClosest(u,u);var l=this._viewer.controls().enabled();n||this._viewer.controls().disable(),this.startMovement((function(){var t=!1;return function(e,r){if(r>=o&&t)return null;var n=Math.min(r/o,1);for(var s in e){var a=h[s],l=u[s];e[s]=a+i(n)*(l-a)}return t=r>=o,e}}),(function(){l&&this._viewer.controls().enable(),r()}))},Na.prototype.startMovement=function(t,e){var r=this._viewer.renderLoop();this._movement&&this.stopMovement();var i=t();if("function"!=typeof i)throw new Error("Bad movement");this._movement=t,this._movementStep=i,this._movementStartTime=ft(),this._movementParams={},this._movementCallback=e,r.addEventListener("beforeRender",this._updateMovementHandler),r.renderOnNextFrame()},Na.prototype.stopMovement=function(){var t=this._viewer.renderLoop();this._movement&&(this._movementCallback&&this._movementCallback(),t.removeEventListener("beforeRender",this._updateMovementHandler),this._movement=null,this._movementStep=null,this._movementStartTime=null,this._movementParams=null,this._movementCallback=null)},Na.prototype.movement=function(){return this._movement},Na.prototype._updateMovement=function(){if(!this._movement)throw new Error("Should not call update");var t=this._viewer.renderLoop(),e=this._view,r=ft()-this._movementStartTime,i=this._movementStep,n=this._movementParams;null==(n=i(n=e.parameters(n),r))?this.stopMovement():(e.setParameters(n),t.renderOnNextFrame())},Na.prototype._updateHotspotContainer=function(){this.visible()?this._hotspotContainer.show():this._hotspotContainer.hide()};var ja=Na,qa={duration:1/0};function Va(t){t=Es(t||{},qa),this._duration=t.duration,this._startTime=null,this._handle=null,this._check=this._check.bind(this)}ct(Va),Va.prototype.start=function(){this._startTime=ft(),null==this._handle&&this._duration<1/0&&this._setup(this._duration)},Va.prototype.started=function(){return null!=this._startTime},Va.prototype.stop=function(){this._startTime=null,null!=this._handle&&(clearTimeout(this._handle),this._handle=null)},Va.prototype._setup=function(t){this._handle=setTimeout(this._check,t)},Va.prototype._teardown=function(){clearTimeout(this._handle),this._handle=null},Va.prototype._check=function(){var t=ft()-this._startTime,e=this._duration-t;this._teardown(),e<=0?(this.emit("timeout"),this._startTime=null):e<1/0&&this._setup(e)},Va.prototype.duration=function(){return this._duration},Va.prototype.setDuration=function(t){this._duration=t,null!=this._startTime&&this._check()};var $a=Va,Wa={active:"move",inactive:"default",disabled:"default"};function Xa(t,e,r,i){i=Es(i||{},Wa),this._element=r,this._controls=t,this._id=e,this._attached=!1,this._setActiveCursor=this._setCursor.bind(this,i.active),this._setInactiveCursor=this._setCursor.bind(this,i.inactive),this._setDisabledCursor=this._setCursor.bind(this,i.disabled),this._setOriginalCursor=this._setCursor.bind(this,this._element.style.cursor),this._updateAttachmentHandler=this._updateAttachment.bind(this),t.addEventListener("methodEnabled",this._updateAttachmentHandler),t.addEventListener("methodDisabled",this._updateAttachmentHandler),t.addEventListener("enabled",this._updateAttachmentHandler),t.addEventListener("disabled",this._updateAttachmentHandler),this._updateAttachment()}Xa.prototype.destroy=function(){this._detachFromControlMethod(this._controls.method(this._id)),this._setOriginalCursor(),this._controls.removeEventListener("methodEnabled",this._updateAttachmentHandler),this._controls.removeEventListener("methodDisabled",this._updateAttachmentHandler),this._controls.removeEventListener("enabled",this._updateAttachmentHandler),this._controls.removeEventListener("disabled",this._updateAttachmentHandler),wt(this)},Xa.prototype._updateAttachment=function(){var t=this._controls,e=this._id;t.enabled()&&t.method(e).enabled?this._attachToControlMethod(t.method(e)):this._detachFromControlMethod(t.method(e))},Xa.prototype._attachToControlMethod=function(t){this._attached||(t.instance.addEventListener("active",this._setActiveCursor),t.instance.addEventListener("inactive",this._setInactiveCursor),t.active?this._setActiveCursor():this._setInactiveCursor(),this._attached=!0)},Xa.prototype._detachFromControlMethod=function(t){this._attached&&(t.instance.removeEventListener("active",this._setActiveCursor),t.instance.removeEventListener("inactive",this._setInactiveCursor),this._setDisabledCursor(),this._attached=!1)},Xa.prototype._setCursor=function(t){this._element.style.cursor=t};var Ya=Xa,Ua={mouseViewMode:"drag"};var Ga=function(t,e,r){r=Es(r||{},Ua);var i={mouseViewDrag:new sa(e,"mouse"),mouseViewQtvr:new ca(e,"mouse"),touchView:new sa(e,"touch"),pinch:new _a(e,"touch"),leftArrowKey:new Ws(37,"x",-.7,3),rightArrowKey:new Ws(39,"x",.7,3),upArrowKey:new Ws(38,"y",-.7,3),downArrowKey:new Ws(40,"y",.7,3),plusKey:new Ws(107,"zoom",-.7,3),minusKey:new Ws(109,"zoom",.7,3),wKey:new Ws(87,"y",-.7,3),aKey:new Ws(65,"x",-.7,3),sKey:new Ws(83,"y",.7,3),dKey:new Ws(68,"x",.7,3),qKey:new Ws(81,"roll",.7,3),eKey:new Ws(69,"roll",-.7,3)};!1!==r.scrollZoom&&(i.scrollZoom=new ma(e));var n={arrowKeys:["leftArrowKey","rightArrowKey","upArrowKey","downArrowKey"],plusMinusKeys:["plusKey","minusKey"],wasdKeys:["wKey","aKey","sKey","dKey"],qeKeys:["qKey","eKey"]},o=["scrollZoom","touchView","pinch"];switch(r.mouseViewMode){case"drag":o.push("mouseViewDrag");break;case"qtvr":o.push("mouseViewQtvr");break;default:throw new Error("Unknown mouse view mode: "+r.mouseViewMode)}for(var s in i){var a=i[s];t.registerMethod(s,a),o.indexOf(s)>=0&&t.enableMethod(s)}for(var h in n){var u=n[h];t.addMethodGroup(h,u)}return i};var Ka=function(t,e,r){var i=!1,n=ft();return e(0),requestAnimationFrame((function o(){if(!i){var s=(ft()-n)/t;s<1?(e(s),requestAnimationFrame(o)):(e(1),r())}})),function(){i=!0,r.apply(null,arguments)}},Za=Yt.setOverflowHidden,Qa=Yt.setAbsolute,Ja=Yt.setFullSize,th=Yt.setBlocking;function eh(t,e){e=e||{},this._domElement=t,Za(t),this._stage=new Jt(e.stage),Zn(this._stage),this._domElement.appendChild(this._stage.domElement()),this._controlContainer=document.createElement("div"),Qa(this._controlContainer),Ja(this._controlContainer),Nt.ios&&this._controlContainer.addEventListener("touchmove",(function(t){t.preventDefault()}));var r=document.createElement("div");Qa(r),Ja(r),th(r),this._controlContainer.appendChild(r),t.appendChild(this._controlContainer),this._size={},this.updateSize(),this._updateSizeListener=this.updateSize.bind(this),window.addEventListener("resize",this._updateSizeListener),this._renderLoop=new js(this._stage),this._controls=new Sa,this._controlMethods=Ga(this._controls,this._controlContainer,e.controls),this._controls.attach(this._renderLoop),this._hammerManagerTouch=Qs.get(this._controlContainer,"touch"),this._hammerManagerMouse=Qs.get(this._controlContainer,"mouse"),this._dragCursor=new Ya(this._controls,"mouseViewDrag",t,e.cursors&&e.cursors.drag||{}),this._renderLoop.start(),this._scenes=[],this._currentScene=null,this._replacedScene=null,this._cancelCurrentTween=null,this._layerChangeHandler=this._updateSceneLayers.bind(this),this._viewChangeHandler=this.emit.bind(this,"viewChange"),this._idleTimer=new $a,this._idleTimer.start(),this._resetIdleTimerHandler=this._resetIdleTimer.bind(this),this.addEventListener("viewChange",this._resetIdleTimerHandler),this._triggerIdleTimerHandler=this._triggerIdleTimer.bind(this),this._idleTimer.addEventListener("timeout",this._triggerIdleTimerHandler),this._stopMovementHandler=this.stopMovement.bind(this),this._controls.addEventListener("active",this._stopMovementHandler),this.addEventListener("sceneChange",this._stopMovementHandler),this._idleMovement=null}ct(eh),eh.prototype.destroy=function(){for(var t in window.removeEventListener("resize",this._updateSizeListener),this._currentScene&&this._removeSceneEventListeners(this._currentScene),this._replacedScene&&this._removeSceneEventListeners(this._replacedScene),this._dragCursor.destroy(),this._controlMethods)this._controlMethods[t].destroy();for(;this._scenes.length;)this.destroyScene(this._scenes[0]);this._domElement.removeChild(this._stage.domElement()),this._stage.destroy(),this._renderLoop.destroy(),this._controls.destroy(),this._controls=null,this._cancelCurrentTween&&this._cancelCurrentTween(),wt(this)},eh.prototype.updateSize=function(){var t=this._size;t.width=this._domElement.clientWidth,t.height=this._domElement.clientHeight,this._stage.setSize(t)},eh.prototype.stage=function(){return this._stage},eh.prototype.renderLoop=function(){return this._renderLoop},eh.prototype.controls=function(){return this._controls},eh.prototype.domElement=function(){return this._domElement},eh.prototype.createScene=function(t){t=t||{};var e=this.createEmptyScene({view:t.view});return e.createLayer({source:t.source,geometry:t.geometry,pinFirstLevel:t.pinFirstLevel,textureStoreOpts:t.textureStoreOpts,layerOpts:t.layerOpts}),e},eh.prototype.createEmptyScene=function(t){var e=new ja(this,(t=t||{}).view);return this._scenes.push(e),e},eh.prototype._updateSceneLayers=function(){var t,e,r=this._stage,i=this._currentScene,n=this._replacedScene,o=r.listLayers(),s=[];if(n&&(s=s.concat(n.listLayers())),i&&(s=s.concat(i.listLayers())),1!==Math.abs(o.length-s.length))throw new Error("Stage and scene out of sync");if(s.length<o.length)for(t=0;t<o.length;t++)if(e=o[t],s.indexOf(e)<0){this._removeLayerFromStage(e);break}if(s.length>o.length)for(t=0;t<s.length;t++)e=s[t],o.indexOf(e)<0&&this._addLayerToStage(e,t)},eh.prototype._addLayerToStage=function(t,e){t.pinFirstLevel(),this._stage.addLayer(t,e)},eh.prototype._removeLayerFromStage=function(t){this._stage.removeLayer(t),t.unpinFirstLevel(),t.textureStore().clearNotPinned()},eh.prototype._addSceneEventListeners=function(t){t.addEventListener("layerChange",this._layerChangeHandler),t.addEventListener("viewChange",this._viewChangeHandler)},eh.prototype._removeSceneEventListeners=function(t){t.removeEventListener("layerChange",this._layerChangeHandler),t.removeEventListener("viewChange",this._viewChangeHandler)},eh.prototype.destroyScene=function(t){var e,r,i=this._scenes.indexOf(t);if(i<0)throw new Error("No such scene in viewer");if(this._currentScene===t){for(this._removeSceneEventListeners(t),r=t.listLayers(),e=0;e<r.length;e++)this._removeLayerFromStage(r[e]);this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null),this._currentScene=null,this.emit("sceneChange")}if(this._replacedScene===t){for(this._removeSceneEventListeners(t),r=t.listLayers(),e=0;e<r.length;e++)this._removeLayerFromStage(r[e]);this._replacedScene=null}this._scenes.splice(i,1),t.destroy()},eh.prototype.destroyAllScenes=function(){for(;this._scenes.length>0;)this.destroyScene(this._scenes[0])},eh.prototype.hasScene=function(t){return this._scenes.indexOf(t)>=0},eh.prototype.listScenes=function(){return[].concat(this._scenes)},eh.prototype.scene=function(){return this._currentScene},eh.prototype.view=function(){var t=this._currentScene;return t?t.view():null},eh.prototype.lookTo=function(t,e,r){var i=this._currentScene;i&&i.lookTo(t,e,r)},eh.prototype.startMovement=function(t,e){var r=this._currentScene;r&&r.startMovement(t,e)},eh.prototype.stopMovement=function(){var t=this._currentScene;t&&t.stopMovement()},eh.prototype.movement=function(){var t=this._currentScene;if(t)return t.movement()},eh.prototype.setIdleMovement=function(t,e){this._idleTimer.setDuration(t),this._idleMovement=e},eh.prototype.breakIdleMovement=function(){this.stopMovement(),this._resetIdleTimer()},eh.prototype._resetIdleTimer=function(){this._idleTimer.start()},eh.prototype._triggerIdleTimer=function(){var t=this._idleMovement;t&&this.startMovement(t)};function rh(t,e,r){e.listLayers().forEach((function(e){e.mergeEffects({opacity:t})})),e._hotspotContainer.domElement().style.opacity=t}eh.prototype.switchScene=function(t,e,r){var i=this;e=e||{},r=r||us;var n=this._stage,o=this._currentScene;if(o!==t){if(this._scenes.indexOf(t)<0)throw new Error("No such scene in viewer");this._cancelCurrentTween&&(this._cancelCurrentTween(),this._cancelCurrentTween=null);var s=o?o.listLayers():[],a=t.listLayers(),h=n.listLayers();if(o&&(h.length!==s.length||h.length>1&&h[0]!=s[0]))throw new Error("Stage not in sync with viewer");for(var u=null!=e.transitionDuration?e.transitionDuration:1e3,l=null!=e.transitionUpdate?e.transitionUpdate:rh,c=0;c<a.length;c++)this._addLayerToStage(a[c]);this._cancelCurrentTween=Ka(u,(function(e){l(e,t,o)}),(function(){if(i._replacedScene){i._removeSceneEventListeners(i._replacedScene),s=i._replacedScene.listLayers();for(var t=0;t<s.length;t++)i._removeLayerFromStage(s[t]);i._replacedScene=null}i._cancelCurrentTween=null,r()})),this._currentScene=t,this._replacedScene=o,this.emit("sceneChange"),this.emit("viewChange"),this._addSceneEventListeners(t)}else r()};var ih=eh,nh=Hi.vec4,oh=Hi.mat4;function sh(t,e,r){var i,n,o,s,a,h,u;i=r,n=t,o=e.colorMatrix,s=n[0],a=n[1],h=n[2],u=n[3],i[0]=o[0]*s+o[1]*a+o[2]*h+o[3]*u,i[1]=o[4]*s+o[5]*a+o[6]*h+o[7]*u,i[2]=o[8]*s+o[9]*a+o[10]*h+o[11]*u,i[3]=o[12]*s+o[13]*a+o[14]*h+o[15]*u,nh.add(r,r,e.colorOffset)}var ah=nh.create();var hh=.01,uh={yawSpeed:.1,pitchSpeed:.1,fovSpeed:.1,yawAccel:hh,pitchAccel:hh,fovAccel:hh,targetPitch:0,targetFov:null};var lh={WebGlStage:Jt,WebGlCubeRenderer:An,WebGlFlatRenderer:Pn,WebGlEquirectRenderer:Kn,registerDefaultRenderers:Zn,CubeGeometry:Po,FlatGeometry:Ho,EquirectGeometry:Vo,RectilinearView:ts,FlatView:ss,ImageUrlSource:ms,SingleAssetSource:_s,StaticAsset:zt,DynamicAsset:gs,TextureStore:ks,Layer:Hs,RenderLoop:js,KeyControlMethod:Ws,DragControlMethod:sa,QtvrControlMethod:ca,ScrollZoomControlMethod:ma,PinchZoomControlMethod:_a,VelocityControlMethod:ga,ElementPressControlMethod:Ma,Controls:Sa,Dynamics:Vs,Viewer:ih,Scene:ja,Hotspot:Ra,HotspotContainer:Ha,colorEffects:{identity:function(t){var e=t||{};return e.colorOffset=e.colorOffset||nh.create(),e.colorMatrix=e.colorMatrix||oh.create(),e},applyToPixel:sh,applyToImageData:function(t,e){for(var r=t.width,i=t.height,n=t.data,o=0;o<r*i;o++)nh.set(ah,n[4*o+0]/255,n[4*o+1]/255,n[4*o+2]/255,n[4*o+3]/255),sh(ah,e,ah),n[4*o+0]=255*ah[0],n[4*o+1]=255*ah[1],n[4*o+2]=255*ah[2],n[4*o+3]=255*ah[3]}},registerDefaultControls:Ga,autorotate:function(t){var e=(t=Es(t||{},uh)).yawSpeed,r=t.pitchSpeed,i=t.fovSpeed,n=t.yawAccel,o=t.pitchAccel,s=t.fovAccel,a=t.targetPitch,h=t.targetFov;return function(){var t,u,l,c,f=0,d=0,p=0,m=0,v=0,_=0,y=0;return function(g,w){if(t=(w-f)/1e3,v=Math.min(d+t*n,e),u=v*t,g.yaw=g.yaw+u,null!=a&&g.pitch!==a){var M=.5*p*p/o;_=Math.abs(a-g.pitch)>M?Math.min(p+t*o,r):Math.max(p-t*o,0),l=_*t,a<g.pitch&&(g.pitch=Math.max(a,g.pitch-l)),a>g.pitch&&(g.pitch=Math.min(a,g.pitch+l))}if(null!=h&&g.fov!==a){var b=.5*m*m/s;y=Math.abs(h-g.fov)>b?Math.min(m+t*s,i):Math.max(m-t*s,0),c=y*t,h<g.fov&&(g.fov=Math.max(h,g.fov-c)),h>g.fov&&(g.fov=Math.min(h,g.fov+c))}return f=w,d=v,p=_,m=y,g}}},util:{async:_t,cancelize:gt,chain:ls,clamp:Bi,clearOwnProperties:wt,cmp:ho,compose:Uo,convertFov:Wo,decimal:Yo,defaults:Es,defer:function(t,e){setTimeout((function(){e&&e.length>0?t.apply(null,e):t()}),0)},degToRad:function(t){return t*Math.PI/180},delay:cs,dom:Yt,extend:Ds,hash:Qn,inherits:Ft,mod:Jn,noop:us,now:ft,once:yt,pixelRatio:jt,radToDeg:function(t){return 180*t/Math.PI},real:Xo,retry:Ts,tween:Ka,type:lo},dependencies:{bowser:Nt,glMatrix:Hi,eventEmitter:ct,hammerjs:Xs}},ch=At((function(t,e){!function(t){function e(){const t=new TextDecoder("utf-8");return{concat(t,e){const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r},copy(t,e,r){const i=new Uint8Array(r-e);return i.set(t.subarray(e,r)),i},toUtf8String:(e,r,i)=>t.decode(e.subarray(r,i))}}function r(t,r){const i=null!=r?r:e();let n,o=!1,s=!1;return{next(e){if(!o)try{!function(e){let r,a=0;for(n?(e=i.concat(n,e),r=n.length):r=0;r<e.length;){const n=e[r];if(10===n){if(!s){const n=r>0&&13===e[r-1]?r-1:r;if(o)return;t.next(i.toUtf8String(e,a,n)),a=r+1}}else 34===n&&(s=!s);r++}n=a<r?i.copy(e,a,r):void 0}(e)}catch(t){this.error(t)}},error(e){o||(o=!0,t.error(e))},complete(){o||(n&&t.next(i.toUtf8String(n,0,n.length)),o=!0,t.complete())},useCancellable(e){if(t.useCancellable){const r=this;t.useCancellable({cancel(){e.cancel(),n=void 0,r.complete()},isCancelled:()=>e.isCancelled()})}}}}class i{constructor(){this._reuse=!1}get reuse(){return this._reuse}set reuse(t){t&&!this.reusedValues&&(this.reusedValues=new Array(10)),this._reuse=t}withReuse(){return this.reuse=!0,this}splitLine(t){if(null==t)return this.lastSplitLength=0,[];let e=0,r=0;const i=this._reuse?this.reusedValues:[];let n=0;for(let o=0;o<t.length;o++){const s=t[o];if(","===s){if(e%2==0){const s=this.getValue(t,r,o,e);this._reuse?i[n++]=s:i.push(s),r=o+1,e=0}}else'"'===s&&e++}const o=this.getValue(t,r,t.length,e);return this._reuse?(i[n]=o,this.lastSplitLength=n+1):(i.push(o),this.lastSplitLength=i.length),i}getValue(t,e,r,i){return e===t.length?"":0===i?t.substring(e,r):2===i?t.substring(e+1,r-1):t.substring(e+1,r-1).replace(/""/gi,'"')}}class n{}function o(){return new n}const s=[404,408,425,429,500,502,503,504];function a(t){return s.includes(t)}class h extends Error{constructor(t){super(t),this.name="IllegalArgumentError",Object.setPrototypeOf(this,h.prototype)}}class u extends Error{constructor(t,e,r,i,n,o){if(super(),this.statusCode=t,this.statusMessage=e,this.body=r,this.contentType=n,Object.setPrototypeOf(this,u.prototype),o)this.message=o;else if(r){if(null==n?void 0:n.startsWith("application/json"))try{this.json=JSON.parse(r),this.message=this.json.message,this.code=this.json.code}catch(t){}this.message||(this.message=`${t} ${e} : ${r}`)}else this.message=`${t} ${e}`;this.name="HttpError",this.setRetryAfter(i)}setRetryAfter(t){"string"==typeof t&&/^[0-9]+$/.test(t)?this._retryAfter=parseInt(t):this._retryAfter=0}canRetry(){return a(this.statusCode)}retryAfter(){return this._retryAfter}}const l=["ECONNRESET","ENOTFOUND","ESOCKETTIMEDOUT","ETIMEDOUT","ECONNREFUSED","EHOSTUNREACH","EPIPE"];function c(t,e){if(t){let r;return"function"==typeof t.retryAfter?t.retryAfter():(r=0,e&&e>0?r+Math.round(Math.random()*e):r)}return 0}class f extends Error{constructor(){super(),Object.setPrototypeOf(this,f.prototype),this.name="RequestTimedOutError",this.message="Request timed out"}canRetry(){return!0}retryAfter(){return 0}}class d extends Error{constructor(){super(),this.name="AbortError",Object.setPrototypeOf(this,d.prototype),this.message="Response aborted"}canRetry(){return!0}retryAfter(){return 0}}const p=t=>t,m={boolean:t=>"true"===t,unsignedLong:t=>""===t?null:+t,long:t=>""===t?null:+t,double:t=>""===t?null:+t,string:p,base64Binary:p,duration:t=>""===t?null:t,"dateTime:RFC3339":t=>""===t?null:t};class v{constructor(t){t.forEach(((t,e)=>t.index=e)),this.columns=t}column(t){for(let e=0;e<this.columns.length;e++){const r=this.columns[e];if(r.label===t)return r}throw new h(`Column ${t} not found!`)}toObject(t){var e;const r={};for(let i=0;i<this.columns.length&&i<t.length;i++){let n=t[i];const o=this.columns[i];""===n&&o.defaultValue&&(n=o.defaultValue),r[o.label]=(null!==(e=m[o.dataType])&&void 0!==e?e:p)(n)}return r}}function _(t){return new v(t)}function y(t){const e=(new i).withReuse();let r,n,s=!0,a=0;return{error(e){t.error(e)},next(i){if(""===i)s=!0,r=void 0;else{const h=e.splitLine(i),u=e.lastSplitLength;if(s){if(!r){r=new Array(u);for(let t=0;t<u;t++)r[t]=o()}if(h[0].startsWith("#")){if("#datatype"===h[0])for(let t=1;t<u;t++)r[t].dataType=h[t];else if("#default"===h[0])for(let t=1;t<u;t++)r[t].defaultValue=h[t];else if("#group"===h[0])for(let t=1;t<u;t++)r[t].group="t"===h[t][0]}else{""===h[0]?(a=1,r=r.slice(1)):a=0;for(let t=a;t<u;t++)r[t-a].label=h[t];n=_(r),s=!1}}else t.next(h.slice(a,u),n)}},complete(){t.complete()},useCancellable(e){t.useCancellable&&t.useCancellable(e)}}}const g={retryJitter:200,minRetryDelay:5e3,maxRetryDelay:18e4,exponentialBase:5},w={batchSize:1e3,flushInterval:6e4,writeFailed:function(){},writeSuccess:function(){},maxRetries:3,maxBufferLines:32e3,retryJitter:200,minRetryDelay:5e3,maxRetryDelay:18e4,exponentialBase:5};function M(t,e){return function(r){let i="",n=0,o=0;for(;o<r.length;){const s=t.indexOf(r[o]);s>=0&&(i+=r.substring(n,o),i+=e[s],n=o+1),o++}return 0==n?r:(n<r.length&&(i+=r.substring(n,r.length)),i)}}const b={measurement:M(", \n\r\t",["\\,","\\ ","\\n","\\r","\\t"]),quoted:function(t,e){const r=M('"\\',['\\"',"\\\\"]);return t=>'"'+r(t)+'"'}(),tag:M(", =\n\r\t",["\\,","\\ ","\\=","\\n","\\r","\\t"])};let x=Date.now(),E=0;function T(){{const t=Date.now();t!==x?(x=t,E=0):E++;const e=String(E);return String(t)+"000000000".substr(0,6-e.length)+e}}function S(){return String(Date.now())+"000000000".substr(0,3)}function L(){return String(Date.now())}function A(){return String(Math.floor(Date.now()/1e3))}const C={s:A,ms:L,us:S,ns:T,seconds:A,millis:L,micros:S,nanos:T},P={s:t=>""+Math.floor(t.getTime()/1e3),ms:t=>""+t.getTime(),us:t=>t.getTime()+"000",ns:t=>t.getTime()+"000000"},R=Symbol("FLUX_VALUE");class O{constructor(t){this.fluxValue=t}toString(){return this.fluxValue}[R](){return this.fluxValue}}function z(t){if(null==t)return"";t=t.toString();let e,r=0;function i(){void 0===e&&(e=t.substring(0,r))}for(;r<t.length;r++){const n=t.charAt(r);switch(n){case"\r":i(),e+="\\r";break;case"\n":i(),e+="\\n";break;case"\t":i(),e+="\\t";break;case'"':case"\\":i(),e=e+"\\"+n;break;case"$":if(r+1<t.length&&"{"===t.charAt(r+1)){i(),r++,e+="\\${";break}null!=e&&(e+=n);break;default:null!=e&&(e+=n)}}return void 0!==e?e:t}function F(t){const e=String(t);let r=!1;for(const t of e){if("."===t){if(r)throw new Error("not a flux float: "+e);r=!r}if("."!==t&&(t<"0"||t>"9"))throw new Error("not a flux float: "+e)}return e}function I(t){return`regexp.compile(v: "${z(t)}")`}function k(t){return new O(String(t))}function D(t){if(void 0===t)return"";if(null===t)return"null";if("boolean"==typeof t)return t.toString();if("string"==typeof t)return`"${z(t)}"`;if("number"==typeof t)return F(t);if("object"==typeof t){if("function"==typeof t[R])return t[R]();if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return I(t);if(Array.isArray(t))return`[${t.map(D).join(",")}]`}return D(t.toString())}const B="function"==typeof Symbol&&Symbol.observable||"@@observable";function H(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))}let N={error(t,e){console.error("ERROR: "+t,e||"")},warn(t,e){console.warn("WARN: "+t,e||"")}};const j={error(t,e){N.error(t,e)},warn(t,e){N.warn(t,e)}};class q{constructor(t){this.options=Object.assign(Object.assign({},g),t),this.success()}nextDelay(t,e){const r=c(t);if(r&&r>0)return r+Math.round(Math.random()*this.options.retryJitter);{let t=this.currentDelay;if(e&&e>0){t=this.options.minRetryDelay;for(let r=1;r<e&&(t*=this.options.exponentialBase,!(t>=this.options.maxRetryDelay));r++);return Math.min(Math.max(t,1),this.options.maxRetryDelay)+Math.round(Math.random()*this.options.retryJitter)}return this.currentDelay?this.currentDelay=Math.min(Math.max(this.currentDelay*this.options.exponentialBase,1)+Math.round(Math.random()*this.options.retryJitter),this.options.maxRetryDelay):this.currentDelay=this.options.minRetryDelay+Math.round(Math.random()*this.options.retryJitter),this.currentDelay}}success(){this.currentDelay=void 0}}class V{constructor(t,e){this.maxLines=t,this.retryLines=e,this.size=0,this.nextRetryTime=0,this.closed=!1,this._timeoutHandle=void 0}addLines(t,e,r){if(this.closed)return;if(!t.length)return;const i=Date.now()+r;if(i>this.nextRetryTime&&(this.nextRetryTime=i),this.first&&this.size+t.length>this.maxLines){const e=this.size,r=.7*e;do{const t=this.first.next;this.size-=this.first.lines.length,this.first=t}while(this.first&&this.size+t.length>r);j.error(`RetryBuffer: ${e-this.size} oldest lines removed to keep buffer size under the limit of ${this.maxLines} lines`)}const n={lines:t,retryCount:e};this.last?(this.last.next=n,this.last=n):(this.first=n,this.last=n,this.scheduleRetry(r)),this.size+=t.length}removeLines(){if(this.first){const t=this.first;return this.first=this.first.next,this.size-=t.lines.length,this.first||(this.last=void 0),t}}scheduleRetry(t){this._timeoutHandle=setTimeout((()=>{const t=this.removeLines();t?this.retryLines(t.lines,t.retryCount).then((()=>{this.scheduleRetry(1)})).catch((t=>{this.scheduleRetry(this.nextRetryTime-Date.now())})):this._timeoutHandle=void 0}),t)}flush(){return H(this,void 0,void 0,(function*(){let t;for(;t=this.removeLines();)yield this.retryLines(t.lines,t.retryCount)}))}close(){return this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0),this.closed=!0,this.size}}class ${constructor(t,e,r){this.maxChunkRecords=t,this.flushFn=e,this.scheduleSend=r,this.length=0,this.lines=new Array(t)}add(t){0===this.length&&this.scheduleSend(),this.lines[this.length]=t,this.length++,this.length>=this.maxChunkRecords&&this.flush().catch((t=>{}))}flush(){const t=this.reset();return t.length>0?this.flushFn(t):Promise.resolve()}reset(){const t=this.lines.slice(0,this.length);return this.length=0,t}}class W{constructor(t,e,r,i,n){var o;this.transport=t,this.closed=!1,this._timeoutHandle=void 0,this.httpPath=`/api/v2/write?org=${encodeURIComponent(e)}&bucket=${encodeURIComponent(r)}&precision=${i}`,this.writeOptions=Object.assign(Object.assign({},w),n),this.currentTime=C[i],this.dateToProtocolTimestamp=P[i],this.writeOptions.defaultTags&&this.useDefaultTags(this.writeOptions.defaultTags),this.sendOptions={method:"POST",headers:Object.assign({"content-type":"text/plain; charset=utf-8"},null==n?void 0:n.headers)},this.writeBuffer=new $(this.writeOptions.batchSize,(t=>(this._clearFlushTimeout(),this.sendBatch(t,this.writeOptions.maxRetries+1))),(()=>{this.writeOptions.flushInterval>0&&(this._clearFlushTimeout(),this.closed||(this._timeoutHandle=setTimeout((()=>this.sendBatch(this.writeBuffer.reset(),this.writeOptions.maxRetries+1).catch((t=>{}))),this.writeOptions.flushInterval)))})),this.sendBatch=this.sendBatch.bind(this),this.retryStrategy=(o=this.writeOptions,new q(o)),this.retryBuffer=new V(this.writeOptions.maxBufferLines,this.sendBatch)}sendBatch(t,e){const r=this;return!this.closed&&t.length>0?new Promise(((i,n)=>{let o;const s={responseStarted(t,e){o=e},error(o){const s=r.writeOptions.maxRetries+2-e,a=r.writeOptions.writeFailed.call(r,o,t,s);if(a)a.then(i,n);else{if(!r.closed&&e>1&&(!(o instanceof u)||o.statusCode>=429))return j.warn(`Write to InfluxDB failed (remaining attempts: ${e-1}).`,o),r.retryBuffer.addLines(t,e-1,r.retryStrategy.nextDelay(o,s)),void n(o);j.error("Write to InfluxDB failed.",o),n(o)}},complete(){if(204==o||null==o)r.writeOptions.writeSuccess.call(r,t),r.retryStrategy.success(),i();else{const t=`204 HTTP response status code expected, but ${o} returned`,e=new u(o,t,void 0,"0");e.message=t,s.error(e)}}};this.transport.send(this.httpPath,t.join("\n"),this.sendOptions,s)})):Promise.resolve()}_clearFlushTimeout(){void 0!==this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=void 0)}writeRecord(t){if(this.closed)throw new Error("writeApi: already closed!");this.writeBuffer.add(t)}writeRecords(t){if(this.closed)throw new Error("writeApi: already closed!");for(let e=0;e<t.length;e++)this.writeBuffer.add(t[e])}writePoint(t){if(this.closed)throw new Error("writeApi: already closed!");const e=t.toLineProtocol(this);e&&this.writeBuffer.add(e)}writePoints(t){if(this.closed)throw new Error("writeApi: already closed!");for(let e=0;e<t.length;e++){const r=t[e].toLineProtocol(this);r&&this.writeBuffer.add(r)}}flush(t){return H(this,void 0,void 0,(function*(){if(yield this.writeBuffer.flush(),t)return yield this.retryBuffer.flush()}))}close(){return this.writeBuffer.flush().finally((()=>{const t=this.retryBuffer.close();t&&j.error(`Retry buffer closed with ${t} items that were not written to InfluxDB!`,null),this.closed=!0}))}dispose(){return this._clearFlushTimeout(),this.closed=!0,this.retryBuffer.close()+this.writeBuffer.length}useDefaultTags(t){return this.defaultTags=void 0,Object.keys(t).forEach((e=>{(this.defaultTags||(this.defaultTags={}))[e]=b.tag(t[e])})),this}convertTime(t){return void 0===t?this.currentTime():"string"==typeof t?t.length>0?t:void 0:t instanceof Date?this.dateToProtocolTimestamp(t):String("number"==typeof t?Math.floor(t):t)}}class X{constructor(t){this.connectionOptions=t,this.chunkCombiner=e(),this.defaultHeaders={"content-type":"application/json; charset=utf-8"},this.connectionOptions.token&&(this.defaultHeaders.Authorization="Token "+this.connectionOptions.token),this.url=String(this.connectionOptions.url),this.url.endsWith("/")&&(this.url=this.url.substring(0,this.url.length-1)),this.url.endsWith("/api/v2")&&(this.url=this.url.substring(0,this.url.length-"/api/v2".length),j.warn(`Please remove '/api/v2' context path from InfluxDB base url, using ${this.url} !`))}send(t,e,r,i){const n=function(t={}){let e=0;return{next:r=>{0===e&&t.next&&null!=r&&t.next(r)},error:r=>{0===e&&(e=1,t.error&&t.error(r))},complete:()=>{0===e&&(e=2,t.complete&&t.complete())},responseStarted:(e,r)=>{t.responseStarted&&t.responseStarted(e,r)}}}(i);let o=!1,s=r.signal;if(i&&i.useCancellable){const t=new AbortController;s||(s=t.signal,r=Object.assign(Object.assign({},r),s)),i.useCancellable({cancel(){o=!0,t.abort()},isCancelled:()=>o||s.aborted})}this.fetch(t,e,r).then((t=>H(this,void 0,void 0,(function*(){if(null==i?void 0:i.responseStarted){const e={};t.headers.forEach(((t,r)=>{const i=e[r];void 0===i?e[r]=t:Array.isArray(i)?i.push(t):e[r]=[i,t]})),n.responseStarted(e,t.status)}if(t.status>=300)return t.text().then((e=>{if(!e){const r=t.headers.get("x-influxdb-error");r&&(e=r)}n.error(new u(t.status,t.statusText,e,t.headers.get("retry-after"),t.headers.get("content-type")))})).catch((e=>{j.warn("Unable to receive error body",e),n.error(new u(t.status,t.statusText,void 0,t.headers.get("retry-after"),t.headers.get("content-type")))}));if(t.body){const e=t.body.getReader();let r;do{r=yield e.read(),n.next(r.value)}while(!r.done)}else if(t.arrayBuffer){const e=yield t.arrayBuffer();n.next(new Uint8Array(e))}else{const e=yield t.text();n.next((new TextEncoder).encode(e))}})))).catch((t=>{o||n.error(t)})).finally((()=>n.complete()))}request(t,e,r){var i,n;return H(this,void 0,void 0,(function*(){const o=yield this.fetch(t,e,r),{status:s,headers:a}=o,h=a.get("content-type")||"";if(s>=300){let t=yield o.text();if(!t){const e=a.get("x-influxdb-error");e&&(t=e)}throw new u(s,o.statusText,t,o.headers.get("retry-after"),o.headers.get("content-type"))}const l=null!==(n=null===(i=r.headers)||void 0===i?void 0:i.accept)&&void 0!==n?n:h;return l.includes("json")?yield o.json():l.includes("text")||l.startsWith("application/csv")?yield o.text():void 0}))}fetch(t,e,r){const{method:i,headers:n}=r,o=
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.

      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.

      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */
function(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]])}return r}(r,["method","headers"]);return fetch(`${this.url}${t}`,Object.assign({method:i,body:"GET"===i||"HEAD"===i?void 0:"string"==typeof e?e:JSON.stringify(e),headers:Object.assign(Object.assign({},this.defaultHeaders),n),credentials:"omit"},o))}}function Y(t,e){return e.toObject(t)}class U{constructor(t,e){this.isClosed=!1;try{e({next:e=>{t.next(e)},error:e=>{this.isClosed=!0,t.error(e)},complete:()=>{this.isClosed=!0,t.complete()},useCancellable:t=>{this.cancellable=t}})}catch(e){this.isClosed=!0,t.error(e)}}get closed(){return this.isClosed}unsubscribe(){var t;null===(t=this.cancellable)||void 0===t||t.cancel(),this.isClosed=!0}}function G(){}class K{constructor(t,e){this.executor=t,this.decorator=e}subscribe(t,e,r){const i=function(t){const{next:e,error:r,complete:i}=t;return{next:e?e.bind(t):G,error:r?r.bind(t):G,complete:i?i.bind(t):G}}("object"!=typeof t||null===t?{next:t,error:e,complete:r}:t);return new U(this.decorator(i),this.executor)}[B](){return this}}const Z={header:!0,delimiter:",",quoteChar:'"',commentPrefix:"#",annotations:["datatype","group","default"]},Q=t=>t;class J{constructor(t,e){this.transport=t,this.options="string"==typeof e?{org:e}:e}with(t){return new J(this.transport,Object.assign(Object.assign({},this.options),t))}lines(t){return new K(this.createExecutor(t),Q)}rows(t){return new K(this.createExecutor(t),(t=>y({next(e,r){t.next({values:e,tableMeta:r})},error(e){t.error(e)},complete(){t.complete()}})))}queryLines(t,e){this.createExecutor(t)(e)}queryRows(t,e){this.createExecutor(t)(y(e))}collectRows(t,e=Y){const r=[];return new Promise(((i,n)=>{this.queryRows(t,{next(t,i){const n=e.call(this,t,i);void 0!==n&&r.push(n)},error(t){n(t)},complete(){i(r)}})}))}collectLines(t){const e=[];return new Promise(((r,i)=>{this.queryLines(t,{next(t){e.push(t)},error(t){i(t)},complete(){r(e)}})}))}queryRaw(t){const{org:e,type:r,gzip:i,headers:n}=this.options;return this.transport.request("/api/v2/query?org="+encodeURIComponent(e),JSON.stringify(this.decorateRequest({query:t.toString(),dialect:Z,type:r})),{method:"POST",headers:Object.assign({accept:"text/csv","accept-encoding":i?"gzip":"identity","content-type":"application/json; encoding=utf-8"},n)})}createExecutor(t){const{org:e,type:i,gzip:n,headers:o}=this.options;return s=>{this.transport.send("/api/v2/query?org="+encodeURIComponent(e),JSON.stringify(this.decorateRequest({query:t.toString(),dialect:Z,type:i})),{method:"POST",headers:Object.assign({"content-type":"application/json; encoding=utf-8","accept-encoding":n?"gzip":"identity"},o)},r(s,this.transport.chunkCombiner))}}decorateRequest(t){var e;return"function"==typeof this.options.now&&(t.now=this.options.now()),t.type=null!==(e=this.options.type)&&void 0!==e?e:"flux",t}}t.AbortError=d,t.DEFAULT_ConnectionOptions={timeout:1e4},t.DEFAULT_RetryDelayStrategyOptions=g,t.DEFAULT_WriteOptions=w,t.FLUX_VALUE=R,t.HttpError=u,t.IllegalArgumentError=h,t.InfluxDB=class{constructor(t){var e;if("string"==typeof t)this._options={url:t};else{if(null===t||"object"!=typeof t)throw new h("No url or configuration specified!");this._options=t}const r=this._options.url;if("string"!=typeof r)throw new h("No url specified!");r.endsWith("/")&&(this._options.url=r.substring(0,r.length-1)),this.transport=null!==(e=this._options.transport)&&void 0!==e?e:new X(this._options)}getWriteApi(t,e,r="ns",i){return new W(this.transport,t,e,r,null!=i?i:this._options.writeOptions)}getQueryApi(t){return new J(this.transport,t)}},t.LineSplitter=i,t.Point=class{constructor(t){this.tags={},this.fields={},t&&(this.name=t)}measurement(t){return this.name=t,this}tag(t,e){return this.tags[t]=e,this}booleanField(t,e){return this.fields[t]=e?"T":"F",this}intField(t,e){if("number"!=typeof e){let r;if(isNaN(r=parseInt(String(e))))throw new Error(`Expected integer value for field ${t}, but got '${e}'!`);e=r}return this.fields[t]=Math.floor(e)+"i",this}floatField(t,e){if("number"!=typeof e){let r;if(isNaN(r=parseFloat(e)))throw new Error(`Expected float value for field ${t}, but got '${e}'!`);e=r}return this.fields[t]=String(e),this}stringField(t,e){return null!=e&&("string"!=typeof e&&(e=String(e)),this.fields[t]=b.quoted(e)),this}timestamp(t){return this.time=t,this}toLineProtocol(t){if(!this.name)return;let e="";if(Object.keys(this.fields).sort().forEach((t=>{if(t){const r=this.fields[t];e.length>0&&(e+=","),e+=`${b.tag(t)}=${r}`}})),0===e.length)return;let r="";const i=t&&t.defaultTags?Object.assign(Object.assign({},t.defaultTags),this.tags):this.tags;Object.keys(i).sort().forEach((t=>{if(t){const e=i[t];e&&(r+=",",r+=`${b.tag(t)}=${b.tag(e)}`)}}));let n=this.time;return t&&t.convertTime&&(n=t.convertTime(n)),`${b.measurement(this.name)}${r} ${e}${void 0!==n?" "+n:""}`}toString(){return this.toLineProtocol(void 0)||"invalid point: "+JSON.stringify(this,void 0)}},t.RequestTimedOutError=f,t.canRetryHttpCall=function(t){return!(!t||!("function"==typeof t.canRetry?t.canRetry():t.code&&l.includes(t.code)))},t.chunksToLines=r,t.createFluxTableColumn=function(t){var e,r;const i=new n;return i.label=String(t.label),i.dataType=t.dataType,i.group=Boolean(t.group),i.defaultValue=null!==(e=t.defaultValue)&&void 0!==e?e:"",i.index=null!==(r=t.index)&&void 0!==r?r:0,i},t.createFluxTableMetaData=_,t.createTextDecoderCombiner=e,t.currentTime=C,t.dateToProtocolTimestamp=P,t.escape=b,t.flux=function(t,...e){if(1==t.length&&(!e||0===e.length))return k(t[0]);const r=new Array(t.length+e.length);let i=0;for(let o=0;o<t.length;o++){const s=t[o];if(r[i++]=s,o<e.length){const a=e[o];let h;if(s.endsWith('"')&&o+1<t.length&&t[o+1].startsWith('"'))h=z(a);else if(h=D(a),""===h&&("object"!=typeof(n=a)||"function"!=typeof n[R]))throw new Error(`Unsupported parameter literal '${a}' at index: ${o}, type: ${typeof a}`);r[i++]=h}else if(o<t.length-1)throw new Error("Too few parameters supplied!")}var n;return k(r.join(""))},t.fluxBool=function(t){return new O("true"===t||"false"===t?t:(!!t).toString())},t.fluxDateTime=function(t){return new O(function(t){return`time(v: "${z(t)}")`}(t))},t.fluxDuration=function(t){return new O(`duration(v: "${z(t)}")`)},t.fluxExpression=k,t.fluxFloat=function(t){return new O(F(t))},t.fluxInteger=function(t){const e=String(t);for(const t of e)if(t<"0"||t>"9")throw new Error("not a flux integer: "+e);return new O(e)},t.fluxRegExp=function(t){return new O(I(t))},t.fluxString=function(t){return new O(`"${z(t)}"`)},t.getRetryDelay=c,t.isStatusCodeRetriable=a,t.linesToTables=y,t.newFluxTableColumn=o,t.sanitizeFloat=F,t.serializeDateTimeAsDate=function(){m["dateTime:RFC3339"]=t=>""===t?null:new Date(Date.parse(t))},t.serializeDateTimeAsNumber=function(){m["dateTime:RFC3339"]=t=>""===t?null:Date.parse(t)},t.serializeDateTimeAsString=function(){m["dateTime:RFC3339"]=t=>""===t?null:t},t.stringToLines=function(t,e){let r=!1,i=0,n=0;for(;n<t.length;){const o=t.charCodeAt(n);if(10===o){if(!r){const r=n>0&&13===t.charCodeAt(n-1)?n-1:n;e.next(t.substring(i,r)),i=n+1}}else 34===o&&(r=!r);n++}i<n&&e.next(t.substring(i,n)),e.complete()},t.symbolObservable=B,t.toFluxValue=D,t.typeSerializers=m,t.useProcessHrtime=function(t){return!1},Object.defineProperty(t,"__esModule",{value:!0})}(e)}));function fh(e){let r,i;return{c(){r=m("tspan"),i=v(e[0])},m(t,e){c(t,r,e),l(r,i)},p(t,[e]){1&e&&M(i,t[0])},i:t,o:t,d(t){t&&f(r)}}}function dh(t,e,r){let{url:i}=e,{token:n}=e,{organization:o}=e,{query:s}=e,a="No data";console.log(i,n,o,s);const h=new ch.InfluxDB({url:i,token:n}).getQueryApi(o);const u=setInterval((()=>{return t=s,void h.queryRows(t,{next(t,e){const i=e.toObject(t);i.example?r(0,a=i._value):r(0,a="No data")},error(t){r(0,a="No data")},complete(){}});var t}),500);return T((()=>{clearInterval(u)})),t.$$set=t=>{"url"in t&&r(1,i=t.url),"token"in t&&r(2,n=t.token),"organization"in t&&r(3,o=t.organization),"query"in t&&r(4,s=t.query)},[a,i,n,o,s]}class ph extends U{constructor(t){super(),Y(this,t,dh,fh,o,{url:1,token:2,organization:3,query:4})}}function mh(e){let r,i;return{c(){r=m("tspan"),i=v(e[0])},m(t,e){c(t,r,e),l(r,i)},p(t,[e]){1&e&&M(i,t[0])},i:t,o:t,d(t){t&&f(r)}}}function vh(t,e,r){let i="No data";const n=setInterval((()=>r(0,i=(100*Math.random()).toFixed(2))),500);return T((()=>{clearInterval(n)})),[i]}class _h extends U{constructor(t){super(),Y(this,t,vh,mh,o,{})}}function yh(t,e,r){const i=t.slice();return i[15]=e[r],i[17]=r,i}function gh(t,e,r){const i=t.slice();return i[15]=e[r],i[17]=r,i}function wh(t,e,r){const i=t.slice();return i[19]=e[r],i}function Mh(t){let e,r,i=t[4].scenes,n=[];for(let e=0;e<i.length;e+=1)n[e]=zh(gh(t,i,e));const o=t=>q(n[t],1,1,(()=>{n[t]=null}));return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=y()},m(t,i){for(let e=0;e<n.length;e+=1)n[e].m(t,i);c(t,e,i),r=!0},p(t,r){if(18&r){let s;for(i=t[4].scenes,s=0;s<i.length;s+=1){const o=gh(t,i,s);n[s]?(n[s].p(o,r),j(n[s],1)):(n[s]=zh(o),n[s].c(),j(n[s],1),n[s].m(e.parentNode,e))}for(H(),s=i.length;s<n.length;s+=1)o(s);N()}},i(t){if(!r){for(let t=0;t<i.length;t+=1)j(n[t]);r=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)q(n[t]);r=!1},d(t){d(n,t),t&&f(e)}}}function bh(e){let r,i,o,s,a,h,u,d,m,v,y,g;const M=[Th,Eh,xh],b=[];function x(t,e){return"data"==t[19].type?0:"scene"==t[19].type?1:"info"==t[19].type?2:-1}return~(i=x(e))&&(o=b[i]=M[i](e)),{c(){r=p("div"),o&&o.c(),s=_(),w(r,"data-scene-index",a=e[17]),w(r,"data-yaw",h=e[19].yaw),w(r,"data-pitch",u=e[19].pitch),w(r,"data-extra-transforms",d=e[19].extraTransforms)},m(o,a){var h;c(o,r,a),~i&&b[i].m(r,null),l(r,s),v=!0,y||(h=m=e[5].call(null,r),g=h&&n(h.destroy)?h.destroy:t,y=!0)},p(t,e){let n=i;i=x(t),i===n?~i&&b[i].p(t,e):(o&&(H(),q(b[n],1,1,(()=>{b[n]=null})),N()),~i?(o=b[i],o?o.p(t,e):(o=b[i]=M[i](t),o.c()),j(o,1),o.m(r,s)):o=null),(!v||16&e&&h!==(h=t[19].yaw))&&w(r,"data-yaw",h),(!v||16&e&&u!==(u=t[19].pitch))&&w(r,"data-pitch",u),(!v||16&e&&d!==(d=t[19].extraTransforms))&&w(r,"data-extra-transforms",d)},i(t){v||(j(o),v=!0)},o(t){q(o),v=!1},d(t){t&&f(r),~i&&b[i].d(),y=!1,g()}}}function xh(e){let r,i;return r=new st({}),{c(){V(r.$$.fragment)},m(t,e){$(r,t,e),i=!0},p:t,i(t){i||(j(r.$$.fragment,t),i=!0)},o(t){q(r.$$.fragment,t),i=!1},d(t){W(r,t)}}}function Eh(t){let e,r;function i(){return t[7](t[19])}return e=new ut({props:{func:i}}),{c(){V(e.$$.fragment)},m(t,i){$(e,t,i),r=!0},p(r,n){t=r;const o={};18&n&&(o.func=i),e.$set(o)},i(t){r||(j(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Th(t){let e,r;return e=new it({props:{type:t[19].dataType,value:252,$$slots:{default:[Rh],value:[Ph],title:[Sh]},$$scope:{ctx:t}}}),{c(){V(e.$$.fragment)},m(t,i){$(e,t,i),r=!0},p(t,r){const i={};16&r&&(i.type=t[19].dataType),4194320&r&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(t){r||(j(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Sh(t){let e,r,i=t[19].title+"";return{c(){e=m("tspan"),r=v(i),w(e,"slot","title")},m(t,i){c(t,e,i),l(e,r)},p(t,e){16&e&&i!==(i=t[19].title+"")&&M(r,i)},d(t){t&&f(e)}}}function Lh(t){let e,r,i,n="influx"==t[4].databases[t[19].data.database].type&&Ah(t),o="random"==t[4].databases[t[19].data.database].type&&Ch();return{c(){n&&n.c(),e=y(),o&&o.c(),r=y()},m(t,s){n&&n.m(t,s),c(t,e,s),o&&o.m(t,s),c(t,r,s),i=!0},p(t,i){"influx"==t[4].databases[t[19].data.database].type?n?(n.p(t,i),16&i&&j(n,1)):(n=Ah(t),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(H(),q(n,1,1,(()=>{n=null})),N()),"random"==t[4].databases[t[19].data.database].type?o?16&i&&j(o,1):(o=Ch(),o.c(),j(o,1),o.m(r.parentNode,r)):o&&(H(),q(o,1,1,(()=>{o=null})),N())},i(t){i||(j(n),j(o),i=!0)},o(t){q(n),q(o),i=!1},d(t){n&&n.d(t),t&&f(e),o&&o.d(t),t&&f(r)}}}function Ah(t){let e,r;return e=new ph({props:{url:t[4].databases[t[19].data.database].url??"",token:t[4].databases[t[19].data.database].token??"",organization:t[4].databases[t[19].data.database].organization??"",query:t[19].data.query??""}}),{c(){V(e.$$.fragment)},m(t,i){$(e,t,i),r=!0},p(t,r){const i={};16&r&&(i.url=t[4].databases[t[19].data.database].url??""),16&r&&(i.token=t[4].databases[t[19].data.database].token??""),16&r&&(i.organization=t[4].databases[t[19].data.database].organization??""),16&r&&(i.query=t[19].data.query??""),e.$set(i)},i(t){r||(j(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Ch(t){let e,r;return e=new _h({}),{c(){V(e.$$.fragment)},m(t,i){$(e,t,i),r=!0},i(t){r||(j(e.$$.fragment,t),r=!0)},o(t){q(e.$$.fragment,t),r=!1},d(t){W(e,t)}}}function Ph(t){let e,r,i=t[19].data.database&&t[4].databases&&t[4].databases[t[19].data.database]&&Lh(t);return{c(){e=m("tspan"),i&&i.c(),w(e,"slot","value")},m(t,n){c(t,e,n),i&&i.m(e,null),r=!0},p(t,r){t[19].data.database&&t[4].databases&&t[4].databases[t[19].data.database]?i?(i.p(t,r),16&r&&j(i,1)):(i=Lh(t),i.c(),j(i,1),i.m(e,null)):i&&(H(),q(i,1,1,(()=>{i=null})),N())},i(t){r||(j(i),r=!0)},o(t){q(i),r=!1},d(t){t&&f(e),i&&i.d()}}}function Rh(e){let r;return{c(){r=_()},m(t,e){c(t,r,e)},p:t,i:t,o:t,d(t){t&&f(r)}}}function Oh(t){let e,r,i=t[1]==t[17]&&bh(t);return{c(){i&&i.c(),e=y()},m(t,n){i&&i.m(t,n),c(t,e,n),r=!0},p(t,r){t[1]==t[17]?i?(i.p(t,r),2&r&&j(i,1)):(i=bh(t),i.c(),j(i,1),i.m(e.parentNode,e)):i&&(H(),q(i,1,1,(()=>{i=null})),N())},i(t){r||(j(i),r=!0)},o(t){q(i),r=!1},d(t){i&&i.d(t),t&&f(e)}}}function zh(t){let e,r,i=t[15].hotspots,n=[];for(let e=0;e<i.length;e+=1)n[e]=Oh(wh(t,i,e));const o=t=>q(n[t],1,1,(()=>{n[t]=null}));return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=y()},m(t,i){for(let e=0;e<n.length;e+=1)n[e].m(t,i);c(t,e,i),r=!0},p(t,r){if(18&r){let s;for(i=t[15].hotspots,s=0;s<i.length;s+=1){const o=wh(t,i,s);n[s]?(n[s].p(o,r),j(n[s],1)):(n[s]=Oh(o),n[s].c(),j(n[s],1),n[s].m(e.parentNode,e))}for(H(),s=i.length;s<n.length;s+=1)o(s);N()}},i(t){if(!r){for(let t=0;t<i.length;t+=1)j(n[t]);r=!0}},o(t){n=n.filter(Boolean);for(let t=0;t<n.length;t+=1)q(n[t]);r=!1},d(t){d(n,t),t&&f(e)}}}function Fh(t){let e,r,i,n,o,s,a,h,d,m,y=t[15].name+"";return{c(){e=p("li"),r=p("label"),i=p("input"),o=_(),s=v(y),h=_(),w(i,"type","radio"),i.__value=n=t[17],i.value=i.__value,w(i,"class","svelte-komer1"),t[10][0].push(i),w(r,"class",a=u(t[17]==t[1]?"active":"")+" svelte-komer1")},m(n,a){c(n,e,a),l(e,r),l(r,i),i.checked=i.__value===t[1],l(r,o),l(r,s),l(e,h),d||(m=g(i,"change",t[9]),d=!0)},p(t,e){2&e&&(i.checked=i.__value===t[1]),1&e&&y!==(y=t[15].name+"")&&M(s,y),2&e&&a!==(a=u(t[17]==t[1]?"active":"")+" svelte-komer1")&&w(r,"class",a)},d(r){r&&f(e),t[10][0].splice(t[10][0].indexOf(i),1),d=!1,m()}}}function Ih(t){let e,r,i,n,o,s,a,h=t[4]&&t[0].length>0&&Mh(t),u=t[0],m=[];for(let e=0;e<u.length;e+=1)m[e]=Fh(yh(t,u,e));return{c(){e=p("div"),r=p("div"),i=_(),h&&h.c(),n=_(),o=p("div"),s=p("ul");for(let t=0;t<m.length;t+=1)m[t].c();w(r,"class","panorama-container svelte-komer1"),w(s,"class","svelte-komer1"),w(o,"class","scene-list svelte-komer1")},m(u,f){c(u,e,f),l(e,r),t[6](r),l(e,i),h&&h.m(e,null),t[8](e),c(u,n,f),c(u,o,f),l(o,s);for(let t=0;t<m.length;t+=1)m[t].m(s,null);a=!0},p(t,[r]){if(t[4]&&t[0].length>0?h?(h.p(t,r),17&r&&j(h,1)):(h=Mh(t),h.c(),j(h,1),h.m(e,null)):h&&(H(),q(h,1,1,(()=>{h=null})),N()),3&r){let e;for(u=t[0],e=0;e<u.length;e+=1){const i=yh(t,u,e);m[e]?m[e].p(i,r):(m[e]=Fh(i),m[e].c(),m[e].m(s,null))}for(;e<m.length;e+=1)m[e].d(1);m.length=u.length}},i(t){a||(j(h),a=!0)},o(t){q(h),a=!1},d(r){r&&f(e),t[6](null),h&&h.d(),t[8](null),r&&f(n),r&&f(o),d(m,r)}}}function kh(t,e,r){var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}h((i=i.apply(t,e||[])).next())}))};let n,o,s,a=[],h=0;const u=window.location.href,l=u+"/config.json";var c;c=()=>i(void 0,void 0,void 0,(function*(){const t=new lh.Viewer(o);if(r(4,s=yield function(){return i(this,void 0,void 0,(function*(){return yield fetch(u+"/config.json").then((t=>t.json())).catch((t=>{console.warn("Failed to fetch config from "+l)}))}))}()),s&&s.scenes)for(const e of s.scenes){const i=lh.ImageUrlSource.fromString(u+e.url),n=new lh.EquirectGeometry([{width:4096}]),o=lh.RectilinearView.limit.traditional(1024,100*Math.PI/180),s=new lh.RectilinearView({yaw:0},o),h=t.createScene({source:i,geometry:n,view:s,pinFirstLevel:!0});r(0,a=[...a,{name:e.name,scene:h}])}o.addEventListener("click",(t=>{console.log(a[h].scene.view().screenToCoordinates({x:t.x,y:t.y}))}))})),E().$$.on_mount.push(c);return t.$$.update=()=>{3&t.$$.dirty&&null!=h&&a.length>0&&a[h].scene.switchTo()},[a,h,n,o,s,function(t){const e=t.dataset.sceneIndex;e&&a[Number(e)].scene.hotspotContainer().createHotspot(t,{yaw:Number(t.dataset.yaw),pitch:Number(t.dataset.pitch)},{perspective:{extraTransforms:"rotateZ(-0.5deg)"}})},function(t){L[t?"unshift":"push"]((()=>{o=t,r(3,o)}))},t=>{r(1,h=t.sceneIndex)},function(t){L[t?"unshift":"push"]((()=>{n=t,r(2,n)}))},function(){h=this.__value,r(1,h)},[[]]]}class Dh extends U{constructor(t){super(),Y(this,t,kh,Ih,o,{})}}function Bh(e){let r,i;return r=new Dh({}),{c(){V(r.$$.fragment)},m(t,e){$(r,t,e),i=!0},p:t,i(t){i||(j(r.$$.fragment,t),i=!0)},o(t){q(r.$$.fragment,t),i=!1},d(t){W(r,t)}}}return new class extends U{constructor(t){super(),Y(this,t,null,Bh,o,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
